!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("binaryen")):"function"==typeof define&&define.amd?define(["binaryen"],t):"object"==typeof exports?exports.assemblyscript=t(require("binaryen")):e.assemblyscript=t(e.binaryen)}("undefined"!=typeof self?self:this,(function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=17)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.IMPORT=1]="IMPORT",e[e.EXPORT=2]="EXPORT",e[e.DECLARE=4]="DECLARE",e[e.CONST=8]="CONST",e[e.LET=16]="LET",e[e.STATIC=32]="STATIC",e[e.READONLY=64]="READONLY",e[e.ABSTRACT=128]="ABSTRACT",e[e.PUBLIC=256]="PUBLIC",e[e.PRIVATE=512]="PRIVATE",e[e.PROTECTED=1024]="PROTECTED",e[e.GET=2048]="GET",e[e.SET=4096]="SET",e[e.DEFINITE_ASSIGNMENT=8192]="DEFINITE_ASSIGNMENT",e[e.AMBIENT=16384]="AMBIENT",e[e.GENERIC=32768]="GENERIC",e[e.GENERIC_CONTEXT=65536]="GENERIC_CONTEXT",e[e.INSTANCE=131072]="INSTANCE",e[e.CONSTRUCTOR=262144]="CONSTRUCTOR",e[e.MODULE_EXPORT=524288]="MODULE_EXPORT",e[e.MODULE_IMPORT=1048576]="MODULE_IMPORT",e[e.RESOLVED=2097152]="RESOLVED",e[e.COMPILED=4194304]="COMPILED",e[e.INLINED=8388608]="INLINED",e[e.SCOPED=16777216]="SCOPED",e[e.TRAMPOLINE=33554432]="TRAMPOLINE",e[e.VIRTUAL=67108864]="VIRTUAL",e[e.MAIN=134217728]="MAIN",e[e.QUOTED=268435456]="QUOTED"}(t.CommonFlags||(t.CommonFlags={})),t.PATH_DELIMITER="/",t.PARENT_SUBST="..",t.GETTER_PREFIX="get:",t.SETTER_PREFIX="set:",t.INSTANCE_DELIMITER="#",t.STATIC_DELIMITER=".",t.INNER_DELIMITER="~",t.LIBRARY_SUBST="~lib",t.LIBRARY_PREFIX=t.LIBRARY_SUBST+t.PATH_DELIMITER,t.INDEX_SUFFIX=t.PATH_DELIMITER+"index",function(e){e.EMPTY="",e.i8="i8",e.i16="i16",e.i32="i32",e.i64="i64",e.isize="isize",e.u8="u8",e.u16="u16",e.u32="u32",e.u64="u64",e.usize="usize",e.bool="bool",e.f32="f32",e.f64="f64",e.v128="v128",e.anyref="anyref",e.i8x16="i8x16",e.u8x16="u8x16",e.i16x8="i16x8",e.u16x8="u16x8",e.i32x4="i32x4",e.u32x4="u32x4",e.i64x2="i64x2",e.u64x2="u64x2",e.f32x4="f32x4",e.f64x2="f64x2",e.void_="void",e.number="number",e.boolean="boolean",e.string="string",e.native="native",e.indexof="indexof",e.valueof="valueof",e.returnof="returnof",e.null_="null",e.true_="true",e.false_="false",e.this_="this",e.super_="super",e.constructor="constructor",e.ASC_TARGET="ASC_TARGET",e.ASC_NO_TREESHAKING="ASC_NO_TREESHAKING",e.ASC_NO_ASSERT="ASC_NO_ASSERT",e.ASC_MEMORY_BASE="ASC_MEMORY_BASE",e.ASC_OPTIMIZE_LEVEL="ASC_OPTIMIZE_LEVEL",e.ASC_SHRINK_LEVEL="ASC_SHRINK_LEVEL",e.ASC_FEATURE_SIGN_EXTENSION="ASC_FEATURE_SIGN_EXTENSION",e.ASC_FEATURE_MUTABLE_GLOBALS="ASC_FEATURE_MUTABLE_GLOBALS",e.ASC_FEATURE_NONTRAPPING_F2I="ASC_FEATURE_NONTRAPPING_F2I",e.ASC_FEATURE_BULK_MEMORY="ASC_FEATURE_BULK_MEMORY",e.ASC_FEATURE_SIMD="ASC_FEATURE_SIMD",e.ASC_FEATURE_THREADS="ASC_FEATURE_THREADS",e.ASC_FEATURE_EXCEPTION_HANDLING="ASC_FEATURE_EXCEPTION_HANDLING",e.ASC_FEATURE_TAIL_CALLS="ASC_FEATURE_TAIL_CALLS",e.ASC_FEATURE_REFERENCE_TYPES="ASC_FEATURE_REFERENCE_TYPES",e.I8="I8",e.I16="I16",e.I32="I32",e.I64="I64",e.Isize="Isize",e.U8="U8",e.U16="U16",e.U32="U32",e.U64="U64",e.Usize="Usize",e.Bool="Bool",e.F32="F32",e.F64="F64",e.V128="V128",e.Anyref="Anyref",e.String="String",e.Array="Array",e.FixedArray="FixedArray",e.Set="Set",e.Map="Map",e.ArrayBufferView="ArrayBufferView",e.ArrayBuffer="ArrayBuffer",e.Math="Math",e.Mathf="Mathf",e.Int8Array="Int8Array",e.Int16Array="Int16Array",e.Int32Array="Int32Array",e.Int64Array="Int64Array",e.Uint8Array="Uint8Array",e.Uint8ClampedArray="Uint8ClampedArray",e.Uint16Array="Uint16Array",e.Uint32Array="Uint32Array",e.Uint64Array="Uint64Array",e.Float32Array="Float32Array",e.Float64Array="Float64Array",e.abort="abort",e.pow="pow",e.mod="mod",e.alloc="__alloc",e.realloc="__realloc",e.free="__free",e.retain="__retain",e.release="__release",e.collect="__collect",e.typeinfo="__typeinfo",e.instanceof_="__instanceof",e.visit="__visit",e.allocArray="__allocArray"}(t.CommonSymbols||(t.CommonSymbols={}));var n=r(25);t.Feature=n.Feature,t.featureToString=n.featureToString;var i=r(26);t.Target=i.Target;var s=r(27);t.Typeinfo=s.Typeinfo,t.TypeinfoFlags=s.TypeinfoFlags},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(29)),n(r(30)),n(r(31)),n(r(32)),n(r(33)),n(r(34)),t.isPowerOf2=function(e){return 0!=e&&0==(e&e-1)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(12),i=r(1);var s,a=r(12);function o(e){switch(e){case s.INFO:return"INFO";case s.WARNING:return"WARNING";case s.ERROR:return"ERROR";default:return assert(!1),""}}function l(e){switch(e){case s.INFO:return t.COLOR_BLUE;case s.WARNING:return t.COLOR_YELLOW;case s.ERROR:return t.COLOR_RED;default:return assert(!1),""}}t.DiagnosticCode=a.DiagnosticCode,t.diagnosticCodeToString=a.diagnosticCodeToString,function(e){e[e.INFO=0]="INFO",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR"}(s=t.DiagnosticCategory||(t.DiagnosticCategory={})),t.diagnosticCategoryToString=o,t.COLOR_BLUE="[96m",t.COLOR_YELLOW="[93m",t.COLOR_RED="[91m",t.COLOR_RESET="[0m",t.diagnosticCategoryToColor=l;class c{constructor(e,t,r){this.range=null,this.relatedRange=null,this.code=e,this.category=t,this.message=r}static create(e,t,r=null,i=null,s=null){var a=n.diagnosticCodeToString(e);return null!=r&&(a=a.replace("{0}",r)),null!=i&&(a=a.replace("{1}",i)),null!=s&&(a=a.replace("{2}",s)),new c(e,t,a)}static createInfo(e,t=null,r=null){return c.create(e,s.INFO,t,r)}static createWarning(e,t=null,r=null){return c.create(e,s.WARNING,t,r)}static createError(e,t=null,r=null){return c.create(e,s.ERROR,t,r)}withRange(e){return this.range=e,this}withRelatedRange(e){return this.relatedRange=e,this}toString(){return this.range?o(this.category)+" "+this.code.toString(10)+': "'+this.message+'" in '+this.range.source.normalizedPath+":"+this.range.line.toString(10)+":"+this.range.column.toString(10):o(this.category)+" "+this.code.toString(10)+": "+this.message}}function u(e,r=!1){for(var n=e.source.text,s=n.length,a=e.start,o=e.end;a>0&&!i.isLineBreak(n.charCodeAt(a-1));)a--;for(;o<s&&!i.isLineBreak(n.charCodeAt(o));)o++;for(var l=["\n ",n.substring(a,o),"\n "];a<e.start;)l.push(" "),a++;if(r&&l.push(t.COLOR_RED),e.start==e.end)l.push("^");else for(;a++<e.end;){if(i.isLineBreak(n.charCodeAt(a))){l.push(a==e.start+1?"^":"~");break}l.push("~")}return r&&l.push(t.COLOR_RESET),l.join("")}t.DiagnosticMessage=c,t.formatDiagnosticMessage=function(e,r=!1,n=!1){var i=[];if(r&&i.push(l(e.category)),i.push(o(e.category)),r&&i.push(t.COLOR_RESET),i.push(e.code<1e3?" AS":" TS"),i.push(e.code.toString(10)),i.push(": "),i.push(e.message),e.range){let t=e.range;n&&(i.push("\n"),i.push(u(t,r))),i.push("\n"),i.push(" in "),i.push(t.source.normalizedPath),i.push("("),i.push(t.line.toString(10)),i.push(","),i.push(t.column.toString(10)),i.push(")");let s=e.relatedRange;s&&(n&&(i.push("\n"),i.push(u(s,r))),i.push("\n"),i.push(" in "),i.push(s.source.normalizedPath),i.push("("),i.push(s.line.toString(10)),i.push(","),i.push(s.column.toString(10)),i.push(")"))}return i.join("")},t.formatDiagnosticContext=u;t.DiagnosticEmitter=class{constructor(e=null){this.diagnostics=e||new Array}emitDiagnostic(e,t,r,n,i=null,s=null,a=null){var o=c.create(e,t,i,s,a).withRange(r);n&&(o.relatedRange=n),this.diagnostics.push(o)}info(e,t,r=null,n=null,i=null){this.emitDiagnostic(e,s.INFO,t,null,r,n,i)}infoRelated(e,t,r,n=null,i=null,a=null){this.emitDiagnostic(e,s.INFO,t,r,n,i,a)}warning(e,t,r=null,n=null,i=null){this.emitDiagnostic(e,s.WARNING,t,null,r,n,i)}warningRelated(e,t,r,n=null,i=null,a=null){this.emitDiagnostic(e,s.WARNING,t,r,n,i,a)}error(e,t,r=null,n=null,i=null){this.emitDiagnostic(e,s.ERROR,t,null,r,n,i)}errorRelated(e,t,r,n=null,i=null,a=null){this.emitDiagnostic(e,s.ERROR,t,r,n,i,a)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(7);t.Token=i.Token,t.Range=i.Range;const s=r(1);var a,o,l,c;!function(e){e[e.SOURCE=0]="SOURCE",e[e.NAMEDTYPE=1]="NAMEDTYPE",e[e.FUNCTIONTYPE=2]="FUNCTIONTYPE",e[e.TYPENAME=3]="TYPENAME",e[e.TYPEPARAMETER=4]="TYPEPARAMETER",e[e.PARAMETER=5]="PARAMETER",e[e.IDENTIFIER=6]="IDENTIFIER",e[e.ASSERTION=7]="ASSERTION",e[e.BINARY=8]="BINARY",e[e.CALL=9]="CALL",e[e.CLASS=10]="CLASS",e[e.COMMA=11]="COMMA",e[e.ELEMENTACCESS=12]="ELEMENTACCESS",e[e.FALSE=13]="FALSE",e[e.FUNCTION=14]="FUNCTION",e[e.INSTANCEOF=15]="INSTANCEOF",e[e.LITERAL=16]="LITERAL",e[e.NEW=17]="NEW",e[e.NULL=18]="NULL",e[e.PARENTHESIZED=19]="PARENTHESIZED",e[e.PROPERTYACCESS=20]="PROPERTYACCESS",e[e.TERNARY=21]="TERNARY",e[e.SUPER=22]="SUPER",e[e.THIS=23]="THIS",e[e.TRUE=24]="TRUE",e[e.CONSTRUCTOR=25]="CONSTRUCTOR",e[e.UNARYPOSTFIX=26]="UNARYPOSTFIX",e[e.UNARYPREFIX=27]="UNARYPREFIX",e[e.BLOCK=28]="BLOCK",e[e.BREAK=29]="BREAK",e[e.CONTINUE=30]="CONTINUE",e[e.DO=31]="DO",e[e.EMPTY=32]="EMPTY",e[e.EXPORT=33]="EXPORT",e[e.EXPORTDEFAULT=34]="EXPORTDEFAULT",e[e.EXPORTIMPORT=35]="EXPORTIMPORT",e[e.EXPRESSION=36]="EXPRESSION",e[e.FOR=37]="FOR",e[e.IF=38]="IF",e[e.IMPORT=39]="IMPORT",e[e.RETURN=40]="RETURN",e[e.SWITCH=41]="SWITCH",e[e.THROW=42]="THROW",e[e.TRY=43]="TRY",e[e.VARIABLE=44]="VARIABLE",e[e.VOID=45]="VOID",e[e.WHILE=46]="WHILE",e[e.CLASSDECLARATION=47]="CLASSDECLARATION",e[e.ENUMDECLARATION=48]="ENUMDECLARATION",e[e.ENUMVALUEDECLARATION=49]="ENUMVALUEDECLARATION",e[e.FIELDDECLARATION=50]="FIELDDECLARATION",e[e.FUNCTIONDECLARATION=51]="FUNCTIONDECLARATION",e[e.IMPORTDECLARATION=52]="IMPORTDECLARATION",e[e.INDEXSIGNATUREDECLARATION=53]="INDEXSIGNATUREDECLARATION",e[e.INTERFACEDECLARATION=54]="INTERFACEDECLARATION",e[e.METHODDECLARATION=55]="METHODDECLARATION",e[e.NAMESPACEDECLARATION=56]="NAMESPACEDECLARATION",e[e.TYPEDECLARATION=57]="TYPEDECLARATION",e[e.VARIABLEDECLARATION=58]="VARIABLEDECLARATION",e[e.DECORATOR=59]="DECORATOR",e[e.EXPORTMEMBER=60]="EXPORTMEMBER",e[e.SWITCHCASE=61]="SWITCHCASE",e[e.COMMENT=62]="COMMENT"}(a=t.NodeKind||(t.NodeKind={})),t.nodeIsConstantValue=function(e){switch(e){case a.LITERAL:case a.NULL:case a.TRUE:case a.FALSE:return!0}return!1},t.nodeIsCallable=function(e){switch(e){case a.IDENTIFIER:case a.ASSERTION:case a.CALL:case a.ELEMENTACCESS:case a.PARENTHESIZED:case a.PROPERTYACCESS:case a.SUPER:return!0}return!1},t.nodeIsGenericCallable=function(e){switch(e){case a.IDENTIFIER:case a.PROPERTYACCESS:return!0}return!1};class u{static createTypeName(e,t){var r=new _;return r.range=t,r.identifier=e,r.next=null,r}static createSimpleTypeName(e,t){return u.createTypeName(u.createIdentifierExpression(e,t),t)}static createNamedType(e,t,r,n){var i=new h;return i.range=n,i.name=e,i.typeArguments=t,i.isNullable=r,i}static createFunctionType(e,t,r,n,i){var s=new d;return s.range=i,s.parameters=e,s.returnType=t,s.explicitThisType=r,s.isNullable=n,s}static createOmittedType(e){return u.createNamedType(u.createSimpleTypeName("",e),null,!1,e)}static createTypeParameter(e,t,r,n){var i=new y;return i.range=n,i.name=e,i.extendsType=t,i.defaultType=r,i}static createParameter(e,t,r,n,i){var s=new T;return s.range=i,s.name=e,s.type=t,s.initializer=r,s.parameterKind=n,s}static createDecorator(e,t,r){var n=new m;return n.range=r,n.name=e,n.arguments=t,n.decoratorKind=o.fromNode(e),n}static createComment(e,t,r){var n=new g;return n.range=r,n.commentKind=t,n.text=e,n}static createIdentifierExpression(e,t,r=!1){var n=new f;return n.range=t,n.text=e,n.symbol=e,n.isQuoted=r,n}static createEmptyIdentifierExpression(e){var t=new f;return t.range=e,t.text="",t}static createArrayLiteralExpression(e,t){var r=new x;return r.range=t,r.elementExpressions=e,r}static createAssertionExpression(e,t,r,n){var i=new b;return i.range=n,i.assertionKind=e,i.expression=t,i.toType=r,i}static createBinaryExpression(e,t,r,n){var i=new A;return i.range=n,i.operator=e,i.left=t,i.right=r,i}static createCallExpression(e,t,r,n){var i=new N;return i.range=n,i.expression=e,i.typeArguments=t,i.arguments=r,i}static createClassExpression(e){var t=new S;return t.range=e.range,t.declaration=e,t}static createCommaExpression(e,t){var r=new C;return r.range=t,r.expressions=e,r}static createConstructorExpression(e){var t=new O;return t.range=e,t}static createElementAccessExpression(e,t,r){var n=new v;return n.range=r,n.expression=e,n.elementExpression=t,n}static createFalseExpression(e){var t=new H;return t.range=e,t}static createFloatLiteralExpression(e,t){var r=new R;return r.range=t,r.value=e,r}static createFunctionExpression(e){var t=new L;return t.range=e.range,t.declaration=e,t}static createInstanceOfExpression(e,t,r){var n=new k;return n.range=r,n.expression=e,n.isType=t,n}static createIntegerLiteralExpression(e,t){var r=new F;return r.range=t,r.value=e,r}static createNewExpression(e,t,r,n){var i=new B;return i.range=n,i.expression=e,i.typeArguments=t,i.arguments=r,i}static createNullExpression(e){var t=new D;return t.range=e,t}static createObjectLiteralExpression(e,t,r){var n=new U;return n.range=r,n.names=e,n.values=t,n}static createParenthesizedExpression(e,t){var r=new P;return r.range=t,r.expression=e,r}static createPropertyAccessExpression(e,t,r){var n=new w;return n.range=r,n.expression=e,n.property=t,n}static createRegexpLiteralExpression(e,t,r){var n=new M;return n.range=r,n.pattern=e,n.patternFlags=t,n}static createTernaryExpression(e,t,r,n){var i=new G;return i.range=n,i.condition=e,i.ifThen=t,i.ifElse=r,i}static createStringLiteralExpression(e,t){var r=new V;return r.range=t,r.value=e,r}static createSuperExpression(e){var t=new K;return t.range=e,t}static createThisExpression(e){var t=new z;return t.range=e,t}static createTrueExpression(e){var t=new Y;return t.range=e,t}static createUnaryPostfixExpression(e,t,r){var n=new X;return n.range=r,n.operator=e,n.operand=t,n}static createUnaryPrefixExpression(e,t,r){var n=new q;return n.range=r,n.operator=e,n.operand=t,n}static createBlockStatement(e,t){var r=new $;return r.range=t,r.statements=e,r}static createBreakStatement(e,t){var r=new ee;return r.range=t,r.label=e,r}static createClassDeclaration(e,t,r,n,i,s,a,o){var l=new te;return l.range=o,l.flags=a,l.name=e,l.typeParameters=t,l.extendsType=r,l.implementsTypes=n,l.members=i,l.decorators=s,l}static createContinueStatement(e,t){var r=new re;return r.range=t,r.label=e,r}static createDoStatement(e,t,r){var n=new ne;return n.range=r,n.statement=e,n.condition=t,n}static createEmptyStatement(e){var t=new ie;return t.range=e,t}static createEnumDeclaration(e,t,r,n,i){var s=new se;return s.range=i,s.flags=n,s.name=e,s.values=t,s.decorators=r,s}static createEnumValueDeclaration(e,t,r,n){var i=new ae;return i.range=n,i.flags=r,i.name=e,i.value=t,i}static createExportStatement(e,t,r,i){var a=new ce;if(a.range=i,a.members=e,a.path=t,t){let e=s.normalizePath(t.value);t.value.startsWith(".")?e=s.resolvePath(e,i.source.internalPath):e.startsWith(n.LIBRARY_PREFIX)||(e=n.LIBRARY_PREFIX+e),a.internalPath=Le(e)}else a.internalPath=null;return a.isDeclare=r,a}static createExportDefaultStatement(e,t){var r=new ue;return r.declaration=e,r.range=t,r}static createExportImportStatement(e,t,r){var n=new oe;return n.range=r,n.name=e,n.externalName=t,n}static createExportMember(e,t,r){var n=new le;return n.range=r,n.localName=e,t||(t=e),n.exportedName=t,n}static createExpressionStatement(e){var t=new pe;return t.range=e.range,t.expression=e,t}static createIfStatement(e,t,r,n){var i=new ye;return i.range=n,i.condition=e,i.ifTrue=t,i.ifFalse=r,i}static createImportStatement(e,t,r){var i=new me;i.range=r,i.declarations=e,i.namespaceName=null,i.path=t;var a=s.normalizePath(t.value);return t.value.startsWith(".")?a=s.resolvePath(a,r.source.internalPath):a.startsWith(n.LIBRARY_PREFIX)||(a=n.LIBRARY_PREFIX+a),i.internalPath=Le(a),i}static createImportStatementWithWildcard(e,t,r){var i=new me;i.range=r,i.declarations=null,i.namespaceName=e,i.path=t;var a=s.normalizePath(t.value);return t.value.startsWith(".")?a=s.resolvePath(a,r.source.internalPath):a.startsWith(n.LIBRARY_PREFIX)||(a=n.LIBRARY_PREFIX+a),i.internalPath=Le(a),i}static createImportDeclaration(e,t,r){var n=new Te;return n.range=r,n.foreignName=e,t||(t=e),n.name=t,n}static createInterfaceDeclaration(e,t,r,n,i,s,a){var o=new ge;return o.range=a,o.flags=s,o.name=e,o.typeParameters=t,o.extendsType=r,o.members=n,o.decorators=i,o}static createFieldDeclaration(e,t,r,n,i,s){var a=new _e;return a.range=s,a.flags=i,a.name=e,a.type=t,a.initializer=r,a.decorators=n,a}static createForStatement(e,t,r,n,i){var s=new he;return s.range=i,s.initializer=e,s.condition=t,s.incrementor=r,s.statement=n,s}static createFunctionDeclaration(e,t,r,n,i,s,a,o){var l=new de;return l.range=o,l.flags=s,l.name=e,l.typeParameters=t,l.signature=r,l.body=n,l.decorators=i,l.arrowKind=a,l}static createIndexSignatureDeclaration(e,t,r){var n=new Z;return n.range=r,n.keyType=e,n.valueType=t,n}static createMethodDeclaration(e,t,r,n,i,s,a){var o=new Ee;return o.range=a,o.flags=s,o.name=e,o.typeParameters=t,o.signature=r,o.body=n,o.decorators=i,o}static createNamespaceDeclaration(e,t,r,n,i){var s=new fe;return s.range=i,s.flags=n,s.name=e,s.members=t,s.decorators=r,s}static createReturnStatement(e,t){var r=new Ie;return r.range=t,r.value=e,r}static createSwitchStatement(e,t,r){var n=new be;return n.range=r,n.condition=e,n.cases=t,n}static createSwitchCase(e,t,r){var n=new xe;return n.range=r,n.label=e,n.statements=t,n}static createThrowStatement(e,t){var r=new Ae;return r.range=t,r.value=e,r}static createTryStatement(e,t,r,n,i){var s=new Ne;return s.range=i,s.statements=e,s.catchVariable=t,s.catchStatements=r,s.finallyStatements=n,s}static createTypeDeclaration(e,t,r,n,i,s){var a=new Se;return a.range=s,a.flags=i,a.name=e,a.typeParameters=t,a.type=r,a.decorators=n,a}static createVariableStatement(e,t,r){var n=new Oe;return n.range=r,n.declarations=e,n.decorators=t,n}static createVariableDeclaration(e,t,r,n,i,s){var a=new Ce;return a.range=s,a.flags=i,a.name=e,a.type=t,a.initializer=r,a.decorators=n,a}static createVoidStatement(e,t){var r=new ve;return r.range=t,r.expression=e,r}static createWhileStatement(e,t,r){var n=new Re;return n.range=r,n.condition=e,n.statement=t,n}}t.Node=u;class p extends u{hasGenericComponent(e){if(this.kind==a.NAMEDTYPE){if(!this.name.next){let t=this.typeArguments;if(null!==t&&t.length){for(let r=0,n=t.length;r<n;++r)if(t[r].hasGenericComponent(e))return!0}else{let t=this.name.identifier.text;for(let r=0,n=e.length;r<n;++r)if(e[r].name.text==t)return!0}}}else if(this.kind==a.FUNCTIONTYPE){let t=this.parameters;for(let r=0,n=t.length;r<n;++r)if(t[r].type.hasGenericComponent(e))return!0;if(this.returnType.hasGenericComponent(e))return!0;let r=this.explicitThisType;if(null!==r&&r.hasGenericComponent(e))return!0}else assert(!1);return!1}}t.TypeNode=p;class _ extends u{constructor(){super(...arguments),this.kind=a.TYPENAME}}t.TypeName=_;class h extends p{constructor(){super(...arguments),this.kind=a.NAMEDTYPE}}t.NamedTypeNode=h;class d extends p{constructor(){super(...arguments),this.kind=a.FUNCTIONTYPE}}t.FunctionTypeNode=d;class y extends u{constructor(){super(...arguments),this.kind=a.TYPEPARAMETER}}t.TypeParameterNode=y,function(e){e[e.DEFAULT=0]="DEFAULT",e[e.OPTIONAL=1]="OPTIONAL",e[e.REST=2]="REST"}(t.ParameterKind||(t.ParameterKind={}));class T extends u{constructor(){super(...arguments),this.kind=a.PARAMETER,this.implicitFieldDeclaration=null,this.flags=n.CommonFlags.NONE}is(e){return(this.flags&e)==e}isAny(e){return 0!=(this.flags&e)}set(e){this.flags|=e}}t.ParameterNode=T,function(e){e[e.CUSTOM=0]="CUSTOM",e[e.GLOBAL=1]="GLOBAL",e[e.OPERATOR=2]="OPERATOR",e[e.OPERATOR_BINARY=3]="OPERATOR_BINARY",e[e.OPERATOR_PREFIX=4]="OPERATOR_PREFIX",e[e.OPERATOR_POSTFIX=5]="OPERATOR_POSTFIX",e[e.UNMANAGED=6]="UNMANAGED",e[e.SEALED=7]="SEALED",e[e.INLINE=8]="INLINE",e[e.EXTERNAL=9]="EXTERNAL",e[e.BUILTIN=10]="BUILTIN",e[e.LAZY=11]="LAZY",e[e.UNSAFE=12]="UNSAFE"}(o=t.DecoratorKind||(t.DecoratorKind={})),function(e){e.fromNode=function(t){if(t.kind==a.IDENTIFIER){let r=t.text;switch(assert(r.length),r.charCodeAt(0)){case 98:if("builtin"==r)return e.BUILTIN;break;case 101:if("external"==r)return e.EXTERNAL;break;case 103:if("global"==r)return e.GLOBAL;break;case 105:if("inline"==r)return e.INLINE;break;case 108:if("lazy"==r)return e.LAZY;break;case 111:if("operator"==r)return e.OPERATOR;break;case 115:if("sealed"==r)return e.SEALED;break;case 117:if("unmanaged"==r)return e.UNMANAGED;if("unsafe"==r)return e.UNSAFE}}else if(t.kind==a.PROPERTYACCESS&&t.expression.kind==a.IDENTIFIER){let r=t.expression.text;assert(r.length);let n=t.property.text;if(assert(n.length),"operator"==r)switch(n.charCodeAt(0)){case 98:if("binary"==n)return e.OPERATOR_BINARY;break;case 112:switch(n){case"prefix":return e.OPERATOR_PREFIX;case"postfix":return e.OPERATOR_POSTFIX}}}return e.CUSTOM}}(o=t.DecoratorKind||(t.DecoratorKind={}));class m extends u{constructor(){super(...arguments),this.kind=a.DECORATOR}}t.DecoratorNode=m,function(e){e[e.LINE=0]="LINE",e[e.TRIPLE=1]="TRIPLE",e[e.BLOCK=2]="BLOCK"}(t.CommentKind||(t.CommentKind={}));class g extends u{constructor(){super(...arguments),this.kind=a.COMMENT}}t.CommentNode=g;class E extends u{}t.Expression=E;class f extends E{constructor(){super(...arguments),this.kind=a.IDENTIFIER}}t.IdentifierExpression=f,function(e){e[e.FLOAT=0]="FLOAT",e[e.INTEGER=1]="INTEGER",e[e.STRING=2]="STRING",e[e.REGEXP=3]="REGEXP",e[e.ARRAY=4]="ARRAY",e[e.OBJECT=5]="OBJECT"}(l=t.LiteralKind||(t.LiteralKind={})),t.isNumericLiteral=function(e){if(e.kind==a.LITERAL)switch(e.literalKind){case l.FLOAT:case l.INTEGER:return!0}return!1};class I extends E{constructor(){super(...arguments),this.kind=a.LITERAL}}t.LiteralExpression=I;class x extends I{constructor(){super(...arguments),this.literalKind=l.ARRAY}}t.ArrayLiteralExpression=x,function(e){e[e.PREFIX=0]="PREFIX",e[e.AS=1]="AS",e[e.NONNULL=2]="NONNULL"}(t.AssertionKind||(t.AssertionKind={}));class b extends E{constructor(){super(...arguments),this.kind=a.ASSERTION}}t.AssertionExpression=b;class A extends E{constructor(){super(...arguments),this.kind=a.BINARY}}t.BinaryExpression=A;class N extends E{constructor(){super(...arguments),this.kind=a.CALL}get typeArgumentsRange(){var e,t=this.typeArguments;return t&&(e=t.length)?i.Range.join(t[0].range,t[e-1].range):this.expression.range}get argumentsRange(){var e=this.arguments,t=e.length;return t?i.Range.join(e[0].range,e[t-1].range):this.expression.range}}t.CallExpression=N;class S extends E{constructor(){super(...arguments),this.kind=a.CLASS}}t.ClassExpression=S;class C extends E{constructor(){super(...arguments),this.kind=a.COMMA}}t.CommaExpression=C;class O extends f{constructor(){super(...arguments),this.kind=a.CONSTRUCTOR,this.text="constructor",this.symbol=n.CommonSymbols.constructor}}t.ConstructorExpression=O;class v extends E{constructor(){super(...arguments),this.kind=a.ELEMENTACCESS}}t.ElementAccessExpression=v;class R extends I{constructor(){super(...arguments),this.literalKind=l.FLOAT}}t.FloatLiteralExpression=R;class L extends E{constructor(){super(...arguments),this.kind=a.FUNCTION}}t.FunctionExpression=L;class k extends E{constructor(){super(...arguments),this.kind=a.INSTANCEOF}}t.InstanceOfExpression=k;class F extends I{constructor(){super(...arguments),this.literalKind=l.INTEGER}}t.IntegerLiteralExpression=F;class B extends N{constructor(){super(...arguments),this.kind=a.NEW}}t.NewExpression=B;class D extends f{constructor(){super(...arguments),this.kind=a.NULL,this.text="null",this.symbol=n.CommonSymbols.null_}}t.NullExpression=D;class U extends I{constructor(){super(...arguments),this.literalKind=l.OBJECT}}t.ObjectLiteralExpression=U;class P extends E{constructor(){super(...arguments),this.kind=a.PARENTHESIZED}}t.ParenthesizedExpression=P;class w extends E{constructor(){super(...arguments),this.kind=a.PROPERTYACCESS}}t.PropertyAccessExpression=w;class M extends I{constructor(){super(...arguments),this.literalKind=l.REGEXP}}t.RegexpLiteralExpression=M;class G extends E{constructor(){super(...arguments),this.kind=a.TERNARY}}t.TernaryExpression=G;class V extends I{constructor(){super(...arguments),this.literalKind=l.STRING}}t.StringLiteralExpression=V;class K extends f{constructor(){super(...arguments),this.kind=a.SUPER,this.text="super",this.symbol=n.CommonSymbols.super_}}t.SuperExpression=K;class z extends f{constructor(){super(...arguments),this.kind=a.THIS,this.text="this",this.symbol=n.CommonSymbols.this_}}t.ThisExpression=z;class Y extends f{constructor(){super(...arguments),this.kind=a.TRUE,this.text="true",this.symbol=n.CommonSymbols.true_}}t.TrueExpression=Y;class H extends f{constructor(){super(...arguments),this.kind=a.FALSE,this.text="false",this.symbol=n.CommonSymbols.false_}}t.FalseExpression=H;class W extends E{}t.UnaryExpression=W;class X extends W{constructor(){super(...arguments),this.kind=a.UNARYPOSTFIX}}t.UnaryPostfixExpression=X;class q extends W{constructor(){super(...arguments),this.kind=a.UNARYPREFIX}}t.UnaryPrefixExpression=q;class Q extends u{}t.Statement=Q,function(e){e[e.USER=0]="USER",e[e.USER_ENTRY=1]="USER_ENTRY",e[e.LIBRARY=2]="LIBRARY",e[e.LIBRARY_ENTRY=3]="LIBRARY_ENTRY"}(c=t.SourceKind||(t.SourceKind={}));t.Source=class extends u{constructor(e,t,r){super(),this.kind=a.SOURCE,this.parent=null,this.tokenizer=null,this.debugInfoIndex=-1,this.exportPaths=null,this.sourceKind=r,this.normalizedPath=e;var s=Le(this.normalizedPath);this.internalPath=s;var o=s.lastIndexOf(n.PATH_DELIMITER);this.simplePath=o>=0?s.substring(o+1):s,this.statements=new Array,this.range=new i.Range(this,0,t.length),this.text=t}get isNative(){return this.internalPath==n.LIBRARY_SUBST}get isLibrary(){var e=this.sourceKind;return e==c.LIBRARY||e==c.LIBRARY_ENTRY}};class j extends Q{constructor(){super(...arguments),this.decorators=null,this.flags=n.CommonFlags.NONE}is(e){return(this.flags&e)==e}isAny(e){return 0!=(this.flags&e)}set(e){this.flags|=e}}t.DeclarationStatement=j;class Z extends j{constructor(){super(...arguments),this.kind=a.INDEXSIGNATUREDECLARATION}}t.IndexSignatureDeclaration=Z;class J extends j{}t.VariableLikeDeclarationStatement=J;class $ extends Q{constructor(){super(...arguments),this.kind=a.BLOCK}}t.BlockStatement=$;class ee extends Q{constructor(){super(...arguments),this.kind=a.BREAK}}t.BreakStatement=ee;class te extends j{constructor(){super(...arguments),this.kind=a.CLASSDECLARATION}get isGeneric(){var e=this.typeParameters;return null!=e&&e.length>0}}t.ClassDeclaration=te;class re extends Q{constructor(){super(...arguments),this.kind=a.CONTINUE}}t.ContinueStatement=re;class ne extends Q{constructor(){super(...arguments),this.kind=a.DO}}t.DoStatement=ne;class ie extends Q{constructor(){super(...arguments),this.kind=a.EMPTY}}t.EmptyStatement=ie;class se extends j{constructor(){super(...arguments),this.kind=a.ENUMDECLARATION}}t.EnumDeclaration=se;class ae extends J{constructor(){super(...arguments),this.kind=a.ENUMVALUEDECLARATION}}t.EnumValueDeclaration=ae;class oe extends u{constructor(){super(...arguments),this.kind=a.EXPORTIMPORT}}t.ExportImportStatement=oe;class le extends u{constructor(){super(...arguments),this.kind=a.EXPORTMEMBER}}t.ExportMember=le;class ce extends Q{constructor(){super(...arguments),this.kind=a.EXPORT}}t.ExportStatement=ce;class ue extends Q{constructor(){super(...arguments),this.kind=a.EXPORTDEFAULT}}t.ExportDefaultStatement=ue;class pe extends Q{constructor(){super(...arguments),this.kind=a.EXPRESSION}}t.ExpressionStatement=pe;class _e extends J{constructor(){super(...arguments),this.kind=a.FIELDDECLARATION,this.parameterIndex=-1}}t.FieldDeclaration=_e;class he extends Q{constructor(){super(...arguments),this.kind=a.FOR}}t.ForStatement=he,function(e){e[e.NONE=0]="NONE",e[e.ARROW_PARENTHESIZED=1]="ARROW_PARENTHESIZED",e[e.ARROW_SINGLE=2]="ARROW_SINGLE"}(t.ArrowKind||(t.ArrowKind={}));class de extends j{constructor(){super(...arguments),this.kind=a.FUNCTIONDECLARATION}get isGeneric(){var e=this.typeParameters;return null!=e&&e.length>0}clone(){return u.createFunctionDeclaration(this.name,this.typeParameters,this.signature,this.body,this.decorators,this.flags,this.arrowKind,this.range)}}t.FunctionDeclaration=de;class ye extends Q{constructor(){super(...arguments),this.kind=a.IF}}t.IfStatement=ye;class Te extends j{constructor(){super(...arguments),this.kind=a.IMPORTDECLARATION}}t.ImportDeclaration=Te;class me extends Q{constructor(){super(...arguments),this.kind=a.IMPORT}}t.ImportStatement=me;class ge extends te{constructor(){super(...arguments),this.kind=a.INTERFACEDECLARATION}}t.InterfaceDeclaration=ge;class Ee extends de{constructor(){super(...arguments),this.kind=a.METHODDECLARATION}}t.MethodDeclaration=Ee;class fe extends j{constructor(){super(...arguments),this.kind=a.NAMESPACEDECLARATION}}t.NamespaceDeclaration=fe;class Ie extends Q{constructor(){super(...arguments),this.kind=a.RETURN}}t.ReturnStatement=Ie;class xe extends u{constructor(){super(...arguments),this.kind=a.SWITCHCASE}}t.SwitchCase=xe;class be extends Q{constructor(){super(...arguments),this.kind=a.SWITCH}}t.SwitchStatement=be;class Ae extends Q{constructor(){super(...arguments),this.kind=a.THROW}}t.ThrowStatement=Ae;class Ne extends Q{constructor(){super(...arguments),this.kind=a.TRY}}t.TryStatement=Ne;class Se extends j{constructor(){super(...arguments),this.kind=a.TYPEDECLARATION}}t.TypeDeclaration=Se;class Ce extends J{constructor(){super(...arguments),this.kind=a.VARIABLEDECLARATION}}t.VariableDeclaration=Ce;class Oe extends Q{constructor(){super(...arguments),this.kind=a.VARIABLE}}t.VariableStatement=Oe;class ve extends Q{constructor(){super(...arguments),this.kind=a.VOID}}t.VoidStatement=ve;class Re extends Q{constructor(){super(...arguments),this.kind=a.WHILE}}function Le(e){return e.endsWith(".ts")&&(e=e.substring(0,e.length-3)),e}t.WhileStatement=Re,t.findDecorator=function(e,t){if(t)for(let r=0,n=t.length;r<n;++r){let n=t[r];if(n.decoratorKind==e)return n}return null},t.mangleInternalPath=Le,t.isTypeOmitted=function(e){if(e.kind==a.NAMEDTYPE){let t=e.name;return!(t.next||t.identifier.text.length)}return!1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(2),s=r(6),a=r(3),o=r(1),l=r(9),c=r(10);class u{constructor(e,t,r,n,i){this.localFile=e,this.localIdentifier=t,this.foreignIdentifier=r,this.foreignPath=n,this.foreignPathAlt=i}}class p{constructor(e,t,r,n){this.localIdentifier=e,this.foreignIdentifier=t,this.foreignPath=r,this.foreignPathAlt=n}}class _{constructor(e,t,r){this.foreignPath=e,this.foreignPathAlt=t,this.pathLiteral=r}}var h,d,y;!function(e){e[e.INVALID=0]="INVALID",e[e.INDEXED_GET=1]="INDEXED_GET",e[e.INDEXED_SET=2]="INDEXED_SET",e[e.UNCHECKED_INDEXED_GET=3]="UNCHECKED_INDEXED_GET",e[e.UNCHECKED_INDEXED_SET=4]="UNCHECKED_INDEXED_SET",e[e.ADD=5]="ADD",e[e.SUB=6]="SUB",e[e.MUL=7]="MUL",e[e.DIV=8]="DIV",e[e.REM=9]="REM",e[e.POW=10]="POW",e[e.BITWISE_AND=11]="BITWISE_AND",e[e.BITWISE_OR=12]="BITWISE_OR",e[e.BITWISE_XOR=13]="BITWISE_XOR",e[e.BITWISE_SHL=14]="BITWISE_SHL",e[e.BITWISE_SHR=15]="BITWISE_SHR",e[e.BITWISE_SHR_U=16]="BITWISE_SHR_U",e[e.EQ=17]="EQ",e[e.NE=18]="NE",e[e.GT=19]="GT",e[e.GE=20]="GE",e[e.LT=21]="LT",e[e.LE=22]="LE",e[e.PLUS=23]="PLUS",e[e.MINUS=24]="MINUS",e[e.NOT=25]="NOT",e[e.BITWISE_NOT=26]="BITWISE_NOT",e[e.PREFIX_INC=27]="PREFIX_INC",e[e.PREFIX_DEC=28]="PREFIX_DEC",e[e.POSTFIX_INC=29]="POSTFIX_INC",e[e.POSTFIX_DEC=30]="POSTFIX_DEC"}(h=t.OperatorKind||(t.OperatorKind={})),function(e){e.fromDecorator=function(t,r){switch(assert(r.length),t){case a.DecoratorKind.OPERATOR:case a.DecoratorKind.OPERATOR_BINARY:switch(r.charCodeAt(0)){case 91:if("[]"==r)return e.INDEXED_GET;if("[]="==r)return e.INDEXED_SET;break;case 123:if("{}"==r)return e.UNCHECKED_INDEXED_GET;if("{}="==r)return e.UNCHECKED_INDEXED_SET;break;case 43:if("+"==r)return e.ADD;break;case 45:if("-"==r)return e.SUB;break;case 42:if("*"==r)return e.MUL;if("**"==r)return e.POW;break;case 47:if("/"==r)return e.DIV;break;case 37:if("%"==r)return e.REM;break;case 38:if("&"==r)return e.BITWISE_AND;break;case 124:if("|"==r)return e.BITWISE_OR;break;case 94:if("^"==r)return e.BITWISE_XOR;break;case 61:if("=="==r)return e.EQ;break;case 33:if("!="==r)return e.NE;break;case 62:if(">"==r)return e.GT;if(">="==r)return e.GE;if(">>"==r)return e.BITWISE_SHR;if(">>>"==r)return e.BITWISE_SHR_U;break;case 60:if("<"==r)return e.LT;if("<="==r)return e.LE;if("<<"==r)return e.BITWISE_SHL}break;case a.DecoratorKind.OPERATOR_PREFIX:switch(r.charCodeAt(0)){case 43:if("+"==r)return e.PLUS;if("++"==r)return e.PREFIX_INC;break;case 45:if("-"==r)return e.MINUS;if("--"==r)return e.PREFIX_DEC;break;case 33:if("!"==r)return e.NOT;break;case 126:if("~"==r)return e.BITWISE_NOT}break;case a.DecoratorKind.OPERATOR_POSTFIX:switch(r.charCodeAt(0)){case 43:if("++"==r)return e.POSTFIX_INC;break;case 45:if("--"==r)return e.POSTFIX_DEC}}return e.INVALID},e.fromBinaryToken=function(t){switch(t){case a.Token.PLUS:case a.Token.PLUS_EQUALS:return e.ADD;case a.Token.MINUS:case a.Token.MINUS_EQUALS:return e.SUB;case a.Token.ASTERISK:case a.Token.ASTERISK_EQUALS:return e.MUL;case a.Token.SLASH:case a.Token.SLASH_EQUALS:return e.DIV;case a.Token.PERCENT:case a.Token.PERCENT_EQUALS:return e.REM;case a.Token.ASTERISK_ASTERISK:case a.Token.ASTERISK_ASTERISK_EQUALS:return e.POW;case a.Token.AMPERSAND:case a.Token.AMPERSAND_EQUALS:return e.BITWISE_AND;case a.Token.BAR:case a.Token.BAR_EQUALS:return e.BITWISE_OR;case a.Token.CARET:case a.Token.CARET_EQUALS:return e.BITWISE_XOR;case a.Token.LESSTHAN_LESSTHAN:case a.Token.LESSTHAN_LESSTHAN_EQUALS:return e.BITWISE_SHL;case a.Token.GREATERTHAN_GREATERTHAN:case a.Token.GREATERTHAN_GREATERTHAN_EQUALS:return e.BITWISE_SHR;case a.Token.GREATERTHAN_GREATERTHAN_GREATERTHAN:case a.Token.GREATERTHAN_GREATERTHAN_GREATERTHAN_EQUALS:return e.BITWISE_SHR_U;case a.Token.EQUALS_EQUALS:return e.EQ;case a.Token.EXCLAMATION_EQUALS:return e.NE;case a.Token.GREATERTHAN:return e.GT;case a.Token.GREATERTHAN_EQUALS:return e.GE;case a.Token.LESSTHAN:return e.LT;case a.Token.LESSTHAN_EQUALS:return e.LE}return e.INVALID},e.fromUnaryPrefixToken=function(t){switch(t){case a.Token.PLUS:return e.PLUS;case a.Token.MINUS:return e.MINUS;case a.Token.EXCLAMATION:return e.NOT;case a.Token.TILDE:return e.BITWISE_NOT;case a.Token.PLUS_PLUS:return e.PREFIX_INC;case a.Token.MINUS_MINUS:return e.PREFIX_DEC}return e.INVALID},e.fromUnaryPostfixToken=function(t){switch(t){case a.Token.PLUS_PLUS:return e.POSTFIX_INC;case a.Token.MINUS_MINUS:return e.POSTFIX_DEC}return e.INVALID}}(h=t.OperatorKind||(t.OperatorKind={}));class T extends i.DiagnosticEmitter{constructor(e=null){super(e),this.sources=[],this.diagnosticsOffset=0,this.filesByName=new Map,this.elementsByName=new Map,this.elementsByDeclaration=new Map,this.instancesByName=new Map,this.wrapperClasses=new Map,this.managedClasses=new Map,this.uniqueSignatures=new Array(0),this.nextClassId=0,this.nextSignatureId=0,this.nativeDummySignature=null;var t=new a.Source(n.LIBRARY_SUBST,"[native code]",a.SourceKind.LIBRARY_ENTRY);this.nativeSource=t;var r=new A(this,t);this.nativeFile=r,this.filesByName.set(r.internalName,r),this.resolver=new l.Resolver(this)}getSource(e){var t=this.sources;for(let r=0;r<t.length;++r){let n=t[r];if(n.internalPath==e)return n.text}return null}writeRuntimeHeader(e,t,r,n){assert(n<1<<28),o.writeI32(n,e,t),o.writeI32(1,e,t+4),o.writeI32(r.id,e,t+8),o.writeI32(n,e,t+12)}get runtimeHeaderSize(){return 16}makeNativeVariableDeclaration(e,t=n.CommonFlags.NONE){var r=this.nativeSource.range;return a.Node.createVariableDeclaration(a.Node.createIdentifierExpression(e,r),null,null,null,t,r)}makeNativeTypeDeclaration(e,t=n.CommonFlags.NONE){var r=this.nativeSource.range,i=a.Node.createIdentifierExpression(e,r);return a.Node.createTypeDeclaration(i,null,a.Node.createOmittedType(r),null,t,r)}makeNativeFunctionDeclaration(e,t=n.CommonFlags.NONE){var r=this.nativeSource.range;return a.Node.createFunctionDeclaration(a.Node.createIdentifierExpression(e,r),null,this.nativeDummySignature||(this.nativeDummySignature=a.Node.createFunctionType([],a.Node.createNamedType(a.Node.createSimpleTypeName(n.CommonSymbols.void_,r),null,!1,r),null,!1,r)),null,null,t,0,r)}makeNativeNamespaceDeclaration(e,t=n.CommonFlags.NONE){var r=this.nativeSource.range;return a.Node.createNamespaceDeclaration(a.Node.createIdentifierExpression(e,r),[],null,t,r)}makeNativeFunction(e,t,r=this.nativeFile,i=n.CommonFlags.NONE,s=y.NONE){return new F(e,new k(e,r,this.makeNativeFunctionDeclaration(e,i),s),t)}getElementByDeclaration(e){var t=this.elementsByDeclaration;return t.has(e)?t.get(e):null}initialize(e){this.options=e,this.registerNativeType(n.CommonSymbols.i8,s.Type.i8),this.registerNativeType(n.CommonSymbols.i16,s.Type.i16),this.registerNativeType(n.CommonSymbols.i32,s.Type.i32),this.registerNativeType(n.CommonSymbols.i64,s.Type.i64),this.registerNativeType(n.CommonSymbols.isize,e.isizeType),this.registerNativeType(n.CommonSymbols.u8,s.Type.u8),this.registerNativeType(n.CommonSymbols.u16,s.Type.u16),this.registerNativeType(n.CommonSymbols.u32,s.Type.u32),this.registerNativeType(n.CommonSymbols.u64,s.Type.u64),this.registerNativeType(n.CommonSymbols.usize,e.usizeType),this.registerNativeType(n.CommonSymbols.bool,s.Type.bool),this.registerNativeType(n.CommonSymbols.f32,s.Type.f32),this.registerNativeType(n.CommonSymbols.f64,s.Type.f64),this.registerNativeType(n.CommonSymbols.void_,s.Type.void),this.registerNativeType(n.CommonSymbols.number,s.Type.f64),this.registerNativeType(n.CommonSymbols.boolean,s.Type.bool),this.nativeFile.add(n.CommonSymbols.native,new N(n.CommonSymbols.native,this.nativeFile,this.makeNativeTypeDeclaration(n.CommonSymbols.native,n.CommonFlags.EXPORT|n.CommonFlags.GENERIC),y.BUILTIN)),this.nativeFile.add(n.CommonSymbols.indexof,new N(n.CommonSymbols.indexof,this.nativeFile,this.makeNativeTypeDeclaration(n.CommonSymbols.indexof,n.CommonFlags.EXPORT|n.CommonFlags.GENERIC),y.BUILTIN)),this.nativeFile.add(n.CommonSymbols.valueof,new N(n.CommonSymbols.valueof,this.nativeFile,this.makeNativeTypeDeclaration(n.CommonSymbols.valueof,n.CommonFlags.EXPORT|n.CommonFlags.GENERIC),y.BUILTIN)),this.nativeFile.add(n.CommonSymbols.returnof,new N(n.CommonSymbols.returnof,this.nativeFile,this.makeNativeTypeDeclaration(n.CommonSymbols.returnof,n.CommonFlags.EXPORT|n.CommonFlags.GENERIC),y.BUILTIN)),e.hasFeature(16)&&this.registerNativeType(n.CommonSymbols.v128,s.Type.v128),e.hasFeature(256)&&this.registerNativeType(n.CommonSymbols.anyref,s.Type.anyref),this.registerConstantInteger(n.CommonSymbols.ASC_TARGET,s.Type.i32,i64_new(e.isWasm64?n.Target.WASM64:n.Target.WASM32)),this.registerConstantInteger(n.CommonSymbols.ASC_NO_ASSERT,s.Type.bool,i64_new(e.noAssert?1:0,0)),this.registerConstantInteger(n.CommonSymbols.ASC_MEMORY_BASE,s.Type.i32,i64_new(e.memoryBase,0)),this.registerConstantInteger(n.CommonSymbols.ASC_OPTIMIZE_LEVEL,s.Type.i32,i64_new(e.optimizeLevelHint,0)),this.registerConstantInteger(n.CommonSymbols.ASC_SHRINK_LEVEL,s.Type.i32,i64_new(e.shrinkLevelHint,0)),this.registerConstantInteger(n.CommonSymbols.ASC_FEATURE_SIGN_EXTENSION,s.Type.bool,i64_new(e.hasFeature(1)?1:0,0)),this.registerConstantInteger(n.CommonSymbols.ASC_FEATURE_MUTABLE_GLOBALS,s.Type.bool,i64_new(e.hasFeature(2)?1:0,0)),this.registerConstantInteger(n.CommonSymbols.ASC_FEATURE_NONTRAPPING_F2I,s.Type.bool,i64_new(e.hasFeature(4)?1:0,0)),this.registerConstantInteger(n.CommonSymbols.ASC_FEATURE_BULK_MEMORY,s.Type.bool,i64_new(e.hasFeature(8)?1:0,0)),this.registerConstantInteger(n.CommonSymbols.ASC_FEATURE_SIMD,s.Type.bool,i64_new(e.hasFeature(16)?1:0,0)),this.registerConstantInteger(n.CommonSymbols.ASC_FEATURE_THREADS,s.Type.bool,i64_new(e.hasFeature(32)?1:0,0)),this.registerConstantInteger(n.CommonSymbols.ASC_FEATURE_EXCEPTION_HANDLING,s.Type.bool,i64_new(e.hasFeature(64)?1:0,0)),this.registerConstantInteger(n.CommonSymbols.ASC_FEATURE_TAIL_CALLS,s.Type.bool,i64_new(e.hasFeature(128)?1:0,0)),this.registerConstantInteger(n.CommonSymbols.ASC_FEATURE_REFERENCE_TYPES,s.Type.bool,i64_new(e.hasFeature(256)?1:0,0));var t=new Array,r=new Map,o=new Map,l=new Array,c=new Array;for(let e=0,n=this.sources.length;e<n;++e){let n=this.sources[e],i=new A(this,n);this.filesByName.set(i.internalName,i);let s=n.statements;for(let e=0,n=s.length;e<n;++e){let n=s[e];switch(n.kind){case a.NodeKind.EXPORT:this.initializeExports(n,i,r,o);break;case a.NodeKind.EXPORTDEFAULT:this.initializeExportDefault(n,i,l,c);break;case a.NodeKind.IMPORT:this.initializeImports(n,i,t,r);break;case a.NodeKind.VARIABLE:this.initializeVariables(n,i);break;case a.NodeKind.CLASSDECLARATION:this.initializeClass(n,i,l,c);break;case a.NodeKind.ENUMDECLARATION:this.initializeEnum(n,i);break;case a.NodeKind.FUNCTIONDECLARATION:this.initializeFunction(n,i);break;case a.NodeKind.INTERFACEDECLARATION:this.initializeInterface(n,i);break;case a.NodeKind.NAMESPACEDECLARATION:this.initializeNamespace(n,i,l,c);break;case a.NodeKind.TYPEDECLARATION:this.initializeTypeDefinition(n,i)}}}for(let[e,t]of o)for(let r=0,n=t.length;r<n;++r){let n=t[r],s=this.lookupForeignFile(n.foreignPath,n.foreignPathAlt);s?e.ensureExportStar(s):this.error(i.DiagnosticCode.File_0_not_found,n.pathLiteral.range,n.pathLiteral.value)}for(let e=0,n=t.length;e<n;++e){let n=t[e],s=n.foreignIdentifier;if(s){let e=this.lookupForeign(s.text,n.foreignPath,n.foreignPathAlt,r);e?n.localFile.add(n.localIdentifier.text,e,!0):this.error(i.DiagnosticCode.Module_0_has_no_exported_member_1,s.range,n.foreignPath,s.text)}else{let e=this.lookupForeignFile(n.foreignPath,n.foreignPathAlt);if(e){let t=n.localFile,r=n.localIdentifier.text;t.add(r,e.asImportedNamespace(r,t),!0)}else assert(!1)}}for(let[e,t]of r)for(let[n,s]of t){let t=s.localIdentifier.text,a=s.foreignPath;if(a){let o=this.lookupForeign(t,a,assert(s.foreignPathAlt),r);o?e.ensureExport(n,o):this.error(i.DiagnosticCode.Module_0_has_no_exported_member_1,s.localIdentifier.range,a,t)}else{let r=e.lookupInSelf(t);if(r)e.ensureExport(n,r);else{let r=this.lookupGlobal(t);r&&r instanceof f?e.ensureExport(n,r):this.error(i.DiagnosticCode.Module_0_has_no_exported_member_1,s.foreignIdentifier.range,e.internalName,s.foreignIdentifier.text)}}}assert(0==this.nextClassId),this.arrayBufferInstance=this.requireClass(n.CommonSymbols.ArrayBuffer),assert(0==this.arrayBufferInstance.id),this.stringInstance=this.requireClass(n.CommonSymbols.String),assert(1==this.stringInstance.id),this.arrayBufferViewInstance=this.requireClass(n.CommonSymbols.ArrayBufferView),assert(2==this.arrayBufferViewInstance.id),this.registerWrapperClass(s.Type.i8,n.CommonSymbols.I8),this.registerWrapperClass(s.Type.i16,n.CommonSymbols.I16),this.registerWrapperClass(s.Type.i32,n.CommonSymbols.I32),this.registerWrapperClass(s.Type.i64,n.CommonSymbols.I64),this.registerWrapperClass(e.isizeType,n.CommonSymbols.Isize),this.registerWrapperClass(s.Type.u8,n.CommonSymbols.U8),this.registerWrapperClass(s.Type.u16,n.CommonSymbols.U16),this.registerWrapperClass(s.Type.u32,n.CommonSymbols.U32),this.registerWrapperClass(s.Type.u64,n.CommonSymbols.U64),this.registerWrapperClass(e.usizeType,n.CommonSymbols.Usize),this.registerWrapperClass(s.Type.bool,n.CommonSymbols.Bool),this.registerWrapperClass(s.Type.f32,n.CommonSymbols.F32),this.registerWrapperClass(s.Type.f64,n.CommonSymbols.F64),e.hasFeature(16)&&this.registerWrapperClass(s.Type.v128,n.CommonSymbols.V128),e.hasFeature(256)&&this.registerWrapperClass(s.Type.anyref,n.CommonSymbols.Anyref),this.i8ArrayPrototype=this.require(n.CommonSymbols.Int8Array,d.CLASS_PROTOTYPE),this.i16ArrayPrototype=this.require(n.CommonSymbols.Int16Array,d.CLASS_PROTOTYPE),this.i32ArrayPrototype=this.require(n.CommonSymbols.Int32Array,d.CLASS_PROTOTYPE),this.i64ArrayPrototype=this.require(n.CommonSymbols.Int64Array,d.CLASS_PROTOTYPE),this.u8ArrayPrototype=this.require(n.CommonSymbols.Uint8Array,d.CLASS_PROTOTYPE),this.u8ClampedArrayPrototype=this.require(n.CommonSymbols.Uint8ClampedArray,d.CLASS_PROTOTYPE),this.u16ArrayPrototype=this.require(n.CommonSymbols.Uint16Array,d.CLASS_PROTOTYPE),this.u32ArrayPrototype=this.require(n.CommonSymbols.Uint32Array,d.CLASS_PROTOTYPE),this.u64ArrayPrototype=this.require(n.CommonSymbols.Uint64Array,d.CLASS_PROTOTYPE),this.f32ArrayPrototype=this.require(n.CommonSymbols.Float32Array,d.CLASS_PROTOTYPE),this.f64ArrayPrototype=this.require(n.CommonSymbols.Float64Array,d.CLASS_PROTOTYPE);var u=this.resolver;for(let e=0,t=l.length;e<t;++e){let t=l[e],r=assert(t.extendsNode),n=u.resolveTypeName(r.name,t.parent);if(n)if(n.kind==d.CLASS_PROTOTYPE){let e=n;e.hasDecorator(y.SEALED)&&this.error(i.DiagnosticCode.Class_0_is_sealed_and_cannot_be_extended,r.range,n.identifierNode.text),e.hasDecorator(y.UNMANAGED)!=t.hasDecorator(y.UNMANAGED)&&this.error(i.DiagnosticCode.Unmanaged_classes_cannot_extend_managed_classes_and_vice_versa,a.Range.join(t.identifierNode.range,r.range)),t.basePrototype=e}else this.error(i.DiagnosticCode.A_class_may_only_extend_another_class,r.range)}{let t=e.globalAliases;if(t)for(let[e,r]of t){if(!r.length)continue;let t=r.charCodeAt(0);if(t>=48&&t<=57)this.registerConstantInteger(e,s.Type.i32,i64_new(parseInt(r,10)));else{let t=this.elementsByName,n=t.get(r);if(!n)throw new Error("no such global element: "+r);if(t.has(e))throw new Error("duplicate global element: "+r);t.set(e,n)}}}this.arrayPrototype=this.require(n.CommonSymbols.Array,d.CLASS_PROTOTYPE),this.fixedArrayPrototype=this.require(n.CommonSymbols.FixedArray,d.CLASS_PROTOTYPE),this.setPrototype=this.require(n.CommonSymbols.Set,d.CLASS_PROTOTYPE),this.mapPrototype=this.require(n.CommonSymbols.Map,d.CLASS_PROTOTYPE),this.abortInstance=this.lookupFunction(n.CommonSymbols.abort),this.allocInstance=this.requireFunction(n.CommonSymbols.alloc),this.reallocInstance=this.requireFunction(n.CommonSymbols.realloc),this.freeInstance=this.requireFunction(n.CommonSymbols.free),this.retainInstance=this.requireFunction(n.CommonSymbols.retain),this.releaseInstance=this.requireFunction(n.CommonSymbols.release),this.collectInstance=this.requireFunction(n.CommonSymbols.collect),this.typeinfoInstance=this.requireFunction(n.CommonSymbols.typeinfo),this.instanceofInstance=this.requireFunction(n.CommonSymbols.instanceof_),this.visitInstance=this.requireFunction(n.CommonSymbols.visit),this.allocArrayInstance=this.requireFunction(n.CommonSymbols.allocArray);for(let e of this.filesByName.values()){let t=e.exports;if(null!==t&&e.source.sourceKind==a.SourceKind.USER_ENTRY)for(let e of t.values())this.markModuleExport(e)}}require(e,t){var r=this.lookupGlobal(e);if(!r)throw new Error("missing "+e);if(r.kind!=t)throw new Error("unexpected "+e);return r}requireClass(e){var t=this.require(e,d.CLASS_PROTOTYPE),r=this.resolver.resolveClass(t,null);if(!r)throw new Error("invalid "+e);return r}lookupFunction(e){var t=this.lookupGlobal(e);return t&&t.kind==d.FUNCTION_PROTOTYPE?this.resolver.resolveFunction(t,null):null}requireFunction(e,t=null){var r=this.require(e,d.FUNCTION_PROTOTYPE),n=this.resolver.resolveFunction(r,t);if(!n)throw new Error("invalid "+e);return n}markModuleExport(e){switch(e.set(n.CommonFlags.MODULE_EXPORT),e.kind){case d.CLASS_PROTOTYPE:{let t=e.instanceMembers;if(t)for(let e of t.values())this.markModuleExport(e);break}case d.PROPERTY_PROTOTYPE:{let t=e.getterPrototype;t&&this.markModuleExport(t);let r=e.setterPrototype;r&&this.markModuleExport(r);break}case d.PROPERTY:case d.FUNCTION:case d.FIELD:case d.CLASS:assert(!1)}{let t=e.members;if(t)for(let e of t.values())this.markModuleExport(e)}}registerNativeType(e,t){var r=new N(e,this.nativeFile,this.makeNativeTypeDeclaration(e,n.CommonFlags.EXPORT),y.BUILTIN);r.setType(t),this.nativeFile.add(e,r)}registerWrapperClass(e,t){var r=this.wrapperClasses;assert(!e.classReference&&!r.has(e));var n=this.lookupGlobal(t);if(n){assert(n.kind==d.CLASS_PROTOTYPE);var i=this.resolver.resolveClass(n,null);i&&(i.wrappedType=e,r.set(e,i))}}registerConstantInteger(e,t,r){assert(t.is(4));var i=new R(e,this.nativeFile,y.NONE,this.makeNativeVariableDeclaration(e,n.CommonFlags.CONST|n.CommonFlags.EXPORT));i.setConstantIntegerValue(r,t),this.nativeFile.add(e,i)}registerConstantFloat(e,t,r){assert(t.is(8));var i=new R(e,this.nativeFile,y.NONE,this.makeNativeVariableDeclaration(e,n.CommonFlags.CONST|n.CommonFlags.EXPORT));i.setConstantFloatValue(r,t),this.nativeFile.add(e,i)}ensureGlobal(e,t){var r=this.elementsByName;if(r.has(e)){let n=r.get(e);if(n!==t){let r=G(n,t);if(!r)return E(n.kind)?this.errorRelated(i.DiagnosticCode.Duplicate_identifier_0,t.identifierNode.range,n.declaration.name.range,e):this.error(i.DiagnosticCode.Duplicate_identifier_0,t.identifierNode.range,e),t;t=r}}return r.set(e,t),t}lookupGlobal(e){var t=this.elementsByName;return t.has(e)?t.get(e):null}requireGlobal(e){var t=this.elementsByName;if(t.has(e))return t.get(e);throw new Error("missing global")}lookupForeignFile(e,t){var r=this.filesByName;return r.has(e)?r.get(e):r.has(t)?r.get(t):null}lookupForeign(e,t,r,n){for(;;){let i=this.lookupForeignFile(t,r);if(!i)return null;let s=i.lookupExport(e);if(s)return s;if(n.has(i)){let a=n.get(i);if(a.has(e)){let n=a.get(e);if(n.foreignPath){e=n.localIdentifier.text,t=n.foreignPath,r=assert(n.foreignPathAlt);continue}if(s=i.lookupInSelf(n.localIdentifier.text))return s}}break}return null}checkDecorators(e,t){var r=y.NONE;if(e)for(let n=0,s=e.length;n<s;++n){let s=e[n],o=a.DecoratorKind.fromNode(s.name),l=y.fromKind(o);l&&(l==y.BUILTIN?t&l||s.range.source.isLibrary?r|=l:this.error(i.DiagnosticCode.Decorator_0_is_not_valid_here,s.range,s.name.range.toString()):t&l?r&l?this.error(i.DiagnosticCode.Duplicate_decorator,s.range):r|=l:this.error(i.DiagnosticCode.Decorator_0_is_not_valid_here,s.range,s.name.range.toString()))}return r}initializeClass(e,t,r,s){var o=e.name.text,l=new U(o,t,e,this.checkDecorators(e.decorators,y.GLOBAL|y.SEALED|y.UNMANAGED));if(!t.add(o,l))return null;var c=e.implementsTypes;if(c){let t=c.length;if(l.hasDecorator(y.UNMANAGED))t&&this.error(i.DiagnosticCode.Unmanaged_classes_cannot_implement_interfaces,a.Range.join(e.name.range,c[t-1].range));else if(t){for(let e=0;e<t;++e)this.warning(i.DiagnosticCode.Not_implemented,c[e].range);s.push(l)}}e.extendsType&&r.push(l);var u=e.members;for(let e=0,t=u.length;e<t;++e){let t=u[e];switch(t.kind){case a.NodeKind.FIELDDECLARATION:this.initializeField(t,l);break;case a.NodeKind.METHODDECLARATION:t.isAny(n.CommonFlags.GET|n.CommonFlags.SET)?this.initializeProperty(t,l):this.initializeMethod(t,l);break;case a.NodeKind.INDEXSIGNATUREDECLARATION:break;default:assert(!1)}}return l}initializeField(e,t){var r,i=e.name.text,s=e.decorators;if(e.is(n.CommonFlags.STATIC)){if(assert(t.kind!=d.INTERFACE_PROTOTYPE),r=new R(i,t,this.checkDecorators(s,(e.is(n.CommonFlags.READONLY)?y.INLINE:y.NONE)|y.LAZY|y.UNSAFE),e),!t.add(i,r))return}else if(assert(!e.isAny(n.CommonFlags.ABSTRACT|n.CommonFlags.GET|n.CommonFlags.SET)),r=new B(i,t,e,this.checkDecorators(s,y.UNSAFE)),!t.addInstance(i,r))return}initializeMethod(e,t){var r=e.name.text,i=e.is(n.CommonFlags.STATIC),s=y.INLINE|y.UNSAFE;e.is(n.CommonFlags.GENERIC)||(s|=y.OPERATOR_BINARY|y.OPERATOR_PREFIX|y.OPERATOR_POSTFIX);var o=new k(r,t,e,this.checkDecorators(e.decorators,s));if(i){if(assert(e.name.kind!=a.NodeKind.CONSTRUCTOR),!t.add(r,o))return}else if(!t.addInstance(r,o))return;this.checkOperatorOverloads(e.decorators,o,t)}checkOperatorOverloads(e,t,r){if(e)for(let n=0,s=e.length;n<s;++n){let s=e[n];switch(s.decoratorKind){case a.DecoratorKind.OPERATOR:case a.DecoratorKind.OPERATOR_BINARY:case a.DecoratorKind.OPERATOR_PREFIX:case a.DecoratorKind.OPERATOR_POSTFIX:{let e=s.arguments&&s.arguments.length||0;if(1==e){let e=s.arguments[0];if(e.kind==a.NodeKind.LITERAL&&e.literalKind==a.LiteralKind.STRING){let n=e.value,a=h.fromDecorator(s.decoratorKind,n);if(a==h.INVALID)this.error(i.DiagnosticCode._0_is_not_a_valid_operator,e.range,n);else{let n=r.overloadPrototypes;n.has(a)?this.error(i.DiagnosticCode.Duplicate_function_implementation,e.range):(t.operatorKind=a,n.set(a,t))}}else this.error(i.DiagnosticCode.String_literal_expected,e.range)}else this.error(i.DiagnosticCode.Expected_0_arguments_but_got_1,s.range,"1",e.toString(10))}}}}ensureProperty(e,t){var r=e.name.text;if(e.is(n.CommonFlags.STATIC)){let n=t.members;if(!n||!n.has(r)){let n=new D(r,t,e);return t.add(r,n)?n:null}{let e=n.get(r);if(e.kind==d.PROPERTY_PROTOTYPE)return e}}else{let n=t.instanceMembers;if(!n||!n.has(r)){let n=new D(r,t,e);return t.addInstance(r,n)?n:null}{let e=n.get(r);if(e.kind==d.PROPERTY_PROTOTYPE)return e}}return this.error(i.DiagnosticCode.Duplicate_property_0,e.name.range,r),null}initializeProperty(e,t){var r=this.ensureProperty(e,t);if(r){var s=e.name.text,a=e.is(n.CommonFlags.GET);if(a){if(r.getterPrototype)return void this.error(i.DiagnosticCode.Duplicate_property_0,e.name.range,s)}else if(r.setterPrototype)return void this.error(i.DiagnosticCode.Duplicate_property_0,e.name.range,s);var o=new k((a?n.GETTER_PREFIX:n.SETTER_PREFIX)+s,r,e,this.checkDecorators(e.decorators,y.INLINE|y.UNSAFE));a?r.getterPrototype=o:r.setterPrototype=o}}initializeEnum(e,t){var r=e.name.text,n=new C(r,t,e,this.checkDecorators(e.decorators,y.GLOBAL|y.INLINE|y.LAZY));if(!t.add(r,n))return null;var i=e.values;for(let e=0,t=i.length;e<t;++e)this.initializeEnumValue(i[e],n);return n}initializeEnumValue(e,t){var r=e.name.text,n=new v(r,t,e,this.checkDecorators(e.decorators,y.NONE));t.add(r,n)}initializeExports(e,t,r,i){var s=e.members;if(s)for(let n=0,i=s.length;n<i;++n)this.initializeExport(s[n],t,e.internalPath,r);else{let r;i.has(t)?r=i.get(t):i.set(t,r=[]);let s=assert(e.internalPath);r.push(new _(s,s.endsWith(n.INDEX_SUFFIX)?s.substring(0,s.length-n.INDEX_SUFFIX.length):s+n.INDEX_SUFFIX,assert(e.path)))}}initializeExport(e,t,r,s){var a=e.localName.text,o=e.exportedName.text,l=t.lookupExport(o);if(l)this.error(i.DiagnosticCode.Export_declaration_conflicts_with_exported_declaration_of_0,e.exportedName.range,o);else if(null===r)if(l=t.lookupInSelf(a))t.ensureExport(o,l);else{let r;s.has(t)?r=s.get(t):s.set(t,r=new Map),r.set(o,new p(e.localName,e.exportedName,null,null))}else{let i;s.has(t)?i=s.get(t):s.set(t,i=new Map),i.set(o,new p(e.localName,e.exportedName,r,r.endsWith(n.INDEX_SUFFIX)?r.substring(0,r.length-n.INDEX_SUFFIX.length):r+n.INDEX_SUFFIX))}}initializeExportDefault(e,t,r,n){var s=e.declaration,o=null;switch(s.kind){case a.NodeKind.ENUMDECLARATION:o=this.initializeEnum(s,t);break;case a.NodeKind.FUNCTIONDECLARATION:o=this.initializeFunction(s,t);break;case a.NodeKind.CLASSDECLARATION:o=this.initializeClass(s,t,r,n);break;case a.NodeKind.INTERFACEDECLARATION:o=this.initializeInterface(s,t);break;case a.NodeKind.NAMESPACEDECLARATION:o=this.initializeNamespace(s,t,r,n);break;default:assert(!1)}if(o){let e=t.exports;if(e){if(e.has("default")){let t=e.get("default");return void this.errorRelated(i.DiagnosticCode.Duplicate_identifier_0,s.name.range,t.declaration.name.range,"default")}}else t.exports=e=new Map;e.set("default",o)}}initializeImports(e,t,r,i){var s=e.declarations;if(s)for(let n=0,a=s.length;n<a;++n)this.initializeImport(s[n],t,e.internalPath,r,i);else e.namespaceName&&r.push(new u(t,e.namespaceName,null,e.internalPath,e.internalPath+n.INDEX_SUFFIX))}initializeImport(e,t,r,i,s){var a=r.endsWith(n.INDEX_SUFFIX)?r.substring(0,r.length-n.INDEX_SUFFIX.length):r+n.INDEX_SUFFIX,o=this.lookupForeign(e.foreignName.text,r,a,s);o?t.add(e.name.text,o,!0):i.push(new u(t,e.name,e.foreignName,r,a))}initializeFunction(e,t){var r=e.name.text,i=y.UNSAFE|y.BUILTIN;e.is(n.CommonFlags.AMBIENT)?i|=y.EXTERNAL:i|=y.INLINE,e.is(n.CommonFlags.INSTANCE)||t.kind!=d.CLASS_PROTOTYPE&&(i|=y.GLOBAL);var s=new k(r,t,e,this.checkDecorators(e.decorators,i));return t.add(r,s)?s:null}initializeInterface(e,t){var r=e.name.text,i=new w(r,t,e,this.checkDecorators(e.decorators,y.GLOBAL));if(!t.add(r,i))return null;var s=e.members;for(let e=0,t=s.length;e<t;++e){let t=s[e];switch(t.kind){case a.NodeKind.FIELDDECLARATION:this.initializeField(t,i);break;case a.NodeKind.METHODDECLARATION:t.isAny(n.CommonFlags.GET|n.CommonFlags.SET)?this.initializeProperty(t,i):this.initializeMethod(t,i);break;default:assert(!1)}}return i}initializeNamespace(e,t,r,n){var i=e.name.text,s=new S(i,t,e,this.checkDecorators(e.decorators,y.GLOBAL));if(!t.add(i,s))return null;var o=assert(t.lookupInSelf(i)),l=e.members;for(let e=0,t=l.length;e<t;++e){let t=l[e];switch(t.kind){case a.NodeKind.CLASSDECLARATION:this.initializeClass(t,s,r,n);break;case a.NodeKind.ENUMDECLARATION:this.initializeEnum(t,s);break;case a.NodeKind.FUNCTIONDECLARATION:this.initializeFunction(t,s);break;case a.NodeKind.INTERFACEDECLARATION:this.initializeInterface(t,s);break;case a.NodeKind.NAMESPACEDECLARATION:this.initializeNamespace(t,s,r,n);break;case a.NodeKind.TYPEDECLARATION:this.initializeTypeDefinition(t,s);break;case a.NodeKind.VARIABLE:this.initializeVariables(t,s);break;default:assert(!1)}}return s!=o&&V(s,o),o}initializeTypeDefinition(e,t){var r=e.name.text,n=new N(r,t,e,this.checkDecorators(e.decorators,y.NONE));t.add(r,n)}initializeVariables(e,t){var r=e.declarations;for(let e=0,i=r.length;e<i;++e){let i=r[e],s=i.name.text,a=y.GLOBAL|y.LAZY;i.is(n.CommonFlags.DECLARE)&&(a|=y.EXTERNAL),i.is(n.CommonFlags.CONST)&&(a|=y.INLINE);let o=new R(s,t,this.checkDecorators(i.decorators,a),i);t.add(s,o)}}}t.Program=T,function(e){e[e.GLOBAL=0]="GLOBAL",e[e.LOCAL=1]="LOCAL",e[e.ENUM=2]="ENUM",e[e.ENUMVALUE=3]="ENUMVALUE",e[e.FUNCTION_PROTOTYPE=4]="FUNCTION_PROTOTYPE",e[e.FUNCTION=5]="FUNCTION",e[e.FUNCTION_TARGET=6]="FUNCTION_TARGET",e[e.CLASS_PROTOTYPE=7]="CLASS_PROTOTYPE",e[e.CLASS=8]="CLASS",e[e.INTERFACE_PROTOTYPE=9]="INTERFACE_PROTOTYPE",e[e.INTERFACE=10]="INTERFACE",e[e.FIELD_PROTOTYPE=11]="FIELD_PROTOTYPE",e[e.FIELD=12]="FIELD",e[e.PROPERTY_PROTOTYPE=13]="PROPERTY_PROTOTYPE",e[e.PROPERTY=14]="PROPERTY",e[e.NAMESPACE=15]="NAMESPACE",e[e.FILE=16]="FILE",e[e.TYPEDEFINITION=17]="TYPEDEFINITION",e[e.INDEXSIGNATURE=18]="INDEXSIGNATURE"}(d=t.ElementKind||(t.ElementKind={})),function(e){e[e.NONE=0]="NONE",e[e.GLOBAL=1]="GLOBAL",e[e.OPERATOR_BINARY=2]="OPERATOR_BINARY",e[e.OPERATOR_PREFIX=4]="OPERATOR_PREFIX",e[e.OPERATOR_POSTFIX=8]="OPERATOR_POSTFIX",e[e.UNMANAGED=16]="UNMANAGED",e[e.SEALED=32]="SEALED",e[e.INLINE=64]="INLINE",e[e.EXTERNAL=128]="EXTERNAL",e[e.BUILTIN=256]="BUILTIN",e[e.LAZY=512]="LAZY",e[e.UNSAFE=1024]="UNSAFE"}(y=t.DecoratorFlags||(t.DecoratorFlags={})),function(e){e.fromKind=function(t){switch(t){case a.DecoratorKind.GLOBAL:return e.GLOBAL;case a.DecoratorKind.OPERATOR:case a.DecoratorKind.OPERATOR_BINARY:return e.OPERATOR_BINARY;case a.DecoratorKind.OPERATOR_PREFIX:return e.OPERATOR_PREFIX;case a.DecoratorKind.OPERATOR_POSTFIX:return e.OPERATOR_POSTFIX;case a.DecoratorKind.UNMANAGED:return e.UNMANAGED;case a.DecoratorKind.SEALED:return e.SEALED;case a.DecoratorKind.INLINE:return e.INLINE;case a.DecoratorKind.EXTERNAL:return e.EXTERNAL;case a.DecoratorKind.BUILTIN:return e.BUILTIN;case a.DecoratorKind.LAZY:return e.LAZY;case a.DecoratorKind.UNSAFE:return e.UNSAFE;default:return e.NONE}}}(y=t.DecoratorFlags||(t.DecoratorFlags={}));class m{constructor(e,t,r,i,s){this.kind=e,this.name=t,this.internalName=r,this.program=i,this.flags=n.CommonFlags.NONE,this.decoratorFlags=y.NONE,this.members=null,this.shadowType=null,this.program=i,this.name=t,this.internalName=r,s?this.parent=s:(assert(this.kind==d.FILE),this.parent=this)}get file(){for(var e=this;;)if((e=e.parent).kind==d.FILE)return e}is(e){return(this.flags&e)==e}isAny(e){return 0!=(this.flags&e)}set(e){this.flags|=e}unset(e){this.flags&=~e}hasDecorator(e){return(this.decoratorFlags&e)==e}lookupInSelf(e){var t=this.members;return t&&t.has(e)?t.get(e):null}add(e,t){var r=t.declaration,n=this.members;if(n){if(n.has(e)){let r=n.get(e);if(r.parent!==this);else{let e=G(r,t);if(!e)return E(r.kind)?this.program.errorRelated(i.DiagnosticCode.Duplicate_identifier_0,t.identifierNode.range,r.declaration.name.range,t.identifierNode.text):this.program.error(i.DiagnosticCode.Duplicate_identifier_0,t.identifierNode.range,t.identifierNode.text),!1;t=e}}}else this.members=n=new Map;n.set(e,t);var s=this.program;return t.kind==d.FUNCTION_PROTOTYPE&&t.isBound||(s.elementsByName.set(t.internalName,t),s.elementsByDeclaration.set(r,t)),!0}toString(){return d[this.kind]+":"+this.internalName}}t.Element=m;var g=new Set;function E(e){return g.has(e)}t.isDeclaredElement=E;class f extends m{constructor(e,t,r,n,i,s){super(e,t,r,n,i),this.declaration=s,g.add(e),this.declaration=s,this.flags=s.flags}get isDeclaredInLibrary(){return this.declaration.range.source.isLibrary}get identifierNode(){return this.declaration.name}get decoratorNodes(){return this.declaration.decorators}}t.DeclaredElement=f;var I,x=new Set;t.isTypedElement=function(e){return x.has(e)};class b extends f{constructor(e,t,r,n,i,a){super(e,t,r,n,i,a),this.type=s.Type.void,x.add(e)}setType(e){assert(!this.is(n.CommonFlags.RESOLVED)),this.type=e,this.set(n.CommonFlags.RESOLVED)}}t.TypedElement=b;class A extends m{constructor(e,t){super(d.FILE,t.normalizedPath,t.internalPath,e,null),this.source=t,this.exports=null,this.exportsStar=null,this.source=t,assert(!e.filesByName.has(this.internalName)),e.filesByName.set(this.internalName,this);var r=this.program.makeNativeFunction("start:"+this.internalName,new s.Signature(e,null,s.Type.void),this);r.internalName=r.name,this.startFunction=r}add(e,t,r=!1){return t.hasDecorator(y.GLOBAL)&&(t=this.program.ensureGlobal(e,t)),!!super.add(e,t)&&((t=assert(this.lookupInSelf(e))).is(n.CommonFlags.EXPORT)&&!r&&this.ensureExport(t.name,t),!0)}lookupInSelf(e){var t=super.lookupInSelf(e);if(t)return t;var r=this.exportsStar;if(r)for(let n=0,i=r.length;n<i;++n)if(t=r[n].lookupInSelf(e))return t;return null}lookup(e){var t=this.lookupInSelf(e);return t||this.program.lookupGlobal(e)}ensureExport(e,t){var r=this.exports;r||(this.exports=r=new Map),r.set(e,t),this.source.sourceKind==a.SourceKind.LIBRARY_ENTRY&&this.program.ensureGlobal(e,t)}ensureExportStar(e){var t=this.exportsStar;if(t){if(t.includes(e))return}else this.exportsStar=t=[];t.push(e)}lookupExport(e){var t=this.exports;if(t&&t.has(e))return t.get(e);var r=this.exportsStar;if(r)for(let t=0,n=r.length;t<n;++t){let n=r[t].lookupExport(e);if(n)return n}return null}asImportedNamespace(e,t){var r=new S(e,t,this.program.makeNativeNamespaceDeclaration(e)),n=this.exports;if(n)for(let[e,t]of n)r.add(e,t);return r}}t.File=A;class N extends b{constructor(e,t,r,n=y.NONE){super(d.TYPEDEFINITION,e,K(e,t,!1),t.program,t,r),this.decoratorFlags=n}get typeParameterNodes(){return this.declaration.typeParameters}get typeNode(){return this.declaration.type}lookup(e){return this.parent.lookup(e)}}t.TypeDefinition=N;class S extends f{constructor(e,t,r,n=y.NONE){super(d.NAMESPACE,e,K(e,t,!1),t.program,t,r),this.decoratorFlags=n}lookup(e){return this.lookupInSelf(e)||this.parent.lookup(e)}}t.Namespace=S;class C extends b{constructor(e,t,r,n=y.NONE){super(d.ENUM,e,K(e,t,!1),t.program,t,r),this.decoratorFlags=n,this.setType(s.Type.i32)}lookup(e){return this.lookupInSelf(e)||this.parent.lookup(e)}}t.Enum=C,function(e){e[e.NONE=0]="NONE",e[e.INTEGER=1]="INTEGER",e[e.FLOAT=2]="FLOAT"}(t.ConstantValueKind||(t.ConstantValueKind={}));class O extends b{constructor(e,t,r,n=r.program.makeNativeVariableDeclaration(t)){super(e,t,K(t,r,!1),r.program,r,n),this.constantValueKind=0,this.flags=n.flags}get typeNode(){return this.declaration.type}get initializerNode(){return this.declaration.initializer}setConstantIntegerValue(e,t){assert(t.is(4)),this.type=t,this.constantValueKind=1,this.constantIntegerValue=e,this.set(n.CommonFlags.CONST|n.CommonFlags.INLINED|n.CommonFlags.RESOLVED)}setConstantFloatValue(e,t){assert(t.is(8)),this.type=t,this.constantValueKind=2,this.constantFloatValue=e,this.set(n.CommonFlags.CONST|n.CommonFlags.INLINED|n.CommonFlags.RESOLVED)}lookup(e){return this.parent.lookup(e)}}t.VariableLikeElement=O;class v extends O{constructor(e,t,r,n=y.NONE){super(d.ENUMVALUE,e,t,r),this.isImmutable=!1,this.decoratorFlags=n,this.setType(s.Type.i32)}get valueNode(){return this.declaration.value}lookup(e){return this.parent.lookup(e)}}t.EnumValue=v;class R extends O{constructor(e,t,r,n=t.program.makeNativeVariableDeclaration(e)){super(d.GLOBAL,e,t,n),this.decoratorFlags=r}}t.Global=R;t.Parameter=class{constructor(e,t,r=null){this.name=e,this.type=t,this.initializer=r}};class L extends O{constructor(e,t,r,n,i=n.program.makeNativeVariableDeclaration(e)){super(d.LOCAL,e,n,i),this.index=t,this.index=t,assert(r!=s.Type.void),this.setType(r)}}t.Local=L;class k extends f{constructor(e,t,r,i=y.NONE){super(d.FUNCTION_PROTOTYPE,e,K(e,t,r.is(n.CommonFlags.INSTANCE)),t.program,t,r),this.operatorKind=h.INVALID,this.instances=null,this.boundPrototypes=null,this.decoratorFlags=i}get typeParameterNodes(){return this.declaration.typeParameters}get functionTypeNode(){return this.declaration.signature}get bodyNode(){return this.declaration.body}get arrowKind(){return this.declaration.arrowKind}get isBound(){var e=this.parent;return e.kind==d.CLASS||e.kind==d.PROPERTY_PROTOTYPE&&e.parent.kind==d.CLASS}toBound(e){assert(this.is(n.CommonFlags.INSTANCE)),assert(!this.isBound);var t=this.boundPrototypes;if(t){if(t.has(e))return t.get(e)}else this.boundPrototypes=t=new Map;var r=this.declaration;assert(r.kind==a.NodeKind.METHODDECLARATION);var i=new k(this.name,e,r,this.decoratorFlags);return i.flags=this.flags,i.operatorKind=this.operatorKind,t.set(e,i),i}getResolvedInstance(e){var t=this.instances;return t&&t.has(e)?t.get(e):null}setResolvedInstance(e,t){var r=this.instances;r?assert(!r.has(e)):this.instances=r=new Map,r.set(e,t)}lookup(e){return this.parent.lookup(e)}}t.FunctionPrototype=k;class F extends b{constructor(e,t,r,i=null){if(super(d.FUNCTION,e,K(e,t.parent,t.is(n.CommonFlags.INSTANCE)),t.program,t.parent,t.declaration),this.localsByName=new Map,this.localsByIndex=[],this.additionalLocals=[],this.debugLocations=[],this.ref=0,this.functionTableIndex=-1,this.trampoline=null,this.nextInlineId=0,this.nextAnonymousId=0,this.nextAutoreleaseId=0,this.tempI32s=null,this.tempI64s=null,this.tempF32s=null,this.tempF64s=null,this.tempV128s=null,this.tempAnyrefs=null,this.nextBreakId=0,this.breakStack=null,this.breakLabel=null,this.prototype=t,this.signature=r,this.flags=t.flags|n.CommonFlags.RESOLVED,this.decoratorFlags=t.decoratorFlags,this.contextualTypeArguments=i,this.type=s.Type.u32.asFunction(r),!t.is(n.CommonFlags.AMBIENT)){let e=0;if(this.is(n.CommonFlags.INSTANCE)){let t=new L(n.CommonSymbols.this_,e++,assert(r.thisType),this);this.localsByName.set(n.CommonSymbols.this_,t),this.localsByIndex[t.index]=t}let t=r.parameterTypes;for(let n=0,i=t.length;n<i;++n){let i=t[n],s=r.getParameterName(n),a=new L(s,e++,i,this);this.localsByName.set(s,a),this.localsByIndex[a.index]=a}}this.flow=c.Flow.create(this),M(this.program,this)}addLocal(e,t=null,r=null){var i=this.signature.parameterTypes.length+this.additionalLocals.length;this.is(n.CommonFlags.INSTANCE)&&++i;var s=null!==t?t:"var$"+i.toString(),a=new L(s,i,e,this,r||this.program.makeNativeVariableDeclaration(s));if(t){if(this.localsByName.has(t))throw new Error("duplicate local name");this.localsByName.set(t,a)}return this.localsByIndex[a.index]=a,this.additionalLocals.push(e),a}lookup(e){var t=this.localsByName;return t.has(e)?t.get(e):this.parent.lookup(e)}finalize(e,t){if(this.ref=t,assert(!this.breakStack||!this.breakStack.length),this.breakStack=null,this.breakLabel=null,this.tempI32s=this.tempI64s=this.tempF32s=this.tempF64s=null,this.program.options.sourceMap){let r=this.debugLocations;for(let n=0,i=r.length;n<i;++n){let i=r[n];e.setDebugLocation(t,i.debugInfoRef,i.source.debugInfoIndex,i.line,i.column)}}}}t.Function=F;t.FunctionTarget=class extends m{constructor(e,t,r=""){super(d.FUNCTION_TARGET,r="sig:"+e.toSignatureString(),r,t,t.nativeFile),this.signature=e,this.flags=n.CommonFlags.RESOLVED,this.type=s.Type.u32.asFunction(e)}lookup(e){return null}};class B extends f{constructor(e,t,r,i=y.NONE){super(d.FIELD_PROTOTYPE,e,K(e,t,assert(r.is(n.CommonFlags.INSTANCE))),t.program,t,r),this.decoratorFlags=i}get typeNode(){return this.declaration.type}get initializerNode(){return this.declaration.initializer}get parameterIndex(){return this.declaration.parameterIndex}lookup(e){return this.parent.lookup(e)}}t.FieldPrototype=B;t.Field=class extends O{constructor(e,t,r){super(d.FIELD,e.name,t,e.declaration),this.memoryOffset=-1,this.prototype=e,this.flags=e.flags,this.decoratorFlags=e.decoratorFlags,assert(r!=s.Type.void),this.setType(r),M(this.program,this)}};class D extends f{constructor(e,t,r){super(d.PROPERTY_PROTOTYPE,e,K(e,t,r.is(n.CommonFlags.INSTANCE)),t.program,t,r),this.getterPrototype=null,this.setterPrototype=null,this.flags&=~(n.CommonFlags.GET|n.CommonFlags.SET)}lookup(e){return this.parent.lookup(e)}}t.PropertyPrototype=D;t.Property=class extends O{constructor(e,t){super(d.PROPERTY,e.name,t,e.program.makeNativeVariableDeclaration(e.name,e.is(n.CommonFlags.INSTANCE)?n.CommonFlags.INSTANCE:n.CommonFlags.NONE)),this.getterInstance=null,this.setterInstance=null,this.prototype=e,this.flags=e.flags,this.decoratorFlags=e.decoratorFlags,M(this.program,this)}lookup(e){return this.parent.lookup(e)}};t.IndexSignature=class extends O{constructor(e){super(d.INDEXSIGNATURE,e.internalName+"[]",e)}getGetterInstance(e){return this.parent.lookupOverload(h.INDEXED_GET,e)}getSetterInstance(e){return this.parent.lookupOverload(h.INDEXED_SET,e)}lookup(e){return this.parent.lookup(e)}};class U extends f{constructor(e,t,r,i=y.NONE,s=!1){super(s?d.INTERFACE_PROTOTYPE:d.CLASS_PROTOTYPE,e,K(e,t,r.is(n.CommonFlags.INSTANCE)),t.program,t,r),this.instanceMembers=null,this.basePrototype=null,this.constructorPrototype=null,this.overloadPrototypes=new Map,this.instances=null,this.decoratorFlags=i}get typeParameterNodes(){return this.declaration.typeParameters}get extendsNode(){return this.declaration.extendsType}get implementsNodes(){return this.declaration.implementsTypes}get isBuiltinArray(){var e=this.program.arrayBufferViewInstance;return null!==e&&this.extends(e.prototype)}extends(e){var t=this;do{if(t===e)return!0}while(t=t.basePrototype);return!1}addInstance(e,t){var r=t.declaration,s=this.instanceMembers;if(s){if(s.has(e)){let r=s.get(e),n=G(r,t);if(!n)return E(r.kind)?this.program.errorRelated(i.DiagnosticCode.Duplicate_identifier_0,t.identifierNode.range,r.declaration.name.range,t.identifierNode.text):this.program.error(i.DiagnosticCode.Duplicate_identifier_0,t.identifierNode.range,t.identifierNode.text),!1;t=n}}else this.instanceMembers=s=new Map;return s.set(e,t),t.is(n.CommonFlags.EXPORT)&&this.is(n.CommonFlags.MODULE_EXPORT)&&t.set(n.CommonFlags.MODULE_EXPORT),this.program.elementsByDeclaration.set(r,t),!0}getResolvedInstance(e){var t=this.instances;return t&&t.has(e)?t.get(e):null}setResolvedInstance(e,t){var r=this.instances;r?assert(!r.has(e)):this.instances=r=new Map,r.set(e,t)}lookup(e){return this.parent.lookup(e)}}t.ClassPrototype=U,function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.ACYCLIC=1]="ACYCLIC",e[e.NOT_ACYCLIC=2]="NOT_ACYCLIC"}(I||(I={}));class P extends b{constructor(e,t,r=null,i=null,s=!1){super(s?d.INTERFACE:d.CLASS,e,K(e,t.parent,t.is(n.CommonFlags.INSTANCE)),t.program,t.parent,t.declaration),this.contextualTypeArguments=null,this.currentMemoryOffset=0,this.constructorInstance=null,this.overloads=null,this.indexSignature=null,this._id=0,this._acyclic=0,this.rttiFlags=0,this.wrappedType=null;var a=this.program;if(this.prototype=t,this.flags=t.flags,this.decoratorFlags=t.decoratorFlags,this.typeArguments=r,this.setType(a.options.usizeType.asClass(this)),this.base=i,!this.hasDecorator(y.UNMANAGED)){let e=a.nextClassId++;this._id=e,a.managedClasses.set(e,this)}if(i){let e=i.contextualTypeArguments;if(e){let t=this.contextualTypeArguments;for(let[r,n]of e)t||(this.contextualTypeArguments=t=new Map),t.set(r,n)}}var o=t.typeParameterNodes;if(r){let e=r.length;if(!o||e!=o.length)throw new Error("type argument count mismatch");if(e){this.contextualTypeArguments||(this.contextualTypeArguments=new Map);for(let t=0;t<e;++t)this.contextualTypeArguments.set(o[t].name.text,r[t])}}else if(o&&o.length)throw new Error("type argument count mismatch");M(a,this)}get id(){return this._id}get isBuiltinArray(){return this.prototype.isBuiltinArray}get isArrayLike(){if(this.isBuiltinArray)return!0;var e=this.lookupInSelf("length");return null!==e&&(e.kind==d.FIELD||e.kind==d.PROPERTY&&null!==e.getterInstance)&&(null!==this.lookupOverload(h.INDEXED_GET)||null!==this.lookupOverload(h.UNCHECKED_INDEXED_GET))}isAssignableTo(e){var t=this;do{if(t==e)return!0}while(t=t.base);return!1}lookupOverload(e,t=!1){if(t)switch(e){case h.INDEXED_GET:{let e=this.lookupOverload(h.UNCHECKED_INDEXED_GET);if(e)return e;break}case h.INDEXED_SET:{let e=this.lookupOverload(h.UNCHECKED_INDEXED_SET);if(e)return e;break}default:assert(!1)}var r=this;do{let t=r.overloads;if(t){let r=t.get(e);if(r)return r}}while(r=r.base);return null}lookup(e){return this.parent.lookup(e)}offsetof(e){var t=assert(this.members);assert(t.has(e));var r=t.get(e);return assert(r.kind==d.FIELD),r.memoryOffset}writeField(e,t,r,n){var i=this.lookupInSelf(e);if(i&&i.kind==d.FIELD){let e=n+i.memoryOffset;switch(i.type.kind){case 0:case 5:return o.writeI8(i32(t),r,e),1;case 1:case 6:return o.writeI16(i32(t),r,e),2;case 2:case 7:return o.writeI32(i32(t),r,e),4;case 4:case 9:return assert(!this.program.options.isWasm64),o.writeI32(i32(t),r,e),4;case 11:return o.writeF32(f32(t),r,e),4;case 12:return o.writeF64(f64(t),r,e),8}}return assert(!1),0}extends(e){return this.prototype.extends(e)}getTypeArgumentsTo(e){var t=this;do{if(t.prototype===e)return t.typeArguments}while(t=t.base);return null}getArrayValueType(){for(var e=this,t=this.program,r=t.arrayBufferViewInstance;e.base!==r;)e=assert(e.base);switch(e.prototype){case t.i8ArrayPrototype:return s.Type.i8;case t.i16ArrayPrototype:return s.Type.i16;case t.i32ArrayPrototype:return s.Type.i32;case t.i64ArrayPrototype:return s.Type.i64;case t.u8ArrayPrototype:case t.u8ClampedArrayPrototype:return s.Type.u8;case t.u16ArrayPrototype:return s.Type.u16;case t.u32ArrayPrototype:return s.Type.u32;case t.u64ArrayPrototype:return s.Type.u64;case t.f32ArrayPrototype:return s.Type.f32;case t.f64ArrayPrototype:return s.Type.f64;case t.arrayPrototype:return assert(this.getTypeArgumentsTo(t.arrayPrototype))[0];default:assert(!1)}return s.Type.void}get isAcyclic(){var e=this._acyclic;if(0==e){let t=this.cyclesTo(this);this._acyclic=e=t?2:1}return 1==e}cyclesTo(e,t=new Set){if(t.has(this))return!1;var r;t.add(this);var n,i=this.members;if(i)for(let n of i.values())if(n.kind==d.FIELD){let i=n.type;if(i.is(256)&&null!==(r=i.classReference)&&(r===e||r.cyclesTo(e,t)))return!0}if((n=this.program.arrayPrototype)&&this.prototype.extends(n)){let i=assert(this.getTypeArgumentsTo(n));if(assert(1==i.length),null!==(r=i[0].classReference)&&(r===e||r.cyclesTo(e,t)))return!0}else if((n=this.program.setPrototype)&&this.prototype.extends(n)){let i=assert(this.getTypeArgumentsTo(n));if(assert(1==i.length),null!==(r=i[0].classReference)&&(r===e||r.cyclesTo(e,t)))return!0}else if((n=this.program.mapPrototype)&&this.prototype.extends(n)){let i=assert(this.getTypeArgumentsTo(n));if(assert(2==i.length),null!==(r=i[0].classReference)&&(r===e||r.cyclesTo(e,t)))return!0;if(null!==(r=i[1].classReference)&&(r===e||r.cyclesTo(e,t)))return!0}return!1}}t.Class=P;class w extends U{constructor(e,t,r,n){super(e,t,r,n,!0)}}t.InterfacePrototype=w;function M(e,t){assert(!e.instancesByName.has(t.internalName)),e.instancesByName.set(t.internalName,t)}function G(e,t){assert(e.program===t.program),assert(!t.members);var r=null;switch(e.kind){case d.FUNCTION_PROTOTYPE:switch(t.kind){case d.NAMESPACE:V(t,e),r=e;break;case d.TYPEDEFINITION:e.shadowType||(e.shadowType=t,V(t,e),r=e)}break;case d.CLASS_PROTOTYPE:case d.ENUM:if(t.kind==d.NAMESPACE){V(t,e),r=e;break}break;case d.NAMESPACE:switch(t.kind){case d.ENUM:case d.CLASS_PROTOTYPE:case d.FUNCTION_PROTOTYPE:V(e,t),r=t;break;case d.NAMESPACE:V(t,e),r=e;break;case d.TYPEDEFINITION:e.shadowType||(e.shadowType=t,V(t,e),r=e)}break;case d.GLOBAL:t.kind==d.TYPEDEFINITION&&(e.shadowType||(e.shadowType=t,V(t,e),r=e));break;case d.TYPEDEFINITION:switch(t.kind){case d.GLOBAL:case d.FUNCTION_PROTOTYPE:case d.NAMESPACE:t.shadowType||(t.shadowType=e,V(e,t),r=t)}}if(r){(e.is(n.CommonFlags.EXPORT)||e.hasDecorator(y.GLOBAL))!=(t.is(n.CommonFlags.EXPORT)||t.hasDecorator(y.GLOBAL))&&e.program.error(i.DiagnosticCode.Individual_declarations_in_merged_declaration_0_must_be_all_exported_or_all_local,r.identifierNode.range,r.identifierNode.text)}return r}function V(e,t){var r=e.members;if(r){let e=t.members;e||(t.members=e=new Map);for(let[t,n]of r)e.set(t,n)}}function K(e,t,r,i=!1){switch(t.kind){case d.FILE:return i?e:t.internalName+n.PATH_DELIMITER+e;case d.FUNCTION:return i?e:(assert(!r),t.internalName+n.INNER_DELIMITER+e);default:return K(t.name,t.parent,t.is(n.CommonFlags.INSTANCE),i)+(r?n.INSTANCE_DELIMITER:n.STATIC_DELIMITER)+e}}t.Interface=class extends P{constructor(e,t,r=[],n=null){super(e,t,r,n,!0)}},t.mangleInternalName=K},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);var i,s;!function(e){e[e.None=_BinaryenTypeNone()]="None",e[e.I32=_BinaryenTypeInt32()]="I32",e[e.I64=_BinaryenTypeInt64()]="I64",e[e.F32=_BinaryenTypeFloat32()]="F32",e[e.F64=_BinaryenTypeFloat64()]="F64",e[e.V128=_BinaryenTypeVec128()]="V128",e[e.Anyref=_BinaryenTypeAnyref()]="Anyref",e[e.Exnref=_BinaryenTypeExnref()]="Exnref",e[e.Unreachable=_BinaryenTypeUnreachable()]="Unreachable",e[e.Auto=_BinaryenTypeAuto()]="Auto"}(i=t.NativeType||(t.NativeType={})),function(e){e[e.MVP=_BinaryenFeatureMVP()]="MVP",e[e.Atomics=_BinaryenFeatureAtomics()]="Atomics",e[e.MutableGloabls=_BinaryenFeatureMutableGlobals()]="MutableGloabls",e[e.NontrappingFPToInt=_BinaryenFeatureNontrappingFPToInt()]="NontrappingFPToInt",e[e.SIMD128=_BinaryenFeatureSIMD128()]="SIMD128",e[e.BulkMemory=_BinaryenFeatureBulkMemory()]="BulkMemory",e[e.SignExt=_BinaryenFeatureSignExt()]="SignExt",e[e.ExceptionHandling=_BinaryenFeatureExceptionHandling()]="ExceptionHandling",e[e.TailCall=_BinaryenFeatureTailCall()]="TailCall",e[e.ReferenceTypes=_BinaryenFeatureReferenceTypes()]="ReferenceTypes",e[e.All=_BinaryenFeatureAll()]="All"}(t.FeatureFlags||(t.FeatureFlags={})),function(e){e[e.Invalid=_BinaryenInvalidId()]="Invalid",e[e.Block=_BinaryenBlockId()]="Block",e[e.If=_BinaryenIfId()]="If",e[e.Loop=_BinaryenLoopId()]="Loop",e[e.Break=_BinaryenBreakId()]="Break",e[e.Switch=_BinaryenSwitchId()]="Switch",e[e.Call=_BinaryenCallId()]="Call",e[e.CallIndirect=_BinaryenCallIndirectId()]="CallIndirect",e[e.LocalGet=_BinaryenLocalGetId()]="LocalGet",e[e.LocalSet=_BinaryenLocalSetId()]="LocalSet",e[e.GlobalGet=_BinaryenGlobalGetId()]="GlobalGet",e[e.GlobalSet=_BinaryenGlobalSetId()]="GlobalSet",e[e.Load=_BinaryenLoadId()]="Load",e[e.Store=_BinaryenStoreId()]="Store",e[e.Const=_BinaryenConstId()]="Const",e[e.Unary=_BinaryenUnaryId()]="Unary",e[e.Binary=_BinaryenBinaryId()]="Binary",e[e.Select=_BinaryenSelectId()]="Select",e[e.Drop=_BinaryenDropId()]="Drop",e[e.Return=_BinaryenReturnId()]="Return",e[e.Host=_BinaryenHostId()]="Host",e[e.Nop=_BinaryenNopId()]="Nop",e[e.Unreachable=_BinaryenUnreachableId()]="Unreachable",e[e.AtomicCmpxchg=_BinaryenAtomicCmpxchgId()]="AtomicCmpxchg",e[e.AtomicRMW=_BinaryenAtomicRMWId()]="AtomicRMW",e[e.AtomicWait=_BinaryenAtomicWaitId()]="AtomicWait",e[e.AtomicNotify=_BinaryenAtomicNotifyId()]="AtomicNotify",e[e.AtomicFence=_BinaryenAtomicFenceId()]="AtomicFence",e[e.SIMDExtract=_BinaryenSIMDExtractId()]="SIMDExtract",e[e.SIMDReplace=_BinaryenSIMDReplaceId()]="SIMDReplace",e[e.SIMDShuffle=_BinaryenSIMDShuffleId()]="SIMDShuffle",e[e.SIMDTernary=_BinaryenSIMDTernaryId()]="SIMDTernary",e[e.SIMDShift=_BinaryenSIMDShiftId()]="SIMDShift",e[e.SIMDLoad=_BinaryenSIMDLoadId()]="SIMDLoad",e[e.MemoryInit=_BinaryenMemoryInitId()]="MemoryInit",e[e.DataDrop=_BinaryenDataDropId()]="DataDrop",e[e.MemoryCopy=_BinaryenMemoryCopyId()]="MemoryCopy",e[e.MemoryFill=_BinaryenMemoryFillId()]="MemoryFill",e[e.Try=_BinaryenTryId()]="Try",e[e.Throw=_BinaryenThrowId()]="Throw",e[e.Rethrow=_BinaryenRethrowId()]="Rethrow",e[e.BrOnExn=_BinaryenBrOnExnId()]="BrOnExn",e[e.Push=_BinaryenPushId()]="Push",e[e.Pop=_BinaryenPopId()]="Pop"}(s=t.ExpressionId||(t.ExpressionId={})),function(e){e[e.ClzI32=_BinaryenClzInt32()]="ClzI32",e[e.CtzI32=_BinaryenCtzInt32()]="CtzI32",e[e.PopcntI32=_BinaryenPopcntInt32()]="PopcntI32",e[e.NegF32=_BinaryenNegFloat32()]="NegF32",e[e.AbsF32=_BinaryenAbsFloat32()]="AbsF32",e[e.CeilF32=_BinaryenCeilFloat32()]="CeilF32",e[e.FloorF32=_BinaryenFloorFloat32()]="FloorF32",e[e.TruncF32=_BinaryenTruncFloat32()]="TruncF32",e[e.NearestF32=_BinaryenNearestFloat32()]="NearestF32",e[e.SqrtF32=_BinaryenSqrtFloat32()]="SqrtF32",e[e.EqzI32=_BinaryenEqZInt32()]="EqzI32",e[e.ClzI64=_BinaryenClzInt64()]="ClzI64",e[e.CtzI64=_BinaryenCtzInt64()]="CtzI64",e[e.PopcntI64=_BinaryenPopcntInt64()]="PopcntI64",e[e.NegF64=_BinaryenNegFloat64()]="NegF64",e[e.AbsF64=_BinaryenAbsFloat64()]="AbsF64",e[e.CeilF64=_BinaryenCeilFloat64()]="CeilF64",e[e.FloorF64=_BinaryenFloorFloat64()]="FloorF64",e[e.TruncF64=_BinaryenTruncFloat64()]="TruncF64",e[e.NearestF64=_BinaryenNearestFloat64()]="NearestF64",e[e.SqrtF64=_BinaryenSqrtFloat64()]="SqrtF64",e[e.EqzI64=_BinaryenEqZInt64()]="EqzI64",e[e.ExtendI32=_BinaryenExtendSInt32()]="ExtendI32",e[e.ExtendU32=_BinaryenExtendUInt32()]="ExtendU32",e[e.WrapI64=_BinaryenWrapInt64()]="WrapI64",e[e.TruncF32ToI32=_BinaryenTruncSFloat32ToInt32()]="TruncF32ToI32",e[e.TruncF32ToI64=_BinaryenTruncSFloat32ToInt64()]="TruncF32ToI64",e[e.TruncF32ToU32=_BinaryenTruncUFloat32ToInt32()]="TruncF32ToU32",e[e.TruncF32ToU64=_BinaryenTruncUFloat32ToInt64()]="TruncF32ToU64",e[e.TruncF64ToI32=_BinaryenTruncSFloat64ToInt32()]="TruncF64ToI32",e[e.TruncF64ToI64=_BinaryenTruncSFloat64ToInt64()]="TruncF64ToI64",e[e.TruncF64ToU32=_BinaryenTruncUFloat64ToInt32()]="TruncF64ToU32",e[e.TruncF64ToU64=_BinaryenTruncUFloat64ToInt64()]="TruncF64ToU64",e[e.ReinterpretF32=_BinaryenReinterpretFloat32()]="ReinterpretF32",e[e.ReinterpretF64=_BinaryenReinterpretFloat64()]="ReinterpretF64",e[e.ConvertI32ToF32=_BinaryenConvertSInt32ToFloat32()]="ConvertI32ToF32",e[e.ConvertI32ToF64=_BinaryenConvertSInt32ToFloat64()]="ConvertI32ToF64",e[e.ConvertU32ToF32=_BinaryenConvertUInt32ToFloat32()]="ConvertU32ToF32",e[e.ConvertU32ToF64=_BinaryenConvertUInt32ToFloat64()]="ConvertU32ToF64",e[e.ConvertI64ToF32=_BinaryenConvertSInt64ToFloat32()]="ConvertI64ToF32",e[e.ConvertI64ToF64=_BinaryenConvertSInt64ToFloat64()]="ConvertI64ToF64",e[e.ConvertU64ToF32=_BinaryenConvertUInt64ToFloat32()]="ConvertU64ToF32",e[e.ConvertU64ToF64=_BinaryenConvertUInt64ToFloat64()]="ConvertU64ToF64",e[e.PromoteF32=_BinaryenPromoteFloat32()]="PromoteF32",e[e.DemoteF64=_BinaryenDemoteFloat64()]="DemoteF64",e[e.ReinterpretI32=_BinaryenReinterpretInt32()]="ReinterpretI32",e[e.ReinterpretI64=_BinaryenReinterpretInt64()]="ReinterpretI64",e[e.ExtendI8ToI32=_BinaryenExtendS8Int32()]="ExtendI8ToI32",e[e.ExtendI16ToI32=_BinaryenExtendS16Int32()]="ExtendI16ToI32",e[e.ExtendI8ToI64=_BinaryenExtendS8Int64()]="ExtendI8ToI64",e[e.ExtendI16ToI64=_BinaryenExtendS16Int64()]="ExtendI16ToI64",e[e.ExtendI32ToI64=_BinaryenExtendS32Int64()]="ExtendI32ToI64",e[e.TruncF32ToI32Sat=_BinaryenTruncSatSFloat32ToInt32()]="TruncF32ToI32Sat",e[e.TruncF32ToU32Sat=_BinaryenTruncSatUFloat32ToInt32()]="TruncF32ToU32Sat",e[e.TruncF64ToI32Sat=_BinaryenTruncSatSFloat64ToInt32()]="TruncF64ToI32Sat",e[e.TruncF64ToU32Sat=_BinaryenTruncSatUFloat64ToInt32()]="TruncF64ToU32Sat",e[e.TruncF32ToI64Sat=_BinaryenTruncSatSFloat32ToInt64()]="TruncF32ToI64Sat",e[e.TruncF32ToU64Sat=_BinaryenTruncSatUFloat32ToInt64()]="TruncF32ToU64Sat",e[e.TruncF64ToI64Sat=_BinaryenTruncSatSFloat64ToInt64()]="TruncF64ToI64Sat",e[e.TruncF64ToU64Sat=_BinaryenTruncSatUFloat64ToInt64()]="TruncF64ToU64Sat",e[e.SplatI8x16=_BinaryenSplatVecI8x16()]="SplatI8x16",e[e.SplatI16x8=_BinaryenSplatVecI16x8()]="SplatI16x8",e[e.SplatI32x4=_BinaryenSplatVecI32x4()]="SplatI32x4",e[e.SplatI64x2=_BinaryenSplatVecI64x2()]="SplatI64x2",e[e.SplatF32x4=_BinaryenSplatVecF32x4()]="SplatF32x4",e[e.SplatF64x2=_BinaryenSplatVecF64x2()]="SplatF64x2",e[e.NotV128=_BinaryenNotVec128()]="NotV128",e[e.NegI8x16=_BinaryenNegVecI8x16()]="NegI8x16",e[e.AnyTrueI8x16=_BinaryenAnyTrueVecI8x16()]="AnyTrueI8x16",e[e.AllTrueI8x16=_BinaryenAllTrueVecI8x16()]="AllTrueI8x16",e[e.NegI16x8=_BinaryenNegVecI16x8()]="NegI16x8",e[e.AnyTrueI16x8=_BinaryenAnyTrueVecI16x8()]="AnyTrueI16x8",e[e.AllTrueI16x8=_BinaryenAllTrueVecI16x8()]="AllTrueI16x8",e[e.NegI32x4=_BinaryenNegVecI32x4()]="NegI32x4",e[e.AnyTrueI32x4=_BinaryenAnyTrueVecI32x4()]="AnyTrueI32x4",e[e.AllTrueI32x4=_BinaryenAllTrueVecI32x4()]="AllTrueI32x4",e[e.NegI64x2=_BinaryenNegVecI64x2()]="NegI64x2",e[e.AnyTrueI64x2=_BinaryenAnyTrueVecI64x2()]="AnyTrueI64x2",e[e.AllTrueI64x2=_BinaryenAllTrueVecI64x2()]="AllTrueI64x2",e[e.AbsF32x4=_BinaryenAbsVecF32x4()]="AbsF32x4",e[e.NegF32x4=_BinaryenNegVecF32x4()]="NegF32x4",e[e.SqrtF32x4=_BinaryenSqrtVecF32x4()]="SqrtF32x4",e[e.AbsF64x2=_BinaryenAbsVecF64x2()]="AbsF64x2",e[e.NegF64x2=_BinaryenNegVecF64x2()]="NegF64x2",e[e.SqrtF64x2=_BinaryenSqrtVecF64x2()]="SqrtF64x2",e[e.TruncSatF32x4ToI32x4=_BinaryenTruncSatSVecF32x4ToVecI32x4()]="TruncSatF32x4ToI32x4",e[e.TruncSatF32x4ToU32x4=_BinaryenTruncSatUVecF32x4ToVecI32x4()]="TruncSatF32x4ToU32x4",e[e.TruncSatF64x2ToI64x2=_BinaryenTruncSatSVecF64x2ToVecI64x2()]="TruncSatF64x2ToI64x2",e[e.TruncSatF64x2ToU64x2=_BinaryenTruncSatUVecF64x2ToVecI64x2()]="TruncSatF64x2ToU64x2",e[e.ConvertI32x4ToF32x4=_BinaryenConvertSVecI32x4ToVecF32x4()]="ConvertI32x4ToF32x4",e[e.ConvertU32x4ToF32x4=_BinaryenConvertUVecI32x4ToVecF32x4()]="ConvertU32x4ToF32x4",e[e.ConvertI64x2ToF64x2=_BinaryenConvertSVecI64x2ToVecF64x2()]="ConvertI64x2ToF64x2",e[e.ConvertU64x2ToF64x2=_BinaryenConvertUVecI64x2ToVecF64x2()]="ConvertU64x2ToF64x2",e[e.WidenLowI8x16ToI16x8=_BinaryenWidenLowSVecI8x16ToVecI16x8()]="WidenLowI8x16ToI16x8",e[e.WidenLowU8x16ToU16x8=_BinaryenWidenLowUVecI8x16ToVecI16x8()]="WidenLowU8x16ToU16x8",e[e.WidenHighI8x16ToI16x8=_BinaryenWidenHighSVecI8x16ToVecI16x8()]="WidenHighI8x16ToI16x8",e[e.WidenHighU8x16ToU16x8=_BinaryenWidenHighUVecI8x16ToVecI16x8()]="WidenHighU8x16ToU16x8",e[e.WidenLowI16x8ToI32x4=_BinaryenWidenLowSVecI16x8ToVecI32x4()]="WidenLowI16x8ToI32x4",e[e.WidenLowU16x8ToU32x4=_BinaryenWidenLowUVecI16x8ToVecI32x4()]="WidenLowU16x8ToU32x4",e[e.WidenHighI16x8ToI32x4=_BinaryenWidenHighSVecI16x8ToVecI32x4()]="WidenHighI16x8ToI32x4",e[e.WidenHighU16x8ToU32x4=_BinaryenWidenHighUVecI16x8ToVecI32x4()]="WidenHighU16x8ToU32x4"}(t.UnaryOp||(t.UnaryOp={})),function(e){e[e.AddI32=_BinaryenAddInt32()]="AddI32",e[e.SubI32=_BinaryenSubInt32()]="SubI32",e[e.MulI32=_BinaryenMulInt32()]="MulI32",e[e.DivI32=_BinaryenDivSInt32()]="DivI32",e[e.DivU32=_BinaryenDivUInt32()]="DivU32",e[e.RemI32=_BinaryenRemSInt32()]="RemI32",e[e.RemU32=_BinaryenRemUInt32()]="RemU32",e[e.AndI32=_BinaryenAndInt32()]="AndI32",e[e.OrI32=_BinaryenOrInt32()]="OrI32",e[e.XorI32=_BinaryenXorInt32()]="XorI32",e[e.ShlI32=_BinaryenShlInt32()]="ShlI32",e[e.ShrU32=_BinaryenShrUInt32()]="ShrU32",e[e.ShrI32=_BinaryenShrSInt32()]="ShrI32",e[e.RotlI32=_BinaryenRotLInt32()]="RotlI32",e[e.RotrI32=_BinaryenRotRInt32()]="RotrI32",e[e.EqI32=_BinaryenEqInt32()]="EqI32",e[e.NeI32=_BinaryenNeInt32()]="NeI32",e[e.LtI32=_BinaryenLtSInt32()]="LtI32",e[e.LtU32=_BinaryenLtUInt32()]="LtU32",e[e.LeI32=_BinaryenLeSInt32()]="LeI32",e[e.LeU32=_BinaryenLeUInt32()]="LeU32",e[e.GtI32=_BinaryenGtSInt32()]="GtI32",e[e.GtU32=_BinaryenGtUInt32()]="GtU32",e[e.GeI32=_BinaryenGeSInt32()]="GeI32",e[e.GeU32=_BinaryenGeUInt32()]="GeU32",e[e.AddI64=_BinaryenAddInt64()]="AddI64",e[e.SubI64=_BinaryenSubInt64()]="SubI64",e[e.MulI64=_BinaryenMulInt64()]="MulI64",e[e.DivI64=_BinaryenDivSInt64()]="DivI64",e[e.DivU64=_BinaryenDivUInt64()]="DivU64",e[e.RemI64=_BinaryenRemSInt64()]="RemI64",e[e.RemU64=_BinaryenRemUInt64()]="RemU64",e[e.AndI64=_BinaryenAndInt64()]="AndI64",e[e.OrI64=_BinaryenOrInt64()]="OrI64",e[e.XorI64=_BinaryenXorInt64()]="XorI64",e[e.ShlI64=_BinaryenShlInt64()]="ShlI64",e[e.ShrU64=_BinaryenShrUInt64()]="ShrU64",e[e.ShrI64=_BinaryenShrSInt64()]="ShrI64",e[e.RotlI64=_BinaryenRotLInt64()]="RotlI64",e[e.RotrI64=_BinaryenRotRInt64()]="RotrI64",e[e.EqI64=_BinaryenEqInt64()]="EqI64",e[e.NeI64=_BinaryenNeInt64()]="NeI64",e[e.LtI64=_BinaryenLtSInt64()]="LtI64",e[e.LtU64=_BinaryenLtUInt64()]="LtU64",e[e.LeI64=_BinaryenLeSInt64()]="LeI64",e[e.LeU64=_BinaryenLeUInt64()]="LeU64",e[e.GtI64=_BinaryenGtSInt64()]="GtI64",e[e.GtU64=_BinaryenGtUInt64()]="GtU64",e[e.GeI64=_BinaryenGeSInt64()]="GeI64",e[e.GeU64=_BinaryenGeUInt64()]="GeU64",e[e.AddF32=_BinaryenAddFloat32()]="AddF32",e[e.SubF32=_BinaryenSubFloat32()]="SubF32",e[e.MulF32=_BinaryenMulFloat32()]="MulF32",e[e.DivF32=_BinaryenDivFloat32()]="DivF32",e[e.CopysignF32=_BinaryenCopySignFloat32()]="CopysignF32",e[e.MinF32=_BinaryenMinFloat32()]="MinF32",e[e.MaxF32=_BinaryenMaxFloat32()]="MaxF32",e[e.EqF32=_BinaryenEqFloat32()]="EqF32",e[e.NeF32=_BinaryenNeFloat32()]="NeF32",e[e.LtF32=_BinaryenLtFloat32()]="LtF32",e[e.LeF32=_BinaryenLeFloat32()]="LeF32",e[e.GtF32=_BinaryenGtFloat32()]="GtF32",e[e.GeF32=_BinaryenGeFloat32()]="GeF32",e[e.AddF64=_BinaryenAddFloat64()]="AddF64",e[e.SubF64=_BinaryenSubFloat64()]="SubF64",e[e.MulF64=_BinaryenMulFloat64()]="MulF64",e[e.DivF64=_BinaryenDivFloat64()]="DivF64",e[e.CopysignF64=_BinaryenCopySignFloat64()]="CopysignF64",e[e.MinF64=_BinaryenMinFloat64()]="MinF64",e[e.MaxF64=_BinaryenMaxFloat64()]="MaxF64",e[e.EqF64=_BinaryenEqFloat64()]="EqF64",e[e.NeF64=_BinaryenNeFloat64()]="NeF64",e[e.LtF64=_BinaryenLtFloat64()]="LtF64",e[e.LeF64=_BinaryenLeFloat64()]="LeF64",e[e.GtF64=_BinaryenGtFloat64()]="GtF64",e[e.GeF64=_BinaryenGeFloat64()]="GeF64",e[e.EqI8x16=_BinaryenEqVecI8x16()]="EqI8x16",e[e.NeI8x16=_BinaryenNeVecI8x16()]="NeI8x16",e[e.LtI8x16=_BinaryenLtSVecI8x16()]="LtI8x16",e[e.LtU8x16=_BinaryenLtUVecI8x16()]="LtU8x16",e[e.LeI8x16=_BinaryenLeSVecI8x16()]="LeI8x16",e[e.LeU8x16=_BinaryenLeUVecI8x16()]="LeU8x16",e[e.GtI8x16=_BinaryenGtSVecI8x16()]="GtI8x16",e[e.GtU8x16=_BinaryenGtUVecI8x16()]="GtU8x16",e[e.GeI8x16=_BinaryenGeSVecI8x16()]="GeI8x16",e[e.GeU8x16=_BinaryenGeUVecI8x16()]="GeU8x16",e[e.EqI16x8=_BinaryenEqVecI16x8()]="EqI16x8",e[e.NeI16x8=_BinaryenNeVecI16x8()]="NeI16x8",e[e.LtI16x8=_BinaryenLtSVecI16x8()]="LtI16x8",e[e.LtU16x8=_BinaryenLtUVecI16x8()]="LtU16x8",e[e.LeI16x8=_BinaryenLeSVecI16x8()]="LeI16x8",e[e.LeU16x8=_BinaryenLeUVecI16x8()]="LeU16x8",e[e.GtI16x8=_BinaryenGtSVecI16x8()]="GtI16x8",e[e.GtU16x8=_BinaryenGtUVecI16x8()]="GtU16x8",e[e.GeI16x8=_BinaryenGeSVecI16x8()]="GeI16x8",e[e.GeU16x8=_BinaryenGeUVecI16x8()]="GeU16x8",e[e.EqI32x4=_BinaryenEqVecI32x4()]="EqI32x4",e[e.NeI32x4=_BinaryenNeVecI32x4()]="NeI32x4",e[e.LtI32x4=_BinaryenLtSVecI32x4()]="LtI32x4",e[e.LtU32x4=_BinaryenLtUVecI32x4()]="LtU32x4",e[e.LeI32x4=_BinaryenLeSVecI32x4()]="LeI32x4",e[e.LeU32x4=_BinaryenLeUVecI32x4()]="LeU32x4",e[e.GtI32x4=_BinaryenGtSVecI32x4()]="GtI32x4",e[e.GtU32x4=_BinaryenGtUVecI32x4()]="GtU32x4",e[e.GeI32x4=_BinaryenGeSVecI32x4()]="GeI32x4",e[e.GeU32x4=_BinaryenGeUVecI32x4()]="GeU32x4",e[e.EqF32x4=_BinaryenEqVecF32x4()]="EqF32x4",e[e.NeF32x4=_BinaryenNeVecF32x4()]="NeF32x4",e[e.LtF32x4=_BinaryenLtVecF32x4()]="LtF32x4",e[e.LeF32x4=_BinaryenLeVecF32x4()]="LeF32x4",e[e.GtF32x4=_BinaryenGtVecF32x4()]="GtF32x4",e[e.GeF32x4=_BinaryenGeVecF32x4()]="GeF32x4",e[e.EqF64x2=_BinaryenEqVecF64x2()]="EqF64x2",e[e.NeF64x2=_BinaryenNeVecF64x2()]="NeF64x2",e[e.LtF64x2=_BinaryenLtVecF64x2()]="LtF64x2",e[e.LeF64x2=_BinaryenLeVecF64x2()]="LeF64x2",e[e.GtF64x2=_BinaryenGtVecF64x2()]="GtF64x2",e[e.GeF64x2=_BinaryenGeVecF64x2()]="GeF64x2",e[e.AndV128=_BinaryenAndVec128()]="AndV128",e[e.OrV128=_BinaryenOrVec128()]="OrV128",e[e.XorV128=_BinaryenXorVec128()]="XorV128",e[e.AndNotV128=_BinaryenAndNotVec128()]="AndNotV128",e[e.AddI8x16=_BinaryenAddVecI8x16()]="AddI8x16",e[e.AddSatI8x16=_BinaryenAddSatSVecI8x16()]="AddSatI8x16",e[e.AddSatU8x16=_BinaryenAddSatUVecI8x16()]="AddSatU8x16",e[e.SubI8x16=_BinaryenSubVecI8x16()]="SubI8x16",e[e.SubSatI8x16=_BinaryenSubSatSVecI8x16()]="SubSatI8x16",e[e.SubSatU8x16=_BinaryenSubSatUVecI8x16()]="SubSatU8x16",e[e.MulI8x16=_BinaryenMulVecI8x16()]="MulI8x16",e[e.MinI8x16=_BinaryenMinSVecI8x16()]="MinI8x16",e[e.MinU8x16=_BinaryenMinUVecI8x16()]="MinU8x16",e[e.MaxI8x16=_BinaryenMaxSVecI8x16()]="MaxI8x16",e[e.MaxU8x16=_BinaryenMaxUVecI8x16()]="MaxU8x16",e[e.AddI16x8=_BinaryenAddVecI16x8()]="AddI16x8",e[e.AddSatI16x8=_BinaryenAddSatSVecI16x8()]="AddSatI16x8",e[e.AddSatU16x8=_BinaryenAddSatUVecI16x8()]="AddSatU16x8",e[e.SubI16x8=_BinaryenSubVecI16x8()]="SubI16x8",e[e.SubSatI16x8=_BinaryenSubSatSVecI16x8()]="SubSatI16x8",e[e.SubSatU16x8=_BinaryenSubSatUVecI16x8()]="SubSatU16x8",e[e.MulI16x8=_BinaryenMulVecI16x8()]="MulI16x8",e[e.MinI16x8=_BinaryenMinSVecI16x8()]="MinI16x8",e[e.MinU16x8=_BinaryenMinUVecI16x8()]="MinU16x8",e[e.MaxI16x8=_BinaryenMaxSVecI16x8()]="MaxI16x8",e[e.MaxU16x8=_BinaryenMaxUVecI16x8()]="MaxU16x8",e[e.AddI32x4=_BinaryenAddVecI32x4()]="AddI32x4",e[e.SubI32x4=_BinaryenSubVecI32x4()]="SubI32x4",e[e.MulI32x4=_BinaryenMulVecI32x4()]="MulI32x4",e[e.MinI32x4=_BinaryenMinSVecI32x4()]="MinI32x4",e[e.MinU32x4=_BinaryenMinUVecI32x4()]="MinU32x4",e[e.MaxI32x4=_BinaryenMaxSVecI32x4()]="MaxI32x4",e[e.MaxU32x4=_BinaryenMaxUVecI32x4()]="MaxU32x4",e[e.DotI16x8=_BinaryenDotSVecI16x8ToVecI32x4()]="DotI16x8",e[e.AddI64x2=_BinaryenAddVecI64x2()]="AddI64x2",e[e.SubI64x2=_BinaryenSubVecI64x2()]="SubI64x2",e[e.AddF32x4=_BinaryenAddVecF32x4()]="AddF32x4",e[e.SubF32x4=_BinaryenSubVecF32x4()]="SubF32x4",e[e.MulF32x4=_BinaryenMulVecF32x4()]="MulF32x4",e[e.DivF32x4=_BinaryenDivVecF32x4()]="DivF32x4",e[e.MinF32x4=_BinaryenMinVecF32x4()]="MinF32x4",e[e.MaxF32x4=_BinaryenMaxVecF32x4()]="MaxF32x4",e[e.AddF64x2=_BinaryenAddVecF64x2()]="AddF64x2",e[e.SubF64x2=_BinaryenSubVecF64x2()]="SubF64x2",e[e.MulF64x2=_BinaryenMulVecF64x2()]="MulF64x2",e[e.DivF64x2=_BinaryenDivVecF64x2()]="DivF64x2",e[e.MinF64x2=_BinaryenMinVecF64x2()]="MinF64x2",e[e.MaxF64x2=_BinaryenMaxVecF64x2()]="MaxF64x2",e[e.NarrowI16x8ToI8x16=_BinaryenNarrowSVecI16x8ToVecI8x16()]="NarrowI16x8ToI8x16",e[e.NarrowU16x8ToU8x16=_BinaryenNarrowUVecI16x8ToVecI8x16()]="NarrowU16x8ToU8x16",e[e.NarrowI32x4ToI16x8=_BinaryenNarrowSVecI32x4ToVecI16x8()]="NarrowI32x4ToI16x8",e[e.NarrowU32x4ToU16x8=_BinaryenNarrowUVecI32x4ToVecI16x8()]="NarrowU32x4ToU16x8",e[e.SwizzleV8x16=_BinaryenSwizzleVec8x16()]="SwizzleV8x16"}(t.BinaryOp||(t.BinaryOp={})),function(e){e[e.MemorySize=_BinaryenMemorySize()]="MemorySize",e[e.MemoryGrow=_BinaryenMemoryGrow()]="MemoryGrow"}(t.HostOp||(t.HostOp={})),function(e){e[e.Add=_BinaryenAtomicRMWAdd()]="Add",e[e.Sub=_BinaryenAtomicRMWSub()]="Sub",e[e.And=_BinaryenAtomicRMWAnd()]="And",e[e.Or=_BinaryenAtomicRMWOr()]="Or",e[e.Xor=_BinaryenAtomicRMWXor()]="Xor",e[e.Xchg=_BinaryenAtomicRMWXchg()]="Xchg"}(t.AtomicRMWOp||(t.AtomicRMWOp={})),function(e){e[e.ExtractLaneI8x16=_BinaryenExtractLaneSVecI8x16()]="ExtractLaneI8x16",e[e.ExtractLaneU8x16=_BinaryenExtractLaneUVecI8x16()]="ExtractLaneU8x16",e[e.ExtractLaneI16x8=_BinaryenExtractLaneSVecI16x8()]="ExtractLaneI16x8",e[e.ExtractLaneU16x8=_BinaryenExtractLaneUVecI16x8()]="ExtractLaneU16x8",e[e.ExtractLaneI32x4=_BinaryenExtractLaneVecI32x4()]="ExtractLaneI32x4",e[e.ExtractLaneI64x2=_BinaryenExtractLaneVecI64x2()]="ExtractLaneI64x2",e[e.ExtractLaneF32x4=_BinaryenExtractLaneVecF32x4()]="ExtractLaneF32x4",e[e.ExtractLaneF64x2=_BinaryenExtractLaneVecF64x2()]="ExtractLaneF64x2"}(t.SIMDExtractOp||(t.SIMDExtractOp={})),function(e){e[e.ReplaceLaneI8x16=_BinaryenReplaceLaneVecI8x16()]="ReplaceLaneI8x16",e[e.ReplaceLaneI16x8=_BinaryenReplaceLaneVecI16x8()]="ReplaceLaneI16x8",e[e.ReplaceLaneI32x4=_BinaryenReplaceLaneVecI32x4()]="ReplaceLaneI32x4",e[e.ReplaceLaneI64x2=_BinaryenReplaceLaneVecI64x2()]="ReplaceLaneI64x2",e[e.ReplaceLaneF32x4=_BinaryenReplaceLaneVecF32x4()]="ReplaceLaneF32x4",e[e.ReplaceLaneF64x2=_BinaryenReplaceLaneVecF64x2()]="ReplaceLaneF64x2"}(t.SIMDReplaceOp||(t.SIMDReplaceOp={})),function(e){e[e.ShlI8x16=_BinaryenShlVecI8x16()]="ShlI8x16",e[e.ShrI8x16=_BinaryenShrSVecI8x16()]="ShrI8x16",e[e.ShrU8x16=_BinaryenShrUVecI8x16()]="ShrU8x16",e[e.ShlI16x8=_BinaryenShlVecI16x8()]="ShlI16x8",e[e.ShrI16x8=_BinaryenShrSVecI16x8()]="ShrI16x8",e[e.ShrU16x8=_BinaryenShrUVecI16x8()]="ShrU16x8",e[e.ShlI32x4=_BinaryenShlVecI32x4()]="ShlI32x4",e[e.ShrI32x4=_BinaryenShrSVecI32x4()]="ShrI32x4",e[e.ShrU32x4=_BinaryenShrUVecI32x4()]="ShrU32x4",e[e.ShlI64x2=_BinaryenShlVecI64x2()]="ShlI64x2",e[e.ShrI64x2=_BinaryenShrSVecI64x2()]="ShrI64x2",e[e.ShrU64x2=_BinaryenShrUVecI64x2()]="ShrU64x2"}(t.SIMDShiftOp||(t.SIMDShiftOp={})),function(e){e[e.Bitselect=_BinaryenBitselectVec128()]="Bitselect",e[e.QFMAF32x4=_BinaryenQFMAVecF32x4()]="QFMAF32x4",e[e.QFMSF32x4=_BinaryenQFMSVecF32x4()]="QFMSF32x4",e[e.QFMAF64x2=_BinaryenQFMAVecF64x2()]="QFMAF64x2",e[e.QFMSF64x2=_BinaryenQFMSVecF64x2()]="QFMSF64x2"}(t.SIMDTernaryOp||(t.SIMDTernaryOp={})),function(e){e[e.LoadSplatV8x16=_BinaryenLoadSplatVec8x16()]="LoadSplatV8x16",e[e.LoadSplatV16x8=_BinaryenLoadSplatVec16x8()]="LoadSplatV16x8",e[e.LoadSplatV32x4=_BinaryenLoadSplatVec32x4()]="LoadSplatV32x4",e[e.LoadSplatV64x2=_BinaryenLoadSplatVec64x2()]="LoadSplatV64x2",e[e.LoadI8ToI16x8=_BinaryenLoadExtSVec8x8ToVecI16x8()]="LoadI8ToI16x8",e[e.LoadU8ToU16x8=_BinaryenLoadExtUVec8x8ToVecI16x8()]="LoadU8ToU16x8",e[e.LoadI16ToI32x4=_BinaryenLoadExtSVec16x4ToVecI32x4()]="LoadI16ToI32x4",e[e.LoadU16ToU32x4=_BinaryenLoadExtUVec16x4ToVecI32x4()]="LoadU16ToU32x4",e[e.LoadI32ToI64x2=_BinaryenLoadExtSVec32x2ToVecI64x2()]="LoadI32ToI64x2",e[e.LoadU32ToU64x2=_BinaryenLoadExtUVec32x2ToVecI64x2()]="LoadU32ToU64x2"}(t.SIMDLoadOp||(t.SIMDLoadOp={}));class a{static create(e,t){var r=new a;return r.buffer=e,r.offset=t,r}}t.MemorySegment=a;class o{constructor(){this.hasTemporaryFunction=!1,this.cachedPrecomputeNames=0,this.cachedStrings=new Map}static create(){var e=new o;return e.ref=_BinaryenModuleCreate(),e.lit=memory.allocate(_BinaryenSizeofLiteral()),e}static createFrom(e){var t=u(e);try{let r=new o;return r.ref=_BinaryenModuleRead(t,e.length),r.lit=memory.allocate(_BinaryenSizeofLiteral()),r}finally{memory.free(changetype(t))}}addFunctionType(e,t,r){var n=this.allocStringCached(e),i=p(r);try{return _BinaryenAddFunctionType(this.ref,n,t,i,r?r.length:0)}finally{memory.free(i)}}getFunctionTypeBySignature(e,t){var r=p(t);try{return _BinaryenGetFunctionTypeBySignature(this.ref,e,r,t?t.length:0)}finally{memory.free(r)}}removeFunctionType(e){var t=this.allocStringCached(e);_BinaryenRemoveFunctionType(this.ref,t)}i32(e){var t=this.lit;return _BinaryenLiteralInt32(t,e),_BinaryenConst(this.ref,t)}i64(e,t=0){var r=this.lit;return _BinaryenLiteralInt64(r,e,t),_BinaryenConst(this.ref,r)}f32(e){var t=this.lit;return _BinaryenLiteralFloat32(t,e),_BinaryenConst(this.ref,t)}f64(e){var t=this.lit;return _BinaryenLiteralFloat64(t,e),_BinaryenConst(this.ref,t)}v128(e){assert(16==e.length);var t=this.lit;for(let r=0;r<16;++r)store(t+r,e[r]);return _BinaryenLiteralVec128(t,t),_BinaryenConst(this.ref,t)}unary(e,t){return _BinaryenUnary(this.ref,e,t)}binary(e,t,r){return _BinaryenBinary(this.ref,e,t,r)}host(e,t=null,r=null){var n=this.allocStringCached(t),i=_(r);try{return _BinaryenHost(this.ref,e,n,i,r?r.length:0)}finally{memory.free(i)}}local_get(e,t){return _BinaryenLocalGet(this.ref,e,t)}local_tee(e,t){return _BinaryenLocalTee(this.ref,e,t)}global_get(e,t){var r=this.allocStringCached(e);return _BinaryenGlobalGet(this.ref,r,t)}load(e,t,r,n,i=0,s=e){return _BinaryenLoad(this.ref,e,t?1:0,i,s,n,r)}store(e,t,r,n,s=0,a=e){if(n<i.None||n>i.V128)throw new Error("here: "+n);return _BinaryenStore(this.ref,e,s,a,t,r,n)}atomic_load(e,t,r,n=0){return _BinaryenAtomicLoad(this.ref,e,n,r,t)}atomic_store(e,t,r,n,i=0){return _BinaryenAtomicStore(this.ref,e,i,t,r,n)}atomic_rmw(e,t,r,n,i,s){return _BinaryenAtomicRMW(this.ref,e,t,r,n,i,s)}atomic_cmpxchg(e,t,r,n,i,s){return _BinaryenAtomicCmpxchg(this.ref,e,t,r,n,i,s)}atomic_wait(e,t,r,n){return _BinaryenAtomicWait(this.ref,e,t,r,n)}atomic_notify(e,t){return _BinaryenAtomicNotify(this.ref,e,t)}atomic_fence(){return _BinaryenAtomicFence(this.ref)}local_set(e,t){return _BinaryenLocalSet(this.ref,e,t)}global_set(e,t){var r=this.allocStringCached(e);return _BinaryenGlobalSet(this.ref,r,t)}block(e,t,r=i.None){var n=this.allocStringCached(e),s=_(t);try{return _BinaryenBlock(this.ref,n,s,t.length,r)}finally{memory.free(s)}}br(e,t=0,r=0){var n=this.allocStringCached(e);return _BinaryenBreak(this.ref,n,t,r)}drop(e){return _BinaryenDrop(this.ref,e)}loop(e,t){var r=this.allocStringCached(e);return _BinaryenLoop(this.ref,r,t)}if(e,t,r=0){return _BinaryenIf(this.ref,e,t,r)}nop(){return _BinaryenNop(this.ref)}return(e=0){return _BinaryenReturn(this.ref,e)}select(e,t,r){return _BinaryenSelect(this.ref,r,e,t)}switch(e,t,r,n=0){var i=e.length,s=new Array(i);for(let t=0;t<i;++t)s[t]=this.allocStringCached(e[t]);var a=p(s),o=this.allocStringCached(t);try{return _BinaryenSwitch(this.ref,a,i,o,r,n)}finally{memory.free(a)}}call(e,t,r,n=!1){var i=this.allocStringCached(e),s=_(t);try{return n?_BinaryenReturnCall(this.ref,i,s,t&&t.length||0,r):_BinaryenCall(this.ref,i,s,t&&t.length||0,r)}finally{memory.free(s)}}return_call(e,t,r){return this.call(e,t,r,!0)}call_indirect(e,t,r,n=!1){var i=this.allocStringCached(r),s=_(t);try{return n?_BinaryenReturnCallIndirect(this.ref,e,s,t&&t.length||0,i):_BinaryenCallIndirect(this.ref,e,s,t&&t.length||0,i)}finally{memory.free(s)}}return_call_indirect(e,t,r){return this.call_indirect(e,t,r,!0)}unreachable(){return _BinaryenUnreachable(this.ref)}memory_copy(e,t,r){return _BinaryenMemoryCopy(this.ref,e,t,r)}memory_fill(e,t,r){return _BinaryenMemoryFill(this.ref,e,t,r)}try(e,t){return _BinaryenTry(this.ref,e,t)}throw(e,t){var r=this.allocStringCached(e),n=_(t);try{return _BinaryenThrow(this.ref,r,n,t.length)}finally{memory.free(n)}}rethrow(e){return _BinaryenRethrow(this.ref,e)}br_on_exn(e,t,r){var n=this.allocStringCached(e),i=this.allocStringCached(t);return _BinaryenBrOnExn(this.ref,n,i,r)}push(e){return _BinaryenPush(this.ref,e)}pop(e){return _BinaryenPop(this.ref,e)}simd_extract(e,t,r){return _BinaryenSIMDExtract(this.ref,e,t,r)}simd_replace(e,t,r,n){return _BinaryenSIMDReplace(this.ref,e,t,r,n)}simd_shuffle(e,t,r){assert(16==r.length);var n=u(r);try{return _BinaryenSIMDShuffle(this.ref,e,t,n)}finally{memory.free(n)}}simd_ternary(e,t,r,n){return _BinaryenSIMDTernary(this.ref,e,t,r,n)}simd_shift(e,t,r){return _BinaryenSIMDShift(this.ref,e,t,r)}simd_load(e,t,r,n){return _BinaryenSIMDLoad(this.ref,e,r,n,t)}addGlobal(e,t,r,n){var i=this.allocStringCached(e);return _BinaryenAddGlobal(this.ref,i,t,r,n)}removeGlobal(e){var t=this.allocStringCached(e);_BinaryenRemoveGlobal(this.ref,t)}addEvent(e,t,r){var n=this.allocStringCached(e);return _BinaryenAddEvent(this.ref,n,t,r)}addFunction(e,t,r,n){var i=this.allocStringCached(e),s=p(r);try{return _BinaryenAddFunction(this.ref,i,t,s,r?r.length:0,n)}finally{memory.free(s)}}getFunction(e){var t=this.allocStringCached(e);return _BinaryenGetFunction(this.ref,t)}removeFunction(e){var t=this.allocStringCached(e);_BinaryenRemoveFunction(this.ref,t)}addTemporaryFunction(e,t,r){this.hasTemporaryFunction=assert(!this.hasTemporaryFunction);var n=this.allocStringCached(""),i=p(t);try{let s=_BinaryenAddFunctionType(this.ref,n,e,i,t?t.length:0);return _BinaryenAddFunction(this.ref,n,s,0,0,r)}finally{memory.free(i)}}removeTemporaryFunction(){this.hasTemporaryFunction=!assert(this.hasTemporaryFunction);var e=this.allocStringCached("");_BinaryenRemoveFunction(this.ref,e),_BinaryenRemoveFunctionType(this.ref,e)}addFunctionExport(e,t){var r=this.allocStringCached(e),n=this.allocStringCached(t);return _BinaryenAddFunctionExport(this.ref,r,n)}addTableExport(e,t){var r=this.allocStringCached(e),n=this.allocStringCached(t);return _BinaryenAddTableExport(this.ref,r,n)}addMemoryExport(e,t){var r=this.allocStringCached(e),n=this.allocStringCached(t);return _BinaryenAddMemoryExport(this.ref,r,n)}addGlobalExport(e,t){var r=this.allocStringCached(e),n=this.allocStringCached(t);return _BinaryenAddGlobalExport(this.ref,r,n)}addEventExport(e,t){var r=this.allocStringCached(e),n=this.allocStringCached(t);return _BinaryenAddEventExport(this.ref,r,n)}removeExport(e){var t=this.allocStringCached(e);_BinaryenRemoveExport(this.ref,t)}addFunctionImport(e,t,r,n){var i=this.allocStringCached(e),s=this.allocStringCached(t),a=this.allocStringCached(r);_BinaryenAddFunctionImport(this.ref,i,s,a,n)}addTableImport(e,t,r){var n=this.allocStringCached(e),i=this.allocStringCached(t),s=this.allocStringCached(r);_BinaryenAddTableImport(this.ref,n,i,s)}addMemoryImport(e,t,r,n=!1){var i=this.allocStringCached(e),s=this.allocStringCached(t),a=this.allocStringCached(r);_BinaryenAddMemoryImport(this.ref,i,s,a,n)}addGlobalImport(e,t,r,n,i=!1){var s=this.allocStringCached(e),a=this.allocStringCached(t),o=this.allocStringCached(r);_BinaryenAddGlobalImport(this.ref,s,a,o,n,i)}addEventImport(e,t,r,n,i){var s=this.allocStringCached(e),a=this.allocStringCached(t),o=this.allocStringCached(r);_BinaryenAddEventImport(this.ref,s,a,o,n,i)}setMemory(e,t,r,i,s=null,a=!1){var o=this.allocStringCached(s),l=r.length,c=new Array(l),_=new Uint8Array(l),h=new Array(l),d=new Array(l);for(let e=0;e<l;++e){let t=r[e].buffer,s=r[e].offset;c[e]=u(t),_[e]=0,h[e]=i==n.Target.WASM64?this.i64(i64_low(s),i64_high(s)):this.i32(i64_low(s)),d[e]=t.length}var y=p(c),T=u(_),m=p(h),g=p(d);try{_BinaryenSetMemory(this.ref,e,t,o,y,T,m,g,l,a)}finally{memory.free(g),memory.free(m),memory.free(T),memory.free(y);for(let e=l-1;e>=0;--e)memory.free(c[e])}}setFunctionTable(e,t,r,n){var i=r.length,s=new Array(i);for(let e=0;e<i;++e)s[e]=this.allocStringCached(r[e]);var a=p(s);try{_BinaryenSetFunctionTable(this.ref,e,t,a,i,n)}finally{memory.free(a)}}setStart(e){_BinaryenSetStart(this.ref,e)}addCustomSection(e,t){var r=this.allocStringCached(e),n=u(t);try{_BinaryenAddCustomSection(this.ref,r,n,t.length)}finally{memory.free(n)}}getOptimizeLevel(){return _BinaryenGetOptimizeLevel()}setOptimizeLevel(e=2){_BinaryenSetOptimizeLevel(e)}getShrinkLevel(){return _BinaryenGetShrinkLevel()}setShrinkLevel(e=1){_BinaryenSetShrinkLevel(e)}setDebugInfo(e=!1){_BinaryenSetDebugInfo(e)}getFeatures(){return _BinaryenModuleGetFeatures(this.ref)}setFeatures(e){_BinaryenModuleSetFeatures(this.ref,e)}optimize(e=0){e?_BinaryenFunctionOptimize(e,this.ref):_BinaryenModuleOptimize(this.ref)}runPasses(e,t=0){var r=e.length,n=new Array(r);for(let t=0;t<r;++t)n[t]=h(e[t]);var i=p(n);try{t?_BinaryenFunctionRunPasses(t,this.ref,i,r):_BinaryenModuleRunPasses(this.ref,i,r)}finally{memory.free(i);for(let e=r;e>=0;--e)memory.free(n[e])}}precomputeExpression(e){var t=_BinaryenGetOptimizeLevel(),r=_BinaryenGetShrinkLevel(),n=_BinaryenGetDebugInfo();_BinaryenSetOptimizeLevel(4),_BinaryenSetShrinkLevel(0),_BinaryenSetDebugInfo(!1);var i=_BinaryenExpressionGetType(e),a=this.addTemporaryFunction(i,null,e),o=this.cachedPrecomputeNames;return o||(this.cachedPrecomputeNames=o=p([this.allocStringCached("vacuum"),this.allocStringCached("precompute")])),_BinaryenFunctionRunPasses(a,this.ref,o,2),e=_BinaryenFunctionGetBody(a),_BinaryenExpressionGetId(e)==s.Return&&(e=_BinaryenReturnGetValue(e)),this.removeTemporaryFunction(),_BinaryenSetOptimizeLevel(t),_BinaryenSetShrinkLevel(r),_BinaryenSetDebugInfo(n),e}validate(){return 1==_BinaryenModuleValidate(this.ref)}interpret(){_BinaryenModuleInterpret(this.ref)}toBinary(e){var t=this.lit;assert(_BinaryenSizeofLiteral()>=12);var r=h(e),n=0,i=0;try{_BinaryenModuleAllocateAndWrite(t,this.ref,r),n=d(t);let e=d(t+4);i=d(t+8);let s=new T;return s.output=function(e,t){var r=new Uint8Array(t);for(let n=0;n<t;++n)r[n]=load(e+n);return r}(n,e),s.sourceMap=y(i),s}finally{r&&memory.free(r),n&&memory.free(n),i&&memory.free(i)}}toText(){throw new Error("not implemented")}toAsmjs(){throw new Error("not implemented")}allocStringCached(e){if(null==e)return 0;var t=this.cachedStrings;if(t.has(e))return t.get(e);var r=h(e);return t.set(e,r),r}dispose(){assert(this.ref);for(let e of this.cachedStrings.values())memory.free(e);this.cachedStrings=new Map,memory.free(this.lit),memory.free(this.cachedPrecomputeNames),this.cachedPrecomputeNames=0,_BinaryenModuleDispose(this.ref),this.ref=0}createRelooper(){return c.create(this)}cloneExpression(e,t=!1,r=i32.MAX_VALUE){if(r<0)return 0;var n,a;switch(r-=1,_BinaryenExpressionGetId(e)){case s.Const:switch(_BinaryenExpressionGetType(e)){case i.I32:return this.i32(_BinaryenConstGetValueI32(e));case i.I64:return this.i64(_BinaryenConstGetValueI64Low(e),_BinaryenConstGetValueI64High(e));case i.F32:return this.f32(_BinaryenConstGetValueF32(e));case i.F64:return this.f64(_BinaryenConstGetValueF64(e));case i.V128:case i.Anyref:return 0;default:throw new Error("concrete type expected")}case s.LocalGet:return _BinaryenLocalGet(this.ref,_BinaryenLocalGetGetIndex(e),_BinaryenExpressionGetType(e));case s.GlobalGet:{let t=_BinaryenGlobalGetGetName(e);if(!t)break;return _BinaryenGlobalGet(this.ref,t,_BinaryenExpressionGetType(e))}case s.Load:if(!(n=this.cloneExpression(_BinaryenLoadGetPtr(e),t,r)))break;return _BinaryenLoadIsAtomic(e)?_BinaryenAtomicLoad(this.ref,_BinaryenLoadGetBytes(e),_BinaryenLoadGetOffset(e),_BinaryenExpressionGetType(e),n):_BinaryenLoad(this.ref,_BinaryenLoadGetBytes(e),_BinaryenLoadIsSigned(e)?1:0,_BinaryenLoadGetOffset(e),_BinaryenLoadGetAlign(e),_BinaryenExpressionGetType(e),n);case s.Unary:if(!(n=this.cloneExpression(_BinaryenUnaryGetValue(e),t,r)))break;return _BinaryenUnary(this.ref,_BinaryenUnaryGetOp(e),n);case s.Binary:if(!(n=this.cloneExpression(_BinaryenBinaryGetLeft(e),t,r)))break;if(!(a=this.cloneExpression(_BinaryenBinaryGetRight(e),t,r)))break;return _BinaryenBinary(this.ref,_BinaryenBinaryGetOp(e),n,a)}return 0}addDebugInfoFile(e){var t=h(e);try{return _BinaryenModuleAddDebugInfoFileName(this.ref,t)}finally{memory.free(t)}}getDebugInfoFile(e){return y(_BinaryenModuleGetDebugInfoFileName(this.ref,e))}setDebugLocation(e,t,r,n,i){_BinaryenFunctionSetDebugLocation(e,t,r,n,i)}}function l(e){return _BinaryenExpressionGetId(e)}t.Module=o,o.UNLIMITED_MEMORY=-1,t.getExpressionId=l,t.getExpressionType=function(e){return _BinaryenExpressionGetType(e)},t.getConstValueI32=function(e){return _BinaryenConstGetValueI32(e)},t.getConstValueI64Low=function(e){return _BinaryenConstGetValueI64Low(e)},t.getConstValueI64High=function(e){return _BinaryenConstGetValueI64High(e)},t.getConstValueF32=function(e){return _BinaryenConstGetValueF32(e)},t.getConstValueF64=function(e){return _BinaryenConstGetValueF64(e)},t.getLocalGetIndex=function(e){return _BinaryenLocalGetGetIndex(e)},t.getLocalSetIndex=function(e){return _BinaryenLocalSetGetIndex(e)},t.getLocalSetValue=function(e){return _BinaryenLocalSetGetValue(e)},t.isLocalTee=function(e){return _BinaryenLocalSetIsTee(e)},t.getGlobalGetName=function(e){return y(_BinaryenGlobalGetGetName(e))},t.getBinaryOp=function(e){return _BinaryenBinaryGetOp(e)},t.getBinaryLeft=function(e){return _BinaryenBinaryGetLeft(e)},t.getBinaryRight=function(e){return _BinaryenBinaryGetRight(e)},t.getUnaryOp=function(e){return _BinaryenUnaryGetOp(e)},t.getUnaryValue=function(e){return _BinaryenUnaryGetValue(e)},t.getLoadBytes=function(e){return _BinaryenLoadGetBytes(e)},t.getLoadOffset=function(e){return _BinaryenLoadGetOffset(e)},t.getLoadPtr=function(e){return _BinaryenLoadGetPtr(e)},t.isLoadSigned=function(e){return _BinaryenLoadIsSigned(e)},t.getStoreBytes=function(e){return _BinaryenStoreGetBytes(e)},t.getStoreOffset=function(e){return _BinaryenStoreGetOffset(e)},t.getStorePtr=function(e){return _BinaryenStoreGetPtr(e)},t.getStoreValue=function(e){return _BinaryenStoreGetValue(e)},t.getBlockName=function(e){return y(_BinaryenBlockGetName(e))},t.getBlockChildCount=function(e){return _BinaryenBlockGetNumChildren(e)},t.getBlockChild=function(e,t){return _BinaryenBlockGetChild(e,t)},t.getIfCondition=function(e){return _BinaryenIfGetCondition(e)},t.getIfTrue=function(e){return _BinaryenIfGetIfTrue(e)},t.getIfFalse=function(e){return _BinaryenIfGetIfFalse(e)},t.getLoopName=function(e){return y(_BinaryenLoopGetName(e))},t.getLoopBody=function(e){return _BinaryenLoopGetBody(e)},t.getBreakName=function(e){return y(_BinaryenBreakGetName(e))},t.getBreakCondition=function(e){return _BinaryenBreakGetCondition(e)},t.getSelectThen=function(e){return _BinaryenSelectGetIfTrue(e)},t.getSelectElse=function(e){return _BinaryenSelectGetIfFalse(e)},t.getSelectCondition=function(e){return _BinaryenSelectGetCondition(e)},t.getDropValue=function(e){return _BinaryenDropGetValue(e)},t.getReturnValue=function(e){return _BinaryenReturnGetValue(e)},t.getCallTarget=function(e){return y(_BinaryenCallGetTarget(e))},t.getCallOperandCount=function(e){return _BinaryenCallGetNumOperands(e)},t.getCallOperand=function(e,t){return _BinaryenCallGetOperand(e,t)},t.getHostOp=function(e){return _BinaryenHostGetOp(e)},t.getHostOperandCount=function(e){return _BinaryenHostGetNumOperands(e)},t.getHostOperand=function(e,t){return _BinaryenHostGetOperand(e,t)},t.getHostName=function(e){return y(_BinaryenHostGetNameOperand(e))},t.getFunctionBody=function(e){return _BinaryenFunctionGetBody(e)},t.getFunctionName=function(e){return y(_BinaryenFunctionGetName(e))},t.getFunctionParamCount=function(e){return _BinaryenFunctionGetNumParams(e)},t.getFunctionParamType=function(e,t){return _BinaryenFunctionGetParam(e,t)},t.getFunctionResultType=function(e){return _BinaryenFunctionGetResult(e)};class c{constructor(){}static create(e){var t=new c;return t.module=e,t.ref=_RelooperCreate(e.ref),t}addBlock(e){return _RelooperAddBlock(this.ref,e)}addBranch(e,t,r=0,n=0){_RelooperAddBranch(e,t,r,n)}addBlockWithSwitch(e,t){return _RelooperAddBlockWithSwitch(this.ref,e,t)}addBranchForSwitch(e,t,r,n=0){var i=p(r);try{_RelooperAddBranchForSwitch(e,t,i,r.length,n)}finally{memory.free(i)}}renderAndDispose(e,t){return _RelooperRenderAndDispose(this.ref,e,t)}}function u(e){if(!e)return 0;var t=e.length,r=memory.allocate(t),n=r;for(let r=0;r<t;++r)store(n++,e[r]);return r}function p(e){if(!e)return 0;var t=memory.allocate(e.length<<2),r=t;for(let t=0,n=e.length;t<n;++t){let n=e[t];store(r,255&n),store(r+1,n>>8&255),store(r+2,n>>16&255),store(r+3,n>>>24),r+=4}return t}function _(e){return p(e)}function h(e){if(null==e)return 0;var t=memory.allocate(function(e){var t=0;for(let r=0,n=e.length;r<n;++r){let i=e.charCodeAt(r);i>=55296&&i<=57343&&r+1<n&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++r)),i<=127?++t:t+=i<=2047?2:i<=65535?3:i<=2097151?4:i<=67108863?5:6}return t}(e)+1),r=t;for(let t=0,n=e.length;t<n;++t){let i=e.charCodeAt(t);i>=55296&&i<=57343&&t+1<n&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++t)),i<=127?store(r++,i):i<=2047?(store(r++,192|i>>>6),store(r++,128|63&i)):i<=65535?(store(r++,224|i>>>12),store(r++,128|i>>>6&63),store(r++,128|63&i)):i<=2097151?(store(r++,240|i>>>18),store(r++,128|i>>>12&63),store(r++,128|i>>>6&63),store(r++,128|63&i)):i<=67108863?(store(r++,248|i>>>24),store(r++,128|i>>>18&63),store(r++,128|i>>>12&63),store(r++,128|i>>>6&63),store(r++,128|63&i)):(store(r++,252|i>>>30),store(r++,128|i>>>24&63),store(r++,128|i>>>18&63),store(r++,128|i>>>12&63),store(r++,128|i>>>6&63),store(r++,128|63&i))}return store(r,0),t}function d(e){return load(e)|load(e+1)<<8|load(e+2)<<16|load(e+3)<<24}function y(e){if(!e)return null;for(var t,r,n,i,s,a=new Array;t=load(e++);)128&t?(r=63&load(e++),192!=(224&t)?(n=63&load(e++),224==(240&t)?t=(15&t)<<12|r<<6|n:(i=63&load(e++),240==(248&t)?t=(7&t)<<18|r<<12|n<<6|i:(s=63&load(e++),t=248==(252&t)?(3&t)<<24|r<<18|n<<12|i<<6|s:(1&t)<<30|r<<24|n<<18|i<<12|s<<6|63&load(e++))),a.push(t)):a.push((31&t)<<6|r)):a.push(t);return String.fromCodePoints(a)}t.Relooper=c,t.hasSideEffects=function e(t){switch(_BinaryenExpressionGetId(t)){case s.LocalGet:case s.GlobalGet:case s.Const:case s.Nop:return!1;case s.Block:for(let r=0,n=_BinaryenBlockGetNumChildren(t);r<n;++r)if(e(_BinaryenBlockGetChild(t,r)))return!0;return!1;case s.If:return e(_BinaryenIfGetCondition(t))||e(_BinaryenIfGetIfTrue(t))||e(_BinaryenIfGetIfFalse(t));case s.Unary:return e(_BinaryenUnaryGetValue(t));case s.Binary:return e(_BinaryenBinaryGetLeft(t))||e(_BinaryenBinaryGetRight(t));case s.Drop:return e(_BinaryenDropGetValue(t));case s.Select:return e(_BinaryenSelectGetIfTrue(t))||e(_BinaryenSelectGetIfFalse(t))||e(_BinaryenSelectGetCondition(t))}return!0},t.readString=y;class T{}t.BinaryModule=T,t.needsExplicitUnreachable=function e(t){if(_BinaryenExpressionGetType(t)!=i.Unreachable)return!1;switch(_BinaryenExpressionGetId(t)){case s.Unreachable:case s.Return:return!1;case s.Break:return 0!=_BinaryenBreakGetCondition(t);case s.Block:if(!_BinaryenBlockGetName(t)){let r=_BinaryenBlockGetNumChildren(t);return r>0&&e(_BinaryenBlockGetChild(t,r-1))}}return!0},t.traverse=function(e,t,r){switch(l(e)){case s.Block:for(let n=0,i=_BinaryenBlockGetNumChildren(e);n<i;++n)r(_BinaryenBlockGetChild(e,n),t);break;case s.If:{r(_BinaryenIfGetCondition(e),t),r(_BinaryenIfGetIfTrue(e),t);let n=_BinaryenIfGetIfFalse(e);n&&r(n,t);break}case s.Loop:r(_BinaryenLoopGetBody(e),t);break;case s.Break:{let n=_BinaryenBreakGetCondition(e);n&&r(n,t);break}case s.Switch:r(_BinaryenSwitchGetCondition(e),t);break;case s.Call:for(let n=0,i=_BinaryenCallGetNumOperands(e);n<i;++n)r(_BinaryenCallGetOperand(e,n),t);break;case s.CallIndirect:for(let n=0,i=_BinaryenCallIndirectGetNumOperands(e);n<i;++n)r(_BinaryenCallIndirectGetOperand(e,n),t);break;case s.LocalGet:break;case s.LocalSet:r(_BinaryenLocalSetGetValue(e),t);break;case s.GlobalGet:break;case s.GlobalSet:r(_BinaryenGlobalSetGetValue(e),t);break;case s.Load:r(_BinaryenLoadGetPtr(e),t);break;case s.Store:r(_BinaryenStoreGetPtr(e),t),r(_BinaryenStoreGetValue(e),t);break;case s.AtomicRMW:r(_BinaryenAtomicRMWGetPtr(e),t),r(_BinaryenAtomicRMWGetValue(e),t);break;case s.AtomicCmpxchg:r(_BinaryenAtomicCmpxchgGetPtr(e),t),r(_BinaryenAtomicCmpxchgGetExpected(e),t),r(_BinaryenAtomicCmpxchgGetReplacement(e),t);break;case s.AtomicWait:r(_BinaryenAtomicWaitGetPtr(e),t),r(_BinaryenAtomicWaitGetExpected(e),t),r(_BinaryenAtomicWaitGetTimeout(e),t);break;case s.AtomicNotify:r(_BinaryenAtomicNotifyGetPtr(e),t);break;case s.AtomicFence:break;case s.SIMDExtract:r(_BinaryenSIMDExtractGetVec(e),t);break;case s.SIMDReplace:r(_BinaryenSIMDReplaceGetVec(e),t),r(_BinaryenSIMDReplaceGetValue(e),t);break;case s.SIMDShuffle:r(_BinaryenSIMDShuffleGetLeft(e),t),r(_BinaryenSIMDShuffleGetRight(e),t);break;case s.SIMDTernary:r(_BinaryenSIMDTernaryGetA(e),t),r(_BinaryenSIMDTernaryGetB(e),t),r(_BinaryenSIMDTernaryGetC(e),t);break;case s.SIMDShift:r(_BinaryenSIMDShiftGetVec(e),t),r(_BinaryenSIMDShiftGetShift(e),t);break;case s.SIMDLoad:r(_BinaryenSIMDLoadGetPtr(e),t);break;case s.MemoryInit:r(_BinaryenMemoryInitGetDest(e),t),r(_BinaryenMemoryInitGetOffset(e),t),r(_BinaryenMemoryInitGetSize(e),t);break;case s.DataDrop:break;case s.MemoryCopy:r(_BinaryenMemoryCopyGetDest(e),t),r(_BinaryenMemoryCopyGetSource(e),t),r(_BinaryenMemoryCopyGetSize(e),t);break;case s.MemoryFill:r(_BinaryenMemoryFillGetDest(e),t),r(_BinaryenMemoryFillGetValue(e),t),r(_BinaryenMemoryFillGetSize(e),t);break;case s.Try:r(_BinaryenTryGetBody(e),t),r(_BinaryenTryGetCatchBody(e),t);break;case s.Throw:for(let n=0,i=_BinaryenThrowGetNumOperands(e);n<i;++n)r(_BinaryenThrowGetOperand(e,n),t);break;case s.Rethrow:r(_BinaryenRethrowGetExnref(e),t);break;case s.BrOnExn:r(_BinaryenBrOnExnGetExnref(e),t);break;case s.Push:r(_BinaryenPushGetValue(e),t);break;case s.Pop:case s.Const:break;case s.Unary:r(_BinaryenUnaryGetValue(e),t);break;case s.Binary:r(_BinaryenBinaryGetLeft(e),t),r(_BinaryenBinaryGetRight(e),t);break;case s.Select:r(_BinaryenSelectGetIfTrue(e),t),r(_BinaryenSelectGetIfFalse(e),t),r(_BinaryenSelectGetCondition(e),t);break;case s.Drop:r(_BinaryenDropGetValue(e),t);break;case s.Return:r(_BinaryenReturnGetValue(e),t);break;case s.Host:for(let n=0,i=_BinaryenHostGetNumOperands(e);n<i;++n)r(_BinaryenHostGetOperand(e,n),t);break;case s.Nop:case s.Unreachable:break;default:assert(!1)}return!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(5);!function(e){e[e.I8=0]="I8",e[e.I16=1]="I16",e[e.I32=2]="I32",e[e.I64=3]="I64",e[e.ISIZE=4]="ISIZE",e[e.U8=5]="U8",e[e.U16=6]="U16",e[e.U32=7]="U32",e[e.U64=8]="U64",e[e.USIZE=9]="USIZE",e[e.BOOL=10]="BOOL",e[e.F32=11]="F32",e[e.F64=12]="F64",e[e.V128=13]="V128",e[e.ANYREF=14]="ANYREF",e[e.VOID=15]="VOID"}(t.TypeKind||(t.TypeKind={})),function(e){e[e.NONE=0]="NONE",e[e.SIGNED=1]="SIGNED",e[e.UNSIGNED=2]="UNSIGNED",e[e.INTEGER=4]="INTEGER",e[e.FLOAT=8]="FLOAT",e[e.POINTER=16]="POINTER",e[e.SHORT=32]="SHORT",e[e.LONG=64]="LONG",e[e.VALUE=128]="VALUE",e[e.REFERENCE=256]="REFERENCE",e[e.NULLABLE=512]="NULLABLE",e[e.VECTOR=1024]="VECTOR"}(t.TypeFlags||(t.TypeFlags={}));const s=new Uint8Array(16);class a{constructor(e,t,r){this.cachedNullableType=null,this.kind=e,this.flags=t,this.size=r,this.byteSize=ceil(r/8),this.classReference=null,this.signatureReference=null,this.nonNullableType=this}get intType(){switch(this.kind){case 0:return a.i8;case 1:return a.i16;case 11:case 2:return a.i32;case 12:case 3:return a.i64;case 4:return 64==this.size?a.isize64:a.isize32;case 5:return a.u8;case 6:return a.u16;case 7:return a.u32;case 8:return a.u64;case 9:return 64==this.size?a.usize64:a.usize32;case 10:default:return a.i32}}get exceptVoid(){return 15==this.kind?a.auto:this}get alignLog2(){return 31-clz(this.byteSize)}get isManaged(){var e=this.classReference;return null!==e&&!e.hasDecorator(n.DecoratorFlags.UNMANAGED)}get isUnmanaged(){var e=this.classReference;return null!==e&&e.hasDecorator(n.DecoratorFlags.UNMANAGED)}computeSmallIntegerShift(e){return e.size-this.size}computeSmallIntegerMask(e){var t=this.is(2)?this.size:this.size-1;return-1>>>e.size-t}is(e){return(this.flags&e)==e}isAny(e){return 0!=(this.flags&e)}asClass(e){assert(9==this.kind&&!this.classReference);var t=new a(this.kind,-129&this.flags|256,this.size);return t.classReference=e,t}asFunction(e){assert(7==this.kind&&!this.signatureReference);var t=new a(this.kind,-129&this.flags|256,this.size);return t.signatureReference=e,t}asNullable(){return assert(this.is(256)),this.cachedNullableType||(assert(!this.is(512)),this.cachedNullableType=new a(this.kind,512|this.flags,this.size),this.cachedNullableType.nonNullableType=this,this.cachedNullableType.classReference=this.classReference,this.cachedNullableType.signatureReference=this.signatureReference),this.cachedNullableType}isAssignableTo(e,t=!1){var r,n,i,s;if(this.is(256)){if(e.is(256)&&(!this.is(512)||e.is(512)))if(r=this.classReference){if(n=e.classReference)return r.isAssignableTo(n)}else if(i=this.signatureReference){if(s=e.signatureReference)return i.isAssignableTo(s)}else if(14==this.kind&&14==e.kind)return!0}else if(!e.is(256))if(this.is(4))if(e.is(4)){if(!t||this==a.bool||this.is(1)==e.is(1))return this.size<=e.size}else{if(11==e.kind)return this.size<=23;if(12==e.kind)return this.size<=52}else if(this.is(8)){if(e.is(8))return this.size<=e.size}else if(this.is(1024)&&e.is(1024))return this.size==e.size;return!1}isStrictlyAssignableTo(e,t=!1){return this.is(256)?this.isAssignableTo(e):!e.is(256)&&(this.is(4)?e.is(4)&&e.size==this.size&&(!t||this.is(1)==e.is(1)):this.kind==e.kind)}isChangeableTo(e){if(this.is(4)&&e.is(4)){let t=this.size;return t==e.size&&(t>=32||this.is(1)==e.is(1))}return this.kind==e.kind}static commonDenominator(e,t,r){return t.isAssignableTo(e,r)?e:e.isAssignableTo(t,r)?t:null}toString(){if(this.is(256)){let e=this.classReference;if(e)return this.is(512)?e.internalName+" | null":e.internalName;let t=this.signatureReference;return t?this.is(512)?"("+t.toString()+") | null":t.toString():(assert(14==this.kind),"anyref")}switch(this.kind){case 0:return"i8";case 1:return"i16";case 2:return"i32";case 3:return"i64";case 4:return"isize";case 5:return"u8";case 6:return"u16";case 7:return"u32";case 8:return"u64";case 9:return"usize";case 10:return"bool";case 11:return"f32";case 12:return"f64";case 13:return"v128";case 14:return"anyref";default:assert(!1);case 15:return"void"}}toNativeType(){switch(this.kind){default:return i.NativeType.I32;case 3:case 8:return i.NativeType.I64;case 4:case 9:return 64==this.size?i.NativeType.I64:i.NativeType.I32;case 11:return i.NativeType.F32;case 12:return i.NativeType.F64;case 13:return i.NativeType.V128;case 14:return i.NativeType.Anyref;case 15:return i.NativeType.None}}toNativeZero(e){switch(this.kind){case 14:case 15:assert(!1);default:return e.i32(0);case 4:case 9:if(64!=this.size)return e.i32(0);case 3:case 8:return e.i64(0);case 11:return e.f32(0);case 12:return e.f64(0);case 13:return e.v128(s)}}toNativeOne(e){switch(this.kind){case 13:case 14:case 15:assert(!1);default:return e.i32(1);case 4:case 9:if(64!=this.size)return e.i32(1);case 3:case 8:return e.i64(1);case 11:return e.f32(1);case 12:return e.f64(1)}}toNativeNegOne(e){switch(this.kind){case 13:case 14:case 15:assert(!1);default:return e.i32(-1);case 4:case 9:if(64!=this.size)return e.i32(-1);case 3:case 8:return e.i64(-1,-1);case 11:return e.f32(-1);case 12:return e.f64(-1)}}toSignatureString(){switch(this.kind){case 0:case 5:case 1:case 6:case 2:case 7:case 10:return"i";case 3:case 8:return"j";case 4:case 9:return 64==this.size?"j":"i";case 11:return"f";case 12:return"d";case 13:return"V";case 14:return"a";case 15:return"v";default:assert(!1)}return"i"}}t.Type=a,a.i8=new a(0,165,8),a.i16=new a(1,165,16),a.i32=new a(2,133,32),a.i64=new a(3,197,64),a.isize32=new a(4,149,32),a.isize64=new a(4,213,64),a.u8=new a(5,166,8),a.u16=new a(6,166,16),a.u32=new a(7,134,32),a.u64=new a(8,198,64),a.usize32=new a(9,150,32),a.usize64=new a(9,214,64),a.bool=new a(10,166,1),a.f32=new a(11,137,32),a.f64=new a(12,201,64),a.v128=new a(13,1152,128),a.anyref=new a(14,256,0),a.void=new a(15,0,0),a.auto=new a(a.i32.kind,a.i32.flags,a.i32.size),t.typesToNativeTypes=function(e){var t=e.length,r=new Array(t);for(let n=0;n<t;++n)r[n]=e[n].toNativeType();return r},t.typesToString=function(e){var t=e.length;if(!t)return"";var r=new Array(t);for(let n=0;n<t;++n)r[n]=e[n].toString();return r.join(",")};class o{constructor(e,t=null,r=null,n=null){this.id=0,this.cachedFunctionTarget=null,this.parameterTypes=t||[],this.parameterNames=null,this.requiredParameters=0,this.returnType=r||a.void,this.thisType=n,this.program=e,this.hasRest=!1,this.type=a.u32.asFunction(this);var i=e.uniqueSignatures,s=i.length;for(let e=0;e<s;e++){let t=i[e];if(this.equals(t))return this.id=t.id,this}e.uniqueSignatures.push(this),this.id=e.nextSignatureId++}asFunctionTarget(e){var t=this.cachedFunctionTarget;return t?assert(t.program==e):this.cachedFunctionTarget=t=new n.FunctionTarget(this,e),t}getParameterName(e){var t=this.parameterNames;return t&&t.length>e?t[e]:c(e)}isAssignableTo(e){return this.equals(e)}equals(e){var t=this.thisType,r=e.thisType;if(t){if(!r||!t.isAssignableTo(r))return!1}else if(r)return!1;if(this.hasRest!=e.hasRest)return!1;var n=this.parameterTypes,i=e.parameterTypes,s=n.length;if(s!=i.length)return!1;for(let e=0;e<s;++e){let t=n[e],r=i[e];if(!t.isAssignableTo(r))return!1}var a=this.returnType,o=e.returnType;return a==o||a.isAssignableTo(o)}static makeSignatureString(e,t,r=null){var n=[];if(n.push(t.toSignatureString()),r&&n.push(r.toSignatureString()),e)for(let t=0,r=e.length;t<r;++t)n.push(e[t].toSignatureString());return"FUNCSIG$"+n.join("")}toSignatureString(){return o.makeSignatureString(this.parameterTypes,this.returnType,this.thisType)}toString(){var e=new Array;e.push("(");var t=0,r=this.thisType;r&&(e.push("this: "),assert(!r.signatureReference),e.push(r.toString()),t=1);var n=this.parameterTypes,i=n.length;if(i){let r=this.parameterNames,s=r?r.length:0,a=this.requiredParameters,o=this.hasRest?i-1:-1;for(let l=0;l<i;++l,++t)t&&e.push(", "),l==o&&e.push("..."),l<s?e.push(r[l]):e.push(c(l)),l>=a&&l!=o?e.push("?: "):e.push(": "),e.push(n[l].toString())}return e.push(") => "),e.push(this.returnType.toString()),e.join("")}}t.Signature=o;var l=null;function c(e){l||(l=[]);for(let t=l.length;t<=e;++t)l.push("arg$"+t.toString(10));return l[e-1]}t.getDefaultParameterName=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(3),s=r(1);var a,o;function l(e){switch(assert(e.length),e.charCodeAt(0)){case 97:switch(e){case"abstract":return a.ABSTRACT;case"as":return a.AS;case"async":return a.ASYNC;case"await":return a.AWAIT}break;case 98:switch(e){case"break":return a.BREAK}break;case 99:switch(e){case"case":return a.CASE;case"catch":return a.CATCH;case"class":return a.CLASS;case"continue":return a.CONTINUE;case"const":return a.CONST;case"constructor":return a.CONSTRUCTOR}break;case 100:switch(e){case"debugger":return a.DEBUGGER;case"declare":return a.DECLARE;case"default":return a.DEFAULT;case"delete":return a.DELETE;case"do":return a.DO}break;case 101:switch(e){case"else":return a.ELSE;case"enum":return a.ENUM;case"export":return a.EXPORT;case"extends":return a.EXTENDS}break;case 102:switch(e){case"false":return a.FALSE;case"finally":return a.FINALLY;case"for":return a.FOR;case"from":return a.FROM;case"function":return a.FUNCTION}break;case 103:switch(e){case"get":return a.GET}break;case 105:switch(e){case"if":return a.IF;case"implements":return a.IMPLEMENTS;case"import":return a.IMPORT;case"in":return a.IN;case"instanceof":return a.INSTANCEOF;case"interface":return a.INTERFACE;case"is":return a.IS}break;case 107:switch(e){case"keyof":return a.KEYOF}break;case 108:switch(e){case"let":return a.LET}break;case 109:switch(e){case"module":return a.MODULE}break;case 110:switch(e){case"namespace":return a.NAMESPACE;case"new":return a.NEW;case"null":return a.NULL}break;case 111:switch(e){case"of":return a.OF}break;case 112:switch(e){case"package":return a.PACKAGE;case"private":return a.PRIVATE;case"protected":return a.PROTECTED;case"public":return a.PUBLIC}break;case 114:switch(e){case"readonly":return a.READONLY;case"return":return a.RETURN}break;case 115:switch(e){case"set":return a.SET;case"static":return a.STATIC;case"super":return a.SUPER;case"switch":return a.SWITCH}break;case 116:switch(e){case"this":return a.THIS;case"throw":return a.THROW;case"true":return a.TRUE;case"try":return a.TRY;case"type":return a.TYPE;case"typeof":return a.TYPEOF}break;case 118:switch(e){case"var":return a.VAR;case"void":return a.VOID}break;case 119:switch(e){case"while":return a.WHILE;case"with":return a.WITH}break;case 121:switch(e){case"yield":return a.YIELD}}return a.INVALID}function c(e){switch(e){case a.ABSTRACT:case a.AS:case a.CONSTRUCTOR:case a.DECLARE:case a.DELETE:case a.FROM:case a.FOR:case a.GET:case a.INSTANCEOF:case a.IS:case a.KEYOF:case a.MODULE:case a.NAMESPACE:case a.NULL:case a.READONLY:case a.SET:case a.TYPE:case a.VOID:return!0;default:return!1}}!function(e){e[e.ABSTRACT=0]="ABSTRACT",e[e.AS=1]="AS",e[e.ASYNC=2]="ASYNC",e[e.AWAIT=3]="AWAIT",e[e.BREAK=4]="BREAK",e[e.CASE=5]="CASE",e[e.CATCH=6]="CATCH",e[e.CLASS=7]="CLASS",e[e.CONST=8]="CONST",e[e.CONTINUE=9]="CONTINUE",e[e.CONSTRUCTOR=10]="CONSTRUCTOR",e[e.DEBUGGER=11]="DEBUGGER",e[e.DECLARE=12]="DECLARE",e[e.DEFAULT=13]="DEFAULT",e[e.DELETE=14]="DELETE",e[e.DO=15]="DO",e[e.ELSE=16]="ELSE",e[e.ENUM=17]="ENUM",e[e.EXPORT=18]="EXPORT",e[e.EXTENDS=19]="EXTENDS",e[e.FALSE=20]="FALSE",e[e.FINALLY=21]="FINALLY",e[e.FOR=22]="FOR",e[e.FROM=23]="FROM",e[e.FUNCTION=24]="FUNCTION",e[e.GET=25]="GET",e[e.IF=26]="IF",e[e.IMPLEMENTS=27]="IMPLEMENTS",e[e.IMPORT=28]="IMPORT",e[e.IN=29]="IN",e[e.INSTANCEOF=30]="INSTANCEOF",e[e.INTERFACE=31]="INTERFACE",e[e.IS=32]="IS",e[e.KEYOF=33]="KEYOF",e[e.LET=34]="LET",e[e.MODULE=35]="MODULE",e[e.NAMESPACE=36]="NAMESPACE",e[e.NEW=37]="NEW",e[e.NULL=38]="NULL",e[e.OF=39]="OF",e[e.PACKAGE=40]="PACKAGE",e[e.PRIVATE=41]="PRIVATE",e[e.PROTECTED=42]="PROTECTED",e[e.PUBLIC=43]="PUBLIC",e[e.READONLY=44]="READONLY",e[e.RETURN=45]="RETURN",e[e.SET=46]="SET",e[e.STATIC=47]="STATIC",e[e.SUPER=48]="SUPER",e[e.SWITCH=49]="SWITCH",e[e.THIS=50]="THIS",e[e.THROW=51]="THROW",e[e.TRUE=52]="TRUE",e[e.TRY=53]="TRY",e[e.TYPE=54]="TYPE",e[e.TYPEOF=55]="TYPEOF",e[e.VAR=56]="VAR",e[e.VOID=57]="VOID",e[e.WHILE=58]="WHILE",e[e.WITH=59]="WITH",e[e.YIELD=60]="YIELD",e[e.OPENBRACE=61]="OPENBRACE",e[e.CLOSEBRACE=62]="CLOSEBRACE",e[e.OPENPAREN=63]="OPENPAREN",e[e.CLOSEPAREN=64]="CLOSEPAREN",e[e.OPENBRACKET=65]="OPENBRACKET",e[e.CLOSEBRACKET=66]="CLOSEBRACKET",e[e.DOT=67]="DOT",e[e.DOT_DOT_DOT=68]="DOT_DOT_DOT",e[e.SEMICOLON=69]="SEMICOLON",e[e.COMMA=70]="COMMA",e[e.LESSTHAN=71]="LESSTHAN",e[e.GREATERTHAN=72]="GREATERTHAN",e[e.LESSTHAN_EQUALS=73]="LESSTHAN_EQUALS",e[e.GREATERTHAN_EQUALS=74]="GREATERTHAN_EQUALS",e[e.EQUALS_EQUALS=75]="EQUALS_EQUALS",e[e.EXCLAMATION_EQUALS=76]="EXCLAMATION_EQUALS",e[e.EQUALS_EQUALS_EQUALS=77]="EQUALS_EQUALS_EQUALS",e[e.EXCLAMATION_EQUALS_EQUALS=78]="EXCLAMATION_EQUALS_EQUALS",e[e.EQUALS_GREATERTHAN=79]="EQUALS_GREATERTHAN",e[e.PLUS=80]="PLUS",e[e.MINUS=81]="MINUS",e[e.ASTERISK_ASTERISK=82]="ASTERISK_ASTERISK",e[e.ASTERISK=83]="ASTERISK",e[e.SLASH=84]="SLASH",e[e.PERCENT=85]="PERCENT",e[e.PLUS_PLUS=86]="PLUS_PLUS",e[e.MINUS_MINUS=87]="MINUS_MINUS",e[e.LESSTHAN_LESSTHAN=88]="LESSTHAN_LESSTHAN",e[e.GREATERTHAN_GREATERTHAN=89]="GREATERTHAN_GREATERTHAN",e[e.GREATERTHAN_GREATERTHAN_GREATERTHAN=90]="GREATERTHAN_GREATERTHAN_GREATERTHAN",e[e.AMPERSAND=91]="AMPERSAND",e[e.BAR=92]="BAR",e[e.CARET=93]="CARET",e[e.EXCLAMATION=94]="EXCLAMATION",e[e.TILDE=95]="TILDE",e[e.AMPERSAND_AMPERSAND=96]="AMPERSAND_AMPERSAND",e[e.BAR_BAR=97]="BAR_BAR",e[e.QUESTION=98]="QUESTION",e[e.COLON=99]="COLON",e[e.EQUALS=100]="EQUALS",e[e.PLUS_EQUALS=101]="PLUS_EQUALS",e[e.MINUS_EQUALS=102]="MINUS_EQUALS",e[e.ASTERISK_EQUALS=103]="ASTERISK_EQUALS",e[e.ASTERISK_ASTERISK_EQUALS=104]="ASTERISK_ASTERISK_EQUALS",e[e.SLASH_EQUALS=105]="SLASH_EQUALS",e[e.PERCENT_EQUALS=106]="PERCENT_EQUALS",e[e.LESSTHAN_LESSTHAN_EQUALS=107]="LESSTHAN_LESSTHAN_EQUALS",e[e.GREATERTHAN_GREATERTHAN_EQUALS=108]="GREATERTHAN_GREATERTHAN_EQUALS",e[e.GREATERTHAN_GREATERTHAN_GREATERTHAN_EQUALS=109]="GREATERTHAN_GREATERTHAN_GREATERTHAN_EQUALS",e[e.AMPERSAND_EQUALS=110]="AMPERSAND_EQUALS",e[e.BAR_EQUALS=111]="BAR_EQUALS",e[e.CARET_EQUALS=112]="CARET_EQUALS",e[e.AT=113]="AT",e[e.IDENTIFIER=114]="IDENTIFIER",e[e.STRINGLITERAL=115]="STRINGLITERAL",e[e.INTEGERLITERAL=116]="INTEGERLITERAL",e[e.FLOATLITERAL=117]="FLOATLITERAL",e[e.INVALID=118]="INVALID",e[e.ENDOFFILE=119]="ENDOFFILE"}(a=t.Token||(t.Token={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.PREFER=1]="PREFER",e[e.ALWAYS=2]="ALWAYS"}(o=t.IdentifierHandling||(t.IdentifierHandling={})),t.tokenFromKeyword=l,t.tokenIsAlsoIdentifier=c,t.isIllegalVariableIdentifier=function(e){switch(assert(e.length),e.charCodeAt(0)){case 100:return"delete"==e;case 102:return"for"==e;case 105:return"instanceof"==e;case 110:return"null"==e;case 118:return"void"==e}return!1},t.operatorTokenToString=function(e){switch(e){case a.DELETE:return"delete";case a.IN:return"in";case a.INSTANCEOF:return"instanceof";case a.NEW:return"new";case a.TYPEOF:return"typeof";case a.VOID:return"void";case a.YIELD:return"yield";case a.DOT_DOT_DOT:return"...";case a.COMMA:return",";case a.LESSTHAN:return"<";case a.GREATERTHAN:return">";case a.LESSTHAN_EQUALS:return"<=";case a.GREATERTHAN_EQUALS:return">=";case a.EQUALS_EQUALS:return"==";case a.EXCLAMATION_EQUALS:return"!=";case a.EQUALS_EQUALS_EQUALS:return"===";case a.EXCLAMATION_EQUALS_EQUALS:return"!==";case a.PLUS:return"+";case a.MINUS:return"-";case a.ASTERISK_ASTERISK:return"**";case a.ASTERISK:return"*";case a.SLASH:return"/";case a.PERCENT:return"%";case a.PLUS_PLUS:return"++";case a.MINUS_MINUS:return"--";case a.LESSTHAN_LESSTHAN:return"<<";case a.GREATERTHAN_GREATERTHAN:return">>";case a.GREATERTHAN_GREATERTHAN_GREATERTHAN:return">>>";case a.AMPERSAND:return"&";case a.BAR:return"|";case a.CARET:return"^";case a.EXCLAMATION:return"!";case a.TILDE:return"~";case a.AMPERSAND_AMPERSAND:return"&&";case a.BAR_BAR:return"||";case a.EQUALS:return"=";case a.PLUS_EQUALS:return"+=";case a.MINUS_EQUALS:return"-=";case a.ASTERISK_EQUALS:return"*=";case a.ASTERISK_ASTERISK_EQUALS:return"**=";case a.SLASH_EQUALS:return"/=";case a.PERCENT_EQUALS:return"%=";case a.LESSTHAN_LESSTHAN_EQUALS:return"<<=";case a.GREATERTHAN_GREATERTHAN_EQUALS:return">>=";case a.GREATERTHAN_GREATERTHAN_GREATERTHAN_EQUALS:return">>>=";case a.AMPERSAND_EQUALS:return"&=";case a.BAR_EQUALS:return"|=";case a.CARET_EQUALS:return"^=";default:return assert(!1),""}};class u{constructor(e,t,r){this.debugInfoRef=0,this.source=e,this.start=t,this.end=r}static join(e,t){if(e.source!=t.source)throw new Error("source mismatch");return new u(e.source,e.start<t.start?e.start:t.start,e.end>t.end?e.end:t.end)}get atStart(){return new u(this.source,this.start,this.start)}get atEnd(){return new u(this.source,this.end,this.end)}get line(){var e=this.source.text,t=1;for(let r=this.start;r>=0;--r)10==e.charCodeAt(r)&&t++;return t}get column(){var e=this.source.text,t=0;for(let r=this.start-1;r>=0&&10!=e.charCodeAt(r);--r)++t;return t}toString(){return this.source.text.substring(this.start,this.end)}}t.Range=u;class p extends n.DiagnosticEmitter{constructor(e,t=null){super(t),this.end=0,this.pos=0,this.token=-1,this.tokenPos=0,this.nextToken=-1,this.nextTokenPos=0,this.nextTokenOnNewLine=!1,this.onComment=null,this.source=e,this.pos=0,this.end=e.text.length,this.diagnostics=t||new Array;var r=this.end,n=e.text;if(this.pos<r&&65279==n.charCodeAt(this.pos)&&++this.pos,this.pos+1<r&&35==n.charCodeAt(this.pos)&&33==n.charCodeAt(this.pos+1))for(this.pos+=2;this.pos<r&&10!=n.charCodeAt(this.pos);)++this.pos}next(e=o.DEFAULT){return this.nextToken=-1,this.token=this.unsafeNext(e)}unsafeNext(e=o.DEFAULT,t=i32.MAX_VALUE){for(var r=this.end,u=this.source.text;this.pos<r;){this.tokenPos=this.pos;let p=u.charCodeAt(this.pos);switch(p){case 13:if(!(++this.pos<r&&10==u.charCodeAt(this.pos)))break;case 10:case 9:case 11:case 12:case 32:++this.pos;break;case 33:return++this.pos,t>1&&this.pos<r&&61==u.charCodeAt(this.pos)?(++this.pos,t>2&&this.pos<r&&61==u.charCodeAt(this.pos)?(++this.pos,a.EXCLAMATION_EQUALS_EQUALS):a.EXCLAMATION_EQUALS):a.EXCLAMATION;case 34:case 39:case 96:return a.STRINGLITERAL;case 37:return++this.pos,t>1&&this.pos<r&&61==u.charCodeAt(this.pos)?(++this.pos,a.PERCENT_EQUALS):a.PERCENT;case 38:if(++this.pos,t>1&&this.pos<r){let e=u.charCodeAt(this.pos);if(38==e)return++this.pos,a.AMPERSAND_AMPERSAND;if(61==e)return++this.pos,a.AMPERSAND_EQUALS}return a.AMPERSAND;case 40:return++this.pos,a.OPENPAREN;case 41:return++this.pos,a.CLOSEPAREN;case 42:if(++this.pos,t>1&&this.pos<r){let e=u.charCodeAt(this.pos);if(61==e)return++this.pos,a.ASTERISK_EQUALS;if(42==e)return++this.pos,t>2&&this.pos<r&&61==u.charCodeAt(this.pos)?(++this.pos,a.ASTERISK_ASTERISK_EQUALS):a.ASTERISK_ASTERISK}return a.ASTERISK;case 43:if(++this.pos,t>1&&this.pos<r){let e=u.charCodeAt(this.pos);if(43==e)return++this.pos,a.PLUS_PLUS;if(61==e)return++this.pos,a.PLUS_EQUALS}return a.PLUS;case 44:return++this.pos,a.COMMA;case 45:if(++this.pos,t>1&&this.pos<r){let e=u.charCodeAt(this.pos);if(45==e)return++this.pos,a.MINUS_MINUS;if(61==e)return++this.pos,a.MINUS_EQUALS}return a.MINUS;case 46:if(++this.pos,t>1&&this.pos<r){let e=u.charCodeAt(this.pos);if(s.isDecimalDigit(e))return--this.pos,a.FLOATLITERAL;if(t>2&&this.pos+1<r&&46==e&&46==u.charCodeAt(this.pos+1))return this.pos+=2,a.DOT_DOT_DOT}return a.DOT;case 47:{let e=this.pos;if(++this.pos,t>1&&this.pos<r){let t=u.charCodeAt(this.pos);if(47==t){let t=i.CommentKind.LINE;for(this.pos+1<r&&47==u.charCodeAt(this.pos+1)&&(++this.pos,t=i.CommentKind.TRIPLE);++this.pos<r;)if(10==u.charCodeAt(this.pos)){++this.pos;break}this.onComment&&this.onComment(t,u.substring(e,this.pos),this.range(e,this.pos));break}if(42==t){let t=!1;for(;++this.pos<r;)if(42==(p=u.charCodeAt(this.pos))&&this.pos+1<r&&47==u.charCodeAt(this.pos+1)){this.pos+=2,t=!0;break}t?this.onComment&&this.onComment(i.CommentKind.BLOCK,u.substring(e,this.pos),this.range(e,this.pos)):this.error(n.DiagnosticCode._0_expected,this.range(this.pos),"*/");break}if(61==t)return++this.pos,a.SLASH_EQUALS}return a.SLASH}case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.testInteger()?a.INTEGERLITERAL:a.FLOATLITERAL;case 58:return++this.pos,a.COLON;case 59:return++this.pos,a.SEMICOLON;case 60:if(++this.pos,t>1&&this.pos<r){let e=u.charCodeAt(this.pos);if(60==e)return++this.pos,t>2&&this.pos<r&&61==u.charCodeAt(this.pos)?(++this.pos,a.LESSTHAN_LESSTHAN_EQUALS):a.LESSTHAN_LESSTHAN;if(61==e)return++this.pos,a.LESSTHAN_EQUALS}return a.LESSTHAN;case 61:if(++this.pos,t>1&&this.pos<r){let e=u.charCodeAt(this.pos);if(61==e)return++this.pos,t>2&&this.pos<r&&61==u.charCodeAt(this.pos)?(++this.pos,a.EQUALS_EQUALS_EQUALS):a.EQUALS_EQUALS;if(62==e)return++this.pos,a.EQUALS_GREATERTHAN}return a.EQUALS;case 62:if(++this.pos,t>1&&this.pos<r){let e=u.charCodeAt(this.pos);if(62==e){if(++this.pos,t>2&&this.pos<r){if(62==(e=u.charCodeAt(this.pos)))return++this.pos,t>3&&this.pos<r&&61==u.charCodeAt(this.pos)?(++this.pos,a.GREATERTHAN_GREATERTHAN_GREATERTHAN_EQUALS):a.GREATERTHAN_GREATERTHAN_GREATERTHAN;if(61==e)return++this.pos,a.GREATERTHAN_GREATERTHAN_EQUALS}return a.GREATERTHAN_GREATERTHAN}if(61==e)return++this.pos,a.GREATERTHAN_EQUALS}return a.GREATERTHAN;case 63:return++this.pos,a.QUESTION;case 91:return++this.pos,a.OPENBRACKET;case 93:return++this.pos,a.CLOSEBRACKET;case 94:return++this.pos,t>1&&this.pos<r&&61==u.charCodeAt(this.pos)?(++this.pos,a.CARET_EQUALS):a.CARET;case 123:return++this.pos,a.OPENBRACE;case 124:if(++this.pos,t>1&&this.pos<r){let e=u.charCodeAt(this.pos);if(124==e)return++this.pos,a.BAR_BAR;if(61==e)return++this.pos,a.BAR_EQUALS}return a.BAR;case 125:return++this.pos,a.CLOSEBRACE;case 126:return++this.pos,a.TILDE;case 64:return++this.pos,a.AT;default:if(s.isIdentifierStart(p)){if(s.isKeywordCharacter(p)){let t=this.pos;for(;++this.pos<r&&s.isIdentifierPart(p=u.charCodeAt(this.pos));)if(!s.isKeywordCharacter(p))return this.pos=t,a.IDENTIFIER;let n=l(u.substring(t,this.pos));if(n!==a.INVALID&&e!==o.ALWAYS&&(e!==o.PREFER||!c(n)))return n;this.pos=t}return a.IDENTIFIER}if(s.isWhiteSpace(p)){++this.pos;break}return this.error(n.DiagnosticCode.Invalid_character,this.range(this.pos,this.pos+1)),++this.pos,a.INVALID}}return a.ENDOFFILE}peek(e=!1,t=o.DEFAULT,r=i32.MAX_VALUE){var n=this.source.text;if(this.nextToken<0){let i=this.pos,a=this.token,o=this.tokenPos;if(this.nextToken=this.unsafeNext(t,r),this.nextTokenPos=this.tokenPos,e){this.nextTokenOnNewLine=!1;for(let e=i,t=this.nextTokenPos;e<t;++e)if(s.isLineBreak(n.charCodeAt(e))){this.nextTokenOnNewLine=!0;break}}this.pos=i,this.token=a,this.tokenPos=o}return this.nextToken}skipIdentifier(e=o.PREFER){return this.skip(a.IDENTIFIER,e)}skip(e,t=o.DEFAULT){var r=this.pos,n=this.token,i=this.tokenPos,s=i32.MAX_VALUE;switch(e){case a.GREATERTHAN:s=1}return this.token=this.unsafeNext(t,s),this.token==e?(this.nextToken=-1,!0):(this.pos=r,this.token=n,this.tokenPos=i,!1)}mark(){var e;return h?(e=h,h=null):e=new _,e.pos=this.pos,e.token=this.token,e.tokenPos=this.tokenPos,e}discard(e){h=e}reset(e){this.pos=e.pos,this.token=e.token,this.tokenPos=e.tokenPos,this.nextToken=-1}range(e=-1,t=-1){return e<0?(e=this.tokenPos,t=this.pos):t<0&&(t=e),new u(this.source,e,t)}readIdentifier(){for(var e=this.source.text,t=this.pos,r=this.end;++this.pos<r&&s.isIdentifierPart(e.charCodeAt(this.pos)););return e.substring(t,this.pos)}readString(){for(var e=this.source.text,t=e.charCodeAt(this.pos++),r=this.pos,i=this.end,a="";;){if(this.pos>=i){a+=e.substring(r,this.pos),this.error(n.DiagnosticCode.Unterminated_string_literal,this.range(r-1,i));break}let o=e.charCodeAt(this.pos);if(o==t){a+=e.substring(r,this.pos++);break}if(92!=o){if(s.isLineBreak(o)&&96!=t){a+=e.substring(r,this.pos),this.error(n.DiagnosticCode.Unterminated_string_literal,this.range(r-1,this.pos));break}++this.pos}else a+=e.substring(r,this.pos),a+=this.readEscapeSequence(),r=this.pos}return a}readEscapeSequence(){var e=this.end;if(++this.pos>=e)return this.error(n.DiagnosticCode.Unexpected_end_of_text,this.range(e)),"";var t=this.source.text,r=t.charCodeAt(this.pos++);switch(r){case 48:return"\0";case 98:return"\b";case 116:return"\t";case 110:return"\n";case 118:return"\v";case 102:return"\f";case 114:return"\r";case 39:return"'";case 34:return'"';case 117:return this.pos<e&&123==t.charCodeAt(this.pos)?(++this.pos,this.readExtendedUnicodeEscape()):this.readUnicodeEscape();case 13:this.pos<e&&10==t.charCodeAt(this.pos)&&++this.pos;case 10:case 8232:case 8233:return"";default:return String.fromCharCode(r)}}readRegexpPattern(){for(var e=this.source.text,t=this.pos,r=this.end,i=!1;;){if(this.pos>=r){this.error(n.DiagnosticCode.Unterminated_regular_expression_literal,this.range(t,r));break}if(92==e.charCodeAt(this.pos)){++this.pos,i=!0;continue}let a=e.charCodeAt(this.pos);if(!i&&47==a)break;if(s.isLineBreak(a)){this.error(n.DiagnosticCode.Unterminated_regular_expression_literal,this.range(t,this.pos));break}++this.pos,i=!1}return e.substring(t,this.pos)}readRegexpFlags(){for(var e=this.source.text,t=this.pos,r=this.end,i=0;this.pos<r;){let t=e.charCodeAt(this.pos);if(!s.isIdentifierPart(t))break;switch(++this.pos,t){case 103:i|=1&i?-1:1;break;case 105:i|=2&i?-1:2;break;case 109:i|=4&i?-1:4;break;default:i=-1}}return-1==i&&this.error(n.DiagnosticCode.Invalid_regular_expression_flags,this.range(t,this.pos)),e.substring(t,this.pos)}testInteger(){var e=this.end,t=this.source.text;if(this.pos+1<e&&48==t.charCodeAt(this.pos))switch(t.charCodeAt(this.pos+2)){case 120:case 88:case 98:case 66:case 111:case 79:return!0}for(var r=this.pos;r<e;){let e=t.charCodeAt(r);if(46==e||101==e||69==e)return!1;if((e<48||e>57)&&95!=e)break;r++}return!0}readInteger(){var e=this.source.text;if(this.pos+2<this.end&&48==e.charCodeAt(this.pos)){switch(e.charCodeAt(this.pos+1)){case 120:case 88:return this.pos+=2,this.readHexInteger();case 98:case 66:return this.pos+=2,this.readBinaryInteger();case 111:case 79:return this.pos+=2,this.readOctalInteger()}if(s.isOctalDigit(e.charCodeAt(this.pos+1))){let e=this.pos;++this.pos;let t=this.readOctalInteger();return this.error(n.DiagnosticCode.Octal_literals_are_not_allowed_in_strict_mode,this.range(e,this.pos)),t}}return this.readDecimalInteger()}readHexInteger(){for(var e=this.source.text,t=this.pos,r=i64_new(0),i=i64_new(4),s=t,a=this.end;this.pos<a;){let a=this.pos,o=e.charCodeAt(a);if(o>=48&&o<=57)r=i64_add(i64_shl(r,i),i64_new(o-48));else if(o>=65&&o<=70)r=i64_add(i64_shl(r,i),i64_new(10+o-65));else if(o>=97&&o<=102)r=i64_add(i64_shl(r,i),i64_new(10+o-97));else{if(95!=o)break;s==a&&this.error(s==t?n.DiagnosticCode.Numeric_separators_are_not_allowed_here:n.DiagnosticCode.Multiple_consecutive_numeric_separators_are_not_permitted,this.range(a)),s=a+1}this.pos=a+1}return this.pos==t?this.error(n.DiagnosticCode.Hexadecimal_digit_expected,this.range(t)):s==this.pos&&this.error(n.DiagnosticCode.Numeric_separators_are_not_allowed_here,this.range(s-1)),r}readDecimalInteger(){for(var e=this.source.text,t=this.pos,r=this.end,i=i64_new(0),s=i64_new(10),a=t;this.pos<r;){let r=this.pos,o=e.charCodeAt(r);if(o>=48&&o<=57)i=i64_add(i64_mul(i,s),i64_new(o-48));else{if(95!=o)break;a==r&&this.error(a==t?n.DiagnosticCode.Numeric_separators_are_not_allowed_here:n.DiagnosticCode.Multiple_consecutive_numeric_separators_are_not_permitted,this.range(r)),a=r+1}this.pos=r+1}return this.pos==t?this.error(n.DiagnosticCode.Digit_expected,this.range(t)):a==this.pos&&this.error(n.DiagnosticCode.Numeric_separators_are_not_allowed_here,this.range(a-1)),i}readOctalInteger(){for(var e=this.source.text,t=this.pos,r=i64_new(0),i=i64_new(3),s=t,a=this.end;this.pos<a;){let a=this.pos,o=e.charCodeAt(a);if(o>=48&&o<=55)r=i64_add(i64_shl(r,i),i64_new(o-48));else{if(95!=o)break;s==a&&this.error(s==t?n.DiagnosticCode.Numeric_separators_are_not_allowed_here:n.DiagnosticCode.Multiple_consecutive_numeric_separators_are_not_permitted,this.range(a)),s=a+1}++this.pos}return this.pos==t?this.error(n.DiagnosticCode.Octal_digit_expected,this.range(t)):s==this.pos&&this.error(n.DiagnosticCode.Numeric_separators_are_not_allowed_here,this.range(s-1)),r}readBinaryInteger(){for(var e=this.source.text,t=this.pos,r=i64_new(0),i=i64_new(1),s=t,a=this.end;this.pos<a;){let a=this.pos,o=e.charCodeAt(a);if(48==o)r=i64_shl(r,i);else if(49==o)r=i64_add(i64_shl(r,i),i);else{if(95!=o)break;s==a&&this.error(s==t?n.DiagnosticCode.Numeric_separators_are_not_allowed_here:n.DiagnosticCode.Multiple_consecutive_numeric_separators_are_not_permitted,this.range(a)),s=a+1}this.pos=a+1}return this.pos==t?this.error(n.DiagnosticCode.Binary_digit_expected,this.range(t)):s==this.pos&&this.error(n.DiagnosticCode.Numeric_separators_are_not_allowed_here,this.range(s-1)),r}readFloat(){return this.readDecimalFloat()}readDecimalFloat(){for(var e=this.pos,t=this.end,r=this.source.text;this.pos<t&&s.isDecimalDigit(r.charCodeAt(this.pos));)++this.pos;if(this.pos<t&&46==r.charCodeAt(this.pos))for(++this.pos;this.pos<t&&s.isDecimalDigit(r.charCodeAt(this.pos));)++this.pos;if(this.pos<t){let e=r.charCodeAt(this.pos);if(101==e||69==e)for((++this.pos<t&&45==(e=r.charCodeAt(this.pos))||43==e&&s.isDecimalDigit(r.charCodeAt(this.pos+1)))&&++this.pos;this.pos<t&&s.isDecimalDigit(r.charCodeAt(this.pos));)++this.pos}return parseFloat(r.substring(e,this.pos))}readHexFloat(){throw new Error("not implemented")}readUnicodeEscape(){for(var e=4,t=0,r=this.end,i=this.source.text;this.pos<r;){let r=i.charCodeAt(this.pos++);if(r>=48&&r<=57)t=(t<<4)+r-48;else if(r>=65&&r<=70)t=(t<<4)+r+-55;else{if(!(r>=97&&r<=102))return this.error(n.DiagnosticCode.Hexadecimal_digit_expected,this.range(this.pos-1,this.pos)),"";t=(t<<4)+r+-87}if(0==--e)break}return e?(this.error(n.DiagnosticCode.Unexpected_end_of_text,this.range(this.pos)),""):String.fromCharCode(t)}readExtendedUnicodeEscape(){var e=this.pos,t=this.readHexInteger(),r=i64_low(t),i=!1;assert(!i64_high(t)),r>1114111&&(this.error(n.DiagnosticCode.An_extended_Unicode_escape_value_must_be_between_0x0_and_0x10FFFF_inclusive,this.range(e,this.pos)),i=!0);var s=this.end,a=this.source.text;return this.pos>=s?(this.error(n.DiagnosticCode.Unexpected_end_of_text,this.range(e,s)),i=!0):125==a.charCodeAt(this.pos)?++this.pos:(this.error(n.DiagnosticCode.Unterminated_Unicode_escape_sequence,this.range(e,this.pos)),i=!0),i?"":r<65536?String.fromCharCode(r):String.fromCharCode(55296+(r-65536>>>10),56320+(r-65536&1023))}finish(){}}t.Tokenizer=p;class _{}t.State=_;var h=null},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(4),s=r(3),a=r(6),o=r(0),l=r(1),c=r(7),u=r(13);var p;!function(e){e[e.REPORT=0]="REPORT",e[e.SWALLOW=1]="SWALLOW"}(p=t.ReportMode||(t.ReportMode={}));class _ extends n.DiagnosticEmitter{constructor(e){super(e.diagnostics),this.currentThisExpression=null,this.currentElementExpression=null,this.program=e}resolveType(e,t,r=null,n=p.REPORT){switch(e.kind){case s.NodeKind.NAMEDTYPE:return this.resolveNamedType(e,t,r,n);case s.NodeKind.FUNCTIONTYPE:return this.resolveFunctionType(e,t,r,n);default:assert(!1)}return null}resolveNamedType(e,t,r=null,s=p.REPORT){var c=e.name,u=e.typeArguments,_=!c.next;if(_){let t=c.identifier.text;if(null!==r&&r.has(t)){let i=r.get(t);if(null!==u&&u.length&&s==p.REPORT&&this.error(n.DiagnosticCode.Type_0_is_not_generic,e.range,i.toString()),e.isNullable){if(i.is(256))return i.asNullable();s==p.REPORT&&this.error(n.DiagnosticCode.Basic_type_0_cannot_be_nullable,e.range,i.toString())}return i}}var h=this.resolveTypeName(c,t,s);if(!h)return null;if(h.shadowType)h=h.shadowType;else{if(h.kind==i.ElementKind.ENUM)return null!==u&&u.length&&s==p.REPORT&&this.error(n.DiagnosticCode.Type_0_is_not_generic,e.range,h.internalName),e.isNullable&&s==p.REPORT&&this.error(n.DiagnosticCode.Basic_type_0_cannot_be_nullable,e.range,h.name+"/i32"),a.Type.i32;if(h.kind==i.ElementKind.CLASS_PROTOTYPE){let n=this.resolveClassInclTypeArguments(h,u,t,l.makeMap(r),e,s);return n?e.isNullable?n.type.asNullable():n.type:null}}if(h.kind==i.ElementKind.TYPEDEFINITION){if(h.is(o.CommonFlags.RESOLVED)){null!==u&&u.length&&s==p.REPORT&&this.error(n.DiagnosticCode.Type_0_is_not_generic,e.range,h.internalName);let t=h.type;if(e.isNullable){if(t.is(256))return t.asNullable();s==p.REPORT&&this.error(n.DiagnosticCode.Basic_type_0_cannot_be_nullable,c.range,c.identifier.text)}return t}if(_)switch(c.identifier.symbol){case o.CommonSymbols.native:return this.resolveBuiltinNativeType(e,t,r,s);case o.CommonSymbols.indexof:return this.resolveBuiltinIndexofType(e,t,r,s);case o.CommonSymbols.valueof:return this.resolveBuiltinValueofType(e,t,r,s);case o.CommonSymbols.returnof:return this.resolveBuiltinReturnTypeType(e,t,r,s)}let i=h.typeParameterNodes,a=null;if(i){if(!(a=this.resolveTypeArguments(i,u,t,r=l.makeMap(r),e,s)))return null}else u&&u.length&&this.error(n.DiagnosticCode.Type_0_is_not_generic,e.range,c.identifier.text);let d=this.resolveType(h.typeNode,h,r,s);if(!d)return null;if(e.isNullable){if(d.is(256))return d.asNullable();s==p.REPORT&&this.error(n.DiagnosticCode.Basic_type_0_cannot_be_nullable,c.range,c.identifier.text)}return d}return s==p.REPORT&&this.error(n.DiagnosticCode.Cannot_find_name_0,c.range,c.identifier.text),null}resolveFunctionType(e,t,r=null,i=p.REPORT){var o=e.explicitThisType,l=null;if(o&&!(l=this.resolveType(o,t,r,i)))return null;var c=e.parameters,u=c.length,_=new Array(u),h=new Array(u),d=0,y=!1;for(let e=0;e<u;++e){let a=c[e];switch(a.parameterKind){case s.ParameterKind.DEFAULT:d=e+1;break;case s.ParameterKind.REST:assert(e==u),y=!0}let o=a.type;if(s.isTypeOmitted(o))return i==p.REPORT&&this.error(n.DiagnosticCode.Type_expected,o.range),null;let l=this.resolveType(o,t,r,i);if(!l)return null;_[e]=l,h[e]=a.name.text}var T,m=e.returnType;if(s.isTypeOmitted(m))i==p.REPORT&&this.error(n.DiagnosticCode.Type_expected,m.range),T=a.Type.void;else if(!(T=this.resolveType(m,t,r,i)))return null;var g=new a.Signature(this.program,_,T,l);return g.parameterNames=h,g.requiredParameters=d,g.hasRest=y,e.isNullable?g.type.asNullable():g.type}resolveBuiltinNativeType(e,t,r=null,i=p.REPORT){var s=e.typeArguments;if(!s||1!=s.length)return i==p.REPORT&&this.error(n.DiagnosticCode.Expected_0_type_arguments_but_got_1,e.range,"1",(s?s.length:1).toString(10)),null;var o=this.resolveType(s[0],t,r,i);if(!o)return null;switch(o.kind){case 0:case 1:case 2:return a.Type.i32;case 4:if(!this.program.options.isWasm64)return a.Type.i32;case 3:return a.Type.i64;case 5:case 6:case 7:case 10:return a.Type.u32;case 9:if(!this.program.options.isWasm64)return a.Type.u32;case 8:return a.Type.u64;case 11:return a.Type.f32;case 12:return a.Type.f64;case 13:return a.Type.v128;case 15:return a.Type.void;default:assert(!1)}return null}resolveBuiltinIndexofType(e,t,r=null,s=p.REPORT){var a=e.typeArguments;if(!a||1!=a.length)return s==p.REPORT&&this.error(n.DiagnosticCode.Expected_0_type_arguments_but_got_1,e.range,"1",(a?a.length:1).toString(10)),null;var l=this.resolveType(a[0],t,r,s);if(!l)return null;var c=l.classReference;if(!c)return s==p.REPORT&&this.error(n.DiagnosticCode.Index_signature_is_missing_in_type_0,a[0].range,l.toString()),null;var u=c.lookupOverload(i.OperatorKind.INDEXED_GET);return u?u.is(o.CommonFlags.STATIC)?(assert(2==u.signature.parameterTypes.length),u.signature.parameterTypes[1]):(assert(1==u.signature.parameterTypes.length),u.signature.parameterTypes[0]):(s==p.REPORT&&this.error(n.DiagnosticCode.Index_signature_is_missing_in_type_0,a[0].range,l.toString()),null)}resolveBuiltinValueofType(e,t,r=null,s=p.REPORT){var a=e.typeArguments;if(!a||1!=a.length)return s==p.REPORT&&this.error(n.DiagnosticCode.Expected_0_type_arguments_but_got_1,e.range,"1",(a?a.length:1).toString(10)),null;var o=this.resolveType(a[0],t,r,s);if(!o)return null;var l=o.classReference;if(!l)return s==p.REPORT&&this.error(n.DiagnosticCode.Index_signature_is_missing_in_type_0,a[0].range,o.toString()),null;var c=l.lookupOverload(i.OperatorKind.INDEXED_GET);return c?c.signature.returnType:(s==p.REPORT&&this.error(n.DiagnosticCode.Index_signature_is_missing_in_type_0,a[0].range,o.toString()),null)}resolveBuiltinReturnTypeType(e,t,r=null,i=p.REPORT){var s=e.typeArguments;if(!s||1!=s.length)return i==p.REPORT&&this.error(n.DiagnosticCode.Expected_0_type_arguments_but_got_1,e.range,"1",(s?s.length:1).toString(10)),null;var a=this.resolveType(s[0],t,r,i);if(!a)return null;var o=a.signatureReference;return o?o.returnType:(i==p.REPORT&&this.error(n.DiagnosticCode.Type_0_has_no_call_signatures,s[0].range,a.toString()),null)}resolveTypeName(e,t,r=p.REPORT){var i=t.lookup(e.identifier.text);if(!i)return r==p.REPORT&&this.error(n.DiagnosticCode.Cannot_find_name_0,e.range,e.identifier.text),null;for(var s=e,a=e.next;a;){if(!(i=i.lookupInSelf(a.identifier.text)))return r==p.REPORT&&this.error(n.DiagnosticCode.Property_0_does_not_exist_on_type_1,a.range,a.identifier.text,s.identifier.text),null;s=a,a=a.next}return i}resolveTypeArguments(e,t,r,i=l.makeMap(),a=null,o=p.REPORT){var c=0,u=0;for(let t=0,r=e.length;t<r;++t)e[t].defaultType||++c,++u;var _=t?t.length:0;if(_<c||_>u)return this.error(n.DiagnosticCode.Expected_0_type_arguments_but_got_1,_?s.Range.join(t[0].range,t[_-1].range):assert(a).range,(_<c?c:u).toString(10),_.toString(10)),null;var h=new Array(u);for(let n=0;n<u;++n){let s=n<_?this.resolveType(t[n],r,i,o):this.resolveType(assert(e[n].defaultType),r,i,o);if(!s)return null;i.set(e[n].name.text,s),h[n]=s}return h}maybeInferCall(e,t,r,i=p.REPORT){if(e.typeArguments)return t.is(o.CommonFlags.GENERIC)?this.resolveFunctionInclTypeArguments(t,e.typeArguments,r.actualFunction,l.makeMap(r.contextualTypeArguments),e,i):(i==p.REPORT&&this.error(n.DiagnosticCode.Type_0_is_not_generic,e.expression.range,t.internalName),null);if(t.is(o.CommonFlags.GENERIC)){let s=l.makeMap(r.contextualTypeArguments),o=assert(t.typeParameterNodes),c=o.length,u=new Set;for(let e=0;e<c;++e){let t=o[e].name.text;s.set(t,a.Type.auto),u.add(t)}let _=t.functionTypeNode.parameters,h=_.length,d=e.arguments,y=d.length;for(let t=0;t<h;++t){let l=t<y?d[t]:_[t].initializer;if(!l)return i==p.REPORT&&this.error(n.DiagnosticCode.Expected_0_arguments_but_got_1,e.range,h.toString(10),y.toString(10)),null;let c=_[t].type;if(c.hasGenericComponent(o)){let e=this.resolveExpression(l,r,a.Type.auto,p.SWALLOW);e&&this.propagateInferredGenericTypes(c,e,r,s,u)}}let T=new Array(c);for(let t=0;t<c;++t){let r=o[t].name.text;if(s.has(r)){let e=s.get(r);if(e!=a.Type.auto){T[t]=e;continue}}return i==p.REPORT&&this.error(n.DiagnosticCode.Type_argument_expected,e.expression.range.atEnd),null}return this.resolveFunction(t,T,l.makeMap(r.contextualTypeArguments),i)}return this.resolveFunction(t,null,l.makeMap(),i)}propagateInferredGenericTypes(e,t,r,n,o){if(e.kind==s.NodeKind.NAMEDTYPE){let s=e.typeArguments;if(null!==s&&s.length){let a=t.classReference;if(a){let t=this.resolveTypeName(e.name,r.actualFunction);if(!t||t.kind!=i.ElementKind.CLASS_PROTOTYPE)return;if(a.prototype==t){let e=a.typeArguments;if(null!==e&&e.length==s.length){for(let t=0,i=e.length;t<i;++t)this.propagateInferredGenericTypes(s[t],e[t],r,n,o);return}}}}else{let r=e.name.identifier.text;if(n.has(r)){let e=n.get(r);(e==a.Type.auto||o.has(r)&&e.isAssignableTo(t))&&n.set(r,t)}}}else if(e.kind==s.NodeKind.FUNCTIONTYPE){let i=e.parameters;if(null!==i&&i.length){let s=t.signatureReference;if(s){let t=s.parameterTypes,a=s.thisType;if(t.length==i.length&&!a==!e.explicitThisType){for(let e=0,s=t.length;e<s;++e)this.propagateInferredGenericTypes(i[e].type,t[e],r,n,o);return this.propagateInferredGenericTypes(e.returnType,s.returnType,r,n,o),void(a&&this.propagateInferredGenericTypes(e.explicitThisType,a,r,n,o))}}}}}getTypeOfElement(e){var t=e.kind;if(t==i.ElementKind.GLOBAL&&!this.ensureResolvedLazyGlobal(e,p.SWALLOW))return null;if(i.isTypedElement(t)){let t=e.type;assert(t!=a.Type.void);let r=t.classReference;if(r){let e=r.wrappedType;e&&(t=e)}return t}return t==i.ElementKind.FUNCTION_TARGET?e.type:null}getElementOfType(e){if(e.is(256)){let t=e.classReference;return t||assert(e.signatureReference).asFunctionTarget(this.program)}if(e!=a.Type.void){let t=this.program.wrapperClasses;return assert(t.has(e)),t.get(e)}return null}lookupExpression(e,t,r=a.Type.auto,i=p.REPORT){for(;e.kind==s.NodeKind.PARENTHESIZED;)e=e.expression;switch(e.kind){case s.NodeKind.ASSERTION:return this.lookupAssertionExpression(e,t,r,i);case s.NodeKind.BINARY:return this.lookupBinaryExpression(e,t,r,i);case s.NodeKind.CALL:return this.lookupCallExpression(e,t,r,i);case s.NodeKind.COMMA:return this.lookupCommaExpression(e,t,r,i);case s.NodeKind.ELEMENTACCESS:return this.lookupElementAccessExpression(e,t,r,i);case s.NodeKind.FUNCTION:return this.lookupFunctionExpression(e,t,r,i);case s.NodeKind.IDENTIFIER:case s.NodeKind.FALSE:case s.NodeKind.NULL:case s.NodeKind.TRUE:return this.lookupIdentifierExpression(e,t,t.actualFunction,i);case s.NodeKind.THIS:return this.lookupThisExpression(e,t,r,i);case s.NodeKind.SUPER:return this.lookupSuperExpression(e,t,r,i);case s.NodeKind.INSTANCEOF:return this.lookupInstanceOfExpression(e,t,r,i);case s.NodeKind.LITERAL:return this.lookupLiteralExpression(e,t,r,i);case s.NodeKind.NEW:return this.lookupNewExpression(e,t,r,i);case s.NodeKind.PROPERTYACCESS:return this.lookupPropertyAccessExpression(e,t,r,i);case s.NodeKind.TERNARY:return this.lookupTernaryExpression(e,t,r,i);case s.NodeKind.UNARYPOSTFIX:return this.lookupUnaryPostfixExpression(e,t,r,i);case s.NodeKind.UNARYPREFIX:return this.lookupUnaryPrefixExpression(e,t,r,i)}return i==p.REPORT&&this.error(n.DiagnosticCode.Not_implemented,e.range),null}resolveExpression(e,t,r=a.Type.auto,i=p.REPORT){for(;e.kind==s.NodeKind.PARENTHESIZED;)e=e.expression;switch(e.kind){case s.NodeKind.ASSERTION:return this.resolveAssertionExpression(e,t,r,i);case s.NodeKind.BINARY:return this.resolveBinaryExpression(e,t,r,i);case s.NodeKind.CALL:return this.resolveCallExpression(e,t,r,i);case s.NodeKind.COMMA:return this.resolveCommaExpression(e,t,r,i);case s.NodeKind.ELEMENTACCESS:return this.resolveElementAccessExpression(e,t,r,i);case s.NodeKind.FUNCTION:return this.resolveFunctionExpression(e,t,r,i);case s.NodeKind.IDENTIFIER:case s.NodeKind.FALSE:case s.NodeKind.NULL:case s.NodeKind.TRUE:return this.resolveIdentifierExpression(e,t,r,t.actualFunction,i);case s.NodeKind.THIS:return this.resolveThisExpression(e,t,r,i);case s.NodeKind.SUPER:return this.resolveSuperExpression(e,t,r,i);case s.NodeKind.INSTANCEOF:return this.resolveInstanceOfExpression(e,t,r,i);case s.NodeKind.LITERAL:return this.resolveLiteralExpression(e,t,r,i);case s.NodeKind.NEW:return this.resolveNewExpression(e,t,r,i);case s.NodeKind.PROPERTYACCESS:return this.resolvePropertyAccessExpression(e,t,r,i);case s.NodeKind.TERNARY:return this.resolveTernaryExpression(e,t,r,i);case s.NodeKind.UNARYPOSTFIX:return this.resolveUnaryPostfixExpression(e,t,r,i);case s.NodeKind.UNARYPREFIX:return this.resolveUnaryPrefixExpression(e,t,r,i)}return i==p.REPORT&&this.error(n.DiagnosticCode.Not_implemented,e.range),null}lookupIdentifierExpression(e,t,r=t.actualFunction,i=p.REPORT){switch(e.kind){case s.NodeKind.TRUE:case s.NodeKind.FALSE:case s.NodeKind.NULL:{let n=this.resolveIdentifierExpression(e,t,a.Type.auto,r,i);return n?this.getElementOfType(n):null}}var o,l=e.text;return(o=t.lookup(l))?(this.currentThisExpression=null,this.currentElementExpression=null,o):(o=r.lookup(l))?(this.currentThisExpression=null,this.currentElementExpression=null,o):(o=this.program.lookupGlobal(l))?(this.currentThisExpression=null,this.currentElementExpression=null,o):(i==p.REPORT&&this.error(n.DiagnosticCode.Cannot_find_name_0,e.range,l),null)}resolveIdentifierExpression(e,t,r=a.Type.auto,o=t.actualFunction,c=p.REPORT){switch(e.kind){case s.NodeKind.TRUE:case s.NodeKind.FALSE:return a.Type.bool;case s.NodeKind.NULL:{let e=r.classReference;return r.is(256)&&null!==e?e.type.asNullable():this.program.options.usizeType}}var u=this.lookupIdentifierExpression(e,t,o,c);if(!u)return null;if(u.kind==i.ElementKind.FUNCTION_PROTOTYPE){let e=this.resolveFunction(u,null,l.makeMap(),c);if(!e)return null;u=e}var _=this.getTypeOfElement(u);return _||c==p.REPORT&&this.error(n.DiagnosticCode.Expression_cannot_be_represented_by_a_type,e.range),_}ensureResolvedLazyGlobal(e,t=p.REPORT){if(e.is(o.CommonFlags.RESOLVED))return!0;var r,n=e.typeNode;return!!(r=n?this.resolveType(n,e.parent,null,t):this.resolveExpression(assert(e.initializerNode),e.file.startFunction.flow,a.Type.auto,t))&&(e.setType(r),!0)}lookupPropertyAccessExpression(e,t,r,s=p.REPORT){var c=e.expression,u=this.lookupExpression(c,t,r,s);if(!u)return null;var _=e.property.text;switch(u.kind){case i.ElementKind.GLOBAL:if(!this.ensureResolvedLazyGlobal(u,s))return null;case i.ElementKind.ENUMVALUE:case i.ElementKind.LOCAL:case i.ElementKind.FIELD:{let t=u.type;assert(t!=a.Type.void);let r=t.classReference;if(!r){let i=this.program.wrapperClasses;if(!i.has(t))return s==p.REPORT&&this.error(n.DiagnosticCode.Property_0_does_not_exist_on_type_1,e.property.range,_,u.type.toString()),null;r=i.get(t)}u=r;break}case i.ElementKind.PROPERTY_PROTOTYPE:{let t=this.resolveFunction(assert(u.getterPrototype),null,l.makeMap(),s);if(!t)return null;let r=t.signature.returnType,i=r.classReference;if(!i){let t=this.program.wrapperClasses;if(!t.has(r))return s==p.REPORT&&this.error(n.DiagnosticCode.Property_0_does_not_exist_on_type_1,e.property.range,_,r.toString()),null;i=t.get(r)}u=i;break}case i.ElementKind.PROPERTY:{let t=assert(u.getterInstance).signature.returnType,r=t.classReference;if(!r){let i=this.program.wrapperClasses;if(!i.has(t))return s==p.REPORT&&this.error(n.DiagnosticCode.Property_0_does_not_exist_on_type_1,e.property.range,_,t.toString()),null;r=i.get(t)}u=r;break}case i.ElementKind.INDEXSIGNATURE:{let t=assert(this.currentElementExpression),r=u.parent;assert(r.kind==i.ElementKind.CLASS);let a=r.lookupOverload(i.OperatorKind.INDEXED_GET);if(!a)return s==p.REPORT&&this.error(n.DiagnosticCode.Index_signature_is_missing_in_type_0,t.range,r.internalName),null;let o=a.signature.returnType,l=o.classReference;if(!l){let t=this.program.wrapperClasses;if(!t.has(o))return s==p.REPORT&&this.error(n.DiagnosticCode.Property_0_does_not_exist_on_type_1,e.property.range,_,o.toString()),null;l=t.get(o)}u=l;break}case i.ElementKind.FUNCTION_PROTOTYPE:{let e=u.shadowType;if(e){if(!e.is(o.CommonFlags.RESOLVED)){let t=this.resolveType(e.typeNode,e.parent,null,s);t&&e.setType(t)}let t=e.type.classReference;t&&(u=t.prototype);break}}}switch(u.kind){case i.ElementKind.CLASS_PROTOTYPE:case i.ElementKind.CLASS:for(;;){let e=u.members;if(e&&e.has(_))return this.currentThisExpression=c,this.currentElementExpression=null,e.get(_);if(u.kind==i.ElementKind.CLASS_PROTOTYPE){if(!u.basePrototype)break;u=u.basePrototype}else{if(u.kind!=i.ElementKind.CLASS)break;if(!u.base)break;u=u.base}}break;default:{let e=u.members;if(e&&e.has(_))return this.currentThisExpression=c,this.currentElementExpression=null,e.get(_);break}}return s==p.REPORT&&this.error(n.DiagnosticCode.Property_0_does_not_exist_on_type_1,e.property.range,_,u.internalName),null}resolvePropertyAccessExpression(e,t,r,i=p.REPORT){var s=this.lookupPropertyAccessExpression(e,t,r,i);if(!s)return null;var a=this.getTypeOfElement(s);return a||i==p.REPORT&&this.error(n.DiagnosticCode.Expression_cannot_be_represented_by_a_type,e.range),a}lookupElementAccessExpression(e,t,r,i=p.REPORT){var s=e.expression,a=this.resolveExpression(s,t,r,i);if(!a)return null;if(a.is(256)){let t=a.classReference;if(t){let r=t.indexSignature;if(r)return this.currentThisExpression=s,this.currentElementExpression=e.elementExpression,r}}return i==p.REPORT&&this.error(n.DiagnosticCode.Index_signature_is_missing_in_type_0,s.range,a.toString()),null}resolveElementAccessExpression(e,t,r,i=p.REPORT){var s=this.lookupElementAccessExpression(e,t,r,i);if(!s)return null;var a=this.getTypeOfElement(s);return a||i==p.REPORT&&this.error(n.DiagnosticCode.Expression_cannot_be_represented_by_a_type,e.range),a}determineIntegerLiteralType(e,t){if(!t.is(256))switch(t.kind){case 0:if(i64_is_i8(e))return a.Type.i8;break;case 5:if(i64_is_u8(e))return a.Type.u8;break;case 1:if(i64_is_i16(e))return a.Type.i16;break;case 6:if(i64_is_u16(e))return a.Type.u16;break;case 2:if(i64_is_i32(e))return a.Type.i32;break;case 7:if(i64_is_u32(e))return a.Type.u32;break;case 10:if(i64_is_bool(e))return a.Type.bool;break;case 4:if(!this.program.options.isWasm64){if(i64_is_i32(e))return a.Type.isize32;break}return a.Type.isize64;case 9:if(!this.program.options.isWasm64){if(i64_is_u32(e))return a.Type.usize32;break}return a.Type.usize64;case 3:return a.Type.i64;case 8:return a.Type.u64;case 11:return a.Type.f32;case 12:return a.Type.f64}return i64_is_i32(e)?a.Type.i32:i64_is_u32(e)?a.Type.u32:a.Type.i64}lookupAssertionExpression(e,t,r=a.Type.auto,i=p.REPORT){if(e.assertionKind==s.AssertionKind.NONNULL)return this.lookupExpression(e.expression,t,r,i);var o=this.resolveType(assert(e.toType),t.actualFunction,t.contextualTypeArguments,i);if(!o)return null;var l=this.getElementOfType(o);return l||(i==p.REPORT&&this.error(n.DiagnosticCode.Type_0_is_illegal_in_this_context,e.range,o.toString()),this.currentThisExpression=null,this.currentElementExpression=null,null)}resolveAssertionExpression(e,t,r=a.Type.auto,n=p.REPORT){if(e.assertionKind==s.AssertionKind.NONNULL){let i=this.resolveExpression(e.expression,t,r,n);return i?i.nonNullableType:null}return this.resolveType(assert(e.toType),t.actualFunction,t.contextualTypeArguments,n)}lookupUnaryPrefixExpression(e,t,r=a.Type.auto,i=p.REPORT){var s=this.resolveUnaryPrefixExpression(e,t,r,i);if(!s)return null;var o=this.getElementOfType(s);return o||i==p.REPORT&&this.error(n.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,c.operatorTokenToString(e.operator),s.toString()),o}resolveUnaryPrefixExpression(e,t,r=a.Type.auto,o=p.REPORT){var l=e.operand,u=e.operator;switch(u){case c.Token.MINUS:if(l.kind==s.NodeKind.LITERAL&&l.literalKind==s.LiteralKind.INTEGER)return this.determineIntegerLiteralType(i64_sub(i64_zero,l.value),r);case c.Token.PLUS:case c.Token.PLUS_PLUS:case c.Token.MINUS_MINUS:{let s=this.resolveExpression(l,t,r,o);if(!s)return null;if(s.is(256)){let e=s.classReference;if(e){let t=e.lookupOverload(i.OperatorKind.fromUnaryPrefixToken(u));if(t)return t.signature.returnType;let r=e.wrappedType;r&&(s=r)}}return!s.isAny(12)||s.is(256)?(o==p.REPORT&&this.error(n.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,c.operatorTokenToString(u),s.toString()),null):s}case c.Token.EXCLAMATION:{let e=this.resolveExpression(l,t,r,o);if(!e)return null;if(e.is(256)){let t=e.classReference;if(t){let e=t.lookupOverload(i.OperatorKind.NOT);if(e)return e.signature.returnType}}return a.Type.bool}case c.Token.TILDE:{let s=this.resolveExpression(l,t,r,o);if(!s)return null;if(s.is(256)){let e=s.classReference;if(e){let t=e.lookupOverload(i.OperatorKind.BITWISE_NOT);if(t)return t.signature.returnType}}return s.isAny(12)&&s.is(128)?s.intType:(o==p.REPORT&&this.error(n.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"~",s.toString()),null)}default:assert(!1)}return null}lookupUnaryPostfixExpression(e,t,r=a.Type.auto,i=p.REPORT){var s=this.resolveUnaryPostfixExpression(e,t,r,i);if(!s)return null;var o=this.getElementOfType(s);return o||i==p.REPORT&&this.error(n.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,c.operatorTokenToString(e.operator),s.toString()),o}resolveUnaryPostfixExpression(e,t,r=a.Type.auto,s=p.REPORT){var o=e.operator;switch(o){case c.Token.PLUS_PLUS:case c.Token.MINUS_MINUS:{let a=this.resolveExpression(e.operand,t,r,s);if(!a)return null;if(a.is(256)){let e=a.classReference;if(e){let t=e.lookupOverload(i.OperatorKind.fromUnaryPostfixToken(o));if(t)return t.signature.returnType}}return a.isAny(12)&&a.is(128)?a:(s==p.REPORT&&this.error(n.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,c.operatorTokenToString(o),a.toString()),null)}}return s==p.REPORT&&this.error(n.DiagnosticCode.Not_implemented,e.range),null}lookupBinaryExpression(e,t,r=a.Type.auto,i=p.REPORT){var s=this.resolveBinaryExpression(e,t,r,i);if(!s)return null;var o=this.getElementOfType(s);return o||(i==p.REPORT&&this.error(n.DiagnosticCode.Type_0_is_illegal_in_this_context,e.range,s.toString()),null)}resolveBinaryExpression(e,t,r=a.Type.auto,s=p.REPORT){var o=e.left,l=e.right,u=e.operator;switch(u){case c.Token.EQUALS:case c.Token.PLUS_EQUALS:case c.Token.MINUS_EQUALS:case c.Token.ASTERISK_EQUALS:case c.Token.ASTERISK_ASTERISK_EQUALS:case c.Token.SLASH_EQUALS:case c.Token.PERCENT_EQUALS:case c.Token.LESSTHAN_LESSTHAN_EQUALS:case c.Token.GREATERTHAN_GREATERTHAN_EQUALS:case c.Token.GREATERTHAN_GREATERTHAN_GREATERTHAN_EQUALS:case c.Token.AMPERSAND_EQUALS:case c.Token.BAR_EQUALS:case c.Token.CARET_EQUALS:return this.resolveExpression(o,t,r,s);case c.Token.LESSTHAN:case c.Token.GREATERTHAN:case c.Token.LESSTHAN_EQUALS:case c.Token.GREATERTHAN_EQUALS:{let l=this.resolveExpression(o,t,r,s);if(!l)return null;if(l.is(256)){let e=l.classReference;if(e){let t=e.lookupOverload(i.OperatorKind.fromBinaryToken(u));if(t)return t.signature.returnType}}return!l.isAny(12)||l.is(256)?(s==p.REPORT&&this.error(n.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,c.operatorTokenToString(u),l.toString()),null):a.Type.bool}case c.Token.EQUALS_EQUALS:case c.Token.EXCLAMATION_EQUALS:{let e=this.resolveExpression(o,t,r,s);if(!e)return null;if(e.is(256)){let t=e.classReference;if(t){let e=t.lookupOverload(i.OperatorKind.fromBinaryToken(u));if(e)return e.signature.returnType}}return a.Type.bool}case c.Token.EQUALS_EQUALS_EQUALS:case c.Token.EXCLAMATION_EQUALS_EQUALS:return a.Type.bool;case c.Token.PLUS:case c.Token.MINUS:case c.Token.ASTERISK:case c.Token.SLASH:case c.Token.PERCENT:{let c=this.resolveExpression(o,t,r,s);if(!c)return null;if(c.is(256)){let e=c.classReference;if(e){let t=e.lookupOverload(i.OperatorKind.fromBinaryToken(u));if(t)return t.signature.returnType}}let _=this.resolveExpression(l,t,c,s);if(!_)return null;let h=a.Type.commonDenominator(c,_,!1);return h||s==p.REPORT&&this.error(n.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,c.toString(),_.toString()),h}case c.Token.ASTERISK_ASTERISK:{let e=this.resolveExpression(o,t,r,s);if(!e)return null;if(e.is(256)){let t=e.classReference;if(t){let e=t.lookupOverload(i.OperatorKind.POW);if(e)return e.signature.returnType}}return e==a.Type.f32?a.Type.f32:a.Type.f64}case c.Token.LESSTHAN_LESSTHAN:case c.Token.GREATERTHAN_GREATERTHAN:case c.Token.GREATERTHAN_GREATERTHAN_GREATERTHAN:{let a=this.resolveExpression(o,t,r,s);if(!a)return null;if(a.is(256)){let e=a.classReference;if(e){let t=e.lookupOverload(i.OperatorKind.fromBinaryToken(u));if(t)return t.signature.returnType}}return!a.is(4)||a.is(256)?(s==p.REPORT&&this.error(n.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,c.operatorTokenToString(u),a.toString()),null):a}case c.Token.AMPERSAND:case c.Token.BAR:case c.Token.CARET:{let _=this.resolveExpression(o,t,r,s);if(!_)return null;if(_.is(256)){let e=_.classReference;if(e){let t=e.lookupOverload(i.OperatorKind.fromBinaryToken(u));if(t)return t.signature.returnType}}let h=this.resolveExpression(l,t,r,s);if(!h)return null;let d=a.Type.commonDenominator(_,h,!1);return d&&d.is(4)&&!d.is(256)||s==p.REPORT&&this.error(n.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,c.operatorTokenToString(u),_.toString(),h.toString()),d}case c.Token.AMPERSAND_AMPERSAND:case c.Token.BAR_BAR:return this.resolveExpression(o,t,r,s)}return s==p.REPORT&&this.error(n.DiagnosticCode.Not_implemented,e.range),null}lookupThisExpression(e,t,r=a.Type.auto,i=p.REPORT){if(t.is(32768)){let e=t.lookupLocal(o.CommonSymbols.this_);if(e)return this.currentThisExpression=null,this.currentElementExpression=null,e}var s=t.actualFunction.parent;return s?(this.currentThisExpression=null,this.currentElementExpression=null,s):(i==p.REPORT&&this.error(n.DiagnosticCode._this_cannot_be_referenced_in_current_location,e.range),null)}resolveThisExpression(e,t,r=a.Type.auto,i=p.REPORT){var s=this.lookupThisExpression(e,t,r,i);if(!s)return null;var o=this.getTypeOfElement(s);return o||i==p.REPORT&&this.error(n.DiagnosticCode.Expression_cannot_be_represented_by_a_type,e.range),o}lookupSuperExpression(e,t,r=a.Type.auto,s=p.REPORT){if(t.is(32768)){let e=t.lookupLocal(o.CommonSymbols.super_);if(e)return this.currentThisExpression=null,this.currentElementExpression=null,e}var l=t.actualFunction.parent;return l&&l.kind==i.ElementKind.CLASS&&(l=l.base)?(this.currentThisExpression=null,this.currentElementExpression=null,l):(s==p.REPORT&&this.error(n.DiagnosticCode._super_can_only_be_referenced_in_a_derived_class,e.range),null)}resolveSuperExpression(e,t,r=a.Type.auto,i=p.REPORT){var s=this.lookupSuperExpression(e,t,r,i);if(!s)return null;var o=this.getTypeOfElement(s);return o||i==p.REPORT&&this.error(n.DiagnosticCode.Expression_cannot_be_represented_by_a_type,e.range),o}lookupLiteralExpression(e,t,r=a.Type.auto,i=p.REPORT){switch(e.literalKind){case s.LiteralKind.INTEGER:{this.currentThisExpression=e,this.currentElementExpression=null;let t=this.determineIntegerLiteralType(e.value,r),n=this.program.wrapperClasses;return assert(n.has(t)),n.get(t)}case s.LiteralKind.FLOAT:{this.currentThisExpression=e,this.currentElementExpression=null;let t=r==a.Type.f32?a.Type.f32:a.Type.f64,n=this.program.wrapperClasses;return assert(n.has(t)),n.get(t)}case s.LiteralKind.STRING:return this.currentThisExpression=e,this.currentElementExpression=null,this.program.stringInstance}return i==p.REPORT&&this.error(n.DiagnosticCode.Not_implemented,e.range),null}resolveLiteralExpression(e,t,r=a.Type.auto,i=p.REPORT){var s=this.lookupLiteralExpression(e,t,r,i);if(!s)return null;var o=this.getTypeOfElement(s);return o||i==p.REPORT&&this.error(n.DiagnosticCode.Expression_cannot_be_represented_by_a_type,e.range),o}lookupCallExpression(e,t,r=a.Type.void,i=p.REPORT){var s=this.resolveCallExpression(e,t,r,i);if(!s)return null;var o=this.getElementOfType(s);return o||i==p.REPORT&&this.error(n.DiagnosticCode.Type_0_is_illegal_in_this_context,e.range,s.toString()),o}resolveCallExpression(e,t,r=a.Type.void,s=p.REPORT){var o=e.expression,l=this.lookupExpression(o,t,r,s);if(!l)return null;switch(l.kind){case i.ElementKind.FUNCTION_PROTOTYPE:{if(l.internalName==u.BuiltinSymbols.unchecked&&e.arguments.length>0)return this.resolveExpression(e.arguments[0],t,r,s);let n=this.maybeInferCall(e,l,t,s);return n?n.signature.returnType:null}case i.ElementKind.FUNCTION_TARGET:return l.signature.returnType}return s==p.REPORT&&this.error(n.DiagnosticCode.Cannot_invoke_an_expression_whose_type_lacks_a_call_signature_Type_0_has_no_compatible_call_signatures,o.range,l.internalName),null}lookupCommaExpression(e,t,r=a.Type.auto,n=p.REPORT){var i=e.expressions;return this.lookupExpression(i[assert(i.length)-1],t,r,n)}resolveCommaExpression(e,t,r=a.Type.auto,n=p.REPORT){var i=e.expressions;return this.resolveExpression(i[assert(i.length)-1],t,r,n)}lookupInstanceOfExpression(e,t,r=a.Type.auto,n=p.REPORT){var i=this.program.wrapperClasses;return assert(i.has(a.Type.bool)),i.get(a.Type.bool)}resolveInstanceOfExpression(e,t,r=a.Type.auto,n=p.REPORT){return a.Type.bool}lookupTernaryExpression(e,t,r,i=p.REPORT){var s=this.resolveTernaryExpression(e,t,r,i);if(!s)return null;var a=this.getElementOfType(s);return a||i==p.REPORT&&this.error(n.DiagnosticCode.Type_0_is_illegal_in_this_context,e.range,s.toString()),a}resolveTernaryExpression(e,t,r,i=p.REPORT){var s=this.resolveExpression(e.ifThen,t,r,i);if(!s)return null;var o=this.resolveExpression(e.ifElse,t,s,i);if(!o)return null;var l=a.Type.commonDenominator(s,o,!1);return l||i==p.REPORT&&this.error(n.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,"?:",s.toString(),o.toString()),l}lookupNewExpression(e,t,r,s=p.REPORT){var a=this.lookupExpression(e.expression,t,r,s);return a?a.kind==i.ElementKind.CLASS_PROTOTYPE?this.resolveClassInclTypeArguments(a,e.typeArguments,t.actualFunction,l.makeMap(t.contextualTypeArguments),e,s):(s==p.REPORT&&this.error(n.DiagnosticCode.This_expression_is_not_constructable,e.range),null):null}resolveNewExpression(e,t,r,i=p.REPORT){var s=this.lookupNewExpression(e,t,r,i);if(!s)return null;var a=this.getTypeOfElement(s);return a||i==p.REPORT&&this.error(n.DiagnosticCode.Expression_cannot_be_represented_by_a_type,e.range),a}lookupFunctionExpression(e,t,r,i=p.REPORT){var s=this.resolveFunctionExpression(e,t,r,i);if(!s)return null;var a=this.getElementOfType(s);return a||i==p.REPORT&&this.error(n.DiagnosticCode.Type_0_is_illegal_in_this_context,e.range,s.toString()),a}resolveFunctionExpression(e,t,r,n=p.REPORT){return this.resolveFunctionType(e.declaration.signature,t.actualFunction,t.contextualTypeArguments,n)}resolveFunction(e,t,r=l.makeMap(),c=p.REPORT){var u=e.parent.kind==i.ElementKind.PROPERTY_PROTOTYPE?e.parent.parent:e.parent,_=null,h=t?a.typesToString(t):"";if(e.is(o.CommonFlags.INSTANCE)){assert(u.kind==i.ElementKind.CLASS),_=u;let t=e.getResolvedInstance(h);if(t)return t;let n=_.typeArguments;if(n){let e=assert(_.prototype.typeParameterNodes),t=e.length;assert(t==e.length);for(let i=0;i<t;++i){let t=e[i].name.text;r.has(t)||r.set(t,n[i])}}}else{assert(u.kind!=i.ElementKind.CLASS);let t=e.getResolvedInstance(h);if(t)return t}var d,y=e.functionTypeNode,T=e.typeParameterNodes;if(t&&(d=t.length)){assert(T&&d==T.length);for(let e=0;e<d;++e)r.set(T[e].name.text,t[e])}else assert(!T||0==T.length);var m=null,g=y.explicitThisType;if(g){if(!(m=this.resolveType(g,e.parent,r,c)))return null;r.set(o.CommonSymbols.this_,m)}else _&&(m=_.type,r.set(o.CommonSymbols.this_,m));var E,f=y.parameters,I=f.length,x=new Array(I),b=new Array(I),A=0;for(let t=0;t<I;++t){let i=f[t];i.parameterKind==s.ParameterKind.DEFAULT&&(A=t+1);let a=i.type;if(s.isTypeOmitted(a))return c==p.REPORT&&this.error(n.DiagnosticCode.Type_expected,a.range),null;let o=this.resolveType(a,e.parent,r,c);if(!o)return null;x[t]=o,b[t]=i.name.text}if(e.is(o.CommonFlags.SET))E=a.Type.void;else if(e.is(o.CommonFlags.CONSTRUCTOR))E=assert(_).type;else{let t=y.returnType;if(s.isTypeOmitted(t))return c==p.REPORT&&this.error(n.DiagnosticCode.Type_expected,t.range),null;let i=this.resolveType(t,e.parent,r,c);if(!i)return null;E=i}var N=new a.Signature(this.program,x,E,m);N.parameterNames=b,N.requiredParameters=A;var S=e.name;h.length&&(S+="<"+h+">");var C=new i.Function(S,e,N,r);return e.setResolvedInstance(h,C),C}resolveFunctionInclTypeArguments(e,t,r,s,a,l=p.REPORT){var c=e.parent.kind==i.ElementKind.PROPERTY_PROTOTYPE?e.parent.parent:e.parent,u=null;if(e.is(o.CommonFlags.GENERIC)){if(e.is(o.CommonFlags.INSTANCE)){assert(c.kind==i.ElementKind.CLASS);let e=c.typeArguments;if(e){let t=assert(c.prototype.typeParameterNodes),r=e.length;assert(r==t.length);for(let n=0;n<r;++n)s.set(t[n].name.text,e[n])}}if(!(u=this.resolveTypeArguments(assert(e.typeParameterNodes),t,r,s,a,l)))return null}else if(null!==t&&t.length)return l==p.REPORT&&this.error(n.DiagnosticCode.Type_0_is_not_generic,a.range,e.internalName),null;return this.resolveFunction(e,u,s,l)}resolveClass(e,t,r=l.makeMap(),s=p.REPORT){var c=t?a.typesToString(t):"",u=e.getResolvedInstance(c);if(u)return u;if(t){let n=assert(e.typeParameterNodes),i=n.length,s=t.length;assert(s==i);for(let e=0;e<s;++e)r.set(n[e].name.text,t[e])}else{let t=e.typeParameterNodes;assert(!(t&&t.length))}var _=e.basePrototype,h=null;if(_){let t=assert(e.extendsNode);if(!(h=this.resolveClassInclTypeArguments(_,t.typeArguments,e.parent,l.makeMap(r),t,s)))return null}var d=e.name;c.length&&(d+="<"+c+">"),(u=new i.Class(d,e,t,h)).contextualTypeArguments=r,e.setResolvedInstance(c,u);var y=0;if(h){let e=h.members;if(e){let t=u.members;t||(u.members=t=new Map);for(let[r,n]of e)t.set(r,n)}y=h.currentMemoryOffset}var T=e.instanceMembers;if(T)for(let t of T.values())switch(t.kind){case i.ElementKind.FIELD_PROTOTYPE:{let r=u.members;if(r){if(r.has(t.name)){let e=r.get(t.name);this.errorRelated(n.DiagnosticCode.Duplicate_identifier_0,t.identifierNode.range,e.declaration.name.range,t.name);break}}else u.members=r=new Map;let a=t.typeNode,c=null;if(a)c=this.resolveType(a,e.parent,u.contextualTypeArguments,s);else{if(h){let e=h.members;if(e&&e.has(t.name)){let r=e.get(t.name);r.is(o.CommonFlags.PRIVATE)||(assert(r.kind==i.ElementKind.FIELD),c=r.type)}}c||s==p.REPORT&&this.error(n.DiagnosticCode.Type_expected,t.identifierNode.range.atEnd)}if(!c)break;let _=new i.Field(t,u,c);assert(l.isPowerOf2(c.byteSize));let d=c.byteSize-1;y&d&&(y=1+(y|d)),_.memoryOffset=y,y+=c.byteSize,u.add(t.name,_);break}case i.ElementKind.FUNCTION_PROTOTYPE:{let e=t.toBound(u);u.add(e.name,e);break}case i.ElementKind.PROPERTY_PROTOTYPE:{let e=new i.Property(t,u),r=t.getterPrototype;if(r){let t=this.resolveFunction(r.toBound(u),null,l.makeMap(u.contextualTypeArguments),s);t&&(e.getterInstance=t,e.setType(t.signature.returnType))}let n=t.setterPrototype;if(n){let t=this.resolveFunction(n.toBound(u),null,l.makeMap(u.contextualTypeArguments),s);t&&(e.setterInstance=t,e.is(o.CommonFlags.RESOLVED)||(assert(1==t.signature.parameterTypes.length),e.setType(t.signature.parameterTypes[0])))}u.add(e.name,e);break}default:assert(!1)}u.currentMemoryOffset=y;{let e=u.lookupInSelf(o.CommonSymbols.constructor);if(e&&e.parent===u){assert(e.kind==i.ElementKind.FUNCTION_PROTOTYPE);let t=this.resolveFunction(e,null,u.contextualTypeArguments,s);t&&(u.constructorInstance=t)}}for(let[t,r]of e.overloadPrototypes){let e;if(assert(t!=i.OperatorKind.INVALID),r.is(o.CommonFlags.INSTANCE)){let t=r.toBound(u);e=this.resolveFunction(t,null,l.makeMap(),s)}else e=this.resolveFunction(r,null,l.makeMap(),s);if(!e)continue;let a=u.overloads;if(a||(u.overloads=a=new Map),e.is(o.CommonFlags.INSTANCE))switch(t){case i.OperatorKind.PREFIX_INC:case i.OperatorKind.PREFIX_DEC:case i.OperatorKind.POSTFIX_INC:case i.OperatorKind.POSTFIX_DEC:{let t=e.signature.returnType;t.isAssignableTo(u.type)||s==p.REPORT&&this.error(n.DiagnosticCode.Type_0_is_not_assignable_to_type_1,r.functionTypeNode.returnType.range,t.toString(),u.type.toString())}}if(a.has(t))s==p.REPORT&&this.error(n.DiagnosticCode.Duplicate_decorator,e.declaration.range);else if(a.set(t,e),t==i.OperatorKind.INDEXED_GET||t==i.OperatorKind.INDEXED_SET){let r=u.indexSignature;r||(u.indexSignature=r=new i.IndexSignature(u)),t==i.OperatorKind.INDEXED_GET&&r.setType(e.signature.returnType)}}return u}resolveClassInclTypeArguments(e,t,r,i,s,a=p.REPORT){var l=null;if(e.is(o.CommonFlags.GENERIC)){if(!(l=this.resolveTypeArguments(assert(e.typeParameterNodes),t,r,i,s,a)))return null}else if(null!==t&&t.length)return a==p.REPORT&&this.error(n.DiagnosticCode.Type_0_is_not_generic,s.range,e.internalName),null;return this.resolveClass(e,l,i,a)}}t.Resolver=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),i=r(4),s=r(5),a=r(0),o=r(2);var l;!function(e){e[e.NONE=0]="NONE",e[e.RETURNS=1]="RETURNS",e[e.RETURNS_WRAPPED=2]="RETURNS_WRAPPED",e[e.RETURNS_NONNULL=4]="RETURNS_NONNULL",e[e.THROWS=8]="THROWS",e[e.BREAKS=16]="BREAKS",e[e.CONTINUES=32]="CONTINUES",e[e.ALLOCATES=64]="ALLOCATES",e[e.CALLS_SUPER=128]="CALLS_SUPER",e[e.TERMINATES=256]="TERMINATES",e[e.CONDITIONALLY_RETURNS=512]="CONDITIONALLY_RETURNS",e[e.CONDITIONALLY_THROWS=1024]="CONDITIONALLY_THROWS",e[e.CONDITIONALLY_TERMINATES=2048]="CONDITIONALLY_TERMINATES",e[e.CONDITIONALLY_BREAKS=4096]="CONDITIONALLY_BREAKS",e[e.CONDITIONALLY_CONTINUES=8192]="CONDITIONALLY_CONTINUES",e[e.CONDITIONALLY_ALLOCATES=16384]="CONDITIONALLY_ALLOCATES",e[e.INLINE_CONTEXT=32768]="INLINE_CONTEXT",e[e.UNCHECKED_CONTEXT=65536]="UNCHECKED_CONTEXT",e[e.ANY_CATEGORICAL=511]="ANY_CATEGORICAL",e[e.ANY_CONDITIONAL=30208]="ANY_CONDITIONAL"}(t.FlowFlags||(t.FlowFlags={})),function(e){e[e.NONE=0]="NONE",e[e.CONSTANT=1]="CONSTANT",e[e.PARAMETER=2]="PARAMETER",e[e.WRAPPED=4]="WRAPPED",e[e.NONNULL=8]="NONNULL",e[e.READFROM=16]="READFROM",e[e.WRITTENTO=32]="WRITTENTO",e[e.RETAINED=64]="RETAINED",e[e.RETURNED=128]="RETURNED",e[e.CONDITIONALLY_READFROM=256]="CONDITIONALLY_READFROM",e[e.CONDITIONALLY_WRITTENTO=512]="CONDITIONALLY_WRITTENTO",e[e.CONDITIONALLY_RETAINED=1024]="CONDITIONALLY_RETAINED",e[e.CONDITIONALLY_RETURNED=2048]="CONDITIONALLY_RETURNED",e[e.ANY_CATEGORICAL=255]="ANY_CATEGORICAL",e[e.ANY_CONDITIONAL=3904]="ANY_CONDITIONAL",e[e.ANY_WRITTENTO=544]="ANY_WRITTENTO",e[e.ANY_RETAINED=1088]="ANY_RETAINED",e[e.ANY_RETURNED=2176]="ANY_RETURNED"}(l=t.LocalFlags||(t.LocalFlags={})),function(e){e.join=function(t,r){return t&e.ANY_CATEGORICAL&r&e.ANY_CATEGORICAL|t&e.ANY_CONDITIONAL|r&e.ANY_CONDITIONAL}}(l=t.LocalFlags||(t.LocalFlags={})),function(e){e[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONDITIONALLY_INITIALIZED=2]="CONDITIONALLY_INITIALIZED",e[e.ANY_CATEGORICAL=1]="ANY_CATEGORICAL",e[e.ANY_CONDITIONAL=2]="ANY_CONDITIONAL"}(t.FieldFlags||(t.FieldFlags={})),function(e){e.join=function(t,r){return t&e.ANY_CATEGORICAL&r&e.ANY_CATEGORICAL|t&e.ANY_CONDITIONAL|r&e.ANY_CONDITIONAL}}(t.FieldFlags||(t.FieldFlags={}));class c{constructor(){this.scopedLocals=null,this.fieldFlags=null}static create(e){var t=new c;return t.parent=null,t.flags=0,t.parentFunction=e,t.continueLabel=null,t.breakLabel=null,t.returnType=e.signature.returnType,t.contextualTypeArguments=e.contextualTypeArguments,t.localFlags=[],t.inlineFunction=null,t.inlineReturnLabel=null,t}static createInline(e,t){var r=c.create(e);return r.set(32768),r.inlineFunction=t,r.inlineReturnLabel=t.internalName+"|inlined."+(t.nextInlineId++).toString(10),r.returnType=t.signature.returnType,r.contextualTypeArguments=t.contextualTypeArguments,r}get actualFunction(){return this.inlineFunction||this.parentFunction}is(e){return(this.flags&e)==e}isAny(e){return 0!=(this.flags&e)}set(e){this.flags|=e}unset(e){this.flags&=~e}fork(){var e=new c;return e.parent=this,e.flags=this.flags,e.parentFunction=this.parentFunction,e.continueLabel=this.continueLabel,e.breakLabel=this.breakLabel,e.returnType=this.returnType,e.contextualTypeArguments=this.contextualTypeArguments,e.localFlags=this.localFlags.slice(),e.inlineFunction=this.inlineFunction,e.inlineReturnLabel=this.inlineReturnLabel,e}getTempLocal(e,t=null){var r,n,i=this.parentFunction;switch(e.toNativeType()){case s.NativeType.I32:r=i.tempI32s;break;case s.NativeType.I64:r=i.tempI64s;break;case s.NativeType.F32:r=i.tempF32s;break;case s.NativeType.F64:r=i.tempF64s;break;case s.NativeType.V128:r=i.tempV128s;break;case s.NativeType.Anyref:r=i.tempAnyrefs;break;default:throw new Error("concrete type expected")}if(t){if(r&&r.length)for(let i=0,s=r.length;i<s;++i)if(!t.has(r[i].index)){n=r[i];let t=r.length-1;for(;i<t;)unchecked(r[i]=r[1+i++]);return r.length=t,n.type=e,n.flags=a.CommonFlags.NONE,this.unsetLocalFlag(n.index,-1),n}n=i.addLocal(e)}else r&&r.length?((n=r.pop()).type=e,n.flags=a.CommonFlags.NONE):n=i.addLocal(e);return this.unsetLocalFlag(n.index,-1),n}getAutoreleaseLocal(e,t=null){var r=this.getTempLocal(e,t);r.set(a.CommonFlags.SCOPED);var n=this.scopedLocals;return n||(this.scopedLocals=n=new Map),n.set("~auto"+this.parentFunction.nextAutoreleaseId++,r),this.setLocalFlag(r.index,l.RETAINED),r}freeTempLocal(e){if(!e.is(a.CommonFlags.INLINED)){assert(e.index>=0);var t,r=this.parentFunction;switch(assert(null!=e.type),e.type.toNativeType()){case s.NativeType.I32:t=r.tempI32s||(r.tempI32s=[]);break;case s.NativeType.I64:t=r.tempI64s||(r.tempI64s=[]);break;case s.NativeType.F32:t=r.tempF32s||(r.tempF32s=[]);break;case s.NativeType.F64:t=r.tempF64s||(r.tempF64s=[]);break;case s.NativeType.V128:t=r.tempV128s||(r.tempV128s=[]);break;case s.NativeType.Anyref:t=r.tempAnyrefs||(r.tempAnyrefs=[]);break;default:throw new Error("concrete type expected")}assert(e.index>=0),t.push(e)}}getScopedLocal(e){var t=this.scopedLocals;return t&&t.has(e)?t.get(e):null}addScopedLocal(e,t,r=null){var n=this.getTempLocal(t,r),i=this.scopedLocals;return i?assert(!i.has(e)):this.scopedLocals=i=new Map,n.set(a.CommonFlags.SCOPED),i.set(e,n),n}addScopedAlias(e,t,r,n=null){if(this.scopedLocals){let t=this.scopedLocals.get(e);if(t)return n&&(t.declaration.range.source.isNative?this.parentFunction.program.error(o.DiagnosticCode.Duplicate_identifier_0,n.range,e):this.parentFunction.program.errorRelated(o.DiagnosticCode.Duplicate_identifier_0,n.range,t.declaration.name.range,e)),t}else this.scopedLocals=new Map;assert(r<this.parentFunction.localsByIndex.length);var s=new i.Local(e,r,t,this.parentFunction);return this.scopedLocals.set(e,s),s}get hasScopedLocals(){if(this.scopedLocals)for(let e of this.scopedLocals.values())if(e.is(a.CommonFlags.SCOPED))return!0;return!1}freeScopedLocals(){if(this.scopedLocals){for(let e of this.scopedLocals.values())e.is(a.CommonFlags.SCOPED)&&this.freeTempLocal(e);this.scopedLocals=null}}lookupLocal(e){var t,r=this;do{if((t=r.scopedLocals)&&t.has(e))return t.get(e)}while(r=r.parent);return this.parentFunction.localsByName.get(e)}lookup(e){var t=this.lookupLocal(e);return t||this.actualFunction.lookup(e)}isLocalFlag(e,t,r=!0){return e<0?r:e<this.localFlags.length&&(unchecked(this.localFlags[e])&t)==t}isAnyLocalFlag(e,t,r=!0){return e<0?r:e<this.localFlags.length&&0!=(unchecked(this.localFlags[e])&t)}setLocalFlag(e,t){if(!(e<0)){var r=this.localFlags,n=e<r.length?unchecked(r[e]):0;this.localFlags[e]=n|t}}unsetLocalFlag(e,t){if(!(e<0)){var r=this.localFlags,n=e<r.length?unchecked(r[e]):0;this.localFlags[e]=n&~t}}pushBreakLabel(){var e=this.parentFunction,t=e.nextBreakId++,r=e.breakStack;return r?r.push(t):e.breakStack=[t],e.breakLabel=t.toString(10)}popBreakLabel(){var e=this.parentFunction,t=assert(e.breakStack),r=assert(t.length);t.pop(),r>1?e.breakLabel=t[r-2].toString(10):(e.breakLabel=null,e.breakStack=null)}inherit(e){this.flags|=30719&e.flags,this.localFlags=e.localFlags}inheritConditional(e){this.set(30208&e.flags),e.is(1)&&this.set(512),e.is(8)&&this.set(1024),e.is(16)&&e.breakLabel==this.breakLabel&&this.set(4096),e.is(32)&&e.continueLabel==this.continueLabel&&this.set(8192),e.is(64)&&this.set(16384);var t=e.localFlags;for(let e=0,r=t.length;e<r;++e){let r=t[e];this.setLocalFlag(e,r&l.ANY_CONDITIONAL),r&l.RETAINED&&this.setLocalFlag(e,l.CONDITIONALLY_RETAINED),r&l.READFROM&&this.setLocalFlag(e,l.CONDITIONALLY_READFROM),r&l.WRITTENTO&&this.setLocalFlag(e,l.CONDITIONALLY_WRITTENTO),r&l.RETURNED&&this.setLocalFlag(e,l.CONDITIONALLY_RETURNED)}}inheritMutual(e,t){this.set(e.flags&t.flags&511),this.set(30208&e.flags),this.set(30208&t.flags),this.inheritConditional(e),this.inheritConditional(t);var r=e.localFlags,n=r.length,i=t.localFlags,s=i.length,a=new Array(max(n,s));for(let e=0;e<n;++e)a[e]=l.join(unchecked(r[e]),e<s?unchecked(i[e]):0);for(let e=n;e<s;++e)a[e]=l.join(0,unchecked(i[e]));this.localFlags=a}unifyLocalFlags(e){var t=this.localFlags.length,r=e.localFlags.length;for(let n=0,i=min(t,r);n<i;++n)this.isLocalFlag(n,l.WRAPPED)!=e.isLocalFlag(n,l.WRAPPED)&&this.unsetLocalFlag(n,l.WRAPPED),this.isLocalFlag(n,l.NONNULL)!=e.isLocalFlag(n,l.NONNULL)&&this.unsetLocalFlag(n,l.NONNULL),assert(this.isAnyLocalFlag(n,l.ANY_RETAINED)==e.isAnyLocalFlag(n,l.ANY_RETAINED))}isNonnull(e,t){if(!t.is(512))return!0;switch(s.getExpressionId(e)){case s.ExpressionId.LocalSet:{if(!s.isLocalTee(e))break;let t=this.parentFunction.localsByIndex[s.getLocalSetIndex(e)];return!t.type.is(512)||this.isLocalFlag(t.index,l.NONNULL,!1)}case s.ExpressionId.LocalGet:{let t=this.parentFunction.localsByIndex[s.getLocalGetIndex(e)];return!t.type.is(512)||this.isLocalFlag(t.index,l.NONNULL,!1)}}return!1}inheritNonnullIfTrue(e){switch(s.getExpressionId(e)){case s.ExpressionId.LocalSet:{if(!s.isLocalTee(e))break;let t=this.parentFunction.localsByIndex[s.getLocalSetIndex(e)];this.setLocalFlag(t.index,l.NONNULL),this.inheritNonnullIfTrue(s.getLocalSetValue(e));break}case s.ExpressionId.LocalGet:{let t=this.parentFunction.localsByIndex[s.getLocalGetIndex(e)];this.setLocalFlag(t.index,l.NONNULL);break}case s.ExpressionId.If:{let t=s.getIfFalse(e);if(!t)break;s.getExpressionId(t)==s.ExpressionId.Const&&(s.getExpressionType(t)==s.NativeType.I32&&0==s.getConstValueI32(t)||s.getExpressionType(t)==s.NativeType.I64&&0==s.getConstValueI64Low(t)&&0==s.getConstValueI64High(t))&&(this.inheritNonnullIfTrue(s.getIfCondition(e)),this.inheritNonnullIfTrue(s.getIfTrue(e)));break}case s.ExpressionId.Unary:switch(s.getUnaryOp(e)){case s.UnaryOp.EqzI32:case s.UnaryOp.EqzI64:this.inheritNonnullIfFalse(s.getUnaryValue(e))}break;case s.ExpressionId.Binary:switch(s.getBinaryOp(e)){case s.BinaryOp.EqI32:{let t=s.getBinaryLeft(e),r=s.getBinaryRight(e);s.getExpressionId(t)==s.ExpressionId.Const&&0!=s.getConstValueI32(t)?this.inheritNonnullIfTrue(r):s.getExpressionId(r)==s.ExpressionId.Const&&0!=s.getConstValueI32(r)&&this.inheritNonnullIfTrue(t);break}case s.BinaryOp.EqI64:{let t=s.getBinaryLeft(e),r=s.getBinaryRight(e);s.getExpressionId(t)!=s.ExpressionId.Const||0==s.getConstValueI64Low(t)&&0==s.getConstValueI64High(t)?s.getExpressionId(r)==s.ExpressionId.Const&&0!=s.getConstValueI64Low(r)&&0!=s.getConstValueI64High(r)&&this.inheritNonnullIfTrue(t):this.inheritNonnullIfTrue(r);break}case s.BinaryOp.NeI32:{let t=s.getBinaryLeft(e),r=s.getBinaryRight(e);s.getExpressionId(t)==s.ExpressionId.Const&&0==s.getConstValueI32(t)?this.inheritNonnullIfTrue(r):s.getExpressionId(r)==s.ExpressionId.Const&&0==s.getConstValueI32(r)&&this.inheritNonnullIfTrue(t);break}case s.BinaryOp.NeI64:{let t=s.getBinaryLeft(e),r=s.getBinaryRight(e);s.getExpressionId(t)==s.ExpressionId.Const&&0==s.getConstValueI64Low(t)&&0==s.getConstValueI64High(t)?this.inheritNonnullIfTrue(r):s.getExpressionId(r)==s.ExpressionId.Const&&0==s.getConstValueI64Low(r)&&0==s.getConstValueI64High(r)&&this.inheritNonnullIfTrue(t);break}}break;case s.ExpressionId.Call:switch(s.getCallTarget(e)){case this.parentFunction.program.retainInstance.internalName:this.inheritNonnullIfTrue(s.getCallOperand(e,0))}break}}inheritNonnullIfFalse(e){switch(s.getExpressionId(e)){case s.ExpressionId.Unary:switch(s.getUnaryOp(e)){case s.UnaryOp.EqzI32:case s.UnaryOp.EqzI64:this.inheritNonnullIfTrue(s.getUnaryValue(e))}break;case s.ExpressionId.If:{let t=s.getIfTrue(e);if(s.getExpressionId(t)==s.ExpressionId.Const){if(!s.getIfFalse(e))break;(s.getExpressionType(t)==s.NativeType.I32&&0!=s.getConstValueI32(t)||s.getExpressionType(t)==s.NativeType.I64&&(0!=s.getConstValueI64Low(t)||0!=s.getConstValueI64High(t)))&&(this.inheritNonnullIfFalse(s.getIfCondition(e)),this.inheritNonnullIfFalse(s.getIfFalse(e)))}break}case s.ExpressionId.Binary:switch(s.getBinaryOp(e)){case s.BinaryOp.EqI32:{let t=s.getBinaryLeft(e),r=s.getBinaryRight(e);s.getExpressionId(t)==s.ExpressionId.Const&&0==s.getConstValueI32(t)?this.inheritNonnullIfTrue(r):s.getExpressionId(r)==s.ExpressionId.Const&&0==s.getConstValueI32(r)&&this.inheritNonnullIfTrue(t);break}case s.BinaryOp.EqI64:{let t=s.getBinaryLeft(e),r=s.getBinaryRight(e);s.getExpressionId(t)==s.ExpressionId.Const&&0==s.getConstValueI64Low(t)&&0==s.getConstValueI64High(t)?this.inheritNonnullIfTrue(r):s.getExpressionId(r)==s.ExpressionId.Const&&0==s.getConstValueI64Low(r)&&0==s.getConstValueI64High(r)&&this.inheritNonnullIfTrue(t);break}case s.BinaryOp.NeI32:{let t=s.getBinaryLeft(e),r=s.getBinaryRight(e);s.getExpressionId(t)==s.ExpressionId.Const&&0!=s.getConstValueI32(t)?this.inheritNonnullIfTrue(r):s.getExpressionId(r)==s.ExpressionId.Const&&0!=s.getConstValueI32(r)&&this.inheritNonnullIfTrue(t);break}case s.BinaryOp.NeI64:{let t=s.getBinaryLeft(e),r=s.getBinaryRight(e);s.getExpressionId(t)!=s.ExpressionId.Const||0==s.getConstValueI64Low(t)&&0==s.getConstValueI64High(t)?s.getExpressionId(r)!=s.ExpressionId.Const||0==s.getConstValueI64Low(r)&&0==s.getConstValueI64High(r)||this.inheritNonnullIfTrue(t):this.inheritNonnullIfTrue(r);break}}}}canOverflow(e,t){if(assert(t!=n.Type.void),!t.is(36))return!1;var r;switch(s.getExpressionId(e)){case s.ExpressionId.LocalGet:{let r=this.parentFunction.localsByIndex[s.getLocalGetIndex(e)];return!this.isLocalFlag(r.index,l.WRAPPED,!0)||u(r.type,t)}case s.ExpressionId.LocalSet:return assert(s.isLocalTee(e)),this.canOverflow(s.getLocalSetValue(e),t);case s.ExpressionId.GlobalGet:{let r=assert(this.parentFunction.program.elementsByName.get(assert(s.getGlobalGetName(e))));return assert(r.kind==i.ElementKind.GLOBAL),u(assert(r.type),t)}case s.ExpressionId.Binary:switch(s.getBinaryOp(e)){case s.BinaryOp.EqI32:case s.BinaryOp.EqI64:case s.BinaryOp.EqF32:case s.BinaryOp.EqF64:case s.BinaryOp.NeI32:case s.BinaryOp.NeI64:case s.BinaryOp.NeF32:case s.BinaryOp.NeF64:case s.BinaryOp.LtI32:case s.BinaryOp.LtU32:case s.BinaryOp.LtI64:case s.BinaryOp.LtU64:case s.BinaryOp.LtF32:case s.BinaryOp.LtF64:case s.BinaryOp.LeI32:case s.BinaryOp.LeU32:case s.BinaryOp.LeI64:case s.BinaryOp.LeU64:case s.BinaryOp.LeF32:case s.BinaryOp.LeF64:case s.BinaryOp.GtI32:case s.BinaryOp.GtU32:case s.BinaryOp.GtI64:case s.BinaryOp.GtU64:case s.BinaryOp.GtF32:case s.BinaryOp.GtF64:case s.BinaryOp.GeI32:case s.BinaryOp.GeU32:case s.BinaryOp.GeI64:case s.BinaryOp.GeU64:case s.BinaryOp.GeF32:case s.BinaryOp.GeF64:return!1;case s.BinaryOp.MulI32:return!(s.getExpressionId(r=s.getBinaryLeft(e))==s.ExpressionId.Const&&(0==s.getConstValueI32(r)||1==s.getConstValueI32(r)&&!this.canOverflow(s.getBinaryRight(e),t))||s.getExpressionId(r=s.getBinaryRight(e))==s.ExpressionId.Const&&(0==s.getConstValueI32(r)||1==s.getConstValueI32(r)&&!this.canOverflow(s.getBinaryLeft(e),t)));case s.BinaryOp.AndI32:return!(s.getExpressionId(r=s.getBinaryLeft(e))==s.ExpressionId.Const&&s.getConstValueI32(r)<=t.computeSmallIntegerMask(n.Type.i32)||!this.canOverflow(r,t)||s.getExpressionId(r=s.getBinaryRight(e))==s.ExpressionId.Const&&s.getConstValueI32(r)<=t.computeSmallIntegerMask(n.Type.i32)||!this.canOverflow(r,t));case s.BinaryOp.ShlI32:{let n=32-t.size;return s.getExpressionId(r=s.getBinaryRight(e))!=s.ExpressionId.Const||s.getConstValueI32(r)<n}case s.BinaryOp.ShrI32:{let n=32-t.size;return this.canOverflow(s.getBinaryLeft(e),t)&&(s.getExpressionId(r=s.getBinaryRight(e))!=s.ExpressionId.Const||s.getConstValueI32(r)<n)}case s.BinaryOp.ShrU32:{let n=32-t.size;return t.is(1)?!(s.getExpressionId(r=s.getBinaryRight(e))==s.ExpressionId.Const&&s.getConstValueI32(r)>n):this.canOverflow(s.getBinaryLeft(e),t)&&!(s.getExpressionId(r=s.getBinaryRight(e))==s.ExpressionId.Const&&s.getConstValueI32(r)>=n)}case s.BinaryOp.DivU32:case s.BinaryOp.RemI32:case s.BinaryOp.RemU32:return this.canOverflow(s.getBinaryLeft(e),t)||this.canOverflow(s.getBinaryRight(e),t)}break;case s.ExpressionId.Unary:switch(s.getUnaryOp(e)){case s.UnaryOp.EqzI32:case s.UnaryOp.EqzI64:return!1;case s.UnaryOp.ClzI32:case s.UnaryOp.CtzI32:case s.UnaryOp.PopcntI32:return t.size<7}break;case s.ExpressionId.Const:{let r=0;switch(s.getExpressionType(e)){case s.NativeType.I32:r=s.getConstValueI32(e);break;case s.NativeType.I64:r=s.getConstValueI64Low(e);break;case s.NativeType.F32:r=i32(s.getConstValueF32(e));break;case s.NativeType.F64:r=i32(s.getConstValueF64(e));break;default:assert(!1)}switch(t.kind){case 0:return r<i8.MIN_VALUE||r>i8.MAX_VALUE;case 1:return r<i16.MIN_VALUE||r>i16.MAX_VALUE;case 5:return r<0||r>u8.MAX_VALUE;case 6:return r<0||r>u16.MAX_VALUE;case 10:return 0!=(-2&r)}break}case s.ExpressionId.Load:{let r,i=s.isLoadSigned(e);switch(s.getLoadBytes(e)){case 1:r=i?n.Type.i8:n.Type.u8;break;case 2:r=i?n.Type.i16:n.Type.u16;break;default:r=i?n.Type.i32:n.Type.u32}return u(r,t)}case s.ExpressionId.Block:if(!s.getBlockName(e)){let r=assert(s.getBlockChildCount(e)),n=s.getBlockChild(e,r-1);return this.canOverflow(n,t)}break;case s.ExpressionId.If:return this.canOverflow(s.getIfTrue(e),t)||this.canOverflow(assert(s.getIfFalse(e)),t);case s.ExpressionId.Select:return this.canOverflow(s.getSelectThen(e),t)||this.canOverflow(s.getSelectElse(e),t);case s.ExpressionId.Call:{let r=this.parentFunction.program.instancesByName,n=assert(s.getCallTarget(e));if(r.has(n)){let e=r.get(n);assert(e.kind==i.ElementKind.FUNCTION);let s=e.signature.returnType;return!e.flow.is(2)||u(s,t)}return!1}case s.ExpressionId.Unreachable:return!1}return!0}toString(){for(var e=0,t=this.parent;t;)t=t.parent,++e;return"Flow("+this.actualFunction+")["+e.toString()+"]"}}function u(e,t){return!e.is(4)||e.size>t.size||e.is(1)!=t.is(1)}function p(e,t){switch(s.getExpressionId(e)){case s.ExpressionId.LocalGet:t.add(s.getLocalGetIndex(e));break;case s.ExpressionId.LocalSet:t.add(s.getLocalSetIndex(e));default:s.traverse(e,t,p)}}t.Flow=c,t.findUsedLocals=function(e,t=new Set){return s.traverse(e,t,p),t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(13),i=r(2),s=r(5),a=r(0),o=r(4),l=r(10),c=r(9),u=r(7),p=r(3),_=r(6),h=r(1);class d{constructor(){this.target=a.Target.WASM32,this.noAssert=!1,this.importMemory=!1,this.sharedMemory=0,this.importTable=!1,this.sourceMap=!1,this.explicitStart=!1,this.memoryBase=0,this.globalAliases=null,this.features=2,this.noUnsafe=!1,this.optimizeLevelHint=0,this.shrinkLevelHint=0}get isWasm64(){return this.target==a.Target.WASM64}get usizeType(){return this.target==a.Target.WASM64?_.Type.usize64:_.Type.usize32}get isizeType(){return this.target==a.Target.WASM64?_.Type.isize64:_.Type.isize32}get nativeSizeType(){return this.target==a.Target.WASM64?s.NativeType.I64:s.NativeType.I32}hasFeature(e){return 0!=(this.features&e)}}var y,T;t.Options=d,function(e){e[e.NONE=0]="NONE",e[e.CONV_IMPLICIT=1]="CONV_IMPLICIT",e[e.CONV_EXPLICIT=2]="CONV_EXPLICIT",e[e.MUST_WRAP=4]="MUST_WRAP",e[e.WILL_DROP=8]="WILL_DROP",e[e.WILL_RETAIN=16]="WILL_RETAIN",e[e.PREFER_STATIC=32]="PREFER_STATIC"}(t.Constraints||(t.Constraints={})),function(e){e[e.NONE=0]="NONE",e[e.HEAP=1]="HEAP",e[e.RTTI=2]="RTTI",e[e.visitGlobals=4]="visitGlobals",e[e.visitMembers=8]="visitMembers"}(t.RuntimeFeatures||(t.RuntimeFeatures={}));class m extends i.DiagnosticEmitter{constructor(e,t=null){super(e.diagnostics),this.currentInlineFunctions=[],this.currentParent=null,this.currentType=_.Type.void,this.memorySegments=[],this.stringSegments=new Map,this.functionTable=["null"],this.argcVar=0,this.argcSet=0,this.runtimeFeatures=0,this.skippedAutoreleases=new Set,this.f32ModInstance=null,this.f64ModInstance=null,this.f32PowInstance=null,this.f64PowInstance=null,this.program=e,t||(t=new d),this.options=t,this.memoryOffset=i64_new(max(t.memoryBase,8)),this.module=s.Module.create();var r=0;this.options.hasFeature(1)&&(r|=s.FeatureFlags.SignExt),this.options.hasFeature(2)&&(r|=s.FeatureFlags.MutableGloabls),this.options.hasFeature(4)&&(r|=s.FeatureFlags.NontrappingFPToInt),this.options.hasFeature(8)&&(r|=s.FeatureFlags.BulkMemory),this.options.hasFeature(16)&&(r|=s.FeatureFlags.SIMD128),this.options.hasFeature(32)&&(r|=s.FeatureFlags.Atomics),this.options.hasFeature(64)&&(r|=s.FeatureFlags.ExceptionHandling),this.options.hasFeature(128)&&(r|=s.FeatureFlags.TailCall),this.options.hasFeature(256)&&(r|=s.FeatureFlags.ReferenceTypes),this.module.setFeatures(r)}get resolver(){return this.program.resolver}static compile(e,t=null){return new m(e,t).compile()}compile(){var e=this.options,t=this.module,r=this.program;r.initialize(e);var i=r.makeNativeFunction("start",new _.Signature(r,[],_.Type.void));i.internalName="start";var a=new Array;this.currentFlow=i.flow,this.currentBody=a,e.isWasm64?(t.addGlobal(n.BuiltinSymbols.heap_base,s.NativeType.I64,!0,t.i64(0)),t.addGlobal(n.BuiltinSymbols.rtti_base,s.NativeType.I64,!0,t.i64(0))):(t.addGlobal(n.BuiltinSymbols.heap_base,s.NativeType.I32,!0,t.i32(0)),t.addGlobal(n.BuiltinSymbols.rtti_base,s.NativeType.I32,!0,t.i32(0)));var o=r.filesByName;for(let e of o.values())e.source.sourceKind==p.SourceKind.USER_ENTRY&&(this.compileFile(e),this.compileExports(e));var l=!a.length,c=e.explicitStart;if(!l||c){let e=i.signature;!l&&c&&(t.addGlobal(n.BuiltinSymbols.started,s.NativeType.I32,!0,t.i32(0)),a.unshift(t.if(t.global_get(n.BuiltinSymbols.started,s.NativeType.I32),t.return(),t.global_set(n.BuiltinSymbols.started,t.i32(1)))));let r=t.addFunction(i.internalName,this.ensureFunctionType(e.parameterTypes,e.returnType,e.thisType),_.typesToNativeTypes(i.additionalLocals),t.block(null,a));i.finalize(t,r),c?t.addFunctionExport(i.internalName,"__start"):t.setStart(r)}4&this.runtimeFeatures&&n.compileVisitGlobals(this),8&this.runtimeFeatures&&n.compileVisitMembers(this),t.removeGlobal(n.BuiltinSymbols.rtti_base),2&this.runtimeFeatures&&n.compileRTTI(this);var u=this.memoryOffset;u=i64_align(u,e.usizeType.byteSize),this.memoryOffset=u,t.removeGlobal(n.BuiltinSymbols.heap_base),1&this.runtimeFeatures&&(e.isWasm64?t.addGlobal(n.BuiltinSymbols.heap_base,s.NativeType.I64,!1,t.i64(i64_low(u),i64_high(u))):t.addGlobal(n.BuiltinSymbols.heap_base,s.NativeType.I32,!1,t.i32(i64_low(u))));var h=e.hasFeature(32)&&e.sharedMemory>0;t.setMemory(this.options.memoryBase||this.memorySegments.length?i64_low(i64_shr_u(i64_align(u,65536),i64_new(16,0))):0,h?e.sharedMemory:s.Module.UNLIMITED_MEMORY,this.memorySegments,e.target,"memory",h),e.importMemory&&t.addMemoryImport("0","env","memory",h);var d=this.functionTable;t.setFunctionTable(d.length,4294967295,d,t.i32(0)),t.addFunction("null",this.ensureFunctionType(null,_.Type.void),null,t.block(null,[])),e.importTable&&t.addTableImport("0","env","table");for(let e of this.program.filesByName.values())e.source.sourceKind==p.SourceKind.USER_ENTRY&&this.ensureModuleExports(e);return t}ensureModuleExports(e){var t=e.exports;if(t)for(let[e,r]of t)this.ensureModuleExport(e,r);var r=e.exportsStar;if(r)for(let e=0,t=r.length;e<t;++e)this.ensureModuleExports(r[e])}ensureModuleExport(e,t,r=""){switch(t.kind){case o.ElementKind.FUNCTION_PROTOTYPE:case o.ElementKind.CLASS_PROTOTYPE:{let n=t.instances;if(n)for(let t of n.values()){let n=e;if(t.is(a.CommonFlags.GENERIC)){let e=t.internalName;n+=e.substring(e.lastIndexOf("<"))}this.ensureModuleExport(n,t,r)}break}case o.ElementKind.PROPERTY_PROTOTYPE:{let n=t.getterPrototype,i=t.setterPrototype;n&&this.ensureModuleExport(a.GETTER_PREFIX+e,n,r),i&&this.ensureModuleExport(a.SETTER_PREFIX+e,i,r);break}case o.ElementKind.GLOBAL:t.is(a.CommonFlags.CONST)||t.is(a.CommonFlags.STATIC|a.CommonFlags.READONLY)||this.options.hasFeature(2)?this.module.addGlobalExport(t.internalName,r+e):this.error(i.DiagnosticCode.Cannot_export_a_mutable_global,t.identifierNode.range);break;case o.ElementKind.ENUMVALUE:t.isImmutable||this.options.hasFeature(2)?this.module.addGlobalExport(t.internalName,r+e):this.error(i.DiagnosticCode.Cannot_export_a_mutable_global,t.identifierNode.range);break;case o.ElementKind.FUNCTION:{let n=t,i=n.signature;i.requiredParameters<i.parameterTypes.length&&(n=this.ensureTrampoline(n),this.ensureArgcSet()),n.is(a.CommonFlags.COMPILED)&&this.module.addFunctionExport(n.internalName,r+e);break}case o.ElementKind.PROPERTY:{let n=t.getterInstance;n&&this.ensureModuleExport(a.GETTER_PREFIX+e,n,r);let i=t.setterInstance;i&&this.ensureModuleExport(a.SETTER_PREFIX+e,i,r);break}case o.ElementKind.FIELD:this.ensureModuleFieldGetter(r+a.GETTER_PREFIX+e,t),t.is(a.CommonFlags.READONLY)||this.ensureModuleFieldSetter(r+a.SETTER_PREFIX+e,t);break;case o.ElementKind.CLASS:if(!t.type.isUnmanaged){let n=this.module,i=t.internalName;n.addGlobal(i,s.NativeType.I32,!1,n.i32(t.id)),n.addGlobalExport(i,r+e)}break;case o.ElementKind.ENUM:case o.ElementKind.NAMESPACE:case o.ElementKind.FILE:case o.ElementKind.TYPEDEFINITION:case o.ElementKind.INDEXSIGNATURE:break;default:assert(!1)}var n=t.members;if(n){let i=r+e+(t.kind==o.ElementKind.CLASS?a.INSTANCE_DELIMITER:a.STATIC_DELIMITER);if(t.kind==o.ElementKind.NAMESPACE||t.kind==o.ElementKind.FILE)for(let e of n.values())e.is(a.CommonFlags.EXPORT)&&this.ensureModuleExport(e.name,e,i);else for(let e of n.values())e.is(a.CommonFlags.PRIVATE)||this.ensureModuleExport(e.name,e,i)}}ensureModuleFieldGetter(e,t){var r=t.type,n=this.module,i=this.options.usizeType,s=n.load(r.byteSize,r.is(1),n.local_get(0,i.toNativeType()),r.toNativeType(),t.memoryOffset);r.isManaged&&(s=this.makeRetain(s)),n.addFunction(e,this.ensureFunctionType(null,r,i),null,s),n.addFunctionExport(e,e)}ensureModuleFieldSetter(e,t){var r=t.type,n=this.module,i=r.toNativeType(),s=this.options.usizeType,a=s.toNativeType(),o=n.local_get(1,i);r.isManaged&&(o=this.makeRetainRelease(n.load(r.byteSize,!1,n.local_get(0,a),i,t.memoryOffset),o)),n.addFunction(e,this.ensureFunctionType([r],_.Type.void,s),null,n.store(r.byteSize,n.local_get(0,a),o,i,t.memoryOffset)),n.addFunctionExport(e,e)}compileElement(e,t=!0){switch(e.kind){case o.ElementKind.GLOBAL:this.compileGlobal(e);break;case o.ElementKind.ENUM:this.compileEnum(e);break;case o.ElementKind.FUNCTION_PROTOTYPE:e.is(a.CommonFlags.GENERIC)||this.compileFunctionUsingTypeArguments(e,[]);break;case o.ElementKind.CLASS_PROTOTYPE:e.is(a.CommonFlags.GENERIC)||this.compileClassUsingTypeArguments(e,[]);break;case o.ElementKind.PROPERTY_PROTOTYPE:{let t=e.getterPrototype;t&&this.compileFunctionUsingTypeArguments(t,[]);let r=e.setterPrototype;r&&this.compileFunctionUsingTypeArguments(r,[]);break}case o.ElementKind.NAMESPACE:case o.ElementKind.TYPEDEFINITION:case o.ElementKind.ENUMVALUE:case o.ElementKind.INDEXSIGNATURE:break;default:assert(!1,o.ElementKind[e.kind])}t&&this.compileMembers(e)}compileMembers(e){var t=e.members;if(t)for(let e of t.values())this.compileElement(e)}compileExports(e){var t=e.exports;if(t)for(let e of t.values())this.compileElement(e);var r=e.exportsStar;if(r)for(let e of r)this.compileFile(e),this.compileExports(e)}compileFileByPath(e,t){var r,n,s=this.program.filesByName;if(s.has(e))r=s.get(e);else{if(!s.has(n=e+a.INDEX_SUFFIX))return void this.error(i.DiagnosticCode.File_0_not_found,t.range,e);r=s.get(n)}this.compileFile(r)}compileFile(e){if(!e.is(a.CommonFlags.COMPILED)){e.set(a.CommonFlags.COMPILED);var t=e.startFunction,r=this.currentBody,n=new Array;this.currentBody=n;var i=this.currentFlow,o=t.flow;this.currentFlow=o;for(let t=e.source.statements,r=0,i=t.length;r<i;++r)this.compileTopLevelStatement(t[r],n);if(this.finishAutoreleases(o,n),this.currentFlow=i,this.currentBody=r,n.length){let e=this.module,i=t.localsByIndex,a=i.length,o=new Array(a);for(let e=0;e<a;++e)o[e]=i[e].type.toNativeType();e.addFunction(t.internalName,this.ensureFunctionType(t.signature.parameterTypes,t.signature.returnType),o,n.length>1?e.block(null,n):n[0]),r.push(e.call(t.internalName,null,s.NativeType.None))}}}compileGlobal(e){if(e.is(a.CommonFlags.COMPILED))return!0;e.set(a.CommonFlags.COMPILED);var t=this.module,r=0,l=!1,c=e.typeNode,u=e.initializerNode;if(!e.is(a.CommonFlags.RESOLVED))if(c){let t=this.resolver.resolveType(c,e.parent);if(!t)return!1;if(t==_.Type.void)return this.error(i.DiagnosticCode.Type_expected,c.range),!1;e.setType(t)}else{if(!u)return this.error(i.DiagnosticCode.Type_expected,e.identifierNode.range.atEnd),!1;{let t=this.currentFlow;if(e.hasDecorator(o.DecoratorFlags.LAZY)&&(this.currentFlow=e.file.startFunction.flow),r=this.compileExpression(u,_.Type.auto,20),this.skippedAutoreleases.has(r)&&(l=!0),this.currentFlow=t,this.currentType==_.Type.void)return this.error(i.DiagnosticCode.Type_0_is_not_assignable_to_type_1,u.range,this.currentType.toString(),"<auto>"),!1;e.setType(this.currentType)}}if(e.is(a.CommonFlags.AMBIENT)&&e.hasDecorator(o.DecoratorFlags.BUILTIN))return e.internalName==n.BuiltinSymbols.heap_base?this.runtimeFeatures|=1:e.internalName==n.BuiltinSymbols.rtti_base&&(this.runtimeFeatures|=2),!0;var h=e.type,d=h.toNativeType(),m=e.is(a.CommonFlags.CONST)||e.is(a.CommonFlags.STATIC|a.CommonFlags.READONLY),E=e.hasDecorator(o.DecoratorFlags.INLINE);if(e.is(a.CommonFlags.AMBIENT))return m||this.options.hasFeature(2)?(e.set(a.CommonFlags.MODULE_IMPORT),g(e,e.declaration),t.addGlobalImport(e.internalName,y,T,d,!m),e.set(a.CommonFlags.COMPILED),!0):(this.error(i.DiagnosticCode.Feature_0_is_not_enabled,e.declaration.range,"mutable-globals"),!1);var f=!1;if(u){if(!r){let t=this.currentFlow;e.hasDecorator(o.DecoratorFlags.LAZY)&&(this.currentFlow=e.file.startFunction.flow),r=this.compileExpression(u,h,53),this.skippedAutoreleases.has(r)&&(l=!0),this.currentFlow=t}if(s.getExpressionId(r)!=s.ExpressionId.Const&&(m?(r=t.precomputeExpression(r),s.getExpressionId(r)!=s.ExpressionId.Const&&(f=!0)):f=!0),E)if(f)this.warning(i.DiagnosticCode.Mutable_value_cannot_be_inlined,u.range);else{switch(assert(s.getExpressionId(r)==s.ExpressionId.Const),s.getExpressionType(r)){case s.NativeType.I32:e.constantValueKind=1,e.constantIntegerValue=i64_new(s.getConstValueI32(r),0);break;case s.NativeType.I64:e.constantValueKind=1,e.constantIntegerValue=i64_new(s.getConstValueI64Low(r),s.getConstValueI64High(r));break;case s.NativeType.F32:e.constantValueKind=2,e.constantFloatValue=s.getConstValueF32(r);break;case s.NativeType.F64:e.constantValueKind=2,e.constantFloatValue=s.getConstValueF64(r);break;default:return assert(!1),!1}e.set(a.CommonFlags.INLINED)}}else r=h.toNativeZero(t);var I=e.internalName;return f?(E&&this.error(i.DiagnosticCode.Decorator_0_is_not_valid_here,assert(p.findDecorator(p.DecoratorKind.INLINE,e.decoratorNodes)).range,"inline"),t.addGlobal(I,d,!0,h.toNativeZero(t)),h.isManaged&&!l&&(r=this.makeRetain(r)),this.currentBody.push(t.global_set(I,r))):E||t.addGlobal(I,d,!m,r),!0}compileEnum(e){if(e.is(a.CommonFlags.COMPILED))return!0;e.set(a.CommonFlags.COMPILED);var t=this.module,r=this.currentParent;this.currentParent=e;var n=null,l=!1,c=e.is(a.CommonFlags.CONST)||e.hasDecorator(o.DecoratorFlags.INLINE);if(e.members)for(let r of e.members.values()){if(r.kind!=o.ElementKind.ENUMVALUE)continue;let u=!1,p=r,h=p.valueNode;p.set(a.CommonFlags.COMPILED);let d,y=this.currentFlow;e.hasDecorator(o.DecoratorFlags.LAZY)&&(this.currentFlow=e.file.startFunction.flow),h?(d=this.compileExpression(h,_.Type.i32,1),s.getExpressionId(d)!=s.ExpressionId.Const&&(d=t.precomputeExpression(d),s.getExpressionId(d)!=s.ExpressionId.Const&&(e.is(a.CommonFlags.CONST)&&this.error(i.DiagnosticCode.In_const_enum_declarations_member_initializer_must_be_constant_expression,h.range),u=!0))):null==n?d=t.i32(0):(l&&this.error(i.DiagnosticCode.Enum_member_must_have_initializer,r.identifierNode.range.atEnd),d=t.binary(s.BinaryOp.AddI32,t.global_get(n.internalName,s.NativeType.I32),t.i32(1)),d=t.precomputeExpression(d),s.getExpressionId(d)!=s.ExpressionId.Const&&(e.is(a.CommonFlags.CONST)&&this.error(i.DiagnosticCode.In_const_enum_declarations_member_initializer_must_be_constant_expression,r.declaration.range),u=!0)),this.currentFlow=y,u?(t.addGlobal(p.internalName,s.NativeType.I32,!0,t.i32(0)),this.currentBody.push(this.makeGlobalAssignment(p,d,!1)),l=!0):(c?(p.setConstantIntegerValue(i64_new(s.getConstValueI32(d)),_.Type.i32),p.is(a.CommonFlags.MODULE_EXPORT)&&t.addGlobal(p.internalName,s.NativeType.I32,!1,d)):t.addGlobal(p.internalName,s.NativeType.I32,!1,d),p.isImmutable=!0,l=!1),n=p}return this.currentParent=r,!0}compileFunctionUsingTypeArguments(e,t,r=h.makeMap(),n=null){if(e.hasDecorator(o.DecoratorFlags.BUILTIN))return null;var i=this.resolver.resolveFunctionInclTypeArguments(e,t,e.parent,r,n||e.declaration);return i&&this.compileFunction(i)?i:null}ensureFunctionType(e,t,r=null){var n,i=e?e.length:0,s=0;if(r?((n=new Array(1+i))[0]=r.toNativeType(),s=1):n=new Array(i),e)for(let t=0;t<i;++t,++s)n[s]=e[t].toNativeType();var a=t.toNativeType(),o=this.module,l=o.getFunctionTypeBySignature(a,n);if(!l){let i=_.Signature.makeSignatureString(e,t,r);l=o.addFunctionType(i,a,n)}return l}compileFunctionBody(e,t=null){var r=this.module,n=assert(e.prototype.bodyNode),c=e.signature.returnType,u=this.currentFlow;if(n.kind==p.NodeKind.BLOCK)t=this.compileStatements(n.statements,!0,t);else{assert(n.kind==p.NodeKind.EXPRESSION),assert(e.prototype.arrowKind),assert(!e.isAny(a.CommonFlags.CONSTRUCTOR|a.CommonFlags.GET|a.CommonFlags.SET|a.CommonFlags.MAIN));let i=this.compileExpression(n.expression,c,1);if(t?t.push(i):t=[i],!u.is(256)){let e=t.length;this.performAutoreleases(u,t),this.finishAutoreleases(u,t);let n=u.canOverflow(i,c),s=u.isNonnull(i,c);if(t.length>e){let a=u.getTempLocal(c);n||u.setLocalFlag(a.index,l.LocalFlags.WRAPPED),s&&u.setLocalFlag(a.index,l.LocalFlags.NONNULL),t[e-1]=r.local_set(a.index,i),t.push(r.local_get(a.index,c.toNativeType())),u.freeTempLocal(a)}n||u.set(2),s&&u.set(4),u.set(257)}}if(e.is(a.CommonFlags.CONSTRUCTOR)){let n=this.options.nativeSizeType;assert(e.is(a.CommonFlags.INSTANCE));let l=assert(e.parent);if(assert(l.kind==o.ElementKind.CLASS),!u.is(256)){let e=assert(u.lookupLocal(a.CommonSymbols.this_));u.is(64)||(t.push(r.if(r.unary(n==s.NativeType.I64?s.UnaryOp.EqzI64:s.UnaryOp.EqzI32,r.local_get(e.index,n)),r.local_set(e.index,this.makeRetain(this.makeAllocation(l))))),this.makeFieldInitialization(l,t)),this.performAutoreleases(u,t),this.finishAutoreleases(u,t),t.push(r.local_get(e.index,this.options.nativeSizeType)),u.set(261)}l.base&&!u.is(128)&&this.error(i.DiagnosticCode.Constructors_for_derived_classes_must_contain_a_super_call,e.prototype.declaration.range)}else c==_.Type.void||u.is(256)||this.error(i.DiagnosticCode.A_function_whose_declared_type_is_not_void_must_return_a_value,e.prototype.functionTypeNode.returnType.range);return t}compileFunction(e){if(e.is(a.CommonFlags.COMPILED))return!0;assert(!(e.is(a.CommonFlags.AMBIENT)&&e.hasDecorator(o.DecoratorFlags.BUILTIN)));var t=this.currentType;e.set(a.CommonFlags.COMPILED);var r,n=this.module,s=e.signature,c=e.prototype.bodyNode,u=this.ensureFunctionType(s.parameterTypes,s.returnType,s.thisType);if(c){if(e.is(a.CommonFlags.AMBIENT)&&this.error(i.DiagnosticCode.An_implementation_cannot_be_declared_in_ambient_contexts,e.identifierNode.range),e.hasDecorator(o.DecoratorFlags.EXTERNAL)){let t=e.decoratorNodes,r=assert(p.findDecorator(p.DecoratorKind.EXTERNAL,t));this.error(i.DiagnosticCode.Decorator_0_is_not_valid_here,r.range,"external")}let t=this.currentFlow,c=e.flow;this.currentFlow=c;let h=new Array,d=0;s.thisType&&++d;let y=s.parameterTypes;for(let e=0,t=y.length;e<t;++e,++d){let t=y[e];t.isManaged&&(h.push(n.drop(this.makeRetain(n.local_get(d,t.toNativeType())))),c.setLocalFlag(d,l.LocalFlags.RETAINED|l.LocalFlags.PARAMETER))}this.compileFunctionBody(e,h),c.is(256)||(this.performAutoreleases(c,h),this.finishAutoreleases(c,h)),this.currentFlow=t,r=n.addFunction(e.internalName,u,_.typesToNativeTypes(e.additionalLocals),E(n,h,e.signature.returnType.toNativeType()))}else e.is(a.CommonFlags.AMBIENT)||this.error(i.DiagnosticCode.Function_implementation_is_missing_or_not_immediately_following_the_declaration,e.identifierNode.range),e.set(a.CommonFlags.MODULE_IMPORT),g(e,e.declaration),n.addFunctionImport(e.internalName,y,T,u),r=n.getFunction(e.internalName);return e.finalize(n,r),this.currentType=t,!0}compileClassUsingTypeArguments(e,t,r=h.makeMap(),n=null){var i=this.resolver.resolveClassInclTypeArguments(e,t,e.parent,r,n||e.declaration);i&&this.compileClass(i)}compileClass(e){if(e.is(a.CommonFlags.COMPILED))return!0;e.set(a.CommonFlags.COMPILED);var t=e.prototype.members;if(t)for(let e of t.values())switch(e.kind){case o.ElementKind.GLOBAL:this.compileGlobal(e);break;case o.ElementKind.FUNCTION_PROTOTYPE:e.is(a.CommonFlags.GENERIC)||this.compileFunctionUsingTypeArguments(e,[],h.makeMap(),e.identifierNode);break;case o.ElementKind.PROPERTY_PROTOTYPE:{let t=e.getterPrototype;t&&this.compileFunctionUsingTypeArguments(t,[],h.makeMap(),t.identifierNode);let r=e.setterPrototype;r&&this.compileFunctionUsingTypeArguments(r,[],h.makeMap(),r.identifierNode);break}case o.ElementKind.PROPERTY:}var r=e.constructorInstance;r&&this.compileFunction(r);var n=e.members;if(n)for(let t of n.values())switch(t.kind){case o.ElementKind.FUNCTION_PROTOTYPE:t.is(a.CommonFlags.GENERIC)||this.compileFunctionUsingTypeArguments(t,[],h.makeMap(e.contextualTypeArguments),t.declaration.name);break;case o.ElementKind.FIELD_PROTOTYPE:t.set(a.CommonFlags.COMPILED);break;case o.ElementKind.PROPERTY:{let e=t.getterInstance;e&&this.compileFunction(e);let r=t.setterInstance;r&&this.compileFunction(r);break}}return!0}compileInterfaceDeclaration(e,t,r=null,n=null){this.error(i.DiagnosticCode.Not_implemented,e.range)}addMemorySegment(e,t=8){var r=i64_align(this.memoryOffset,t),n=s.MemorySegment.create(e,r);return this.memorySegments.push(n),this.memoryOffset=i64_add(r,i64_new(e.length,0)),n}ensureStaticString(e){var t,r=this.program,n=r.runtimeHeaderSize,i=assert(r.stringInstance),s=this.stringSegments;if(s.has(e))t=s.get(e);else{let a=e.length,o=new Uint8Array(n+(a<<1));r.writeRuntimeHeader(o,0,i,a<<1);for(let t=0;t<a;++t)h.writeI16(e.charCodeAt(t),o,n+(t<<1));t=this.addMemorySegment(o),s.set(e,t)}var a=i64_add(t.offset,i64_new(n));return this.currentType=i.type,this.options.isWasm64?this.module.i64(i64_low(a),i64_high(a)):(assert(i64_is_u32(a)),this.module.i32(i64_low(a)))}ensureStaticArrayBuffer(e,t){var r=this.program,n=t.length,i=e.byteSize,a=n*i,o=assert(r.arrayBufferInstance),l=r.runtimeHeaderSize,c=new Uint8Array(l+a);r.writeRuntimeHeader(c,0,o,a);var u=l,p=e.toNativeType();switch(p){case s.NativeType.I32:switch(i){case 1:for(let e=0;e<n;++e){let r=t[e];assert(s.getExpressionType(r)==p),assert(s.getExpressionId(r)==s.ExpressionId.Const),h.writeI8(s.getConstValueI32(r),c,u),u+=1}break;case 2:for(let e=0;e<n;++e){let r=t[e];assert(s.getExpressionType(r)==p),assert(s.getExpressionId(r)==s.ExpressionId.Const),h.writeI16(s.getConstValueI32(r),c,u),u+=2}break;case 4:for(let e=0;e<n;++e){let r=t[e];assert(s.getExpressionType(r)==p),assert(s.getExpressionId(r)==s.ExpressionId.Const),h.writeI32(s.getConstValueI32(r),c,u),u+=4}break;default:assert(!1)}break;case s.NativeType.I64:for(let e=0;e<n;++e){let r=t[e];assert(s.getExpressionType(r)==p),assert(s.getExpressionId(r)==s.ExpressionId.Const),h.writeI64(i64_new(s.getConstValueI64Low(r),s.getConstValueI64High(r)),c,u),u+=8}break;case s.NativeType.F32:for(let e=0;e<n;++e){let r=t[e];assert(s.getExpressionType(r)==p),assert(s.getExpressionId(r)==s.ExpressionId.Const),h.writeF32(s.getConstValueF32(r),c,u),u+=4}break;case s.NativeType.F64:for(let e=0;e<n;++e){let r=t[e];assert(s.getExpressionType(r)==p),assert(s.getExpressionId(r)==s.ExpressionId.Const),h.writeF64(s.getConstValueF64(r),c,u),u+=8}break;default:assert(!1)}return assert(u==c.length),this.addMemorySegment(c)}ensureStaticArrayHeader(e,t){var r=this.program,n=r.runtimeHeaderSize,i=assert(r.arrayPrototype),s=assert(this.resolver.resolveClass(i,[e])),a=s.currentMemoryOffset,o=t.buffer.length-n,l=i32(o/e.byteSize),c=new Uint8Array(n+a);r.writeRuntimeHeader(c,0,s,a);var u=i64_low(t.offset)+n;return assert(!r.options.isWasm64),assert(s.writeField("buffer",u,c,n)),assert(s.writeField("dataStart",u,c,n)),assert(s.writeField("byteLength",o,c,n)),assert(s.writeField("length_",l,c,n)),this.addMemorySegment(c)}ensureFunctionTableEntry(e){if(assert(e.is(a.CommonFlags.COMPILED)),e.functionTableIndex>=0)return e.functionTableIndex;var t=this.functionTable,r=t.length;return!e.is(a.CommonFlags.TRAMPOLINE)&&e.signature.requiredParameters<e.signature.parameterTypes.length&&(e=this.ensureTrampoline(e)),t.push(e.internalName),e.functionTableIndex=r,r}compileTopLevelStatement(e,t){switch(e.kind){case p.NodeKind.CLASSDECLARATION:{let r=e.members;for(let e=0,n=r.length;e<n;++e)this.compileTopLevelStatement(r[e],t);break}case p.NodeKind.ENUMDECLARATION:{let t=this.program.getElementByDeclaration(e);t&&(assert(t.kind==o.ElementKind.ENUM),t.hasDecorator(o.DecoratorFlags.LAZY)||this.compileEnum(t));break}case p.NodeKind.NAMESPACEDECLARATION:{let r=this.program.getElementByDeclaration(e);if(r){let n=this.currentParent;this.currentParent=r;let i=e.members;for(let e=0,r=i.length;e<r;++e)this.compileTopLevelStatement(i[e],t);this.currentParent=n}break}case p.NodeKind.VARIABLE:{let t=e.declarations;for(let e=0,r=t.length;e<r;++e){let r=this.program.getElementByDeclaration(t[e]);r&&(assert(r.kind==o.ElementKind.GLOBAL),r.is(a.CommonFlags.AMBIENT)||r.hasDecorator(o.DecoratorFlags.LAZY)||this.compileGlobal(r))}break}case p.NodeKind.FIELDDECLARATION:{let t=this.program.getElementByDeclaration(e);null!==t&&t.kind==o.ElementKind.GLOBAL&&(t.hasDecorator(o.DecoratorFlags.LAZY)||this.compileGlobal(t));break}case p.NodeKind.EXPORT:null!=e.internalPath&&this.compileFileByPath(e.internalPath,e.path);break;case p.NodeKind.EXPORTDEFAULT:this.compileTopLevelStatement(e.declaration,t);break;case p.NodeKind.IMPORT:this.compileFileByPath(e.internalPath,e.path);break;case p.NodeKind.FUNCTIONDECLARATION:case p.NodeKind.METHODDECLARATION:case p.NodeKind.INTERFACEDECLARATION:case p.NodeKind.INDEXSIGNATUREDECLARATION:case p.NodeKind.TYPEDECLARATION:break;default:{let r=this.compileStatement(e);s.getExpressionId(r)!=s.ExpressionId.Nop&&t.push(r);break}}}compileStatement(e,t=!1){var r,n=this.module;switch(e.kind){case p.NodeKind.BLOCK:r=this.compileBlockStatement(e);break;case p.NodeKind.BREAK:r=this.compileBreakStatement(e);break;case p.NodeKind.CONTINUE:r=this.compileContinueStatement(e);break;case p.NodeKind.DO:r=this.compileDoStatement(e);break;case p.NodeKind.EMPTY:r=this.compileEmptyStatement(e);break;case p.NodeKind.EXPRESSION:r=this.compileExpressionStatement(e);break;case p.NodeKind.FOR:r=this.compileForStatement(e);break;case p.NodeKind.IF:r=this.compileIfStatement(e);break;case p.NodeKind.RETURN:r=this.compileReturnStatement(e,t);break;case p.NodeKind.SWITCH:r=this.compileSwitchStatement(e);break;case p.NodeKind.THROW:r=this.compileThrowStatement(e);break;case p.NodeKind.TRY:r=this.compileTryStatement(e);break;case p.NodeKind.VARIABLE:(r=this.compileVariableStatement(e))||(r=n.nop());break;case p.NodeKind.VOID:r=this.compileVoidStatement(e);break;case p.NodeKind.WHILE:r=this.compileWhileStatement(e);break;case p.NodeKind.TYPEDECLARATION:this.error(i.DiagnosticCode.Not_implemented,e.range),r=n.unreachable();break;default:assert(!1),r=n.unreachable()}return this.options.sourceMap&&this.addDebugLocation(r,e.range),r}compileStatements(e,t=!1,r=null){var n=e.length;r||((r=new Array(n)).length=0);var i=this.module,a=this.currentFlow;for(let o=0;o<n;++o){let l=this.compileStatement(e[o],t&&o==n-1);switch(s.getExpressionId(l)){case s.ExpressionId.Block:if(!s.getBlockName(l)){for(let e=0,t=s.getBlockChildCount(l);e<t;++e)r.push(s.getBlockChild(l,e));break}default:r.push(l);case s.ExpressionId.Nop:}if(a.isAny(272)){s.needsExplicitUnreachable(l)&&r.push(i.unreachable());break}}return r}compileBlockStatement(e){var t=e.statements,r=this.currentFlow,n=r.fork();this.currentFlow=n;var i=this.compileStatements(t);return n.isAny(272)||this.performAutoreleases(n,i),n.freeScopedLocals(),r.inherit(n),this.currentFlow=r,E(this.module,i,s.NativeType.None)}compileBreakStatement(e){var t=this.module;if(e.label)return this.error(i.DiagnosticCode.Not_implemented,e.label.range),t.unreachable();var r=this.currentFlow,n=r.breakLabel;if(null==n)return this.error(i.DiagnosticCode.A_break_statement_can_only_be_used_within_an_enclosing_iteration_or_switch_statement,e.range),t.unreachable();var a=new Array;this.performAutoreleases(r,a);for(var o=r.parent;null!==o&&o.breakLabel==n;)this.performAutoreleases(o,a,!1),o=o.parent;return r.freeScopedLocals(),a.push(t.br(n)),r.set(16),E(t,a,s.NativeType.None)}compileContinueStatement(e){var t=this.module,r=e.label;if(r)return this.error(i.DiagnosticCode.Not_implemented,r.range),t.unreachable();var n=this.currentFlow,a=n.continueLabel;if(null==a)return this.error(i.DiagnosticCode.A_continue_statement_can_only_be_used_within_an_enclosing_iteration_statement,e.range),t.unreachable();n.set(288);var o=new Array;this.performAutoreleases(n,o);for(var l=n.parent;l&&l.continueLabel===a;)this.performAutoreleases(l,o,!1),l=l.parent;return n.freeScopedLocals(),o.push(t.br(a)),E(t,o,s.NativeType.None)}compileDoStatement(e){var t=this.module,r=this.currentFlow,n=r.pushBreakLabel(),i=r.fork(),a="break|"+n;i.breakLabel=a;var o="continue|"+n;i.continueLabel=o;var l=r.fork();this.currentFlow=l;var c=t.precomputeExpression(this.makeIsTrueish(this.compileExpression(e.condition,_.Type.i32),this.currentType));assert(!l.hasScopedLocals),i.unifyLocalFlags(l),this.currentFlow=i;var u=new Array;e.statement.kind==p.NodeKind.BLOCK?this.compileStatements(e.statement.statements,!1,u):u.push(this.compileStatement(e.statement));var h=!1;s.getExpressionId(c)==s.ExpressionId.Const&&(assert(s.getExpressionType(c)==s.NativeType.I32),s.getConstValueI32(c)||(h=!0));var d=i.is(256),y=i.isAny(8224),T=i.isAny(4112),m=!d&&!i.is(16);m&&(this.performAutoreleases(i,u),h||u.push(t.br(o,c)));var g=E(t,u,s.NativeType.None);return(m&&!h||y)&&(g=t.loop(o,g)),T&&(g=t.block(a,[g])),i.freeScopedLocals(),r.popBreakLabel(),i.unset(12336),r.inherit(i),this.currentFlow=r,g}compileEmptyStatement(e){return this.module.nop()}compileExpressionStatement(e){return this.compileExpression(e.expression,_.Type.void,1)}compileForStatement(e){var t=this.module,r=this.currentFlow,n=r.pushBreakLabel(),i=r.fork();this.currentFlow=i;var a=e.initializer,o=0;a&&(o=this.compileStatement(a));var l=0,c=!1;if(e.condition){if(l=t.precomputeExpression(this.makeIsTrueish(this.compileExpression(e.condition,_.Type.bool),this.currentType)),s.getExpressionId(l)==s.ExpressionId.Const){if(assert(s.getExpressionType(l)==s.NativeType.I32),0==s.getConstValueI32(l)){let e=new Array;return o&&e.push(o),this.performAutoreleases(i,e),i.freeScopedLocals(),r.popBreakLabel(),this.currentFlow=r,E(t,e,s.NativeType.None)}c=!0}}else l=t.i32(1),c=!0;i.inheritNonnullIfTrue(l);var u=e.incrementor,h=0;if(u){let e=i.fork();this.currentFlow=e,h=this.compileExpression(u,_.Type.void,9),assert(!e.hasScopedLocals),this.currentFlow=i,i.unifyLocalFlags(e)}var d=i.fork();this.currentFlow=d;var y=i.breakLabel="break|"+n;d.breakLabel=y,d.breakLabel=y;var T="continue|"+n;d.continueLabel=T;var m="loop|"+n,g=e.statement,f=new Array;g.kind==p.NodeKind.BLOCK?this.compileStatements(g.statements,!1,f):f.push(this.compileStatement(g));var I=d.is(256),x=d.isAny(8224),b=d.isAny(4112),A=!I&&!i.is(16);A&&this.performAutoreleases(d,f),d.freeScopedLocals(),i.inherit(d),this.currentFlow=i;var N,S=!c||b,C=new Array;if(c||C.push(t.br(y,t.unary(s.UnaryOp.EqzI32,l))),x)(f.length>1||s.getExpressionId(f[0])!=s.ExpressionId.Break)&&C.push(t.block(T,f));else for(let e=0,t=f.length;e<t;++e)C.push(f[e]);return A||x?(h&&C.push(h),this.performAutoreleases(i,C),C.push(t.br(m)),N=o?t.block(S?y:null,[o,t.loop(m,t.block(null,C))]):t.block(S?y:null,[t.loop(m,E(t,C,s.NativeType.None))])):(o&&C.unshift(o),this.performAutoreleases(i,C),N=t.block(S?y:null,C)),i.freeScopedLocals(),r.popBreakLabel(),i.unset(12336),c?r.inherit(i):r.inheritConditional(i),this.currentFlow=r,N}compileIfStatement(e){var t=this.module,r=e.ifTrue,n=e.ifFalse,i=this.currentFlow,a=t.precomputeExpression(this.makeIsTrueish(this.compileExpression(e.condition,_.Type.bool),this.currentType));if(s.getExpressionId(a)==s.ExpressionId.Const&&s.getExpressionType(a)==s.NativeType.I32)return s.getConstValueI32(a)?this.compileStatement(r):n?this.compileStatement(n):t.nop();var o=new Array,l=i.fork();if(this.currentFlow=l,l.inheritNonnullIfTrue(a),r.kind==p.NodeKind.BLOCK?this.compileStatements(r.statements,!1,o):o.push(this.compileStatement(r)),l.isAny(272)||this.performAutoreleases(l,o),l.freeScopedLocals(),this.currentFlow=i,n){let e=i.fork();this.currentFlow=e,e.inheritNonnullIfFalse(a);let r=new Array;return n.kind==p.NodeKind.BLOCK?this.compileStatements(n.statements,!1,r):r.push(this.compileStatement(n)),e.isAny(272)||this.performAutoreleases(e,r),e.freeScopedLocals(),this.currentFlow=i,i.inheritMutual(l,e),t.if(a,E(t,o,s.NativeType.None),E(t,r,s.NativeType.None))}return i.inheritConditional(l),l.is(256)&&i.inheritNonnullIfFalse(a),t.if(a,E(t,o,s.NativeType.None))}compileReturnStatement(e,t){var r=this.module,n=0,o=this.currentFlow,c=o.returnType;o.set(257);var u=e.value;if(u){if(c==_.Type.void)return this.error(i.DiagnosticCode.Type_0_is_not_assignable_to_type_1,u.range,this.currentType.toString(),c.toString()),this.currentType=_.Type.void,r.unreachable();let e=1;if(o.actualFunction.is(a.CommonFlags.MODULE_EXPORT)&&(e|=4),n=this.compileExpression(u,c,16|e),!this.skippedAutoreleases.has(n)&&c.isManaged&&s.getExpressionId(n)==s.ExpressionId.LocalGet){let e=s.getLocalGetIndex(n);o.isAnyLocalFlag(e,l.LocalFlags.ANY_RETAINED)&&(o.unsetLocalFlag(e,l.LocalFlags.ANY_RETAINED),o.setLocalFlag(e,l.LocalFlags.RETURNED),this.skippedAutoreleases.add(n))}o.canOverflow(n,c)||o.set(2),o.isNonnull(n,c)&&o.set(4)}else c!=_.Type.void&&(this.error(i.DiagnosticCode.Type_0_is_not_assignable_to_type_1,e.range,"void",c.toString()),n=r.unreachable());var p=new Array;if(this.performAutoreleases(o,p),this.finishAutoreleases(o,p),c.isManaged&&!this.skippedAutoreleases.has(n)&&(n=this.makeRetain(n)),c!=_.Type.void&&p.length){let e=o.getTempLocal(c);o.isNonnull(n,c)&&o.setLocalFlag(e.index,l.LocalFlags.NONNULL),p.unshift(r.local_set(e.index,n)),n=r.local_get(e.index,c.toNativeType()),o.freeTempLocal(e)}return o.freeScopedLocals(),t&&n&&c!=_.Type.void?p.length?(p.push(n),r.block(null,p,c.toNativeType())):n:o.is(32768)?p.length?(p.push(r.br(assert(o.inlineReturnLabel),0,n)),r.block(null,p)):r.br(assert(o.inlineReturnLabel),0,n):p.length?(p.push(r.return(n)),r.block(null,p)):r.return(n)}compileSwitchStatement(e){var t=this.module,r=e.cases,n=r.length;if(!n)return this.compileExpression(e.condition,_.Type.void,1);var i=this.currentFlow,a=i.pushBreakLabel(),o=i.getTempLocal(_.Type.u32),l=o.index,c=new Array(1+n);c[0]=t.local_set(l,this.compileExpression(e.condition,_.Type.u32,1));var u=1,p=-1;for(let e=0;e<n;++e){let n=r[e].label;n?c[u++]=t.br("case"+e.toString(10)+"|"+a,t.binary(s.BinaryOp.EqI32,t.local_get(l,s.NativeType.I32),this.compileExpression(n,_.Type.u32,1))):p=e}i.freeTempLocal(o),c[u]=t.br((p>=0?"case"+p.toString(10):"break")+"|"+a);var h=t.block("case0|"+a,c,s.NativeType.None),d=511,y=0;for(let e=0;e<n;++e){let o=r[e].statements,l=o.length,c=i.fork();this.currentFlow=c;let u="break|"+a;c.breakLabel=u;let p=e==n-1,_=p?u:"case"+(e+1).toString(10)+"|"+a,T=new Array(1+l);T[0]=h;let m=1,g=!1;for(let e=0;e<l;++e){let t=this.compileStatement(o[e]);if(s.getExpressionId(t)!=s.ExpressionId.Nop&&(T[m++]=t),c.isAny(272)){c.is(256)&&(g=!0);break}}T.length=m,(g||p||c.isAny(4112))&&(d&=c.flags),y|=30208&c.flags,g||this.performAutoreleases(c,T),c.unset(4112),c.freeScopedLocals(),this.currentFlow=i,h=t.block(_,T,s.NativeType.None)}return i.popBreakLabel(),p>=0&&(i.flags|=-17&d),i.flags|=-4097&y,h}compileThrowStatement(e){var t=this.currentFlow;t.set(264);var r=new Array;this.finishAutoreleases(t,r);var i=e.value,a=null;if(i.kind==p.NodeKind.NEW){let e=i.arguments;e.length&&(a=e[0])}return r.push(n.compileAbort(this,a,e)),E(this.module,r,s.NativeType.None)}compileTryStatement(e){return this.error(i.DiagnosticCode.Not_implemented,e.range),this.module.unreachable()}compileVariableStatement(e){var t=this.module,r=e.declarations,n=r.length,c=this.currentFlow,u=new Array,p=this.resolver;for(let e=0;e<n;++e){let n=r[e],h=n.name.text,d=null,y=0,T=!1;if(n.type){if(!(d=p.resolveType(n.type,c.actualFunction,c.contextualTypeArguments)))continue;n.initializer&&(y=this.compileExpression(n.initializer,d,17),T=this.skippedAutoreleases.has(y))}else{if(!n.initializer){this.error(i.DiagnosticCode.Type_expected,n.name.range.atEnd);continue}if(y=this.compileExpression(n.initializer,_.Type.auto,16),T=this.skippedAutoreleases.has(y),this.currentType==_.Type.void){this.error(i.DiagnosticCode.Type_0_is_not_assignable_to_type_1,n.range,this.currentType.toString(),"<auto>");continue}d=this.currentType}let m=n.is(a.CommonFlags.CONST),g=!1;if(m)if(y){if(y=t.precomputeExpression(y),s.getExpressionId(y)==s.ExpressionId.Const){let e=new o.Local(h,-1,d,c.parentFunction);switch(s.getExpressionType(y)){case s.NativeType.I32:e.setConstantIntegerValue(i64_new(s.getConstValueI32(y),0),d);break;case s.NativeType.I64:e.setConstantIntegerValue(i64_new(s.getConstValueI64Low(y),s.getConstValueI64High(y)),d);break;case s.NativeType.F32:e.setConstantFloatValue(s.getConstValueF32(y),d);break;case s.NativeType.F64:e.setConstantFloatValue(s.getConstValueF64(y),d);break;default:return assert(!1),t.unreachable()}let r=c.scopedLocals;if(r){if(r.has(h)){let e=r.get(h);return this.errorRelated(i.DiagnosticCode.Duplicate_identifier_0,n.name.range,e.declaration.name.range,h),this.module.unreachable()}}else c.scopedLocals=r=new Map;r.set(h,e),g=!0}}else this.error(i.DiagnosticCode._const_declarations_must_be_initialized,n.range);if(!g){let e;if(n.isAny(a.CommonFlags.LET|a.CommonFlags.CONST)||c.is(32768)){let t=c.getScopedLocal(h);t?(t.declaration.range.source.isNative?this.error(i.DiagnosticCode.Duplicate_identifier_0,n.name.range,h):this.errorRelated(i.DiagnosticCode.Duplicate_identifier_0,n.name.range,t.declaration.name.range,h),e=t):e=c.addScopedLocal(h,d),m&&c.setLocalFlag(e.index,l.LocalFlags.CONSTANT)}else{let t=c.lookupLocal(h);if(t){this.errorRelated(i.DiagnosticCode.Duplicate_identifier_0,n.name.range,t.declaration.name.range,h);continue}e=c.parentFunction.addLocal(d,h,n),m&&c.setLocalFlag(e.index,l.LocalFlags.CONSTANT)}let r=d.isManaged;y?(c.isNonnull(y,d)&&c.setLocalFlag(e.index,l.LocalFlags.NONNULL),r?(c.setLocalFlag(e.index,l.LocalFlags.RETAINED),u.push(t.local_set(e.index,T?y:this.makeRetain(y)))):(u.push(t.local_set(e.index,y)),e.type.is(36)&&(c.canOverflow(y,d)?c.unsetLocalFlag(e.index,l.LocalFlags.WRAPPED):c.setLocalFlag(e.index,l.LocalFlags.WRAPPED)))):r?(u.push(t.local_set(e.index,d.toNativeZero(t))),c.setLocalFlag(e.index,l.LocalFlags.CONDITIONALLY_RETAINED)):e.type.is(36)&&c.setLocalFlag(e.index,l.LocalFlags.WRAPPED)}}return 0==u.length?0:E(t,u,s.NativeType.None)}compileVoidStatement(e){return this.compileExpression(e.expression,_.Type.void,10)}compileWhileStatement(e){var t=this.module,r=this.currentFlow,n=t.precomputeExpression(this.makeIsTrueish(this.compileExpression(e.condition,_.Type.bool),this.currentType)),i=!1;if(s.getExpressionId(n)==s.ExpressionId.Const){if(assert(s.getExpressionType(n)==s.NativeType.I32),!s.getConstValueI32(n))return t.nop();i=!0}var a=r.pushBreakLabel(),o=r.fork();this.currentFlow=o;var l="break|"+a;o.breakLabel=l;var c="continue|"+a;o.continueLabel=c,o.inheritNonnullIfTrue(n);var u=new Array;e.statement.kind==p.NodeKind.BLOCK?this.compileStatements(e.statement.statements,!1,u):u.push(this.compileStatement(e.statement));var h=!o.is(256)&&!o.is(16);h&&(this.performAutoreleases(o,u),u.push(t.br(c))),i||u.unshift(t.br(l,t.unary(s.UnaryOp.EqzI32,n)));var d=E(t,u,s.NativeType.None);return(h||o.isAny(8224))&&(d=t.loop(c,d)),i&&!o.isAny(4112)||(d=t.block(l,[d])),o.freeScopedLocals(),r.popBreakLabel(),o.unset(12336),i?r.inherit(o):r.inheritConditional(o),this.currentFlow=r,d}compileInlineConstant(e,t,r){assert(e.is(a.CommonFlags.INLINED));var n=e.type;switch(!(3&r)&&n.is(4)&&t.is(4)&&n.size<t.size?(this.currentType=t).kind:(this.currentType=n).kind){case 0:case 1:{let t=n.computeSmallIntegerShift(_.Type.i32);return this.module.i32(1==e.constantValueKind?i64_low(e.constantIntegerValue)<<t>>t:0)}case 5:case 6:case 10:{let t=e.type.computeSmallIntegerMask(_.Type.i32);return this.module.i32(1==e.constantValueKind?i64_low(e.constantIntegerValue)&t:0)}case 2:case 7:return this.module.i32(1==e.constantValueKind?i64_low(e.constantIntegerValue):0);case 4:case 9:if(!e.program.options.isWasm64)return this.module.i32(1==e.constantValueKind?i64_low(e.constantIntegerValue):0);case 3:case 8:return 1==e.constantValueKind?this.module.i64(i64_low(e.constantIntegerValue),i64_high(e.constantIntegerValue)):this.module.i64(0);case 12:if(!e.hasDecorator(o.DecoratorFlags.BUILTIN)||t!=_.Type.f32)return this.module.f64(e.constantFloatValue);this.currentType=_.Type.f32;case 11:return this.module.f32(e.constantFloatValue);default:return assert(!1),this.module.unreachable()}}compileExpression(e,t,r=0){for(;e.kind==p.NodeKind.PARENTHESIZED;)e=e.expression;var n;switch(this.currentType=t,t==_.Type.void&&(r|=8),e.kind){case p.NodeKind.ASSERTION:n=this.compileAssertionExpression(e,t,r);break;case p.NodeKind.BINARY:n=this.compileBinaryExpression(e,t,r);break;case p.NodeKind.CALL:n=this.compileCallExpression(e,t,r);break;case p.NodeKind.COMMA:n=this.compileCommaExpression(e,t,r);break;case p.NodeKind.ELEMENTACCESS:n=this.compileElementAccessExpression(e,t,r);break;case p.NodeKind.FUNCTION:n=this.compileFunctionExpression(e,t.signatureReference,r);break;case p.NodeKind.IDENTIFIER:case p.NodeKind.FALSE:case p.NodeKind.NULL:case p.NodeKind.THIS:case p.NodeKind.SUPER:case p.NodeKind.TRUE:n=this.compileIdentifierExpression(e,t,r);break;case p.NodeKind.INSTANCEOF:n=this.compileInstanceOfExpression(e,t,r);break;case p.NodeKind.LITERAL:n=this.compileLiteralExpression(e,t,r);break;case p.NodeKind.NEW:n=this.compileNewExpression(e,t,r);break;case p.NodeKind.PROPERTYACCESS:n=this.compilePropertyAccessExpression(e,t,r);break;case p.NodeKind.TERNARY:n=this.compileTernaryExpression(e,t,r);break;case p.NodeKind.UNARYPOSTFIX:n=this.compileUnaryPostfixExpression(e,t,r);break;case p.NodeKind.UNARYPREFIX:n=this.compileUnaryPrefixExpression(e,t,r);break;default:this.error(i.DiagnosticCode.Not_implemented,e.range),n=this.module.unreachable()}var s=this.currentType,a=0!=(4&r);return s!=t&&(2&r?(n=this.convertExpression(n,s,t,!0,a,e),a=!1,this.currentType=t):1&r&&(n=this.convertExpression(n,s,t,!1,a,e),a=!1,this.currentType=t)),a&&(n=this.ensureSmallIntegerWrap(n,s)),this.options.sourceMap&&this.addDebugLocation(n,e.range),n}precomputeExpression(e,t,r=0){return this.module.precomputeExpression(this.compileExpression(e,t,r))}convertExpression(e,t,r,n,a,o){var l=this.module;return 15==t.kind?(assert(15!=r.kind),this.error(i.DiagnosticCode.Type_0_is_not_assignable_to_type_1,o.range,t.toString(),r.toString()),l.unreachable()):15==r.kind?l.drop(e):(this.currentFlow.isNonnull(e,t)&&(t=t.nonNullableType),t.isAssignableTo(r)||n||(t.nonNullableType==r?this.error(i.DiagnosticCode.Object_is_possibly_null,o.range):this.error(i.DiagnosticCode.Conversion_from_type_0_to_1_requires_an_explicit_cast,o.range,t.toString(),r.toString())),t.is(8)?r.is(8)?11==t.kind?12==r.kind&&(e=l.unary(s.UnaryOp.PromoteF32,e)):11==r.kind&&(e=l.unary(s.UnaryOp.DemoteF64,e)):r.is(4)?11==t.kind?r==_.Type.bool?(e=l.binary(s.BinaryOp.NeF32,e,l.f32(0)),a=!1):e=r.is(1)?r.is(64)?l.unary(s.UnaryOp.TruncF32ToI64,e):l.unary(s.UnaryOp.TruncF32ToI32,e):r.is(64)?l.unary(s.UnaryOp.TruncF32ToU64,e):l.unary(s.UnaryOp.TruncF32ToU32,e):r==_.Type.bool?(e=l.binary(s.BinaryOp.NeF64,e,l.f64(0)),a=!1):e=r.is(1)?r.is(64)?l.unary(s.UnaryOp.TruncF64ToI64,e):l.unary(s.UnaryOp.TruncF64ToI32,e):r.is(64)?l.unary(s.UnaryOp.TruncF64ToU64,e):l.unary(s.UnaryOp.TruncF64ToU32,e):(assert(0==r.flags,"void type expected"),e=l.drop(e)):t.is(4)&&r.is(8)?e=11==r.kind?t.is(64)?l.unary(t.is(1)?s.UnaryOp.ConvertI64ToF32:s.UnaryOp.ConvertU64ToF32,e):l.unary(t.is(1)?s.UnaryOp.ConvertI32ToF32:s.UnaryOp.ConvertU32ToF32,e):t.is(64)?l.unary(t.is(1)?s.UnaryOp.ConvertI64ToF64:s.UnaryOp.ConvertU64ToF64,e):l.unary(t.is(1)?s.UnaryOp.ConvertI32ToF64:s.UnaryOp.ConvertU32ToF64,e):t.is(64)?r==_.Type.bool?(e=l.binary(s.BinaryOp.NeI64,e,l.i64(0)),a=!1):r.is(64)||(e=l.unary(s.UnaryOp.WrapI64,e)):r.is(64)?(e=l.unary(t.is(1)?s.UnaryOp.ExtendI32:s.UnaryOp.ExtendU32,this.ensureSmallIntegerWrap(e,t)),a=!1):t.is(32)&&t.size<r.size&&(e=this.ensureSmallIntegerWrap(e,t),a=!1),this.currentType=r,a?this.ensureSmallIntegerWrap(e,r):e)}compileAssertionExpression(e,t,r){var n=-4&r;switch(e.assertionKind){case p.AssertionKind.PREFIX:case p.AssertionKind.AS:{let t=this.currentFlow,r=this.resolver.resolveType(assert(e.toType),t.actualFunction,t.contextualTypeArguments);return r?this.compileExpression(e.expression,r,2|n):this.module.unreachable()}case p.AssertionKind.NONNULL:{assert(!e.toType);let r=this.compileExpression(e.expression,t.exceptVoid,n),s=this.currentType;if(this.currentFlow.isNonnull(r,s))this.info(i.DiagnosticCode.Expression_is_never_null,e.expression.range);else if(!this.options.noAssert){let e=this.module,t=this.currentFlow,n=t.getTempLocal(s);t.canOverflow(r,s)||t.setLocalFlag(n.index,l.LocalFlags.WRAPPED),t.setLocalFlag(n.index,l.LocalFlags.NONNULL),r=e.if(e.local_tee(n.index,r),e.local_get(n.index,s.toNativeType()),e.unreachable()),t.freeTempLocal(n)}return this.currentType=this.currentType.nonNullableType,r}default:assert(!1)}return this.module.unreachable()}compileBinaryExpression(e,t,r){var n,c,p,h,d,y,T=this.module,m=e.left,g=e.right,E=!1,f=e.operator;switch(f){case u.Token.LESSTHAN:if(n=this.compileExpression(m,t),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.LT);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"<",c.toString()),this.module.unreachable()}if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!0)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,"<",c.toString(),h.toString()),this.currentType=t,T.unreachable();switch(n=this.convertExpression(n,c,c=d,!1,!0,m),p=this.convertExpression(p,h,h=d,!1,!0,g),d.kind){case 0:case 1:case 2:y=T.binary(s.BinaryOp.LtI32,n,p);break;case 3:y=T.binary(s.BinaryOp.LtI64,n,p);break;case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.LtI64:s.BinaryOp.LtI32,n,p);break;case 5:case 6:case 7:case 10:y=T.binary(s.BinaryOp.LtU32,n,p);break;case 9:y=T.binary(this.options.isWasm64?s.BinaryOp.LtU64:s.BinaryOp.LtU32,n,p);break;case 8:y=T.binary(s.BinaryOp.LtU64,n,p);break;case 11:y=T.binary(s.BinaryOp.LtF32,n,p);break;case 12:y=T.binary(s.BinaryOp.LtF64,n,p);break;default:assert(!1),y=T.unreachable()}this.currentType=_.Type.bool;break;case u.Token.GREATERTHAN:if(n=this.compileExpression(m,t),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.GT);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,">",c.toString()),this.module.unreachable()}if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!0)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,">",c.toString(),h.toString()),this.currentType=t,T.unreachable();switch(n=this.convertExpression(n,c,c=d,!1,!0,m),p=this.convertExpression(p,h,h=d,!1,!0,g),d.kind){case 0:case 1:case 2:y=T.binary(s.BinaryOp.GtI32,n,p);break;case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.GtI64:s.BinaryOp.GtI32,n,p);break;case 3:y=T.binary(s.BinaryOp.GtI64,n,p);break;case 5:case 6:case 7:case 10:y=T.binary(s.BinaryOp.GtU32,n,p);break;case 9:y=T.binary(this.options.isWasm64?s.BinaryOp.GtU64:s.BinaryOp.GtU32,n,p);break;case 8:y=T.binary(s.BinaryOp.GtU64,n,p);break;case 11:y=T.binary(s.BinaryOp.GtF32,n,p);break;case 12:y=T.binary(s.BinaryOp.GtF64,n,p);break;default:assert(!1),y=T.unreachable()}this.currentType=_.Type.bool;break;case u.Token.LESSTHAN_EQUALS:if(n=this.compileExpression(m,t),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.LE);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"<=",c.toString()),this.module.unreachable()}if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!0)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,"<=",c.toString(),h.toString()),this.currentType=t,T.unreachable();switch(n=this.convertExpression(n,c,c=d,!1,!0,m),p=this.convertExpression(p,h,h=d,!1,!0,g),d.kind){case 0:case 1:case 2:y=T.binary(s.BinaryOp.LeI32,n,p);break;case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.LeI64:s.BinaryOp.LeI32,n,p);break;case 3:y=T.binary(s.BinaryOp.LeI64,n,p);break;case 5:case 6:case 7:case 10:y=T.binary(s.BinaryOp.LeU32,n,p);break;case 9:y=T.binary(this.options.isWasm64?s.BinaryOp.LeU64:s.BinaryOp.LeU32,n,p);break;case 8:y=T.binary(s.BinaryOp.LeU64,n,p);break;case 11:y=T.binary(s.BinaryOp.LeF32,n,p);break;case 12:y=T.binary(s.BinaryOp.LeF64,n,p);break;default:assert(!1),y=T.unreachable()}this.currentType=_.Type.bool;break;case u.Token.GREATERTHAN_EQUALS:if(n=this.compileExpression(m,t),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.GE);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,">=",c.toString()),this.module.unreachable()}if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!0)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,">=",c.toString(),h.toString()),this.currentType=t,T.unreachable();switch(n=this.convertExpression(n,c,c=d,!1,!0,m),p=this.convertExpression(p,h,h=d,!1,!0,g),d.kind){case 0:case 1:case 2:y=T.binary(s.BinaryOp.GeI32,n,p);break;case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.GeI64:s.BinaryOp.GeI32,n,p);break;case 3:y=T.binary(s.BinaryOp.GeI64,n,p);break;case 5:case 6:case 7:case 10:y=T.binary(s.BinaryOp.GeU32,n,p);break;case 9:y=T.binary(this.options.isWasm64?s.BinaryOp.GeU64:s.BinaryOp.GeU32,n,p);break;case 8:y=T.binary(s.BinaryOp.GeU64,n,p);break;case 11:y=T.binary(s.BinaryOp.GeF32,n,p);break;case 12:y=T.binary(s.BinaryOp.GeF64,n,p);break;default:assert(!1),y=T.unreachable()}this.currentType=_.Type.bool;break;case u.Token.EQUALS_EQUALS_EQUALS:case u.Token.EQUALS_EQUALS:if(n=this.compileExpression(m,t),c=this.currentType,f==u.Token.EQUALS_EQUALS&&this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.EQ);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}}if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!1)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,u.operatorTokenToString(e.operator),c.toString(),h.toString()),this.currentType=t,T.unreachable();switch(n=this.convertExpression(n,c,c=d,!1,!0,m),p=this.convertExpression(p,h,h=d,!1,!0,g),d.kind){case 0:case 1:case 2:case 5:case 6:case 7:case 10:y=T.binary(s.BinaryOp.EqI32,n,p);break;case 9:case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.EqI64:s.BinaryOp.EqI32,n,p);break;case 3:case 8:y=T.binary(s.BinaryOp.EqI64,n,p);break;case 11:y=T.binary(s.BinaryOp.EqF32,n,p);break;case 12:y=T.binary(s.BinaryOp.EqF64,n,p);break;case 13:y=T.unary(s.UnaryOp.AllTrueI8x16,T.binary(s.BinaryOp.EqI8x16,n,p));break;case 14:this.error(i.DiagnosticCode.Not_implemented,e.range),y=T.unreachable();break;default:assert(!1),y=T.unreachable()}this.currentType=_.Type.bool;break;case u.Token.EXCLAMATION_EQUALS_EQUALS:case u.Token.EXCLAMATION_EQUALS:if(n=this.compileExpression(m,t),c=this.currentType,f==u.Token.EXCLAMATION_EQUALS&&this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.NE);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}}if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!1)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,u.operatorTokenToString(e.operator),c.toString(),h.toString()),this.currentType=t,T.unreachable();switch(n=this.convertExpression(n,c,c=d,!1,!0,m),p=this.convertExpression(p,h,h=d,!1,!0,g),d.kind){case 0:case 1:case 2:case 5:case 6:case 7:case 10:y=T.binary(s.BinaryOp.NeI32,n,p);break;case 9:case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.NeI64:s.BinaryOp.NeI32,n,p);break;case 3:case 8:y=T.binary(s.BinaryOp.NeI64,n,p);break;case 11:y=T.binary(s.BinaryOp.NeF32,n,p);break;case 12:y=T.binary(s.BinaryOp.NeF64,n,p);break;case 13:y=T.unary(s.UnaryOp.AnyTrueI8x16,T.binary(s.BinaryOp.NeI8x16,n,p));break;case 14:this.error(i.DiagnosticCode.Not_implemented,e.range),y=T.unreachable();break;default:assert(!1),y=T.unreachable()}this.currentType=_.Type.bool;break;case u.Token.EQUALS:return this.compileAssignment(m,g,t);case u.Token.PLUS_EQUALS:E=!0;case u.Token.PLUS:if(n=this.compileExpression(m,t),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.ADD);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"+",c.toString()),this.module.unreachable()}if(E)p=this.compileExpression(g,c,1);else{if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!1)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,"+",c.toString(),h.toString()),this.currentType=t,T.unreachable();n=this.convertExpression(n,c,c=d,!1,!1,m),p=this.convertExpression(p,h,h=d,!1,!1,g)}switch(this.currentType.kind){case 0:case 1:case 5:case 6:case 10:case 2:case 7:y=T.binary(s.BinaryOp.AddI32,n,p);break;case 9:case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.AddI64:s.BinaryOp.AddI32,n,p);break;case 3:case 8:y=T.binary(s.BinaryOp.AddI64,n,p);break;case 11:y=T.binary(s.BinaryOp.AddF32,n,p);break;case 12:y=T.binary(s.BinaryOp.AddF64,n,p);break;default:assert(!1),y=T.unreachable()}break;case u.Token.MINUS_EQUALS:E=!0;case u.Token.MINUS:if(n=this.compileExpression(m,t),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.SUB);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"-",c.toString()),this.module.unreachable()}if(E)p=this.compileExpression(g,c,1),h=this.currentType;else{if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!1)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,"-",c.toString(),h.toString()),this.currentType=t,T.unreachable();n=this.convertExpression(n,c,c=d,!1,!1,m),p=this.convertExpression(p,h,h=d,!1,!1,g)}switch(this.currentType.kind){case 0:case 1:case 5:case 6:case 10:case 2:case 7:y=T.binary(s.BinaryOp.SubI32,n,p);break;case 9:case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.SubI64:s.BinaryOp.SubI32,n,p);break;case 3:case 8:y=T.binary(s.BinaryOp.SubI64,n,p);break;case 11:y=T.binary(s.BinaryOp.SubF32,n,p);break;case 12:y=T.binary(s.BinaryOp.SubF64,n,p);break;default:assert(!1),y=T.unreachable()}break;case u.Token.ASTERISK_EQUALS:E=!0;case u.Token.ASTERISK:if(n=this.compileExpression(m,t),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.MUL);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"*",c.toString()),this.module.unreachable()}if(E)n=this.ensureSmallIntegerWrap(n,c),p=this.compileExpression(g,c,1);else{if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!1)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,"*",c.toString(),h.toString()),this.currentType=t,T.unreachable();n=this.convertExpression(n,c,c=d,!1,!1,m),p=this.convertExpression(p,h,h=d,!1,!1,g)}switch(this.currentType.kind){case 0:case 1:case 5:case 6:case 10:case 2:case 7:y=T.binary(s.BinaryOp.MulI32,n,p);break;case 9:case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.MulI64:s.BinaryOp.MulI32,n,p);break;case 3:case 8:y=T.binary(s.BinaryOp.MulI64,n,p);break;case 11:y=T.binary(s.BinaryOp.MulF32,n,p);break;case 12:y=T.binary(s.BinaryOp.MulF64,n,p);break;default:assert(!1),y=T.unreachable()}break;case u.Token.ASTERISK_ASTERISK_EQUALS:E=!0;case u.Token.ASTERISK_ASTERISK:{if(n=this.compileExpression(m,t),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.POW);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"**",c.toString()),this.module.unreachable()}let r,s=c;if(11==this.currentType.kind){if(p=this.compileExpression(g,_.Type.f32,1),h=this.currentType,!(r=this.f32PowInstance)){let t=this.program.lookupGlobal(a.CommonSymbols.Mathf);if(!t){this.error(i.DiagnosticCode.Cannot_find_name_0,e.range,"Mathf"),y=T.unreachable();break}let n=t.members?t.members.get(a.CommonSymbols.pow):null;if(!n){this.error(i.DiagnosticCode.Cannot_find_name_0,e.range,"Mathf.pow"),y=T.unreachable();break}assert(n.kind==o.ElementKind.FUNCTION_PROTOTYPE),this.f32PowInstance=r=this.resolver.resolveFunction(n,null)}}else if(n=this.convertExpression(n,this.currentType,_.Type.f64,!1,!1,m),c=this.currentType,p=this.compileExpression(g,_.Type.f64,1),h=this.currentType,!(r=this.f64PowInstance)){let t=this.program.lookupGlobal(a.CommonSymbols.Math);if(!t){this.error(i.DiagnosticCode.Cannot_find_name_0,e.range,"Math"),y=T.unreachable();break}let n=t.members?t.members.get(a.CommonSymbols.pow):null;if(!n){this.error(i.DiagnosticCode.Cannot_find_name_0,e.range,"Math.pow"),y=T.unreachable();break}assert(n.kind==o.ElementKind.FUNCTION_PROTOTYPE),this.f64PowInstance=r=this.resolver.resolveFunction(n,null)}r&&this.compileFunction(r)?(y=this.makeCallDirect(r,[n,p],e),E&&s!=this.currentType&&(y=this.convertExpression(y,this.currentType,s,!1,!1,e))):y=T.unreachable();break}case u.Token.SLASH_EQUALS:E=!0;case u.Token.SLASH:if(n=this.compileExpression(m,t),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.DIV);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"/",c.toString()),this.module.unreachable()}if(E)n=this.ensureSmallIntegerWrap(n,c),p=this.compileExpression(g,c,1),h=this.currentType;else{if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!1)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,"/",c.toString(),h.toString()),this.currentType=t,T.unreachable();n=this.convertExpression(n,c,c=d,!1,!0,m),p=this.convertExpression(p,h,h=d,!1,!0,g)}switch(this.currentType.kind){case 0:case 1:case 2:y=T.binary(s.BinaryOp.DivI32,n,p);break;case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.DivI64:s.BinaryOp.DivI32,n,p);break;case 3:y=T.binary(s.BinaryOp.DivI64,n,p);break;case 5:case 6:case 10:case 7:y=T.binary(s.BinaryOp.DivU32,n,p);break;case 9:y=T.binary(this.options.isWasm64?s.BinaryOp.DivU64:s.BinaryOp.DivU32,n,p);break;case 8:y=T.binary(s.BinaryOp.DivU64,n,p);break;case 11:y=T.binary(s.BinaryOp.DivF32,n,p);break;case 12:y=T.binary(s.BinaryOp.DivF64,n,p);break;default:assert(!1),y=T.unreachable()}break;case u.Token.PERCENT_EQUALS:E=!0;case u.Token.PERCENT:if(n=this.compileExpression(m,t),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.REM);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"%",c.toString()),this.module.unreachable()}if(E)n=this.ensureSmallIntegerWrap(n,c),p=this.compileExpression(g,c,1),h=this.currentType;else{if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!1)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,"%",c.toString(),h.toString()),this.currentType=t,T.unreachable();n=this.convertExpression(n,c,c=d,!1,!0,m),p=this.convertExpression(p,h,h=d,!1,!0,g)}switch(this.currentType.kind){case 0:case 1:case 2:y=T.binary(s.BinaryOp.RemI32,n,p);break;case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.RemI64:s.BinaryOp.RemI32,n,p);break;case 3:y=T.binary(s.BinaryOp.RemI64,n,p);break;case 5:case 6:case 10:case 7:y=T.binary(s.BinaryOp.RemU32,n,p);break;case 9:y=T.binary(this.options.isWasm64?s.BinaryOp.RemU64:s.BinaryOp.RemU32,n,p);break;case 8:y=T.binary(s.BinaryOp.RemU64,n,p);break;case 11:{let t=this.f32ModInstance;if(!t){let r=this.program.lookupGlobal(a.CommonSymbols.Mathf);if(!r){this.error(i.DiagnosticCode.Cannot_find_name_0,e.range,"Mathf"),y=T.unreachable();break}let n=r.members?r.members.get(a.CommonSymbols.mod):null;if(!n){this.error(i.DiagnosticCode.Cannot_find_name_0,e.range,"Mathf.mod"),y=T.unreachable();break}assert(n.kind==o.ElementKind.FUNCTION_PROTOTYPE),this.f32ModInstance=t=this.resolver.resolveFunction(n,null)}y=t&&this.compileFunction(t)?this.makeCallDirect(t,[n,p],e):T.unreachable();break}case 12:{let t=this.f64ModInstance;if(!t){let r=this.program.lookupGlobal(a.CommonSymbols.Math);if(!r){this.error(i.DiagnosticCode.Cannot_find_name_0,e.range,"Math"),y=T.unreachable();break}let n=r.members?r.members.get(a.CommonSymbols.mod):null;if(!n){this.error(i.DiagnosticCode.Cannot_find_name_0,e.range,"Math.mod"),y=T.unreachable();break}assert(n.kind==o.ElementKind.FUNCTION_PROTOTYPE),this.f64ModInstance=t=this.resolver.resolveFunction(n,null)}y=t&&this.compileFunction(t)?this.makeCallDirect(t,[n,p],e):T.unreachable();break}default:assert(!1),y=T.unreachable()}break;case u.Token.LESSTHAN_LESSTHAN_EQUALS:E=!0;case u.Token.LESSTHAN_LESSTHAN:if(n=this.compileExpression(m,t.intType),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.BITWISE_SHL);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"<<",c.toString()),this.module.unreachable()}switch(p=this.compileExpression(g,c,1),h=this.currentType,this.currentType.kind){case 0:case 1:case 5:case 6:case 10:case 2:case 7:y=T.binary(s.BinaryOp.ShlI32,n,p);break;case 3:case 8:y=T.binary(s.BinaryOp.ShlI64,n,p);break;case 9:case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.ShlI64:s.BinaryOp.ShlI32,n,p);break;case 11:case 12:return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"<<",this.currentType.toString()),T.unreachable();default:assert(!1),y=T.unreachable()}break;case u.Token.GREATERTHAN_GREATERTHAN_EQUALS:E=!0;case u.Token.GREATERTHAN_GREATERTHAN:if(n=this.compileExpression(m,t.intType),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.BITWISE_SHR);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,">>",c.toString()),this.module.unreachable()}switch(n=this.ensureSmallIntegerWrap(n,c),p=this.compileExpression(g,c,1),h=this.currentType,this.currentType.kind){case 0:case 1:case 2:y=T.binary(s.BinaryOp.ShrI32,n,p);break;case 3:y=T.binary(s.BinaryOp.ShrI64,n,p);break;case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.ShrI64:s.BinaryOp.ShrI32,n,p);break;case 5:case 6:case 10:case 7:y=T.binary(s.BinaryOp.ShrU32,n,p);break;case 8:y=T.binary(s.BinaryOp.ShrU64,n,p);break;case 9:y=T.binary(this.options.isWasm64?s.BinaryOp.ShrU64:s.BinaryOp.ShrU32,n,p);break;case 11:case 12:return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,">>",this.currentType.toString()),T.unreachable();default:assert(!1),y=T.unreachable()}break;case u.Token.GREATERTHAN_GREATERTHAN_GREATERTHAN_EQUALS:E=!0;case u.Token.GREATERTHAN_GREATERTHAN_GREATERTHAN:if(n=this.compileExpression(m,t.intType),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.BITWISE_SHR_U);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,">>>",c.toString()),this.module.unreachable()}switch(n=this.ensureSmallIntegerWrap(n,c),p=this.compileExpression(g,c,1),h=this.currentType,this.currentType.kind){case 5:case 6:case 10:y=T.binary(s.BinaryOp.ShrU32,n,p);case 0:case 1:case 2:case 7:y=T.binary(s.BinaryOp.ShrU32,n,p);break;case 3:case 8:y=T.binary(s.BinaryOp.ShrU64,n,p);break;case 9:case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.ShrU64:s.BinaryOp.ShrU32,n,p);break;case 11:case 12:return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,">>>",this.currentType.toString()),T.unreachable();default:assert(!1),y=T.unreachable()}break;case u.Token.AMPERSAND_EQUALS:E=!0;case u.Token.AMPERSAND:if(n=this.compileExpression(m,t.intType),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.BITWISE_AND);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"&",c.toString()),this.module.unreachable()}if(E)p=this.compileExpression(g,c,1),h=this.currentType;else{if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!1)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,"&",c.toString(),h.toString()),this.currentType=t,T.unreachable();n=this.convertExpression(n,c,c=d,!1,!1,m),p=this.convertExpression(p,h,h=d,!1,!1,g)}switch(this.currentType.kind){case 0:case 1:case 2:case 5:case 6:case 10:case 7:y=T.binary(s.BinaryOp.AndI32,n,p);break;case 3:case 8:y=T.binary(s.BinaryOp.AndI64,n,p);break;case 9:case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.AndI64:s.BinaryOp.AndI32,n,p);break;case 11:case 12:return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"&",this.currentType.toString()),T.unreachable();default:assert(!1),y=T.unreachable()}break;case u.Token.BAR_EQUALS:E=!0;case u.Token.BAR:if(n=this.compileExpression(m,t.intType),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.BITWISE_OR);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"|",c.toString()),this.module.unreachable()}if(E)p=this.compileExpression(g,c,1),h=this.currentType;else{if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!1)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,"|",c.toString(),h.toString()),this.currentType=t,T.unreachable();n=this.convertExpression(n,c,c=d,!1,!1,m),p=this.convertExpression(p,h,h=d,!1,!1,g)}switch(this.currentType.kind){case 0:case 1:case 5:case 6:case 10:y=T.binary(s.BinaryOp.OrI32,n,p);break;case 2:case 7:y=T.binary(s.BinaryOp.OrI32,n,p);break;case 3:case 8:y=T.binary(s.BinaryOp.OrI64,n,p);break;case 9:case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.OrI64:s.BinaryOp.OrI32,n,p);break;case 11:case 12:return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"|",this.currentType.toString()),T.unreachable();default:assert(!1),y=T.unreachable()}break;case u.Token.CARET_EQUALS:E=!0;case u.Token.CARET:if(n=this.compileExpression(m,t.intType),c=this.currentType,this.currentType.is(256)){let t=c.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.BITWISE_XOR);if(r){y=this.compileBinaryOverload(r,m,n,g,e);break}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"^",c.toString()),this.module.unreachable()}if(E)p=this.compileExpression(g,c,1),h=this.currentType;else{if(p=this.compileExpression(g,c),h=this.currentType,!(d=_.Type.commonDenominator(c,h,!1)))return this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,"^",c.toString(),h.toString()),this.currentType=t,T.unreachable();n=this.convertExpression(n,c,c=d,!1,!1,m),p=this.convertExpression(p,h,h=d,!1,!1,g)}switch(this.currentType.kind){case 0:case 1:case 5:case 6:case 10:y=T.binary(s.BinaryOp.XorI32,n,p);break;case 2:case 7:y=T.binary(s.BinaryOp.XorI32,n,p);break;case 3:case 8:y=T.binary(s.BinaryOp.XorI64,n,p);break;case 9:case 4:y=T.binary(this.options.isWasm64?s.BinaryOp.XorI64:s.BinaryOp.XorI32,n,p);break;case 11:case 12:return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"^",this.currentType.toString()),T.unreachable();default:assert(!1),y=T.unreachable()}break;case u.Token.AMPERSAND_AMPERSAND:{let e=this.currentFlow,i=20&r;n=this.compileExpression(m,t.exceptVoid,i),c=this.currentType;let s=e.fork();if(this.currentFlow=s,s.inheritNonnullIfTrue(n),p=this.compileExpression(g,c,1|i),h=c,t==_.Type.bool||t==_.Type.void)p=this.performAutoreleasesWithValue(s,p,h),s.freeScopedLocals(),this.currentFlow=e,this.currentType=_.Type.bool,y=T.if(this.makeIsTrueish(n,c),this.makeIsTrueish(p,h),T.i32(0));else if(c.isManaged){let t=this.skippedAutoreleases.has(n),i=this.skippedAutoreleases.has(p),a=e.getTempLocal(c);n=T.local_tee(a.index,n);let o=!1;t!=i?t?(p=this.makeRetain(p),i=!0):o=!0:16&r||(p=this.moveAutorelease(p,s,e));let l=new Array;t&&l.unshift(this.makeRelease(T.local_get(a.index,c.toNativeType()))),p=this.performAutoreleasesWithValue(s,p,h,l),s.freeScopedLocals(),this.currentFlow=e,y=T.if(this.makeIsTrueish(n,c),p,o?this.makeRetain(T.local_get(a.index,c.toNativeType())):T.local_get(a.index,c.toNativeType())),(t||i)&&this.skippedAutoreleases.add(y),a&&e.freeTempLocal(a)}else if(p=this.performAutoreleasesWithValue(s,p,h),s.freeScopedLocals(),this.currentFlow=e,y=T.cloneExpression(n,!0,0))y=T.if(this.makeIsTrueish(n,this.currentType),p,y);else{let t=e.getTempLocal(c);e.canOverflow(n,c)||e.setLocalFlag(t.index,l.LocalFlags.WRAPPED),e.isNonnull(n,c)&&e.setLocalFlag(t.index,l.LocalFlags.NONNULL),y=T.if(this.makeIsTrueish(T.local_tee(t.index,n),c),p,T.local_get(t.index,c.toNativeType())),e.freeTempLocal(t)}this.currentType=c;break}case u.Token.BAR_BAR:{let e=this.currentFlow,i=20&r;n=this.compileExpression(m,t.exceptVoid,i),c=this.currentType;let s=e.fork();if(this.currentFlow=s,s.inheritNonnullIfFalse(n),p=this.compileExpression(g,c,1|i),h=c,t==_.Type.bool||t==_.Type.void)p=this.performAutoreleasesWithValue(s,p,c),s.freeScopedLocals(),this.currentFlow=e,this.currentType=_.Type.bool,y=T.if(this.makeIsTrueish(n,c),T.i32(1),this.makeIsTrueish(p,h));else if(c.isManaged){let t=this.skippedAutoreleases.has(n),i=this.skippedAutoreleases.has(p),a=e.getTempLocal(c);n=T.local_tee(a.index,n);let o=!1;t!=i?t?(p=this.makeRetain(p),i=!0):o=!0:16&r||(p=this.moveAutorelease(p,s,e));let l=new Array;t&&l.unshift(this.makeRelease(T.local_get(a.index,c.toNativeType()))),p=this.performAutoreleasesWithValue(s,p,h,l),s.freeScopedLocals(),this.currentFlow=e,y=T.if(this.makeIsTrueish(n,c),o?this.makeRetain(T.local_get(a.index,c.toNativeType())):T.local_get(a.index,c.toNativeType()),p),(t||i)&&this.skippedAutoreleases.add(y),a&&e.freeTempLocal(a)}else if(p=this.performAutoreleasesWithValue(s,p,h),s.freeScopedLocals(),this.currentFlow=e,y=T.cloneExpression(n,!0,0))y=T.if(this.makeIsTrueish(n,c),y,p);else{let t=e.getTempLocal(c);e.canOverflow(n,c)||e.setLocalFlag(t.index,l.LocalFlags.WRAPPED),e.isNonnull(n,c)&&e.setLocalFlag(t.index,l.LocalFlags.NONNULL),y=T.if(this.makeIsTrueish(T.local_tee(t.index,n),c),T.local_get(t.index,c.toNativeType()),p),e.freeTempLocal(t)}this.currentType=c;break}default:assert(!1),y=this.module.unreachable()}if(!E)return y;var I=this.resolver,x=I.lookupExpression(m,this.currentFlow);if(!x)return T.unreachable();var b=I.getTypeOfElement(x)||_.Type.void;return this.currentType.isStrictlyAssignableTo(b)?this.makeAssignment(x,y,m,I.currentThisExpression,I.currentElementExpression,t!=_.Type.void):(this.error(i.DiagnosticCode.Type_0_is_not_assignable_to_type_1,e.range,this.currentType.toString(),b.toString()),T.unreachable())}compileUnaryOverload(e,t,r,n){return this.makeCallDirect(e,[r],n,!1)}compileBinaryOverload(e,t,r,n,i){var s;if(e.is(a.CommonFlags.INSTANCE)){let t=assert(e.parent);assert(t.kind==o.ElementKind.CLASS),s=e.signature.parameterTypes[0]}else s=e.signature.parameterTypes[1];var l=this.compileExpression(n,s,1);return this.makeCallDirect(e,[r,l],i)}compileAssignment(e,t,r){var n=this.program.resolver,s=this.currentFlow,a=n.lookupExpression(e,s);if(!a)return this.module.unreachable();var l,u=n.currentThisExpression,p=n.currentElementExpression;switch(a.kind){case o.ElementKind.GLOBAL:if(!this.compileGlobal(a))return this.module.unreachable();case o.ElementKind.LOCAL:case o.ElementKind.FIELD:l=a.type,a.hasDecorator(o.DecoratorFlags.UNSAFE)&&this.checkUnsafe(e);break;case o.ElementKind.PROPERTY_PROTOTYPE:{let t=a.setterPrototype;if(!t)return this.error(i.DiagnosticCode.Cannot_assign_to_0_because_it_is_a_constant_or_a_read_only_property,e.range,a.internalName),this.module.unreachable();let r=this.resolver.resolveFunction(t,null,h.makeMap(),c.ReportMode.REPORT);if(!r)return this.module.unreachable();assert(1==r.signature.parameterTypes.length),l=r.signature.parameterTypes[0],t.hasDecorator(o.DecoratorFlags.UNSAFE)&&this.checkUnsafe(e);break}case o.ElementKind.PROPERTY:{let t=a.setterInstance;if(!t)return this.error(i.DiagnosticCode.Cannot_assign_to_0_because_it_is_a_constant_or_a_read_only_property,e.range,a.internalName),this.module.unreachable();assert(1==t.signature.parameterTypes.length),l=t.signature.parameterTypes[0],t.hasDecorator(o.DecoratorFlags.UNSAFE)&&this.checkUnsafe(e);break}case o.ElementKind.INDEXSIGNATURE:{let t=a.parent;assert(t.kind==o.ElementKind.CLASS);let r=s.is(65536),n=t.lookupOverload(o.OperatorKind.INDEXED_SET,r);if(!n){return t.lookupOverload(o.OperatorKind.INDEXED_GET,r)?this.error(i.DiagnosticCode.Index_signature_in_type_0_only_permits_reading,e.range,t.internalName):this.error(i.DiagnosticCode.Index_signature_is_missing_in_type_0,e.range,t.internalName),this.module.unreachable()}assert(2==n.signature.parameterTypes.length),l=n.signature.parameterTypes[1],n.hasDecorator(o.DecoratorFlags.UNSAFE)&&this.checkUnsafe(e);break}default:return this.error(i.DiagnosticCode.Not_implemented,e.range),this.module.unreachable()}return assert(l!=_.Type.void),this.makeAssignment(a,this.compileExpression(t,l,17),e,u,p,r!=_.Type.void)}makeAssignment(e,t,r,n,s,u){var p=this.module,d=this.currentFlow;switch(e.kind){case o.ElementKind.LOCAL:return d.isLocalFlag(e.index,l.LocalFlags.CONSTANT,!0)?(this.error(i.DiagnosticCode.Cannot_assign_to_0_because_it_is_a_constant_or_a_read_only_property,r.range,e.internalName),this.currentType=u?e.type:_.Type.void,p.unreachable()):this.makeLocalAssignment(e,t,u);case o.ElementKind.GLOBAL:return this.compileGlobal(e)?e.isAny(a.CommonFlags.CONST|a.CommonFlags.READONLY)?(this.error(i.DiagnosticCode.Cannot_assign_to_0_because_it_is_a_constant_or_a_read_only_property,r.range,e.internalName),this.currentType=u?e.type:_.Type.void,p.unreachable()):this.makeGlobalAssignment(e,t,u):p.unreachable();case o.ElementKind.FIELD:{let s=e.initializerNode;return!e.is(a.CommonFlags.READONLY)||d.actualFunction.is(a.CommonFlags.CONSTRUCTOR)||s?this.makeFieldAssignment(e,t,this.compileExpression(assert(n),this.options.usizeType),u):(this.error(i.DiagnosticCode.Cannot_assign_to_0_because_it_is_a_constant_or_a_read_only_property,r.range,e.internalName),p.unreachable())}case o.ElementKind.PROPERTY_PROTOTYPE:{this.skippedAutoreleases.has(t)&&(t=this.makeAutorelease(t,d));let n=e.setterPrototype;if(!n)return this.error(i.DiagnosticCode.Cannot_assign_to_0_because_it_is_a_constant_or_a_read_only_property,r.range,e.internalName),p.unreachable();let s=this.resolver.resolveFunction(n,null,h.makeMap(),c.ReportMode.REPORT);if(!s)return p.unreachable();if(!u)return this.makeCallDirect(s,[t],r);let a=assert(e.getterPrototype),o=this.resolver.resolveFunction(a,null,h.makeMap(),c.ReportMode.REPORT);if(!o)return p.unreachable();let l=o.signature.returnType.toNativeType();return p.block(null,[this.makeCallDirect(s,[t],r),this.makeCallDirect(o,null,r)],l)}case o.ElementKind.PROPERTY:{this.skippedAutoreleases.has(t)&&(t=this.makeAutorelease(t,d));let s=e.setterInstance;if(!s)return this.error(i.DiagnosticCode.Cannot_assign_to_0_because_it_is_a_constant_or_a_read_only_property,r.range,e.internalName),p.unreachable();if(!u){let e=this.compileExpression(assert(n),this.options.usizeType);return this.makeCallDirect(s,[e,t],r)}let a=assert(e.getterInstance),o=a.signature.returnType,l=o.toNativeType(),c=this.compileExpression(assert(n),this.options.usizeType),_=d.getTempLocal(o),h=p.block(null,[this.makeCallDirect(s,[p.local_tee(_.index,c),t],r),this.makeCallDirect(a,[p.local_get(_.index,l)],r)],l);return d.freeTempLocal(_),h}case o.ElementKind.INDEXSIGNATURE:{this.skippedAutoreleases.has(t)&&(t=this.makeAutorelease(t,d));let a=d.is(65536),l=e.parent;assert(l.kind==o.ElementKind.CLASS);let c=l.lookupOverload(o.OperatorKind.INDEXED_GET,a);if(!c)return this.error(i.DiagnosticCode.Index_signature_is_missing_in_type_0,r.range,l.internalName),p.unreachable();let h=l.lookupOverload(o.OperatorKind.INDEXED_SET,a);if(!h)return this.error(i.DiagnosticCode.Index_signature_in_type_0_only_permits_reading,r.range,l.internalName),this.currentType=u?c.signature.returnType:_.Type.void,p.unreachable();let y=l.type,T=this.compileExpression(assert(n),this.options.usizeType),m=this.compileExpression(assert(s),_.Type.i32,1);if(u){let e=d.getTempLocal(y),n=d.getTempLocal(this.currentType),i=c.signature.returnType;d.freeTempLocal(e);let s=p.block(null,[this.makeCallDirect(h,[p.local_tee(e.index,T),p.local_tee(n.index,m),t],r),this.makeCallDirect(c,[p.local_get(e.index,e.type.toNativeType()),p.local_get(n.index,n.type.toNativeType())],r)],i.toNativeType());return d.freeTempLocal(n),d.freeTempLocal(e),s}return this.makeCallDirect(h,[T,m,t],r)}}return this.error(i.DiagnosticCode.Not_implemented,r.range),p.unreachable()}makeLocalAssignment(e,t,r){var n=e.type;assert(n!=_.Type.void);var i=this.currentFlow,s=e.index;if(n.is(512)&&(i.isNonnull(t,n)?i.setLocalFlag(s,l.LocalFlags.NONNULL):i.unsetLocalFlag(s,l.LocalFlags.NONNULL)),i.setLocalFlag(s,l.LocalFlags.WRITTENTO),n.isManaged){let e=this.module,a=n.toNativeType();return i.isAnyLocalFlag(s,l.LocalFlags.ANY_RETAINED)?this.skippedAutoreleases.has(t)?(t=this.makeSkippedRelease(e.local_get(s,a),t),r?(this.currentType=n,e.local_tee(s,t)):(this.currentType=_.Type.void,e.local_set(s,t))):(t=this.makeRetainRelease(e.local_get(s,a),t),r?(this.currentType=n,e.local_tee(s,t)):(this.currentType=_.Type.void,e.local_set(s,t))):(i.unsetLocalFlag(s,l.LocalFlags.CONDITIONALLY_RETAINED),i.setLocalFlag(s,l.LocalFlags.RETAINED),this.skippedAutoreleases.has(t)||(t=this.makeRetain(t)),r?(this.currentType=n,e.local_tee(s,t)):(this.currentType=_.Type.void,e.local_set(s,t)))}return n.is(36)&&(i.canOverflow(t,n)?i.unsetLocalFlag(s,l.LocalFlags.WRAPPED):i.setLocalFlag(s,l.LocalFlags.WRAPPED)),r?(this.currentType=n,this.module.local_tee(s,t)):(this.currentType=_.Type.void,this.module.local_set(s,t))}makeGlobalAssignment(e,t,r){var n=this.module,i=e.type;assert(i!=_.Type.void);var s=i.toNativeType();return i.isManaged?this.skippedAutoreleases.has(t)?r?(this.currentType=i,n.block(null,[n.global_set(e.internalName,this.makeSkippedRelease(n.global_get(e.internalName,s),t)),n.global_get(e.internalName,s)],s)):(this.currentType=_.Type.void,n.global_set(e.internalName,this.makeSkippedRelease(n.global_get(e.internalName,s),t))):r?(this.currentType=i,n.block(null,[n.global_set(e.internalName,this.makeRetainRelease(n.global_get(e.internalName,s),t)),n.global_get(e.internalName,s)],s)):(this.currentType=_.Type.void,n.global_set(e.internalName,this.makeRetainRelease(n.global_get(e.internalName,s),t))):(t=this.ensureSmallIntegerWrap(t,i),r?(this.currentType=i,n.block(null,[n.global_set(e.internalName,t),n.global_get(e.internalName,s)],s)):(this.currentType=_.Type.void,n.global_set(e.internalName,t)))}makeFieldAssignment(e,t,r,n){var i=this.module,s=this.currentFlow,a=e.type,c=a.toNativeType();assert(e.parent.kind==o.ElementKind.CLASS);var u=e.parent.type,p=u.toNativeType();if(a.isManaged&&u.isManaged){let o=s.getTempLocal(u);if(this.skippedAutoreleases.has(t)){if(n){let n=s.getTempLocal(a);s.canOverflow(t,a)||s.setLocalFlag(n.index,l.LocalFlags.WRAPPED),s.isNonnull(t,a)&&s.setLocalFlag(n.index,l.LocalFlags.NONNULL);let u=i.block(null,[i.store(a.byteSize,i.local_tee(o.index,r),this.makeSkippedRelease(i.load(a.byteSize,a.is(1),i.local_get(o.index,p),c,e.memoryOffset),i.local_tee(n.index,t)),c,e.memoryOffset),i.local_get(n.index,c)],c);return s.freeTempLocal(n),s.freeTempLocal(o),this.currentType=a,u}return s.freeTempLocal(o),this.currentType=_.Type.void,i.store(a.byteSize,i.local_tee(o.index,r),this.makeSkippedRelease(i.load(a.byteSize,a.is(1),i.local_get(o.index,p),c,e.memoryOffset),t),c,e.memoryOffset)}if(n){let n=s.getTempLocal(a);s.canOverflow(t,a)||s.setLocalFlag(n.index,l.LocalFlags.WRAPPED),s.isNonnull(t,a)&&s.setLocalFlag(n.index,l.LocalFlags.NONNULL);let u=i.block(null,[i.store(a.byteSize,i.local_tee(o.index,r),this.makeRetainRelease(i.load(a.byteSize,a.is(1),i.local_get(o.index,p),c,e.memoryOffset),i.local_tee(n.index,t)),c,e.memoryOffset),i.local_get(n.index,c)],c);return s.freeTempLocal(n),s.freeTempLocal(o),this.currentType=a,u}return s.freeTempLocal(o),this.currentType=_.Type.void,i.store(a.byteSize,i.local_tee(o.index,r),this.makeRetainRelease(i.load(a.byteSize,a.is(1),i.local_get(o.index,p),c,e.memoryOffset),t),c,e.memoryOffset)}if(n){let n=s.getTempLocal(a);s.canOverflow(t,a)||s.setLocalFlag(n.index,l.LocalFlags.WRAPPED),s.isNonnull(t,a)&&s.setLocalFlag(n.index,l.LocalFlags.NONNULL);let o=i.block(null,[i.store(a.byteSize,r,i.local_tee(n.index,t),c,e.memoryOffset),i.local_get(n.index,c)],c);return s.freeTempLocal(n),this.currentType=a,o}return this.currentType=_.Type.void,i.store(a.byteSize,r,t,c,e.memoryOffset)}compileCallExpression(e,t,r){var n=this.module,l=this.currentFlow;if(e.expression.kind==p.NodeKind.SUPER){let t=this.currentFlow,r=t.actualFunction;if(!r.is(a.CommonFlags.CONSTRUCTOR))return this.error(i.DiagnosticCode.Super_calls_are_not_permitted_outside_constructors_or_in_nested_functions_inside_constructors,e.range),n.unreachable();let s=assert(r.parent);assert(s.kind==o.ElementKind.CLASS);let l=assert(s.base),c=assert(t.lookupLocal(a.CommonSymbols.this_)),u=this.options.nativeSizeType,p=this.compileCallDirect(this.ensureConstructor(l,e),e.arguments,e,n.if(n.local_get(c.index,u),n.local_get(c.index,u),this.makeRetain(this.makeAllocation(s))),16);assert(this.skippedAutoreleases.has(p));let h=[n.local_set(c.index,p)];return this.makeFieldInitialization(s,h),t.isAny(16448)?(this.error(i.DiagnosticCode._super_must_be_called_before_accessing_this_in_the_constructor_of_a_derived_class,e.range),n.unreachable()):(t.set(192),this.currentType=_.Type.void,n.block(null,h))}var c,u,h=this.resolver.lookupExpression(e.expression,l);if(!h)return n.unreachable();switch(h.kind){case o.ElementKind.FUNCTION_PROTOTYPE:{let n=h;if(n.hasDecorator(o.DecoratorFlags.BUILTIN))return this.compileCallExpressionBuiltin(n,e,t);let i=this.resolver.currentThisExpression,s=this.resolver.maybeInferCall(e,n,l);return s?this.compileCallDirect(s,e.arguments,e,s.is(a.CommonFlags.INSTANCE)?this.compileExpression(assert(i),this.options.usizeType):0,r):this.module.unreachable()}case o.ElementKind.LOCAL:if(c=h.type.signatureReference){u=h.is(a.CommonFlags.INLINED)?n.i32(i64_low(h.constantIntegerValue)):n.local_get(h.index,s.NativeType.I32);break}return this.error(i.DiagnosticCode.Cannot_invoke_an_expression_whose_type_lacks_a_call_signature_Type_0_has_no_compatible_call_signatures,e.range,h.type.toString()),n.unreachable();case o.ElementKind.GLOBAL:if(c=h.type.signatureReference){u=n.global_get(h.internalName,h.type.toNativeType());break}return this.error(i.DiagnosticCode.Cannot_invoke_an_expression_whose_type_lacks_a_call_signature_Type_0_has_no_compatible_call_signatures,e.range,h.type.toString()),n.unreachable();case o.ElementKind.FIELD:{let t=h.type;if(c=t.signatureReference){let e=assert(this.resolver.currentThisExpression),t=this.compileExpression(e,this.options.usizeType);u=n.load(4,!1,t,s.NativeType.I32,h.memoryOffset);break}return this.error(i.DiagnosticCode.Cannot_invoke_an_expression_whose_type_lacks_a_call_signature_Type_0_has_no_compatible_call_signatures,e.range,t.toString()),n.unreachable()}case o.ElementKind.FUNCTION_TARGET:c=h.signature,u=this.compileExpression(e.expression,h.type,1);break;case o.ElementKind.PROPERTY_PROTOTYPE:{let t=assert(h.getterPrototype),r=this.resolver.resolveFunction(t,null);if(!r)return n.unreachable();if(u=this.compileCallDirect(r,[],e.expression),!(c=this.currentType.signatureReference))return this.error(i.DiagnosticCode.Cannot_invoke_an_expression_whose_type_lacks_a_call_signature_Type_0_has_no_compatible_call_signatures,e.range,this.currentType.toString()),n.unreachable();break}case o.ElementKind.PROPERTY:{let t=assert(h.getterInstance);if(u=this.compileCallDirect(t,[],e.expression,this.compileExpression(assert(this.resolver.currentThisExpression),this.options.usizeType)),!(c=this.currentType.signatureReference))return this.error(i.DiagnosticCode.Cannot_invoke_an_expression_whose_type_lacks_a_call_signature_Type_0_has_no_compatible_call_signatures,e.range,this.currentType.toString()),n.unreachable();break}default:{let t=this.resolver.getTypeOfElement(h);return t?this.error(i.DiagnosticCode.Type_0_has_no_call_signatures,e.range,t.toString()):this.error(i.DiagnosticCode.Expression_cannot_be_represented_by_a_type,e.range),n.unreachable()}}return this.compileCallIndirect(c,u,e.arguments,e,0,t==_.Type.void)}compileCallExpressionBuiltin(e,t,r){e.hasDecorator(o.DecoratorFlags.UNSAFE)&&this.checkUnsafe(t);var s=null,l=e.typeParameterNodes,c=t.typeArguments;return t.typeArguments&&(e.is(a.CommonFlags.GENERIC)||this.error(i.DiagnosticCode.Type_0_is_not_generic,t.range,e.internalName),s=this.resolver.resolveTypeArguments(assert(l),c,this.currentFlow.actualFunction.parent,h.makeMap(this.currentFlow.contextualTypeArguments),t)),n.compileCall(this,e,s,t.arguments,r,t)}checkCallSignature(e,t,r,n){if(r!=(null!=e.thisType))return this.error(i.DiagnosticCode.The_this_types_of_each_signature_are_incompatible,n.range),!1;var s=e.hasRest;if(s)return this.error(i.DiagnosticCode.Not_implemented,n.range),!1;var a=e.requiredParameters,o=e.parameterTypes.length;return t<a?(this.error(a<o?i.DiagnosticCode.Expected_at_least_0_arguments_but_got_1:i.DiagnosticCode.Expected_0_arguments_but_got_1,n.range,a.toString(),t.toString()),!1):!(t>o&&!s)||(this.error(i.DiagnosticCode.Expected_0_arguments_but_got_1,n.range,o.toString(),t.toString()),!1)}checkUnsafe(e){this.options.noUnsafe&&!e.range.source.isLibrary&&this.error(i.DiagnosticCode.Operation_is_unsafe,e.range)}compileCallDirect(e,t,r,n=0,s=0){var l=t.length,c=e.signature;if(!this.checkCallSignature(c,l,0!=n,r))return this.currentType=c.returnType,this.module.unreachable();if(e.hasDecorator(o.DecoratorFlags.UNSAFE)&&this.checkUnsafe(r),e.hasDecorator(o.DecoratorFlags.INLINE)){if(assert(!e.is(a.CommonFlags.TRAMPOLINE)),!this.currentInlineFunctions.includes(e)){this.currentInlineFunctions.push(e);let r=c.parameterTypes;assert(l<=r.length);let i=new Array(l);for(let e=0;e<l;++e)i[e]=this.compileExpression(t[e],r[e],17);let a=this.makeCallInline(e,i,n,0!=(8&s));return this.currentType.isManaged&&(16&s?this.skippedAutoreleases.add(a):a=this.makeAutorelease(a,this.currentFlow)),this.currentInlineFunctions.pop(),a}this.warning(i.DiagnosticCode.Function_0_cannot_be_inlined_into_itself,r.range,e.internalName)}var u=n?l+1:l,p=new Array(u),_=0;n&&(p[0]=n,_=1);var h=c.parameterTypes;for(let e=0;e<l;++e,++_)p[_]=this.compileExpression(t[e],h[e],1);if(assert(_==u),c.returnType.isManaged){if(8&s)return this.makeCallDirect(e,p,r,!0);if(16&s){let t=this.makeCallDirect(e,p,r,!1,!0);return this.skippedAutoreleases.add(t),t}return this.makeCallDirect(e,p,r,!1,!1)}return this.makeCallDirect(e,p,r,0!=(8&s))}makeCallInline(e,t,r=0,n=!1){var i=this.module,s=t?t.length:0,c=e.signature,u=c.parameterTypes,p=u.length,h=this.currentFlow,d=l.Flow.createInline(h.parentFunction,e),y=[],T=new Set;for(let e=s-1;e>=0;--e){let r=t[e],n=u[e],s=d.addScopedLocal(c.getParameterName(e),n,T);l.findUsedLocals(r,T),h.canOverflow(r,n)||d.setLocalFlag(s.index,l.LocalFlags.WRAPPED),d.isNonnull(r,n)&&d.setLocalFlag(s.index,l.LocalFlags.NONNULL),n.isManaged&&(this.skippedAutoreleases.has(r)||(r=this.makeRetain(r)),d.setLocalFlag(s.index,l.LocalFlags.RETAINED)),y.unshift(i.local_set(s.index,r))}if(r){let t=assert(e.parent);assert(t.kind==o.ElementKind.CLASS);let n=assert(e.signature.thisType),s=d.addScopedLocal(a.CommonSymbols.this_,n,T);y.unshift(i.local_set(s.index,r));let l=t.base;l&&d.addScopedAlias(a.CommonSymbols.super_,l.type,s.index)}else assert(!e.signature.thisType);this.currentFlow=d;for(let t=s;t<p;++t){let r=u[t],n=this.compileExpression(assert(e.prototype.functionTypeNode.parameters[t].initializer),r,17),s=d.addScopedLocal(c.getParameterName(t),r);d.canOverflow(n,r)||d.setLocalFlag(s.index,l.LocalFlags.WRAPPED),d.isNonnull(n,r)&&d.setLocalFlag(s.index,l.LocalFlags.NONNULL),r.isManaged&&(d.setLocalFlag(s.index,l.LocalFlags.RETAINED),this.skippedAutoreleases.has(n)||(n=this.makeRetain(n))),y.push(i.local_set(s.index,n))}this.compileFunctionBody(e,y),d.is(256)||(this.performAutoreleases(d,y),this.finishAutoreleases(d,y)),d.freeScopedLocals();var m=d.returnType;this.currentFlow=h;var g=i.block(d.inlineReturnLabel,y,m.toNativeType());return this.currentType=m,m.isManaged&&n&&(g=this.makeRelease(g),this.currentType=_.Type.void),g}ensureTrampoline(e){var t=e.trampoline;if(t)return t;var r=e.signature,l=e.internalName,c=r.parameterTypes,u=e.prototype.functionTypeNode.parameters,p=r.returnType,h=r.thisType,d=e.is(a.CommonFlags.INSTANCE),y=r.requiredParameters,T=y,m=c.length,g=m;d&&(++T,++g);var E=assert(g-T),f=new Array(T),I=0,x=this.module;d&&(f[0]=x.local_get(0,this.options.nativeSizeType),I=1);for(let e=0;e<y;++e,++I)f[I]=x.local_get(I,c[e].toNativeType());assert(I==T);var b=new _.Signature(this.program,c,p,h);b.requiredParameters=m,b.parameterNames=r.parameterNames,(t=new o.Function(e.name+"|trampoline",e.prototype,b,e.contextualTypeArguments)).set(e.flags|a.CommonFlags.TRAMPOLINE|a.CommonFlags.COMPILED),e.trampoline=t;var A=this.currentFlow,N=t.flow;this.currentFlow=N;var S=E+1,C=new Array(S),O="of"+E.toString(10);for(let e=0;e<S;++e){let t=e.toString(10)+O;C[e]=t}var v=x.block(C[0],[x.block("outOfRange",[x.switch(C,"outOfRange",y?x.binary(s.BinaryOp.SubI32,x.global_get(n.BuiltinSymbols.argc,s.NativeType.I32),x.i32(y)):x.global_get(n.BuiltinSymbols.argc,s.NativeType.I32))]),x.unreachable()]);for(let e=0;e<E;++e,++I){let t,r=c[y+e],n=u[y+e],s=n.initializer;s?t=x.local_set(I,this.compileExpression(s,r,1)):(this.error(i.DiagnosticCode.Optional_parameter_must_have_an_initializer,n.range),t=x.unreachable()),v=x.block(C[e+1],[v,t]),f[I]=x.local_get(I,r.toNativeType())}assert(I==g);var R=[v],L=x.call(l,f,p.toNativeType());p!=_.Type.void?this.performAutoreleasesWithValue(N,L,p,R):(R.push(L),this.performAutoreleases(N,R)),N.freeScopedLocals(),this.currentFlow=A;var k=x.addFunction(t.internalName,this.ensureFunctionType(b.parameterTypes,p,h),_.typesToNativeTypes(t.additionalLocals),x.block(null,R,p.toNativeType()));return t.finalize(x,k),t}ensureArgcVar(){if(!this.argcVar){let e=this.module;this.argcVar=e.addGlobal(n.BuiltinSymbols.argc,s.NativeType.I32,!0,e.i32(0))}return n.BuiltinSymbols.argc}ensureArgcSet(){if(!this.argcSet){let e=this.module;this.argcSet=e.addFunction(n.BuiltinSymbols.setargc,this.ensureFunctionType([_.Type.u32],_.Type.void),null,e.global_set(this.ensureArgcVar(),e.local_get(0,s.NativeType.I32))),e.addFunctionExport(n.BuiltinSymbols.setargc,"__setargc")}return n.BuiltinSymbols.setargc}makeRetain(e){var t=this.program.retainInstance;return this.compileFunction(t),this.module.call(t.internalName,[e],this.options.nativeSizeType)}makeRetainRelease(e,t){var r=this.module,n=this.currentFlow,i=this.options.usizeType,a=this.options.nativeSizeType,o=n.getTempLocal(i,l.findUsedLocals(e)),c=n.getTempLocal(i),u=r.block(null,[r.if(r.binary(a==s.NativeType.I64?s.BinaryOp.NeI64:s.BinaryOp.NeI32,r.local_tee(o.index,t),r.local_tee(c.index,e)),r.block(null,[r.drop(this.makeRetain(r.local_get(o.index,a))),this.makeRelease(r.local_get(c.index,a))])),r.local_get(o.index,a)],a);return n.freeTempLocal(c),n.freeTempLocal(o),u}makeSkippedRelease(e,t){var r=this.module,n=this.currentFlow,i=this.options.usizeType,s=this.options.nativeSizeType,a=n.getTempLocal(i,l.findUsedLocals(e)),o=r.block(null,[r.local_set(a.index,t),this.makeRelease(e),r.local_get(a.index,s)],s);return n.freeTempLocal(a),o}makeRelease(e){var t=this.program.releaseInstance;return this.compileFunction(t),this.module.call(t.internalName,[e],s.NativeType.None)}makeAutorelease(e,t=this.currentFlow){return this.module.local_tee(t.getAutoreleaseLocal(this.options.usizeType).index,e)}undoAutorelease(e,t){switch(s.getExpressionId(e)){case s.ExpressionId.LocalSet:if(s.isLocalTee(e)){let r=s.getLocalSetIndex(e);if(t.isAnyLocalFlag(r,l.LocalFlags.ANY_RETAINED))return t.unsetLocalFlag(r,l.LocalFlags.ANY_RETAINED),r}break;case s.ExpressionId.Block:if(null===s.getBlockName(e)){let r=s.getBlockChildCount(e);if(r)return this.undoAutorelease(s.getBlockChild(e,r-1),t)}}return-1}moveAutorelease(e,t,r){return~this.undoAutorelease(e,t)?this.makeAutorelease(e,r):this.makeAutorelease(this.makeRetain(e),r)}performAutoreleases(e,t,r=!0){var n=e.scopedLocals;if(n){let i=this.module;for(let s of n.values())if(s.is(a.CommonFlags.SCOPED)){let n=s.index;e.isAnyLocalFlag(n,l.LocalFlags.ANY_RETAINED)&&(r&&e.unsetLocalFlag(n,l.LocalFlags.ANY_RETAINED),t.push(this.makeRelease(i.local_get(n,s.type.toNativeType()))))}}}performAutoreleasesWithValue(e,t,r,n=null,i=!0){n||(n=new Array),n.push(this.module.nop());var s=n.length;if(this.performAutoreleases(e,n,i),n.length>s){let i=r.toNativeType(),a=e.getTempLocal(r);e.canOverflow(t,r)||e.setLocalFlag(a.index,l.LocalFlags.WRAPPED),e.isNonnull(t,r)&&e.setLocalFlag(a.index,l.LocalFlags.NONNULL);let o=this.module;n[s-1]=o.local_set(a.index,t),n.push(o.local_get(a.index,i));let c=o.block(null,n,i);return e.freeTempLocal(a),c}return n.length>1?(n[s-1]=t,this.module.block(null,n,r.toNativeType())):t}finishAutoreleases(e,t){var r=this.module;if(e.is(32768)){let r;for(;r=e.parent;)e=r;this.performAutoreleases(e,t,!1)}else for(let n of e.parentFunction.localsByIndex){let i=n.index;e.isAnyLocalFlag(i,l.LocalFlags.ANY_RETAINED)&&(e.unsetLocalFlag(i,l.LocalFlags.ANY_RETAINED),t.push(this.makeRelease(r.local_get(i,n.type.toNativeType()))))}}makeCallDirect(e,t,r,n=!1,s=!1){if(e.hasDecorator(o.DecoratorFlags.INLINE)){if(assert(!e.is(a.CommonFlags.TRAMPOLINE)),!this.currentInlineFunctions.includes(e)){let r;if(this.currentInlineFunctions.push(e),e.is(a.CommonFlags.INSTANCE)){let i=assert(t);assert(i.length),r=this.makeCallInline(e,i.slice(1),i[0],n)}else r=this.makeCallInline(e,t,0,n);return this.currentType.isManaged&&(s?this.skippedAutoreleases.add(r):r=this.makeAutorelease(r,this.currentFlow)),this.currentInlineFunctions.pop(),r}this.warning(i.DiagnosticCode.Function_0_cannot_be_inlined_into_itself,r.range,e.internalName)}var l=t?t.length:0,c=l,u=e.signature.requiredParameters,h=e.signature.parameterTypes.length,d=h;e.is(a.CommonFlags.INSTANCE)&&(++u,++d,--c),assert(l>=u);var y=this.module;if(!this.compileFunction(e))return y.unreachable();var T=e.signature.returnType,m=e.is(a.CommonFlags.MODULE_IMPORT);if(l<d){t||((t=new Array(d)).length=0);let r=e.signature.parameterTypes,i=e.prototype.functionTypeNode.parameters;assert(i.length==r.length);let l=!0;for(let n=c;n<h;++n){let s=i[n].initializer;if(s){if(p.nodeIsConstantValue(s.kind)){t.push(this.compileExpression(i[n].initializer,r[n],1));continue}let l=this.resolver.lookupExpression(s,e.flow,r[n]);if(l&&l.kind==o.ElementKind.GLOBAL){let e=l;if(this.compileGlobal(e)){e.is(a.CommonFlags.INLINED)?t.push(this.compileInlineConstant(e,r[n],1)):t.push(this.convertExpression(y.global_get(e.internalName,e.type.toNativeType()),e.type,r[n],!1,!1,s));continue}}}t.push(r[n].toNativeZero(y)),l=!1}if(!l&&!m){let r=e;if(e=this.ensureTrampoline(e),!this.compileFunction(e))return y.unreachable();e.flow.flags=r.flow.flags;let i=T.toNativeType(),a=y.call(e.internalName,t,i);return this.currentType=T,T.isManaged&&(n?(a=this.makeRelease(a),this.currentType=_.Type.void):s?this.skippedAutoreleases.add(a):a=this.makeAutorelease(a)),y.block(null,[y.global_set(this.ensureArgcVar(),y.i32(c)),a],this.currentType.toNativeType())}}var g=y.call(e.internalName,t,T.toNativeType());return this.currentType=T,T.isManaged&&(n?(g=this.makeRelease(g),this.currentType=_.Type.void):s||(g=this.makeAutorelease(g))),g}compileCallIndirect(e,t,r,n,i=0,s=!1){var a=r.length;if(!this.checkCallSignature(e,a,0!=i,n))return this.module.unreachable();var o=i?a+1:a,l=new Array(o),c=0;i&&(l[0]=i,c=1);var u=e.parameterTypes;for(let e=0;e<a;++e,++c)l[c]=this.compileExpression(r[e],u[e],1);return assert(c==o),this.makeCallIndirect(e,t,l,s)}makeCallIndirect(e,t,r=null,n=!1){var i=r?r.length:0,s=i,a=e.requiredParameters,o=e.parameterTypes.length,l=o;e.thisType&&(++a,++l,--s),assert(i>=a),this.ensureFunctionType(e.parameterTypes,e.returnType,e.thisType);var c=this.module;if(i<l){r||((r=new Array(l)).length=0);let t=e.parameterTypes;for(let e=s;e<o;++e)r.push(t[e].toNativeZero(c))}var u=e.returnType,p=c.call_indirect(t,r,e.toSignatureString());return this.currentType=u,u.isManaged&&(n?(p=this.makeRelease(p),this.currentType=_.Type.void):p=this.makeAutorelease(p)),c.block(null,[c.global_set(this.ensureArgcVar(),c.i32(s)),p],this.currentType.toNativeType())}compileCommaExpression(e,t,r){var n=e.expressions,i=n.length,s=new Array(i--);for(let e=0;e<i;++e)s[e]=this.compileExpression(n[e],_.Type.void,9);return s[i]=this.compileExpression(n[i],t,r),this.module.block(null,s,this.currentType.toNativeType())}compileElementAccessExpression(e,t,r){var n=this.module,s=e.expression,a=this.resolver.resolveExpression(s,this.currentFlow);if(a){if(a.is(256)){let t=a.classReference;if(t){let n=t.lookupOverload(o.OperatorKind.INDEXED_GET,this.currentFlow.is(65536));if(n){let i=this.compileExpression(s,t.type,1);return this.compileCallDirect(n,[e.elementExpression],e,i,r)}}}this.error(i.DiagnosticCode.Index_signature_is_missing_in_type_0,e.expression.range,a.toString())}return n.unreachable()}compileFunctionExpression(e,t,r){var n=e.declaration.clone();assert(!n.typeParameters);var s,a=this.currentFlow,l=a.actualFunction,c=new o.FunctionPrototype(n.name.text.length?n.name.text:"anonymous|"+(l.nextAnonymousId++).toString(10),l,n,o.DecoratorFlags.NONE),u=h.makeMap(a.contextualTypeArguments);if(t){let r=c.functionTypeNode,n=r.parameters,a=n.length,h=t.parameterTypes,d=h.length;if(a>d)return this.error(i.DiagnosticCode.Expected_0_arguments_but_got_1,e.range,d.toString(),a.toString()),this.module.unreachable();let y=new Array(a);for(let e=0;e<a;++e){let t=n[e];if(y[e]=t.name.text,!p.isTypeOmitted(t.type)){let r=this.resolver.resolveType(t.type,l.parent,u);if(!r)return this.module.unreachable();if(!h[e].isStrictlyAssignableTo(r))return this.error(i.DiagnosticCode.Type_0_is_not_assignable_to_type_1,t.range,h[e].toString(),r.toString()),this.module.unreachable()}}let T=t.returnType;if(!p.isTypeOmitted(r.returnType)){let e=this.resolver.resolveType(r.returnType,l.parent,u);if(!e)return this.module.unreachable();if(T==_.Type.void?e!=_.Type.void:!e.isStrictlyAssignableTo(T))return this.error(i.DiagnosticCode.Type_0_is_not_assignable_to_type_1,r.returnType.range,e.toString(),T.toString()),this.module.unreachable()}let m=t.thisType,g=r.explicitThisType;if(g){if(!m)return this.error(i.DiagnosticCode._this_cannot_be_referenced_in_current_location,g.range),this.module.unreachable();let e=this.resolver.resolveType(g,l.parent,u);if(!e)return this.module.unreachable();if(!m.isStrictlyAssignableTo(e))return this.error(i.DiagnosticCode.Type_0_is_not_assignable_to_type_1,g.range,m.toString(),e.toString()),this.module.unreachable()}let E=new _.Signature(this.program,h,T,m);if(E.requiredParameters=d,E.parameterNames=y,s=new o.Function(c.name,c,E,u),!this.compileFunction(s))return this.module.unreachable();this.currentType=t.type}else{if(!(s=this.compileFunctionUsingTypeArguments(c,[],u)))return this.module.unreachable();this.currentType=s.signature.type}var d=this.ensureFunctionTableEntry(s);return d<0?this.module.unreachable():this.module.i32(d)}maybeCompileEnclosingSource(e){var t=e.range.source.internalPath,r=this.program.filesByName;assert(r.has(t)),r.get(t).is(a.CommonFlags.COMPILED)||this.compileFileByPath(t,e)}compileIdentifierExpression(e,t,r){var n=this.module,c=this.currentFlow,u=c.actualFunction;switch(e.kind){case p.NodeKind.NULL:{let e=this.options;if(t.is(256)){let r=t.classReference;if(r)return this.currentType=r.type.asNullable(),e.isWasm64?n.i64(0):n.i32(0);let i=t.signatureReference;if(i)return this.currentType=i.type.asNullable(),n.i32(0)}return this.currentType=e.usizeType,e.isWasm64?n.i64(0):n.i32(0)}case p.NodeKind.TRUE:return this.currentType=_.Type.bool,n.i32(1);case p.NodeKind.FALSE:return this.currentType=_.Type.bool,n.i32(0);case p.NodeKind.THIS:if(u.is(a.CommonFlags.INSTANCE)){let e=assert(c.lookupLocal(a.CommonSymbols.this_)),t=assert(u.parent);assert(t.kind==o.ElementKind.CLASS);let r=this.options.nativeSizeType;if(u.is(a.CommonFlags.CONSTRUCTOR)&&!c.is(64)){c.set(64);let i=[n.if(n.unary(r==s.NativeType.I64?s.UnaryOp.EqzI64:s.UnaryOp.EqzI32,n.local_get(e.index,r)),n.local_set(e.index,this.makeRetain(this.makeAllocation(t))))];return this.makeFieldInitialization(t,i),i.push(n.local_get(e.index,r)),this.currentType=e.type,n.block(null,i,r)}let i=assert(u.signature.thisType);return this.currentType=i,n.local_get(e.index,i.toNativeType())}return this.error(i.DiagnosticCode._this_cannot_be_referenced_in_current_location,e.range),this.currentType=this.options.usizeType,n.unreachable();case p.NodeKind.SUPER:{let t=this.currentFlow,r=t.actualFunction;if(r.is(a.CommonFlags.CONSTRUCTOR)&&(t.is(128)||this.error(i.DiagnosticCode._super_must_be_called_before_accessing_a_property_of_super_in_the_constructor_of_a_derived_class,e.range)),t.is(32768)){let e=t.lookupLocal(a.CommonSymbols.this_);if(e){let t=assert(e.type.classReference).base;if(t)return this.currentType=t.type,n.local_get(e.index,t.type.toNativeType())}}if(r.is(a.CommonFlags.INSTANCE)){let e=assert(r.parent);assert(e.kind==o.ElementKind.CLASS);let t=e.base;if(t){let e=t.type;return this.currentType=e,n.local_get(0,e.toNativeType())}}return this.error(i.DiagnosticCode._super_can_only_be_referenced_in_a_derived_class,e.range),this.currentType=this.options.usizeType,n.unreachable()}}this.maybeCompileEnclosingSource(e);var d=this.resolver.lookupIdentifierExpression(e,c,this.currentParent||u);if(!d)return n.unreachable();switch(d.kind){case o.ElementKind.LOCAL:{let s=d.type;if(d.parent!=c.parentFunction)return this.error(i.DiagnosticCode.Not_implemented,e.range),this.currentType=s,n.unreachable();if(assert(s!=_.Type.void),d.is(a.CommonFlags.INLINED))return this.compileInlineConstant(d,t,r);let o=d.index;return assert(o>=0),s.is(512)&&c.isLocalFlag(o,l.LocalFlags.NONNULL,!1)&&(s=s.nonNullableType),this.currentType=s,this.module.local_get(o,s.toNativeType())}case o.ElementKind.GLOBAL:{if(!this.compileGlobal(d))return this.module.unreachable();let e=d.type;return assert(e!=_.Type.void),d.is(a.CommonFlags.INLINED)?this.compileInlineConstant(d,t,r):(this.currentType=e,this.module.global_get(d.internalName,e.toNativeType()))}case o.ElementKind.ENUMVALUE:return d.is(a.CommonFlags.COMPILED)?(this.currentType=_.Type.i32,d.is(a.CommonFlags.INLINED)?(assert(1==d.constantValueKind),this.module.i32(i64_low(d.constantIntegerValue))):this.module.global_get(d.internalName,s.NativeType.I32)):(this.error(i.DiagnosticCode.A_member_initializer_in_a_enum_declaration_cannot_reference_members_declared_after_it_including_members_defined_in_other_enums,e.range),this.currentType=_.Type.i32,this.module.unreachable());case o.ElementKind.FUNCTION_PROTOTYPE:{let e=this.resolver.resolveFunction(d,null,h.makeMap(c.contextualTypeArguments));if(!e||!this.compileFunction(e))return n.unreachable();let t=this.ensureFunctionTableEntry(e);return this.currentType=e.signature.type,this.module.i32(t)}}return this.error(i.DiagnosticCode.Not_implemented,e.range),this.module.unreachable()}compileInstanceOfExpression(e,t,r){var n=this.module,a=this.compileExpression(e.expression,this.options.usizeType),o=this.currentType,l=this.resolver.resolveType(e.isType,this.currentFlow.actualFunction);if(this.currentType=_.Type.bool,!l)return n.unreachable();if(!l.is(256))return n.block(null,[n.drop(a),n.i32(o==l?1:0)],s.NativeType.I32);if(!o.is(256))return n.block(null,[n.drop(a),n.i32(0)],s.NativeType.I32);var c=o.toNativeType();if(o.is(512)&&!l.is(512)){if(o.nonNullableType.isAssignableTo(l))return n.binary(c==s.NativeType.I64?s.BinaryOp.NeI64:s.BinaryOp.NeI32,a,o.toNativeZero(n));if(l.isAssignableTo(o)){let t=this.program;if(!o.isUnmanaged&&!l.isUnmanaged){let r=this.currentFlow,i=r.getTempLocal(o),u=assert(t.instanceofInstance);this.compileFunction(u);let p=n.if(n.unary(c==s.NativeType.I64?s.UnaryOp.EqzI64:s.UnaryOp.EqzI32,n.local_tee(i.index,a)),n.i32(0),this.makeCallDirect(u,[n.local_get(i.index,c),n.i32(l.classReference.id)],e));return r.freeTempLocal(i),p}this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,"instanceof",o.toString(),l.toString())}}else{if(o.isAssignableTo(l))return n.block(null,[this.convertExpression(a,o,_.Type.void,!1,!1,e.expression),n.i32(1)],s.NativeType.I32);if(l.isAssignableTo(o)){let t=this.program;if(!o.isUnmanaged&&!l.isUnmanaged){let r=this.currentFlow,i=r.getTempLocal(o),u=assert(t.instanceofInstance);this.compileFunction(u);let p=n.if(n.unary(c==s.NativeType.I64?s.UnaryOp.EqzI64:s.UnaryOp.EqzI32,n.local_tee(i.index,a)),n.i32(0),this.makeCallDirect(u,[n.local_get(i.index,c),n.i32(l.classReference.id)],e));return r.freeTempLocal(i),p}this.error(i.DiagnosticCode.Operator_0_cannot_be_applied_to_types_1_and_2,e.range,"instanceof",o.toString(),l.toString())}}return n.block(null,[n.drop(a),n.i32(0)],s.NativeType.I32)}compileLiteralExpression(e,t,r,n=!1){var s=this.module;switch(e.literalKind){case p.LiteralKind.ARRAY:{assert(!n);let a=t.classReference;return a&&a.prototype==this.program.arrayPrototype?this.compileArrayLiteral(assert(a.typeArguments)[0],e.elementExpressions,r,e):(this.error(i.DiagnosticCode.The_type_argument_for_type_parameter_0_cannot_be_inferred_from_the_usage_Consider_specifying_the_type_arguments_explicitly,e.range,"T"),s.unreachable())}case p.LiteralKind.FLOAT:{let r=e.value;return n&&(r=-r),t==_.Type.f32?s.f32(r):(this.currentType=_.Type.f64,s.f64(r))}case p.LiteralKind.INTEGER:{let r=e.value;n&&(r=i64_sub(i64_new(0),r));let i=this.resolver.determineIntegerLiteralType(r,t);switch(this.currentType=i,i.kind){case 4:if(!this.options.isWasm64)return s.i32(i64_low(r));case 3:return s.i64(i64_low(r),i64_high(r));case 9:if(!this.options.isWasm64)return s.i32(i64_low(r));case 8:return s.i64(i64_low(r),i64_high(r));case 11:return s.f32(i64_to_f32(r));case 12:return s.f64(i64_to_f64(r));default:return s.i32(i64_low(r))}}case p.LiteralKind.STRING:return assert(!n),this.compileStringLiteral(e);case p.LiteralKind.OBJECT:return assert(!n),this.compileObjectLiteral(e,t)}return this.error(i.DiagnosticCode.Not_implemented,e.range),this.currentType=t,s.unreachable()}compileStringLiteral(e){return this.ensureStaticString(e.value)}compileArrayLiteral(e,t,r,n){var a=this.module,l=this.program,c=assert(l.arrayPrototype),u=assert(this.resolver.resolveClass(c,[e])),p=assert(l.arrayBufferInstance),_=u.type,h=this.currentFlow,d=h.getTempLocal(_),y=h.getTempLocal(p.type),T=t.length,m=new Array(T),g=!0,E=e.toNativeType();for(let r=0;r<T;++r){let n=t[r],i=n?a.precomputeExpression(this.compileExpression(n,e,1)):e.toNativeZero(a);s.getExpressionId(i)==s.ExpressionId.Const?assert(s.getExpressionType(i)==E):g=!1,m[r]=i}if(g){h.freeTempLocal(d),h.freeTempLocal(y);let t=l.runtimeHeaderSize,i=this.ensureStaticArrayBuffer(e,m),s=i64_add(i.offset,i64_new(t));if(32&r){let r=this.ensureStaticArrayHeader(e,i),n=i64_add(r.offset,i64_new(t));return this.currentType=_,l.options.isWasm64?this.module.i64(i64_low(n),i64_high(n)):this.module.i32(i64_low(n))}{let t=this.makeCallDirect(l.allocArrayInstance,[a.i32(T),l.options.isWasm64?a.i64(e.alignLog2):a.i32(e.alignLog2),a.i32(u.id),l.options.isWasm64?a.i64(i64_low(s),i64_high(s)):a.i32(i64_low(s))],n);return this.currentType=_,this.makeAutorelease(this.makeRetain(t))}}if(!u.lookupOverload(o.OperatorKind.INDEXED_SET,!0))return h.freeTempLocal(d),h.freeTempLocal(y),this.error(i.DiagnosticCode.Index_signature_in_type_0_only_permits_reading,n.range,u.internalName),this.currentType=_,a.unreachable();var f=_.toNativeType(),I=new Array;I.push(a.local_set(d.index,this.makeCallDirect(l.allocArrayInstance,[a.i32(T),l.options.isWasm64?a.i64(e.alignLog2):a.i32(e.alignLog2),a.i32(u.id),l.options.isWasm64?a.i64(0):a.i32(0)],n)));var x=assert(u.lookupInSelf("dataStart"));assert(x.kind==o.ElementKind.FIELD),I.push(a.local_set(y.index,a.load(_.byteSize,!1,a.local_get(d.index,f),f,x.memoryOffset)));var b=e.isManaged;for(let t=0,r=e.alignLog2;t<T;++t){let n=m[t];b&&(n=this.makeRetain(n)),I.push(a.store(e.byteSize,a.local_get(y.index,f),n,E,t<<r))}return I.push(a.local_get(d.index,f)),h.freeTempLocal(d),h.freeTempLocal(y),this.currentType=_,a.block(null,I,f)}compileObjectLiteral(e,t){var r=this.module,n=t.classReference;if(!n||n.is(a.CommonFlags.ABSTRACT))return this.error(i.DiagnosticCode.Type_0_is_not_assignable_to_type_1,e.range,"<object>",t.toString()),r.unreachable();var s=n.constructorInstance;if(s){if(s.signature.requiredParameters)return this.error(i.DiagnosticCode.Constructor_of_class_0_must_not_require_any_arguments,e.range,n.toString()),r.unreachable();if(s.is(a.CommonFlags.PRIVATE))return this.error(i.DiagnosticCode.Constructor_of_class_0_is_private_and_only_accessible_within_the_class_declaration,e.range,n.toString()),r.unreachable();if(s.is(a.CommonFlags.PROTECTED))return this.error(i.DiagnosticCode.Constructor_of_class_0_is_protected_and_only_accessible_within_the_class_declaration,e.range,n.toString()),r.unreachable();s.hasDecorator(o.DecoratorFlags.UNSAFE)&&this.checkUnsafe(e)}var l=e.names,c=l.length,u=e.values,p=n.members,_=!1,h=new Array(c+2),d=this.currentFlow.getAutoreleaseLocal(this.options.usizeType);assert(c==u.length);for(let e=0,t=c;e<t;++e){let t=p?p.get(l[e].text):null;if(!t||t.kind!=o.ElementKind.FIELD){this.error(i.DiagnosticCode.Property_0_does_not_exist_on_type_1,l[e].range,l[e].text,n.toString()),_=!0;continue}let r=t.type;h[e+1]=this.module.store(r.byteSize,this.module.local_get(d.index,this.options.nativeSizeType),this.compileExpression(u[e],t.type,1),r.toNativeType(),t.memoryOffset)}return this.currentType=n.type.nonNullableType,_?r.unreachable():(h[0]=r.local_set(d.index,this.makeRetain(this.makeAllocation(n))),h[h.length-1]=r.local_get(d.index,this.options.nativeSizeType),this.currentType=n.type,r.block(null,h,this.options.nativeSizeType))}compileNewExpression(e,t,r){var n=this.module,s=this.currentFlow,l=this.resolver.lookupExpression(e.expression,s);if(!l)return n.unreachable();if(l.kind!=o.ElementKind.CLASS_PROTOTYPE)return this.error(i.DiagnosticCode.This_expression_is_not_constructable,e.expression.range),this.module.unreachable();var c,u=l,p=null,d=e.typeArguments;return(p=!d&&null!==(c=t.classReference)&&c.is(a.CommonFlags.GENERIC)?this.resolver.resolveClass(u,c.typeArguments,h.makeMap(s.contextualTypeArguments)):this.resolver.resolveClassInclTypeArguments(u,d,s.actualFunction.parent,h.makeMap(s.contextualTypeArguments),e))?(t==_.Type.void&&(r|=8),this.compileInstantiate(p,e.arguments,r,e)):n.unreachable()}ensureConstructor(e,t){var r=e.constructorInstance;if(r)return r.hasDecorator(o.DecoratorFlags.INLINE)||this.compileFunction(r),r;var n=e.base;if(n){let i=this.ensureConstructor(n,t);r=new o.Function(a.CommonSymbols.constructor,new o.FunctionPrototype(a.CommonSymbols.constructor,e,i.declaration.clone()),i.signature,null)}else r=new o.Function(a.CommonSymbols.constructor,new o.FunctionPrototype(a.CommonSymbols.constructor,e,this.program.makeNativeFunctionDeclaration(a.CommonSymbols.constructor,a.CommonFlags.INSTANCE|a.CommonFlags.CONSTRUCTOR)),new _.Signature(this.program,null,e.type,e.type),null);r.internalName=e.internalName+a.INSTANCE_DELIMITER+"constructor",r.set(a.CommonFlags.COMPILED),r.prototype.setResolvedInstance("",r),e.constructorInstance=r;var i=this.currentFlow,l=r.flow;this.currentFlow=l;var c=r.signature,u=this.module,p=this.options.nativeSizeType,h=new Array,d=this.makeAllocation(e);if(e.type.isManaged&&(d=this.makeRetain(d)),h.push(u.if(u.unary(p==s.NativeType.I64?s.UnaryOp.EqzI64:s.UnaryOp.EqzI32,u.local_get(0,p)),u.local_set(0,d))),n){let e=c.parameterTypes,r=e.length,i=new Array(1+r);i[0]=u.local_get(0,p);for(let t=0;t<r;++t)i[t+1]=u.local_get(t+1,e[t].toNativeType());h.push(u.local_set(0,this.makeCallDirect(assert(n.constructorInstance),i,t,!1,!0)))}this.makeFieldInitialization(e,h);var y=this.performAutoreleasesWithValue(l,u.local_get(0,p),e.type,h);l.freeScopedLocals(),this.currentFlow=i;var T=this.ensureFunctionType(c.parameterTypes,c.returnType,c.thisType),m=r.localsByIndex,g=new Array,E=1+c.parameterTypes.length,f=m.length;if(f>E)for(let e=E;e<f;++e)g.push(m[e].type.toNativeType());var I=u.addFunction(r.internalName,T,g,y);return r.finalize(u,I),r}compileInstantiate(e,t,r,n){var i=this.ensureConstructor(e,n);i.hasDecorator(o.DecoratorFlags.UNSAFE)&&this.checkUnsafe(n);var a=this.compileCallDirect(i,t,n,this.options.usizeType.toNativeZero(this.module),r);return s.getExpressionType(a)!=s.NativeType.None&&(this.currentType=e.type),a}compilePropertyAccessExpression(e,t,r){var n=this.module,l=this.currentFlow;this.maybeCompileEnclosingSource(e);var c=this.resolver.lookupExpression(e,l,t);if(!c)return n.unreachable();switch(c.hasDecorator(o.DecoratorFlags.UNSAFE)&&this.checkUnsafe(e),c.kind){case o.ElementKind.GLOBAL:{if(!this.compileGlobal(c))return n.unreachable();let e=c.type;return assert(e!=_.Type.void),c.is(a.CommonFlags.INLINED)?this.compileInlineConstant(c,t,r):(this.currentType=e,n.global_get(c.internalName,e.toNativeType()))}case o.ElementKind.ENUMVALUE:{let e=assert(c.parent);return assert(e.kind==o.ElementKind.ENUM),this.compileEnum(e)?(this.currentType=_.Type.i32,c.is(a.CommonFlags.INLINED)?(assert(1==c.constantValueKind),this.compileInlineConstant(c,t,r)):(assert(c.type==_.Type.i32),n.global_get(c.internalName,s.NativeType.I32))):(this.currentType=_.Type.i32,this.module.unreachable())}case o.ElementKind.FIELD:{assert(c.memoryOffset>=0);let e=this.compileExpression(assert(this.resolver.currentThisExpression),this.options.usizeType);return this.currentType=c.type,n.load(c.type.byteSize,c.type.is(5),e,c.type.toNativeType(),c.memoryOffset)}case o.ElementKind.PROPERTY_PROTOTYPE:{let t=c.getterPrototype;if(t){let r=this.resolver.resolveFunction(t,null);if(r)return this.compileCallDirect(r,[],e,0)}return n.unreachable()}case o.ElementKind.PROPERTY:{let t=assert(c.getterInstance);return this.compileCallDirect(t,[],e,this.compileExpression(assert(this.resolver.currentThisExpression),this.options.usizeType))}case o.ElementKind.FUNCTION_PROTOTYPE:{let t=c;if(t.is(a.CommonFlags.STATIC)){let r=this.compileFunctionUsingTypeArguments(t,[],h.makeMap(),e);return null==r?n.unreachable():(this.currentType=r.type,n.i32(this.ensureFunctionTableEntry(r)))}return this.error(i.DiagnosticCode.Cannot_access_method_0_without_calling_it_as_it_requires_this_to_be_set,e.range,t.name),n.unreachable()}}return this.error(i.DiagnosticCode.Not_implemented,e.range),n.unreachable()}compileTernaryExpression(e,t,r){var n=e.ifThen,a=e.ifElse,o=this.currentFlow,l=this.module.precomputeExpression(this.makeIsTrueish(this.compileExpression(e.condition,_.Type.bool),this.currentType));if(s.getExpressionId(l)==s.ExpressionId.Const&&s.getExpressionType(l)==s.NativeType.I32)return s.getConstValueI32(l)?this.compileExpression(n,t):this.compileExpression(a,t);var c=16&r,u=o.fork();this.currentFlow=u;var p=this.compileExpression(n,t,c),h=this.currentType,d=this.skippedAutoreleases.has(p),y=o.fork();this.currentFlow=y;var T=this.compileExpression(a,t,c),m=this.currentType,g=this.skippedAutoreleases.has(T),E=_.Type.commonDenominator(h,m,!1);if(!E)return this.error(i.DiagnosticCode.Type_0_is_not_assignable_to_type_1,a.range,m.toString(),h.toString()),this.currentType=t,this.module.unreachable();p=this.convertExpression(p,h,E,!1,!1,n),T=this.convertExpression(T,m,E,!1,!1,a),this.currentType=E,d!=g?d?(T=this.makeRetain(T),g=!0):(p=this.makeRetain(p),d=!0):!d&&E.isManaged&&(p=this.moveAutorelease(p,u,o),T=this.moveAutorelease(T,y,o)),p=this.performAutoreleasesWithValue(u,p,E),u.freeScopedLocals(),T=this.performAutoreleasesWithValue(y,T,E),y.freeScopedLocals(),this.currentFlow=o,o.inheritMutual(u,y);var f=this.module.if(l,p,T);return assert(d==g),d&&this.skippedAutoreleases.add(f),f}compileUnaryPostfixExpression(e,t,r){var n=this.module,l=this.currentFlow,c=this.compileExpression(e.operand,t.exceptVoid,0);if(s.getExpressionId(c)==s.ExpressionId.Unreachable)return c;var p,h=null;switch(t!=_.Type.void&&(h=l.getTempLocal(this.currentType),c=n.local_tee(h.index,c)),e.operator){case u.Token.PLUS_PLUS:if(this.currentType.is(256)){let t=this.currentType.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.POSTFIX_INC);if(r){let t=r.is(a.CommonFlags.INSTANCE);if(null===h||t||(c=s.getLocalSetValue(c),l.freeTempLocal(h),h=null),p=this.compileUnaryOverload(r,e.operand,c,e),t)break;return p}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"++",this.currentType.toString()),h&&l.freeTempLocal(h),n.unreachable()}switch(this.currentType.kind){case 0:case 1:case 2:case 5:case 6:case 7:case 10:p=n.binary(s.BinaryOp.AddI32,c,n.i32(1));break;case 9:case 4:{let e=this.options;p=n.binary(e.isWasm64?s.BinaryOp.AddI64:s.BinaryOp.AddI32,c,this.currentType.toNativeOne(n));break}case 3:case 8:p=n.binary(s.BinaryOp.AddI64,c,n.i64(1));break;case 11:p=n.binary(s.BinaryOp.AddF32,c,n.f32(1));break;case 12:p=n.binary(s.BinaryOp.AddF64,c,n.f64(1));break;default:return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"++",this.currentType.toString()),n.unreachable()}break;case u.Token.MINUS_MINUS:if(this.currentType.is(256)){let t=this.currentType.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.POSTFIX_DEC);if(r){let t=r.is(a.CommonFlags.INSTANCE);if(null===h||t||(c=s.getLocalSetValue(c),l.freeTempLocal(h),h=null),p=this.compileUnaryOverload(r,e.operand,c,e),r.is(a.CommonFlags.INSTANCE))break;return p}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"--",this.currentType.toString()),h&&l.freeTempLocal(h),n.unreachable()}switch(this.currentType.kind){case 0:case 1:case 2:case 5:case 6:case 7:case 10:p=n.binary(s.BinaryOp.SubI32,c,n.i32(1));break;case 9:case 4:{let e=this.options;p=n.binary(e.isWasm64?s.BinaryOp.SubI64:s.BinaryOp.SubI32,c,this.currentType.toNativeOne(n));break}case 3:case 8:p=n.binary(s.BinaryOp.SubI64,c,n.i64(1));break;case 11:p=n.binary(s.BinaryOp.SubF32,c,n.f32(1));break;case 12:p=n.binary(s.BinaryOp.SubF64,c,n.f64(1));break;default:return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"--",this.currentType.toString()),n.unreachable()}break;default:return assert(!1),n.unreachable()}var d=this.resolver,y=d.lookupExpression(e.operand,l);if(!y)return h&&l.freeTempLocal(h),n.unreachable();if(!h)return this.makeAssignment(y,p,e.operand,d.currentThisExpression,d.currentElementExpression,!1);var T=this.makeAssignment(y,p,e.operand,d.currentThisExpression,d.currentElementExpression,!1);this.currentType=h.type,l.freeTempLocal(h);var m=h.type.toNativeType();return n.block(null,[T,n.local_get(h.index,m)],m)}compileUnaryPrefixExpression(e,t,r){var n,l=this.module,c=!1;switch(e.operator){case u.Token.PLUS:if(n=this.compileExpression(e.operand,t.exceptVoid,0),this.currentType.is(256)){let t=this.currentType.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.PLUS);if(r)return this.compileUnaryOverload(r,e.operand,n,e)}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"+",this.currentType.toString()),l.unreachable()}break;case u.Token.MINUS:if(e.operand.kind==p.NodeKind.LITERAL&&(e.operand.literalKind==p.LiteralKind.INTEGER||e.operand.literalKind==p.LiteralKind.FLOAT)){n=this.compileLiteralExpression(e.operand,t,0,!0),this.options.sourceMap&&this.addDebugLocation(n,e.range);break}if(n=this.compileExpression(e.operand,t.exceptVoid,0),this.currentType.is(256)){let t=this.currentType.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.MINUS);if(r)return this.compileUnaryOverload(r,e.operand,n,e)}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"-",this.currentType.toString()),l.unreachable()}switch(this.currentType.kind){case 0:case 1:case 2:case 5:case 6:case 7:case 10:n=l.binary(s.BinaryOp.SubI32,l.i32(0),n);break;case 9:case 4:n=l.binary(this.options.isWasm64?s.BinaryOp.SubI64:s.BinaryOp.SubI32,this.currentType.toNativeZero(l),n);break;case 3:case 8:n=l.binary(s.BinaryOp.SubI64,l.i64(0),n);break;case 11:n=l.unary(s.UnaryOp.NegF32,n);break;case 12:n=l.unary(s.UnaryOp.NegF64,n);break;default:this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"-",this.currentType.toString()),n=l.unreachable()}break;case u.Token.PLUS_PLUS:if(c=!0,n=this.compileExpression(e.operand,t.exceptVoid,0),this.currentType.is(256)){let t=this.currentType.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.PREFIX_INC);if(r){if(n=this.compileUnaryOverload(r,e.operand,n,e),r.is(a.CommonFlags.INSTANCE))break;return n}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"++",this.currentType.toString()),l.unreachable()}switch(this.currentType.kind){case 0:case 1:case 2:case 5:case 6:case 7:case 10:n=l.binary(s.BinaryOp.AddI32,n,this.module.i32(1));break;case 9:case 4:n=l.binary(this.options.isWasm64?s.BinaryOp.AddI64:s.BinaryOp.AddI32,n,this.currentType.toNativeOne(l));break;case 3:case 8:n=l.binary(s.BinaryOp.AddI64,n,l.i64(1));break;case 11:n=l.binary(s.BinaryOp.AddF32,n,l.f32(1));break;case 12:n=l.binary(s.BinaryOp.AddF64,n,l.f64(1));break;default:this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"++",this.currentType.toString()),n=l.unreachable()}break;case u.Token.MINUS_MINUS:if(c=!0,n=this.compileExpression(e.operand,t.exceptVoid,0),this.currentType.is(256)){let t=this.currentType.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.PREFIX_DEC);if(r){if(n=this.compileUnaryOverload(r,e.operand,n,e),r.is(a.CommonFlags.INSTANCE))break;return n}}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"--",this.currentType.toString()),l.unreachable()}switch(this.currentType.kind){case 0:case 1:case 2:case 5:case 6:case 7:case 10:n=l.binary(s.BinaryOp.SubI32,n,l.i32(1));break;case 9:case 4:n=l.binary(this.options.isWasm64?s.BinaryOp.SubI64:s.BinaryOp.SubI32,n,this.currentType.toNativeOne(l));break;case 3:case 8:n=l.binary(s.BinaryOp.SubI64,n,l.i64(1));break;case 11:n=l.binary(s.BinaryOp.SubF32,n,l.f32(1));break;case 12:n=l.binary(s.BinaryOp.SubF64,n,l.f64(1));break;default:this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"--",this.currentType.toString()),n=l.unreachable()}break;case u.Token.EXCLAMATION:if(n=this.compileExpression(e.operand,t.exceptVoid,0),this.currentType.is(256)){let t=this.currentType.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.NOT);if(r)return this.compileUnaryOverload(r,e.operand,n,e)}}n=l.unary(s.UnaryOp.EqzI32,this.makeIsTrueish(n,this.currentType)),this.currentType=_.Type.bool;break;case u.Token.TILDE:if(n=this.compileExpression(e.operand,t==_.Type.void?_.Type.i32:t.is(8)?_.Type.i64:t,0),this.currentType.is(256)){let t=this.currentType.classReference;if(t){let r=t.lookupOverload(o.OperatorKind.BITWISE_NOT);if(r)return this.compileUnaryOverload(r,e.operand,n,e)}return this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"~",this.currentType.toString()),l.unreachable()}switch(n=this.convertExpression(n,this.currentType,this.currentType.intType,!1,!1,e.operand),this.currentType.kind){case 0:case 1:case 2:case 5:case 6:case 7:case 10:n=l.binary(s.BinaryOp.XorI32,n,l.i32(-1));break;case 9:case 4:n=l.binary(this.options.isWasm64?s.BinaryOp.XorI64:s.BinaryOp.XorI32,n,this.currentType.toNativeNegOne(l));break;case 3:case 8:n=l.binary(s.BinaryOp.XorI64,n,l.i64(-1,-1));break;default:this.error(i.DiagnosticCode.The_0_operator_cannot_be_applied_to_type_1,e.range,"~",this.currentType.toString()),n=l.unreachable()}break;case u.Token.TYPEOF:return this.compileTypeof(e,t,r);default:return assert(!1),l.unreachable()}if(!c)return n;var h=this.resolver,d=h.lookupExpression(e.operand,this.currentFlow);return d?this.makeAssignment(d,n,e.operand,h.currentThisExpression,h.currentElementExpression,t!=_.Type.void):l.unreachable()}compileTypeof(e,t,r){var n,i=e.operand,s=0,a=this.program.stringInstance;if(i.kind==p.NodeKind.NULL)n="object";else{let e=this.resolver.lookupExpression(i,this.currentFlow,_.Type.auto,c.ReportMode.SWALLOW);if(e)switch(e.kind){case o.ElementKind.CLASS_PROTOTYPE:case o.ElementKind.NAMESPACE:case o.ElementKind.ENUM:n="object";break;case o.ElementKind.FUNCTION_PROTOTYPE:n="function";break;default:{s=this.compileExpression(i,_.Type.auto);let e=this.currentType;if(s=this.convertExpression(s,e,_.Type.void,!0,!1,i),e.is(256)){if(e.signatureReference)n="function";else{let t=e.classReference;n=t?t.prototype===a.prototype?"string":"object":"anyref"}}else n=e==_.Type.bool?"boolean":e.isAny(12)?"number":"undefined";break}}else{switch(i.kind){case p.NodeKind.PROPERTYACCESS:case p.NodeKind.ELEMENTACCESS:if(i.kind,p.NodeKind.PROPERTYACCESS,i=i.expression,!this.resolver.resolveExpression(i,this.currentFlow,_.Type.auto,c.ReportMode.REPORT))return this.currentType=a.type,this.module.unreachable();s=this.compileExpression(i,_.Type.auto);break;case p.NodeKind.IDENTIFIER:break;default:s=this.compileExpression(i,_.Type.auto)}n="undefined"}}return this.currentType=a.type,s?this.module.block(null,[s,this.ensureStaticString(n)],this.options.nativeSizeType):this.ensureStaticString(n)}ensureSmallIntegerWrap(e,t){var r=this.module,n=this.currentFlow;switch(t.kind){case 0:n.canOverflow(e,t)&&(e=this.options.hasFeature(1)?r.unary(s.UnaryOp.ExtendI8ToI32,e):r.binary(s.BinaryOp.ShrI32,r.binary(s.BinaryOp.ShlI32,e,r.i32(24)),r.i32(24)));break;case 1:n.canOverflow(e,t)&&(e=this.options.hasFeature(1)?r.unary(s.UnaryOp.ExtendI16ToI32,e):r.binary(s.BinaryOp.ShrI32,r.binary(s.BinaryOp.ShlI32,e,r.i32(16)),r.i32(16)));break;case 5:n.canOverflow(e,t)&&(e=r.binary(s.BinaryOp.AndI32,e,r.i32(255)));break;case 6:n.canOverflow(e,t)&&(e=r.binary(s.BinaryOp.AndI32,e,r.i32(65535)));break;case 10:n.canOverflow(e,t)&&(e=r.binary(s.BinaryOp.NeI32,e,r.i32(0)))}return e}addDebugLocation(e,t){var r=this.currentFlow.parentFunction,n=t.source;n.debugInfoIndex<0&&(n.debugInfoIndex=this.module.addDebugInfoFile(n.normalizedPath)),t.debugInfoRef=e,r.debugLocations.push(t)}makeIsTrueish(e,t){var r=this.module;switch(t.kind){case 0:case 1:case 5:case 6:e=this.ensureSmallIntegerWrap(e,t);case 10:case 2:case 7:return e;case 3:case 8:return r.binary(s.BinaryOp.NeI64,e,r.i64(0));case 9:this.skippedAutoreleases.has(e)&&(e=this.makeAutorelease(e));case 4:return 64==t.size?r.binary(s.BinaryOp.NeI64,e,r.i64(0)):e;case 11:{let t=this.currentFlow,n=t.getTempLocal(_.Type.f32),i=r.binary(s.BinaryOp.AndI32,r.binary(s.BinaryOp.NeF32,r.local_tee(n.index,e),r.f32(0)),r.binary(s.BinaryOp.EqF32,r.local_get(n.index,s.NativeType.F32),r.local_get(n.index,s.NativeType.F32)));return t.freeTempLocal(n),i}case 12:{let t=this.currentFlow,n=t.getTempLocal(_.Type.f64),i=r.binary(s.BinaryOp.AndI32,r.binary(s.BinaryOp.NeF64,r.local_tee(n.index,e),r.f64(0)),r.binary(s.BinaryOp.EqF64,r.local_get(n.index,s.NativeType.F64),r.local_get(n.index,s.NativeType.F64)));return t.freeTempLocal(n),i}default:return assert(!1),r.i32(0)}}makeAllocation(e){var t=this.program;assert(e.program==t);var r=this.module,n=this.options;this.currentType=e.type;var i=t.allocInstance;return this.compileFunction(i),r.call(i.internalName,[n.isWasm64?r.i64(e.currentMemoryOffset):r.i32(e.currentMemoryOffset),r.i32(e.hasDecorator(o.DecoratorFlags.UNMANAGED)?0:e.id)],n.nativeSizeType)}makeFieldInitialization(e,t=[]){var r=e.members;if(!r)return[];var n=this.module,i=this.currentFlow,s=i.is(32768),l=s?assert(i.lookupLocal(a.CommonSymbols.this_)).index:0,c=this.options.nativeSizeType;for(let u of r.values()){if(u.kind!=o.ElementKind.FIELD||u.parent!=e)continue;let r=u;assert(!r.isAny(a.CommonFlags.CONST));let p,_=r.type,h=_.toNativeType(),d=r.prototype,y=d.initializerNode,T=d.parameterIndex;y?(p=this.compileExpression(y,_,17),_.isManaged&&!this.skippedAutoreleases.has(p)&&(p=this.makeRetain(p))):T>=0?(p=n.local_get(s?assert(i.lookupLocal(r.name)).index:1+T,h),_.isManaged&&(p=this.makeRetain(p))):p=_.toNativeZero(n),t.push(n.store(_.byteSize,n.local_get(l,c),p,h,r.memoryOffset))}return t}makeInstanceOfClass(e,t){var r=this.module,n=this.currentFlow,i=n.getTempLocal(_.Type.i32),a=r.load(4,!1,r.binary(s.BinaryOp.SubI32,e,r.i32(this.program.runtimeHeaderSize)),s.NativeType.I32),o="instanceof_"+t.name+"|"+n.pushBreakLabel(),l=[];return l.push(r.drop(r.br(o,r.binary(s.BinaryOp.EqI32,r.local_tee(i.index,a),r.i32(t.id)),r.i32(1)))),l.push(r.i32(0)),n.freeTempLocal(i),n.popBreakLabel(),r.block(o,l,s.NativeType.I32)}}function g(e,t){if(y=t.range.source.simplePath,T=o.mangleInternalName(e.name,e.parent,e.is(a.CommonFlags.INSTANCE),!0),e.hasDecorator(o.DecoratorFlags.EXTERNAL)){var r=e.program,n=assert(p.findDecorator(p.DecoratorKind.EXTERNAL,t.decorators)),s=n.arguments;if(s&&s.length){let e=s[0];e.kind==p.NodeKind.LITERAL&&e.literalKind==p.LiteralKind.STRING?(T=e.value,s.length>=2&&((e=s[1]).kind==p.NodeKind.LITERAL&&e.literalKind==p.LiteralKind.STRING?(y=T,T=e.value,s.length>2&&r.error(i.DiagnosticCode.Expected_0_arguments_but_got_1,n.range,"2",s.length.toString())):r.error(i.DiagnosticCode.String_literal_expected,e.range))):r.error(i.DiagnosticCode.String_literal_expected,e.range)}else r.error(i.DiagnosticCode.Expected_at_least_0_arguments_but_got_1,n.range,"1","0")}}function E(e,t,r){var n=t.length;if(0==n)return e.nop();if(1==n){let n=t[0];if(s.getExpressionType(n)==r)return n;if(s.getExpressionId(n)==s.ExpressionId.Block){let t=s.getBlockChildCount(n),i=new Array(t);for(let e=0;e<t;++e)i[e]=s.getBlockChild(n,e);return e.block(s.getBlockName(n),i,r)}}return e.block(null,t,r==s.NativeType.Auto?s.getExpressionType(t[n-1]):r)}t.Compiler=m,t.flatten=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Not_implemented=100]="Not_implemented",e[e.Operation_is_unsafe=101]="Operation_is_unsafe",e[e.User_defined_0=102]="User_defined_0",e[e.Feature_0_is_not_enabled=103]="Feature_0_is_not_enabled",e[e.Conversion_from_type_0_to_1_requires_an_explicit_cast=200]="Conversion_from_type_0_to_1_requires_an_explicit_cast",e[e.Conversion_from_type_0_to_1_will_require_an_explicit_cast_when_switching_between_32_64_bit=201]="Conversion_from_type_0_to_1_will_require_an_explicit_cast_when_switching_between_32_64_bit",e[e.Type_0_cannot_be_changed_to_type_1=202]="Type_0_cannot_be_changed_to_type_1",e[e.Operation_0_cannot_be_applied_to_type_1=203]="Operation_0_cannot_be_applied_to_type_1",e[e.Basic_type_0_cannot_be_nullable=204]="Basic_type_0_cannot_be_nullable",e[e.Cannot_export_a_mutable_global=205]="Cannot_export_a_mutable_global",e[e.Mutable_value_cannot_be_inlined=206]="Mutable_value_cannot_be_inlined",e[e.Unmanaged_classes_cannot_extend_managed_classes_and_vice_versa=207]="Unmanaged_classes_cannot_extend_managed_classes_and_vice_versa",e[e.Unmanaged_classes_cannot_implement_interfaces=208]="Unmanaged_classes_cannot_implement_interfaces",e[e.Invalid_regular_expression_flags=209]="Invalid_regular_expression_flags",e[e.Expression_is_never_null=210]="Expression_is_never_null",e[e.Class_0_is_sealed_and_cannot_be_extended=211]="Class_0_is_sealed_and_cannot_be_extended",e[e.Decorator_0_is_not_valid_here=212]="Decorator_0_is_not_valid_here",e[e.Duplicate_decorator=213]="Duplicate_decorator",e[e.Type_0_is_illegal_in_this_context=214]="Type_0_is_illegal_in_this_context",e[e.Optional_parameter_must_have_an_initializer=215]="Optional_parameter_must_have_an_initializer",e[e.Constructor_of_class_0_must_not_require_any_arguments=216]="Constructor_of_class_0_must_not_require_any_arguments",e[e.Function_0_cannot_be_inlined_into_itself=217]="Function_0_cannot_be_inlined_into_itself",e[e.Cannot_access_method_0_without_calling_it_as_it_requires_this_to_be_set=218]="Cannot_access_method_0_without_calling_it_as_it_requires_this_to_be_set",e[e.Optional_properties_are_not_supported=219]="Optional_properties_are_not_supported",e[e.Expression_must_be_a_compile_time_constant=220]="Expression_must_be_a_compile_time_constant",e[e.Type_0_is_not_a_function_index_or_function_reference=221]="Type_0_is_not_a_function_index_or_function_reference",e[e._0_must_be_a_value_between_1_and_2_inclusive=222]="_0_must_be_a_value_between_1_and_2_inclusive",e[e._0_must_be_a_power_of_two=223]="_0_must_be_a_power_of_two",e[e._0_is_not_a_valid_operator=224]="_0_is_not_a_valid_operator",e[e.Expression_cannot_be_represented_by_a_type=225]="Expression_cannot_be_represented_by_a_type",e[e.Unterminated_string_literal=1002]="Unterminated_string_literal",e[e.Identifier_expected=1003]="Identifier_expected",e[e._0_expected=1005]="_0_expected",e[e.A_file_cannot_have_a_reference_to_itself=1006]="A_file_cannot_have_a_reference_to_itself",e[e.Trailing_comma_not_allowed=1009]="Trailing_comma_not_allowed",e[e.Unexpected_token=1012]="Unexpected_token",e[e.A_rest_parameter_must_be_last_in_a_parameter_list=1014]="A_rest_parameter_must_be_last_in_a_parameter_list",e[e.Parameter_cannot_have_question_mark_and_initializer=1015]="Parameter_cannot_have_question_mark_and_initializer",e[e.A_required_parameter_cannot_follow_an_optional_parameter=1016]="A_required_parameter_cannot_follow_an_optional_parameter",e[e.Statements_are_not_allowed_in_ambient_contexts=1036]="Statements_are_not_allowed_in_ambient_contexts",e[e.Initializers_are_not_allowed_in_ambient_contexts=1039]="Initializers_are_not_allowed_in_ambient_contexts",e[e._0_modifier_cannot_be_used_here=1042]="_0_modifier_cannot_be_used_here",e[e.A_rest_parameter_cannot_be_optional=1047]="A_rest_parameter_cannot_be_optional",e[e.A_rest_parameter_cannot_have_an_initializer=1048]="A_rest_parameter_cannot_have_an_initializer",e[e.A_set_accessor_must_have_exactly_one_parameter=1049]="A_set_accessor_must_have_exactly_one_parameter",e[e.A_set_accessor_parameter_cannot_have_an_initializer=1052]="A_set_accessor_parameter_cannot_have_an_initializer",e[e.A_get_accessor_cannot_have_parameters=1054]="A_get_accessor_cannot_have_parameters",e[e.Enum_member_must_have_initializer=1061]="Enum_member_must_have_initializer",e[e.Type_parameters_cannot_appear_on_a_constructor_declaration=1092]="Type_parameters_cannot_appear_on_a_constructor_declaration",e[e.Type_annotation_cannot_appear_on_a_constructor_declaration=1093]="Type_annotation_cannot_appear_on_a_constructor_declaration",e[e.An_accessor_cannot_have_type_parameters=1094]="An_accessor_cannot_have_type_parameters",e[e.A_set_accessor_cannot_have_a_return_type_annotation=1095]="A_set_accessor_cannot_have_a_return_type_annotation",e[e.Type_parameter_list_cannot_be_empty=1098]="Type_parameter_list_cannot_be_empty",e[e.A_continue_statement_can_only_be_used_within_an_enclosing_iteration_statement=1104]="A_continue_statement_can_only_be_used_within_an_enclosing_iteration_statement",e[e.A_break_statement_can_only_be_used_within_an_enclosing_iteration_or_switch_statement=1105]="A_break_statement_can_only_be_used_within_an_enclosing_iteration_or_switch_statement",e[e.A_return_statement_can_only_be_used_within_a_function_body=1108]="A_return_statement_can_only_be_used_within_a_function_body",e[e.Expression_expected=1109]="Expression_expected",e[e.Type_expected=1110]="Type_expected",e[e.A_default_clause_cannot_appear_more_than_once_in_a_switch_statement=1113]="A_default_clause_cannot_appear_more_than_once_in_a_switch_statement",e[e.Duplicate_label_0=1114]="Duplicate_label_0",e[e.An_export_assignment_cannot_have_modifiers=1120]="An_export_assignment_cannot_have_modifiers",e[e.Octal_literals_are_not_allowed_in_strict_mode=1121]="Octal_literals_are_not_allowed_in_strict_mode",e[e.Digit_expected=1124]="Digit_expected",e[e.Hexadecimal_digit_expected=1125]="Hexadecimal_digit_expected",e[e.Unexpected_end_of_text=1126]="Unexpected_end_of_text",e[e.Invalid_character=1127]="Invalid_character",e[e._case_or_default_expected=1130]="_case_or_default_expected",e[e._super_must_be_followed_by_an_argument_list_or_member_access=1034]="_super_must_be_followed_by_an_argument_list_or_member_access",e[e.A_declare_modifier_cannot_be_used_in_an_already_ambient_context=1038]="A_declare_modifier_cannot_be_used_in_an_already_ambient_context",e[e.Type_argument_expected=1140]="Type_argument_expected",e[e.String_literal_expected=1141]="String_literal_expected",e[e.Line_break_not_permitted_here=1142]="Line_break_not_permitted_here",e[e.Declaration_expected=1146]="Declaration_expected",e[e._const_declarations_must_be_initialized=1155]="_const_declarations_must_be_initialized",e[e.Unterminated_regular_expression_literal=1161]="Unterminated_regular_expression_literal",e[e.Interface_declaration_cannot_have_implements_clause=1176]="Interface_declaration_cannot_have_implements_clause",e[e.Binary_digit_expected=1177]="Binary_digit_expected",e[e.Octal_digit_expected=1178]="Octal_digit_expected",e[e.An_implementation_cannot_be_declared_in_ambient_contexts=1183]="An_implementation_cannot_be_declared_in_ambient_contexts",e[e.An_extended_Unicode_escape_value_must_be_between_0x0_and_0x10FFFF_inclusive=1198]="An_extended_Unicode_escape_value_must_be_between_0x0_and_0x10FFFF_inclusive",e[e.Unterminated_Unicode_escape_sequence=1199]="Unterminated_Unicode_escape_sequence",e[e.Decorators_are_not_valid_here=1206]="Decorators_are_not_valid_here",e[e._abstract_modifier_can_only_appear_on_a_class_method_or_property_declaration=1242]="_abstract_modifier_can_only_appear_on_a_class_method_or_property_declaration",e[e.Method_0_cannot_have_an_implementation_because_it_is_marked_abstract=1245]="Method_0_cannot_have_an_implementation_because_it_is_marked_abstract",e[e.A_definite_assignment_assertion_is_not_permitted_in_this_context=1255]="A_definite_assignment_assertion_is_not_permitted_in_this_context",e[e.A_class_may_only_extend_another_class=1311]="A_class_may_only_extend_another_class",e[e.A_parameter_property_cannot_be_declared_using_a_rest_parameter=1317]="A_parameter_property_cannot_be_declared_using_a_rest_parameter",e[e.Duplicate_identifier_0=2300]="Duplicate_identifier_0",e[e.Cannot_find_name_0=2304]="Cannot_find_name_0",e[e.Module_0_has_no_exported_member_1=2305]="Module_0_has_no_exported_member_1",e[e.Generic_type_0_requires_1_type_argument_s=2314]="Generic_type_0_requires_1_type_argument_s",e[e.Type_0_is_not_generic=2315]="Type_0_is_not_generic",e[e.Type_0_is_not_assignable_to_type_1=2322]="Type_0_is_not_assignable_to_type_1",e[e.Index_signature_is_missing_in_type_0=2329]="Index_signature_is_missing_in_type_0",e[e._this_cannot_be_referenced_in_current_location=2332]="_this_cannot_be_referenced_in_current_location",e[e._super_can_only_be_referenced_in_a_derived_class=2335]="_super_can_only_be_referenced_in_a_derived_class",e[e.Super_calls_are_not_permitted_outside_constructors_or_in_nested_functions_inside_constructors=2337]="Super_calls_are_not_permitted_outside_constructors_or_in_nested_functions_inside_constructors",e[e.Property_0_does_not_exist_on_type_1=2339]="Property_0_does_not_exist_on_type_1",e[e.Cannot_invoke_an_expression_whose_type_lacks_a_call_signature_Type_0_has_no_compatible_call_signatures=2349]="Cannot_invoke_an_expression_whose_type_lacks_a_call_signature_Type_0_has_no_compatible_call_signatures",e[e.This_expression_is_not_constructable=2351]="This_expression_is_not_constructable",e[e.A_function_whose_declared_type_is_not_void_must_return_a_value=2355]="A_function_whose_declared_type_is_not_void_must_return_a_value",e[e.The_operand_of_an_increment_or_decrement_operator_must_be_a_variable_or_a_property_access=2357]="The_operand_of_an_increment_or_decrement_operator_must_be_a_variable_or_a_property_access",e[e.The_left_hand_side_of_an_assignment_expression_must_be_a_variable_or_a_property_access=2364]="The_left_hand_side_of_an_assignment_expression_must_be_a_variable_or_a_property_access",e[e.Operator_0_cannot_be_applied_to_types_1_and_2=2365]="Operator_0_cannot_be_applied_to_types_1_and_2",e[e.A_super_call_must_be_the_first_statement_in_the_constructor=2376]="A_super_call_must_be_the_first_statement_in_the_constructor",e[e.Constructors_for_derived_classes_must_contain_a_super_call=2377]="Constructors_for_derived_classes_must_contain_a_super_call",e[e._get_and_set_accessor_must_have_the_same_type=2380]="_get_and_set_accessor_must_have_the_same_type",e[e.Constructor_implementation_is_missing=2390]="Constructor_implementation_is_missing",e[e.Function_implementation_is_missing_or_not_immediately_following_the_declaration=2391]="Function_implementation_is_missing_or_not_immediately_following_the_declaration",e[e.Multiple_constructor_implementations_are_not_allowed=2392]="Multiple_constructor_implementations_are_not_allowed",e[e.Duplicate_function_implementation=2393]="Duplicate_function_implementation",e[e.Individual_declarations_in_merged_declaration_0_must_be_all_exported_or_all_local=2395]="Individual_declarations_in_merged_declaration_0_must_be_all_exported_or_all_local",e[e.A_namespace_declaration_cannot_be_located_prior_to_a_class_or_function_with_which_it_is_merged=2434]="A_namespace_declaration_cannot_be_located_prior_to_a_class_or_function_with_which_it_is_merged",e[e.The_type_argument_for_type_parameter_0_cannot_be_inferred_from_the_usage_Consider_specifying_the_type_arguments_explicitly=2453]="The_type_argument_for_type_parameter_0_cannot_be_inferred_from_the_usage_Consider_specifying_the_type_arguments_explicitly",e[e.Type_0_has_no_property_1=2460]="Type_0_has_no_property_1",e[e.The_0_operator_cannot_be_applied_to_type_1=2469]="The_0_operator_cannot_be_applied_to_type_1",e[e.In_const_enum_declarations_member_initializer_must_be_constant_expression=2474]="In_const_enum_declarations_member_initializer_must_be_constant_expression",e[e.Export_declaration_conflicts_with_exported_declaration_of_0=2484]="Export_declaration_conflicts_with_exported_declaration_of_0",e[e.Object_is_possibly_null=2531]="Object_is_possibly_null",e[e.Cannot_assign_to_0_because_it_is_a_constant_or_a_read_only_property=2540]="Cannot_assign_to_0_because_it_is_a_constant_or_a_read_only_property",e[e.The_target_of_an_assignment_must_be_a_variable_or_a_property_access=2541]="The_target_of_an_assignment_must_be_a_variable_or_a_property_access",e[e.Index_signature_in_type_0_only_permits_reading=2542]="Index_signature_in_type_0_only_permits_reading",e[e.Expected_0_arguments_but_got_1=2554]="Expected_0_arguments_but_got_1",e[e.Expected_at_least_0_arguments_but_got_1=2555]="Expected_at_least_0_arguments_but_got_1",e[e.Expected_0_type_arguments_but_got_1=2558]="Expected_0_type_arguments_but_got_1",e[e.A_member_initializer_in_a_enum_declaration_cannot_reference_members_declared_after_it_including_members_defined_in_other_enums=2651]="A_member_initializer_in_a_enum_declaration_cannot_reference_members_declared_after_it_including_members_defined_in_other_enums",e[e.Constructor_of_class_0_is_private_and_only_accessible_within_the_class_declaration=2673]="Constructor_of_class_0_is_private_and_only_accessible_within_the_class_declaration",e[e.Constructor_of_class_0_is_protected_and_only_accessible_within_the_class_declaration=2674]="Constructor_of_class_0_is_protected_and_only_accessible_within_the_class_declaration",e[e.The_this_types_of_each_signature_are_incompatible=2685]="The_this_types_of_each_signature_are_incompatible",e[e.Namespace_0_has_no_exported_member_1=2694]="Namespace_0_has_no_exported_member_1",e[e.Required_type_parameters_may_not_follow_optional_type_parameters=2706]="Required_type_parameters_may_not_follow_optional_type_parameters",e[e.Duplicate_property_0=2718]="Duplicate_property_0",e[e.Type_0_has_no_call_signatures=2757]="Type_0_has_no_call_signatures",e[e.File_0_not_found=6054]="File_0_not_found",e[e.Numeric_separators_are_not_allowed_here=6188]="Numeric_separators_are_not_allowed_here",e[e.Multiple_consecutive_numeric_separators_are_not_permitted=6189]="Multiple_consecutive_numeric_separators_are_not_permitted",e[e._super_must_be_called_before_accessing_this_in_the_constructor_of_a_derived_class=17009]="_super_must_be_called_before_accessing_this_in_the_constructor_of_a_derived_class",e[e._super_must_be_called_before_accessing_a_property_of_super_in_the_constructor_of_a_derived_class=17011]="_super_must_be_called_before_accessing_a_property_of_super_in_the_constructor_of_a_derived_class"}(t.DiagnosticCode||(t.DiagnosticCode={})),t.diagnosticCodeToString=function(e){switch(e){case 100:return"Not implemented.";case 101:return"Operation is unsafe.";case 102:return"User-defined: {0}";case 103:return"Feature '{0}' is not enabled.";case 200:return"Conversion from type '{0}' to '{1}' requires an explicit cast.";case 201:return"Conversion from type '{0}' to '{1}' will require an explicit cast when switching between 32/64-bit.";case 202:return"Type '{0}' cannot be changed to type '{1}'.";case 203:return"Operation '{0}' cannot be applied to type '{1}'.";case 204:return"Basic type '{0}' cannot be nullable.";case 205:return"Cannot export a mutable global.";case 206:return"Mutable value cannot be inlined.";case 207:return"Unmanaged classes cannot extend managed classes and vice-versa.";case 208:return"Unmanaged classes cannot implement interfaces.";case 209:return"Invalid regular expression flags.";case 210:return"Expression is never 'null'.";case 211:return"Class '{0}' is sealed and cannot be extended.";case 212:return"Decorator '{0}' is not valid here.";case 213:return"Duplicate decorator.";case 214:return"Type '{0}' is illegal in this context.";case 215:return"Optional parameter must have an initializer.";case 216:return"Constructor of class '{0}' must not require any arguments.";case 217:return"Function '{0}' cannot be inlined into itself.";case 218:return"Cannot access method '{0}' without calling it as it requires 'this' to be set.";case 219:return"Optional properties are not supported.";case 220:return"Expression must be a compile-time constant.";case 221:return"Type '{0}' is not a function index or function reference.";case 222:return"'{0}' must be a value between '{1}' and '{2}' inclusive.";case 223:return"'{0}' must be a power of two.";case 224:return"'{0}' is not a valid operator.";case 225:return"Expression cannot be represented by a type.";case 1002:return"Unterminated string literal.";case 1003:return"Identifier expected.";case 1005:return"'{0}' expected.";case 1006:return"A file cannot have a reference to itself.";case 1009:return"Trailing comma not allowed.";case 1012:return"Unexpected token.";case 1014:return"A rest parameter must be last in a parameter list.";case 1015:return"Parameter cannot have question mark and initializer.";case 1016:return"A required parameter cannot follow an optional parameter.";case 1036:return"Statements are not allowed in ambient contexts.";case 1039:return"Initializers are not allowed in ambient contexts.";case 1042:return"'{0}' modifier cannot be used here.";case 1047:return"A rest parameter cannot be optional.";case 1048:return"A rest parameter cannot have an initializer.";case 1049:return"A 'set' accessor must have exactly one parameter.";case 1052:return"A 'set' accessor parameter cannot have an initializer.";case 1054:return"A 'get' accessor cannot have parameters.";case 1061:return"Enum member must have initializer.";case 1092:return"Type parameters cannot appear on a constructor declaration.";case 1093:return"Type annotation cannot appear on a constructor declaration.";case 1094:return"An accessor cannot have type parameters.";case 1095:return"A 'set' accessor cannot have a return type annotation.";case 1098:return"Type parameter list cannot be empty.";case 1104:return"A 'continue' statement can only be used within an enclosing iteration statement.";case 1105:return"A 'break' statement can only be used within an enclosing iteration or switch statement.";case 1108:return"A 'return' statement can only be used within a function body.";case 1109:return"Expression expected.";case 1110:return"Type expected.";case 1113:return"A 'default' clause cannot appear more than once in a 'switch' statement.";case 1114:return"Duplicate label '{0}'.";case 1120:return"An export assignment cannot have modifiers.";case 1121:return"Octal literals are not allowed in strict mode.";case 1124:return"Digit expected.";case 1125:return"Hexadecimal digit expected.";case 1126:return"Unexpected end of text.";case 1127:return"Invalid character.";case 1130:return"'case' or 'default' expected.";case 1034:return"'super' must be followed by an argument list or member access.";case 1038:return"A 'declare' modifier cannot be used in an already ambient context.";case 1140:return"Type argument expected.";case 1141:return"String literal expected.";case 1142:return"Line break not permitted here.";case 1146:return"Declaration expected.";case 1155:return"'const' declarations must be initialized.";case 1161:return"Unterminated regular expression literal.";case 1176:return"Interface declaration cannot have 'implements' clause.";case 1177:return"Binary digit expected.";case 1178:return"Octal digit expected.";case 1183:return"An implementation cannot be declared in ambient contexts.";case 1198:return"An extended Unicode escape value must be between 0x0 and 0x10FFFF inclusive.";case 1199:return"Unterminated Unicode escape sequence.";case 1206:return"Decorators are not valid here.";case 1242:return"'abstract' modifier can only appear on a class, method, or property declaration.";case 1245:return"Method '{0}' cannot have an implementation because it is marked abstract.";case 1255:return"A definite assignment assertion '!' is not permitted in this context.";case 1311:return"A class may only extend another class.";case 1317:return"A parameter property cannot be declared using a rest parameter.";case 2300:return"Duplicate identifier '{0}'.";case 2304:return"Cannot find name '{0}'.";case 2305:return"Module '{0}' has no exported member '{1}'.";case 2314:return"Generic type '{0}' requires {1} type argument(s).";case 2315:return"Type '{0}' is not generic.";case 2322:return"Type '{0}' is not assignable to type '{1}'.";case 2329:return"Index signature is missing in type '{0}'.";case 2332:return"'this' cannot be referenced in current location.";case 2335:return"'super' can only be referenced in a derived class.";case 2337:return"Super calls are not permitted outside constructors or in nested functions inside constructors.";case 2339:return"Property '{0}' does not exist on type '{1}'.";case 2349:return"Cannot invoke an expression whose type lacks a call signature. Type '{0}' has no compatible call signatures.";case 2351:return"This expression is not constructable.";case 2355:return"A function whose declared type is not 'void' must return a value.";case 2357:return"The operand of an increment or decrement operator must be a variable or a property access.";case 2364:return"The left-hand side of an assignment expression must be a variable or a property access.";case 2365:return"Operator '{0}' cannot be applied to types '{1}' and '{2}'.";case 2376:return"A 'super' call must be the first statement in the constructor.";case 2377:return"Constructors for derived classes must contain a 'super' call.";case 2380:return"'get' and 'set' accessor must have the same type.";case 2390:return"Constructor implementation is missing.";case 2391:return"Function implementation is missing or not immediately following the declaration.";case 2392:return"Multiple constructor implementations are not allowed.";case 2393:return"Duplicate function implementation.";case 2395:return"Individual declarations in merged declaration '{0}' must be all exported or all local.";case 2434:return"A namespace declaration cannot be located prior to a class or function with which it is merged.";case 2453:return"The type argument for type parameter '{0}' cannot be inferred from the usage. Consider specifying the type arguments explicitly.";case 2460:return"Type '{0}' has no property '{1}'.";case 2469:return"The '{0}' operator cannot be applied to type '{1}'.";case 2474:return"In 'const' enum declarations member initializer must be constant expression.";case 2484:return"Export declaration conflicts with exported declaration of '{0}'.";case 2531:return"Object is possibly 'null'.";case 2540:return"Cannot assign to '{0}' because it is a constant or a read-only property.";case 2541:return"The target of an assignment must be a variable or a property access.";case 2542:return"Index signature in type '{0}' only permits reading.";case 2554:return"Expected {0} arguments, but got {1}.";case 2555:return"Expected at least {0} arguments, but got {1}.";case 2558:return"Expected {0} type arguments, but got {1}.";case 2651:return"A member initializer in a enum declaration cannot reference members declared after it, including members defined in other enums.";case 2673:return"Constructor of class '{0}' is private and only accessible within the class declaration.";case 2674:return"Constructor of class '{0}' is protected and only accessible within the class declaration.";case 2685:return"The 'this' types of each signature are incompatible.";case 2694:return"Namespace '{0}' has no exported member '{1}'.";case 2706:return"Required type parameters may not follow optional type parameters.";case 2718:return"Duplicate property '{0}'.";case 2757:return"Type '{0}' has no call signatures.";case 6054:return"File '{0}' not found.";case 6188:return"Numeric separators are not allowed here.";case 6189:return"Multiple consecutive numeric separators are not permitted.";case 17009:return"'super' must be called before accessing 'this' in the constructor of a derived class.";case 17011:return"'super' must be called before accessing a property of 'super' in the constructor of a derived class.";default:return""}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(11),i=r(2),s=r(3),a=r(6),o=r(5),l=r(4),c=r(10),u=r(9),p=r(0),_=r(1);var h;function d(e,t,r,n,p,d,m=!1){var S=e.module;switch(t.internalName){case h.isInteger:{let t=g(e,r,n,d);return e.currentType=a.Type.bool,t?t.is(4)&&!t.is(256)?S.i32(1):S.i32(0):S.unreachable()}case h.isFloat:{let t=g(e,r,n,d);return e.currentType=a.Type.bool,t?t.is(8)?S.i32(1):S.i32(0):S.unreachable()}case h.isBoolean:{let t=g(e,r,n,d);return e.currentType=a.Type.bool,t?t==a.Type.bool?S.i32(1):S.i32(0):S.unreachable()}case h.isSigned:{let t=g(e,r,n,d);return e.currentType=a.Type.bool,t?t.is(1)?S.i32(1):S.i32(0):S.unreachable()}case h.isReference:{let t=g(e,r,n,d);return e.currentType=a.Type.bool,t?t.is(256)?S.i32(1):S.i32(0):S.unreachable()}case h.isString:{let t=g(e,r,n,d);if(e.currentType=a.Type.bool,!t)return S.unreachable();if(t.is(256)){let r=t.classReference;if(r){let t=e.program.stringInstance;if(t&&r.isAssignableTo(t))return S.i32(1)}}return S.i32(0)}case h.isArray:{let t=g(e,r,n,d);if(e.currentType=a.Type.bool,!t)return S.unreachable();if(t.is(256)){let r=t.classReference;if(r)return S.i32(r.prototype.extends(e.program.arrayPrototype)?1:0)}return S.i32(0)}case h.isArrayLike:{let t=g(e,r,n,d);if(e.currentType=a.Type.bool,!t)return S.unreachable();if(t.is(256)){let e=t.classReference;if(e)return S.i32(e.isArrayLike?1:0)}return S.i32(0)}case h.isFunction:{let t=g(e,r,n,d);return e.currentType=a.Type.bool,t?S.i32(t.signatureReference?1:0):S.unreachable()}case h.isNullable:{let t=g(e,r,n,d);return e.currentType=a.Type.bool,t?S.i32(t.is(512)?1:0):S.unreachable()}case h.isDefined:{if(e.currentType=a.Type.bool,b(r,d,t)|A(n,1,d,e))return S.unreachable();let i=e.resolver.lookupExpression(n[0],e.currentFlow,a.Type.auto,u.ReportMode.SWALLOW);return S.i32(i?1:0)}case h.isConstant:{if(e.currentType=a.Type.bool,b(r,d,t)|A(n,1,d,e))return S.unreachable();let i=e.compileExpression(n[0],a.Type.auto);return e.currentType=a.Type.bool,S.i32(o.getExpressionId(i)==o.ExpressionId.Const?1:0)}case h.isManaged:{let t=g(e,r,n,d);return e.currentType=a.Type.bool,t?S.i32(t.isManaged?1:0):S.unreachable()}case h.isVoid:{let t=g(e,r,n,d);return e.currentType=a.Type.bool,t?S.i32(15==t.kind?1:0):S.unreachable()}case h.lengthof:{let t=g(e,r,n,d);if(e.currentType=a.Type.i32,!t)return S.unreachable();let s=t.signatureReference;return s?S.i32(s.parameterTypes.length):(e.error(i.DiagnosticCode.Type_0_has_no_call_signatures,d.range,t.toString()),S.unreachable())}case h.sizeof:{if(e.currentType=e.options.usizeType,I(r,d,e)|A(n,0,d,e))return S.unreachable();let t=r[0],s=t.byteSize;return s?e.options.isWasm64?p.is(4)&&p.size<=32?(e.currentType=a.Type.u32,S.i32(s)):S.i64(s,0):p.is(4)&&64==p.size?(e.currentType=a.Type.u64,S.i64(s,0)):S.i32(s):(e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"sizeof",t.toString()),S.unreachable())}case h.alignof:{if(e.currentType=e.options.usizeType,I(r,d,e)|A(n,0,d,e))return S.unreachable();let t=r[0],s=t.byteSize;if(!_.isPowerOf2(s))return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"alignof",t.toString()),S.unreachable();let o=ctz(s);return e.options.isWasm64?p.is(4)&&p.size<=32?(e.currentType=a.Type.u32,S.i32(o)):S.i64(o,0):p.is(4)&&64==p.size?(e.currentType=a.Type.u64,S.i64(o,0)):S.i32(o)}case h.offsetof:{if(e.currentType=e.options.usizeType,I(r,d,e)|N(n,0,1,d,e))return S.unreachable();let t,o=r[0],c=o.classReference;if(!o.is(256)||null===c)return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"offsetof",o.toString()),e.options.isWasm64?p.is(4)&&p.size<=32&&(e.currentType=a.Type.u32):p.is(4)&&64==p.size&&(e.currentType=a.Type.u64),S.unreachable();if(n.length){if(n[0].kind!=s.NodeKind.LITERAL||n[0].literalKind!=s.LiteralKind.STRING)return e.error(i.DiagnosticCode.String_literal_expected,n[0].range),S.unreachable();let r=n[0].value,a=c.members?c.members.get(r):null;if(!a||a.kind!=l.ElementKind.FIELD)return e.error(i.DiagnosticCode.Type_0_has_no_property_1,n[0].range,c.internalName,r),S.unreachable();t=a.memoryOffset}else t=c.currentMemoryOffset;return e.options.isWasm64?p.is(4)&&p.size<=32?(e.currentType=a.Type.u32,S.i32(t)):S.i64(t):p.is(4)&&64==p.size?(e.currentType=a.Type.u64,S.i64(t)):S.i32(t)}case h.nameof:{let t,i=g(e,r,n,d);if(!i)return e.currentType=e.program.stringInstance.type,S.unreachable();if(i.is(256)){let e=i.classReference;if(e)t=e.name;else{t=i.signatureReference?"Function":"Anyref"}}else switch(i.kind){case 10:t="bool";break;case 0:t="i8";break;case 5:t="u8";break;case 1:t="i16";break;case 6:t="u16";break;case 2:t="i32";break;case 7:t="u32";break;case 11:t="f32";break;case 3:t="i64";break;case 8:t="u64";break;case 12:t="f64";break;case 4:t="isize";break;case 9:t="usize";break;case 13:t="v128";break;case 14:t="anyref";break;default:assert(!1);case 15:t="void"}return e.ensureStaticString(t)}case h.clz:{if(x(r,d,e,!0)|A(n,1,d,e))return S.unreachable();let t=r?e.compileExpression(n[0],r[0],5):e.compileExpression(n[0],a.Type.i32,4),s=e.currentType;if(!s.is(256))switch(s.kind){case 10:case 0:case 5:case 1:case 6:case 2:case 7:return S.unary(o.UnaryOp.ClzI32,t);case 9:case 4:return S.unary(e.options.isWasm64?o.UnaryOp.ClzI64:o.UnaryOp.ClzI32,t);case 3:case 8:return S.unary(o.UnaryOp.ClzI64,t)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"clz",s.toString()),S.unreachable()}case h.ctz:{if(x(r,d,e,!0)|A(n,1,d,e))return S.unreachable();let t=r?e.compileExpression(n[0],r[0],5):e.compileExpression(n[0],a.Type.i32,4),s=e.currentType;if(!s.is(256))switch(s.kind){case 10:case 0:case 5:case 1:case 6:case 2:case 7:return S.unary(o.UnaryOp.CtzI32,t);case 9:case 4:return S.unary(e.options.isWasm64?o.UnaryOp.CtzI64:o.UnaryOp.CtzI32,t);case 3:case 8:return S.unary(o.UnaryOp.CtzI64,t)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"ctz",s.toString()),S.unreachable()}case h.popcnt:{if(x(r,d,e,!0)|A(n,1,d,e))return S.unreachable();let t=r?e.compileExpression(n[0],r[0],5):e.compileExpression(n[0],a.Type.i32,4),s=e.currentType;if(!s.is(256))switch(e.currentType.kind){case 10:case 0:case 5:case 1:case 6:case 2:case 7:return S.unary(o.UnaryOp.PopcntI32,t);case 3:case 8:return S.unary(o.UnaryOp.PopcntI64,t);case 4:case 9:return S.unary(e.options.isWasm64?o.UnaryOp.PopcntI64:o.UnaryOp.PopcntI32,t)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"popcnt",s.toString()),S.unreachable()}case h.rotl:{if(x(r,d,e,!0)|A(n,2,d,e))return S.unreachable();let t=r?e.compileExpression(n[0],r[0],5):e.compileExpression(n[0],a.Type.i32,4),s=e.currentType;if(!s.is(256)){let r=e.compileExpression(n[1],s,1);switch(s.kind){case 0:case 1:case 5:case 6:case 10:return e.ensureSmallIntegerWrap(S.binary(o.BinaryOp.RotlI32,t,r),s);case 2:case 7:return S.binary(o.BinaryOp.RotlI32,t,r);case 9:case 4:return S.binary(e.options.isWasm64?o.BinaryOp.RotlI64:o.BinaryOp.RotlI32,t,r);case 3:case 8:return S.binary(o.BinaryOp.RotlI64,t,r)}}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"rotl",s.toString()),S.unreachable()}case h.rotr:{if(x(r,d,e,!0)|A(n,2,d,e))return S.unreachable();let t=r?e.compileExpression(n[0],r[0],5):e.compileExpression(n[0],a.Type.i32,4),s=e.currentType;if(!s.is(256)){let r=e.compileExpression(n[1],s,1);switch(s.kind){case 0:case 1:case 5:case 6:case 10:return e.ensureSmallIntegerWrap(S.binary(o.BinaryOp.RotrI32,t,r),s);case 2:case 7:return S.binary(o.BinaryOp.RotrI32,t,r);case 9:case 4:return S.binary(e.options.isWasm64?o.BinaryOp.RotrI64:o.BinaryOp.RotrI32,t,r);case 3:case 8:return S.binary(o.BinaryOp.RotrI64,t,r)}}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"rotr",s.toString()),S.unreachable()}case h.abs:{if(x(r,d,e,!0)|A(n,1,d,e))return S.unreachable();let t=r?e.compileExpression(n[0],r[0],5):e.compileExpression(n[0],a.Type.auto,4),s=e.currentType;if(!s.is(256))switch(s.kind){case 0:case 1:case 2:{let r=e.currentFlow,n=r.getTempLocal(a.Type.i32),i=r.getTempLocal(a.Type.i32),s=S.binary(o.BinaryOp.XorI32,S.binary(o.BinaryOp.AddI32,S.local_tee(i.index,S.binary(o.BinaryOp.ShrI32,S.local_tee(n.index,t),S.i32(31))),S.local_get(n.index,o.NativeType.I32)),S.local_get(i.index,o.NativeType.I32));return r.freeTempLocal(i),r.freeTempLocal(n),s}case 4:{let r=e.options,n=e.currentFlow,i=r.isWasm64,s=n.getTempLocal(r.usizeType),a=n.getTempLocal(r.usizeType),l=S.binary(i?o.BinaryOp.XorI64:o.BinaryOp.XorI32,S.binary(i?o.BinaryOp.AddI64:o.BinaryOp.AddI32,S.local_tee(a.index,S.binary(i?o.BinaryOp.ShrI64:o.BinaryOp.ShrI32,S.local_tee(s.index,t),i?S.i64(63):S.i32(31))),S.local_get(s.index,r.nativeSizeType)),S.local_get(a.index,r.nativeSizeType));return n.freeTempLocal(a),n.freeTempLocal(s),l}case 3:{let r=e.currentFlow,n=r.getTempLocal(a.Type.i64),i=r.getTempLocal(a.Type.i64),s=S.binary(o.BinaryOp.XorI64,S.binary(o.BinaryOp.AddI64,S.local_tee(i.index,S.binary(o.BinaryOp.ShrI64,S.local_tee(n.index,t),S.i64(63))),S.local_get(n.index,o.NativeType.I64)),S.local_get(i.index,o.NativeType.I64));return r.freeTempLocal(i),r.freeTempLocal(n),s}case 9:case 5:case 6:case 7:case 8:case 10:return t;case 11:return S.unary(o.UnaryOp.AbsF32,t);case 12:return S.unary(o.UnaryOp.AbsF64,t)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"abs",s.toString()),S.unreachable()}case h.max:{if(x(r,d,e,!0)|A(n,2,d,e))return S.unreachable();let t=n[0],l=r?e.compileExpression(t,r[0],5):e.compileExpression(n[0],a.Type.auto,4),u=e.currentType;if(!u.is(256)){let i;!r&&s.isNumericLiteral(t)?(i=e.compileExpression(n[1],u,4),e.currentType!=u&&(l=e.compileExpression(t,u=e.currentType,5))):i=e.compileExpression(n[1],u,5);let a=-1;switch(u.kind){case 0:case 1:case 2:a=o.BinaryOp.GtI32;break;case 5:case 6:case 7:case 10:a=o.BinaryOp.GtU32;break;case 3:a=o.BinaryOp.GtI64;break;case 8:a=o.BinaryOp.GtU64;break;case 4:a=e.options.isWasm64?o.BinaryOp.GtI64:o.BinaryOp.GtI32;break;case 9:a=e.options.isWasm64?o.BinaryOp.GtU64:o.BinaryOp.GtU32;break;case 11:return S.binary(o.BinaryOp.MaxF32,l,i);case 12:return S.binary(o.BinaryOp.MaxF64,l,i)}if(-1!=a){let t=e.currentFlow,r=u.toNativeType(),n=t.getTempLocal(u);t.setLocalFlag(n.index,c.LocalFlags.WRAPPED);let s=t.getTempLocal(u);t.setLocalFlag(s.index,c.LocalFlags.WRAPPED);let o=S.select(S.local_tee(n.index,l),S.local_tee(s.index,i),S.binary(a,S.local_get(n.index,r),S.local_get(s.index,r)));return t.freeTempLocal(s),t.freeTempLocal(n),o}}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"max",u.toString()),S.unreachable()}case h.min:{if(x(r,d,e,!0)|A(n,2,d,e))return S.unreachable();let t=n[0],l=r?e.compileExpression(t,r[0],5):e.compileExpression(n[0],a.Type.auto,4),u=e.currentType;if(!u.is(256)){let i;!r&&s.isNumericLiteral(t)?(i=e.compileExpression(n[1],u,4),e.currentType!=u&&(l=e.compileExpression(t,u=e.currentType,5))):i=e.compileExpression(n[1],u,5);let a=-1;switch(u.kind){case 0:case 1:case 2:a=o.BinaryOp.LtI32;break;case 5:case 6:case 7:case 10:a=o.BinaryOp.LtU32;break;case 3:a=o.BinaryOp.LtI64;break;case 8:a=o.BinaryOp.LtU64;break;case 4:a=e.options.isWasm64?o.BinaryOp.LtI64:o.BinaryOp.LtI32;break;case 9:a=e.options.isWasm64?o.BinaryOp.LtU64:o.BinaryOp.LtU32;break;case 11:return S.binary(o.BinaryOp.MinF32,l,i);case 12:return S.binary(o.BinaryOp.MinF64,l,i)}if(-1!=a){let t=e.currentFlow,r=u.toNativeType(),n=t.getTempLocal(u);t.setLocalFlag(n.index,c.LocalFlags.WRAPPED);let s=t.getTempLocal(u);t.setLocalFlag(s.index,c.LocalFlags.WRAPPED);let o=S.select(S.local_tee(n.index,l),S.local_tee(s.index,i),S.binary(a,S.local_get(n.index,r),S.local_get(s.index,r)));return t.freeTempLocal(s),t.freeTempLocal(n),o}}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"min",u.toString()),S.unreachable()}case h.ceil:{if(x(r,d,e,!0)|A(n,1,d,e))return S.unreachable();let t=r?e.compileExpression(n[0],r[0],1):e.compileExpression(n[0],a.Type.auto,0),s=e.currentType;if(!s.is(256))switch(s.kind){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:return t;case 11:return S.unary(o.UnaryOp.CeilF32,t);case 12:return S.unary(o.UnaryOp.CeilF64,t)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"ceil",s.toString()),S.unreachable()}case h.floor:{if(x(r,d,e,!0)|A(n,1,d,e))return S.unreachable();let t=r?e.compileExpression(n[0],r[0],1):e.compileExpression(n[0],a.Type.auto,0),s=e.currentType;if(!s.is(256))switch(s.kind){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:return t;case 11:return S.unary(o.UnaryOp.FloorF32,t);case 12:return S.unary(o.UnaryOp.FloorF64,t)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"floor",s.toString()),S.unreachable()}case h.copysign:{if(x(r,d,e,!0)|A(n,2,d,e))return S.unreachable();let t=r?e.compileExpression(n[0],r[0],1):e.compileExpression(n[0],a.Type.f64,0),s=e.currentType;if(!s.is(256)){let r=e.compileExpression(n[1],s,1);switch(s.kind){case 11:return S.binary(o.BinaryOp.CopysignF32,t,r);case 12:return S.binary(o.BinaryOp.CopysignF64,t,r)}}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"copysign",s.toString()),S.unreachable()}case h.nearest:{if(x(r,d,e,!0)|A(n,1,d,e))return S.unreachable();let t=r?e.compileExpression(n[0],r[0],1):e.compileExpression(n[0],a.Type.auto,0),s=e.currentType;if(!s.is(256))switch(s.kind){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:return t;case 11:return S.unary(o.UnaryOp.NearestF32,t);case 12:return S.unary(o.UnaryOp.NearestF64,t)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"nearest",s.toString()),S.unreachable()}case h.reinterpret:{if(I(r,d,e,!0)|A(n,1,d,e))return S.unreachable();let t=r[0];if(!t.is(256))switch(t.kind){case 2:case 7:{let r=e.compileExpression(n[0],a.Type.f32,1);return e.currentType=t,S.unary(o.UnaryOp.ReinterpretF32,r)}case 3:case 8:{let r=e.compileExpression(n[0],a.Type.f64,1);return e.currentType=t,S.unary(o.UnaryOp.ReinterpretF64,r)}case 4:case 9:{let r=e.compileExpression(n[0],e.options.isWasm64?a.Type.f64:a.Type.f32,1);return e.currentType=t,S.unary(e.options.isWasm64?o.UnaryOp.ReinterpretF64:o.UnaryOp.ReinterpretF32,r)}case 11:{let t=e.compileExpression(n[0],a.Type.i32,1);return e.currentType=a.Type.f32,S.unary(o.UnaryOp.ReinterpretI32,t)}case 12:{let t=e.compileExpression(n[0],a.Type.i64,1);return e.currentType=a.Type.f64,S.unary(o.UnaryOp.ReinterpretI64,t)}}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"reinterpret",t.toString()),S.unreachable()}case h.sqrt:{if(x(r,d,e,!0)|A(n,1,d,e))return S.unreachable();let t=r?e.compileExpression(n[0],r[0],1):e.compileExpression(n[0],a.Type.f64,0),s=e.currentType;if(!s.is(256))switch(s.kind){case 11:return S.unary(o.UnaryOp.SqrtF32,t);case 12:return S.unary(o.UnaryOp.SqrtF64,t)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"sqrt",s.toString()),S.unreachable()}case h.trunc:{if(x(r,d,e,!0)|A(n,1,d,e))return S.unreachable();let t=r?e.compileExpression(n[0],r[0],1):e.compileExpression(n[0],a.Type.auto,0),s=e.currentType;if(!s.is(256))switch(s.kind){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:return t;case 11:return S.unary(o.UnaryOp.TruncF32,t);case 12:return S.unary(o.UnaryOp.TruncF64,t)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"trunc",s.toString()),S.unreachable()}case h.load:{if(I(r,d,e,!0)|N(n,1,3,d,e))return S.unreachable();let t,s=r[0],o=p!=a.Type.auto&&s.is(4)&&p.is(4)&&p.size>s.size?p:s,l=e.compileExpression(n[0],e.options.usizeType,1),c=n.length,u=c>=2?E(n[1],e):0;if(u<0)return e.currentType=o,S.unreachable();let h=s.byteSize;if(3==c){if((t=E(n[2],e))<0)return e.currentType=o,S.unreachable();if(t>h)return e.error(i.DiagnosticCode._0_must_be_a_value_between_1_and_2_inclusive,n[2].range,"Alignment","0",h.toString()),e.currentType=o,S.unreachable();if(!_.isPowerOf2(t))return e.error(i.DiagnosticCode._0_must_be_a_power_of_two,n[2].range,"Alignment"),e.currentType=o,S.unreachable()}else t=h;return e.currentType=o,S.load(s.byteSize,s.is(5),l,o.toNativeType(),u,t)}case h.store:{if(e.currentType=a.Type.void,I(r,d,e)|N(n,2,4,d,e))return S.unreachable();let t=r[0],s=e.compileExpression(n[0],e.options.usizeType,1),o=m?e.compileExpression(n[1],p,1):e.compileExpression(n[1],t,t.is(4)?0:1),l=e.currentType;t.is(4)&&(!l.is(4)||l.size<t.size)&&(o=e.convertExpression(o,l,t,!1,!1,n[1]),l=t);let c,u=n.length>=3?E(n[2],e):0;if(u<0)return e.currentType=a.Type.void,S.unreachable();let h=t.byteSize;if(4==n.length){if((c=E(n[3],e))<0)return e.currentType=a.Type.void,S.unreachable();if(c>h)return e.error(i.DiagnosticCode._0_must_be_a_value_between_1_and_2_inclusive,n[3].range,"Alignment","0",h.toString()),e.currentType=a.Type.void,S.unreachable();if(!_.isPowerOf2(c))return e.error(i.DiagnosticCode._0_must_be_a_power_of_two,n[3].range,"Alignment"),e.currentType=a.Type.void,S.unreachable()}else c=h;return e.currentType=a.Type.void,S.store(t.byteSize,s,o,l.toNativeType(),u,c)}case h.atomic_load:{if(f(32,d,e)|I(r,d,e,!0)|N(n,1,2,d,e))return S.unreachable();let t=r[0],s=t.is(4)&&p.is(4)&&p.size>t.size?p:t;if(!t.is(4))return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"atomic.load",t.toString()),e.currentType=s,S.unreachable();let a=e.compileExpression(n[0],e.options.usizeType,1),o=2==n.length?E(n[1],e):0;return o<0?(e.currentType=s,S.unreachable()):(e.currentType=s,S.atomic_load(t.byteSize,a,s.toNativeType(),o))}case h.atomic_store:{if(f(32,d,e)|I(r,d,e)|N(n,2,3,d,e))return S.unreachable();let t=r[0];if(!t.is(4))return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"atomic.store",t.toString()),e.currentType=a.Type.void,S.unreachable();let s=e.compileExpression(n[0],e.options.usizeType,1),o=m?e.compileExpression(n[1],p,1):e.compileExpression(n[1],t,t.is(4)?0:1),l=e.currentType;t.is(4)&&(!l.is(4)||l.size<t.size)&&(o=e.convertExpression(o,l,t,!1,!1,n[1]),l=t);let c=3==n.length?E(n[2],e):0;return c<0?(e.currentType=a.Type.void,S.unreachable()):(e.currentType=a.Type.void,S.atomic_store(t.byteSize,s,o,l.toNativeType(),c))}case h.atomic_add:case h.atomic_sub:case h.atomic_and:case h.atomic_or:case h.atomic_xor:case h.atomic_xchg:{if(f(32,d,e)|I(r,d,e,!0)|N(n,2,3,d,e))return S.unreachable();let s=r[0];if(!s.is(4)||s.size<8){let r;switch(t.internalName){default:assert(!1);case h.atomic_add:r="atomic.add";break;case h.atomic_sub:r="atomic.sub";break;case h.atomic_and:r="atomic.and";break;case h.atomic_or:r="atomic.or";break;case h.atomic_xor:r="atomic.xor";break;case h.atomic_xchg:r="atomic.xchg"}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,r,s.toString()),S.unreachable()}let a=e.compileExpression(n[0],e.options.usizeType,1),l=m?e.compileExpression(n[1],p,1):e.compileExpression(n[1],s,s.is(4)?0:1),c=e.currentType;s.is(4)&&(!c.is(4)||c.size<s.size)&&(l=e.convertExpression(l,c,s,!1,!1,n[1]),c=s);let u,_=3==n.length?E(n[2],e):0;if(_<0)return e.currentType=c,S.unreachable();switch(t.internalName){default:assert(!1);case h.atomic_add:u=o.AtomicRMWOp.Add;break;case h.atomic_sub:u=o.AtomicRMWOp.Sub;break;case h.atomic_and:u=o.AtomicRMWOp.And;break;case h.atomic_or:u=o.AtomicRMWOp.Or;break;case h.atomic_xor:u=o.AtomicRMWOp.Xor;break;case h.atomic_xchg:u=o.AtomicRMWOp.Xchg}return e.currentType=c,S.atomic_rmw(u,s.byteSize,_,a,l,c.toNativeType())}case h.atomic_cmpxchg:{if(f(32,d,e)|I(r,d,e,!0)|N(n,3,4,d,e))return S.unreachable();let t=r[0];if(!t.is(4)||t.size<8)return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"atomic.cmpxchg",t.toString()),S.unreachable();let s=e.compileExpression(n[0],e.options.usizeType,1),a=m?e.compileExpression(n[1],p,1):e.compileExpression(n[1],t,t.is(4)?0:1),o=e.currentType,l=e.compileExpression(n[2],o,1);t.is(4)&&(!o.is(4)||o.size<t.size)&&(a=e.convertExpression(a,o,t,!1,!1,n[1]),l=e.convertExpression(l,o,t,!1,!1,n[2]),o=t);let c=4==n.length?E(n[3],e):0;return c<0?(e.currentType=o,S.unreachable()):(e.currentType=o,S.atomic_cmpxchg(t.byteSize,c,s,a,l,o.toNativeType()))}case h.atomic_wait:{if(f(32,d,e)|I(r,d,e)|A(n,3,d,e))return e.currentType=a.Type.i32,S.unreachable();let t=r[0],s=e.compileExpression(n[0],e.options.usizeType,1),o=e.compileExpression(n[1],t,1),l=e.compileExpression(n[2],a.Type.i64,1);switch(e.currentType=a.Type.i32,t.kind){case 2:case 3:case 4:case 7:case 8:case 9:return S.atomic_wait(s,o,l,t.toNativeType())}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"atomic.wait",t.toString()),S.unreachable()}case h.atomic_notify:{if(f(32,d,e)|b(r,d,t)|A(n,2,d,e))return e.currentType=a.Type.i32,S.unreachable();let i=e.compileExpression(n[0],e.options.usizeType,1),s=e.compileExpression(n[1],a.Type.i32,1);return e.currentType=a.Type.i32,S.atomic_notify(i,s)}case h.atomic_fence:return e.currentType=a.Type.void,f(32,d,e)|b(r,d,t)|A(n,0,d,e)?S.unreachable():S.atomic_fence();case h.select:{if(x(r,d,e,!0)|A(n,3,d,e))return S.unreachable();let t=r?e.compileExpression(n[0],r[0],1):e.compileExpression(n[0],a.Type.auto),s=e.currentType;if(!s.isAny(384))return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"select",s.toString()),S.unreachable();let o=e.compileExpression(n[1],s,1),l=e.makeIsTrueish(e.compileExpression(n[2],a.Type.bool),e.currentType);return e.currentType=s,S.select(t,o,l)}case h.unreachable:return r&&e.error(i.DiagnosticCode.Type_0_is_not_generic,d.typeArgumentsRange,t.internalName),A(n,0,d,e),S.unreachable();case h.memory_size:return e.currentType=a.Type.i32,b(r,d,t)|A(n,0,d,e)?S.unreachable():S.host(o.HostOp.MemorySize);case h.memory_grow:return e.currentType=a.Type.i32,b(r,d,t)|A(n,1,d,e)?S.unreachable():S.host(o.HostOp.MemoryGrow,null,[e.compileExpression(n[0],a.Type.i32,1)]);case h.memory_copy:{if(e.currentType=a.Type.void,b(r,d,t)|A(n,3,d,e))return S.unreachable();if(!e.options.hasFeature(8)){let r=e.resolver.resolveFunction(t,null);return e.currentType=a.Type.void,r?e.compileCallDirect(r,n,d):S.unreachable()}let i=e.options.usizeType,s=e.compileExpression(n[0],i,1),o=e.compileExpression(n[1],i,1),l=e.compileExpression(n[2],i,1);return e.currentType=a.Type.void,S.memory_copy(s,o,l)}case h.memory_fill:{if(e.currentType=a.Type.void,b(r,d,t)|A(n,3,d,e))return S.unreachable();if(!e.options.hasFeature(8)){let r=e.resolver.resolveFunction(t,null);return e.currentType=a.Type.void,r?e.compileCallDirect(r,n,d):S.unreachable()}let i=e.options.usizeType,s=e.compileExpression(n[0],i,1),o=e.compileExpression(n[1],a.Type.u8,1),l=e.compileExpression(n[2],i,1);return e.currentType=a.Type.void,S.memory_fill(s,o,l)}case h.changetype:{if(I(r,d,e,!0)|A(n,1,d,e))return S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.auto),o=e.currentType;return e.currentType=t,o.isChangeableTo(t)?s:(e.error(i.DiagnosticCode.Type_0_cannot_be_changed_to_type_1,d.range,o.toString(),t.toString()),S.unreachable())}case h.assert:{if(x(r,d,e)|N(n,1,2,d,e))return r&&(assert(r.length),e.currentType=r[0].nonNullableType),S.unreachable();let t=r?e.compileExpression(n[0],r[0],5):e.compileExpression(n[0],a.Type.bool,4),s=e.currentType;if(e.currentType=s.nonNullableType,o.getExpressionId(t=S.precomputeExpression(t))==o.ExpressionId.Const)switch(o.getExpressionType(t)){case o.NativeType.I32:if(0!=o.getConstValueI32(t))return p==a.Type.void?(e.currentType=a.Type.void,S.nop()):t;break;case o.NativeType.I64:if(0!=o.getConstValueI64Low(t)||0!=o.getConstValueI64High(t))return p==a.Type.void?(e.currentType=a.Type.void,S.nop()):t;break;case o.NativeType.F32:if(0!=o.getConstValueF32(t))return p==a.Type.void?(e.currentType=a.Type.void,S.nop()):t;break;case o.NativeType.F64:if(0!=o.getConstValueF64(t))return p==a.Type.void?(e.currentType=a.Type.void,S.nop()):t}if(e.options.noAssert)return p==a.Type.void?(e.currentType=a.Type.void,S.nop()):t;let l=T(e,2==n.length?n[1]:null,d);if(e.currentType=s.nonNullableType,p==a.Type.void)switch(e.currentType=a.Type.void,s.kind){case 0:case 1:case 2:case 5:case 6:case 7:case 10:return S.if(S.unary(o.UnaryOp.EqzI32,t),l);case 3:case 8:return S.if(S.unary(o.UnaryOp.EqzI64,t),l);case 4:case 9:return S.if(S.unary(e.options.isWasm64?o.UnaryOp.EqzI64:o.UnaryOp.EqzI32,t),l);case 11:return S.if(S.binary(o.BinaryOp.EqF32,t,S.f32(0)),l);case 12:return S.if(S.binary(o.BinaryOp.EqF64,t,S.f64(0)),l)}else{e.currentType=s.nonNullableType;let r=e.currentFlow;switch(e.currentType.kind){case 0:case 1:case 2:case 5:case 6:case 7:case 10:{let e=r.getTempLocal(s);r.setLocalFlag(e.index,c.LocalFlags.WRAPPED);let n=S.if(S.local_tee(e.index,t),S.local_get(e.index,o.NativeType.I32),l);return r.freeTempLocal(e),n}case 3:case 8:{let e=r.getTempLocal(a.Type.i64),n=S.if(S.unary(o.UnaryOp.EqzI64,S.local_tee(e.index,t)),l,S.local_get(e.index,o.NativeType.I64));return r.freeTempLocal(e),n}case 4:case 9:{let n=r.getTempLocal(e.options.usizeType),i=S.if(S.unary(e.options.isWasm64?o.UnaryOp.EqzI64:o.UnaryOp.EqzI32,S.local_tee(n.index,t)),l,S.local_get(n.index,e.options.nativeSizeType));return r.freeTempLocal(n),i}case 11:{let e=r.getTempLocal(a.Type.f32),n=S.if(S.binary(o.BinaryOp.EqF32,S.local_tee(e.index,t),S.f32(0)),l,S.local_get(e.index,o.NativeType.F32));return r.freeTempLocal(e),n}case 12:{let e=r.getTempLocal(a.Type.f64),n=S.if(S.binary(o.BinaryOp.EqF64,S.local_tee(e.index,t),S.f64(0)),l,S.local_get(e.index,o.NativeType.F64));return r.freeTempLocal(e),n}}}return e.error(i.DiagnosticCode.Not_implemented,d.typeArgumentsRange),l}case h.unchecked:{if(b(r,d,t)|A(n,1,d,e))return S.unreachable();let i=e.currentFlow,s=i.is(65536);i.set(65536);let a=e.compileExpression(n[0],p);return s||i.unset(65536),a}case h.call_direct:case h.call_indirect:{if(x(r,d,e,!0)|N(n,1,i32.MAX_VALUE,d,e))return S.unreachable();let s=r?r[0]:p,l=e.compileExpression(n[0],a.Type.u32),c=e.currentType;if(!(c==a.Type.u32||7==c.kind&&c.signatureReference))return e.error(i.DiagnosticCode.Type_0_is_not_a_function_index_or_function_reference,n[0].range,c.toString()),S.unreachable();let u=n.length-1,_=new Array(u),y=s.toNativeType(),T=new Array(u),m=new Array(u);for(let t=0;t<u;++t){_[t]=e.compileExpression(n[1+t],a.Type.i32);let r=e.currentType;T[t]=r,m[t]=r.toNativeType()}let g=a.Signature.makeSignatureString(T,s),E=S.getFunctionTypeBySignature(y,m);if(E||(E=S.addFunctionType(g,y,m)),e.currentType=s,t.internalName==h.call_direct){if(o.getExpressionId(l=S.precomputeExpression(l))==o.ExpressionId.Const){assert(o.getExpressionType(l)==o.NativeType.I32);let t=o.getConstValueI32(l),r=e.functionTable;if(t>=0&&t<r.length)return S.call(r[t],_,y)}return e.error(i.DiagnosticCode.Expression_must_be_a_compile_time_constant,n[0].range),S.unreachable()}return S.call_indirect(l,_,g)}case h.instantiate:{if(I(r,d,e,!0))return S.unreachable();let t=r[0],s=t.classReference;return t.is(256)&&null!==s?(e.currentType=s.type,e.compileInstantiate(s,n,0,d)):(e.error(i.DiagnosticCode.This_expression_is_not_constructable,d.expression.range),S.unreachable())}case h.ERROR:return b(r,d,t),e.error(i.DiagnosticCode.User_defined_0,d.range,(n.length?n[0]:d).range.toString()),S.unreachable();case h.WARNING:return b(r,d,t),e.warning(i.DiagnosticCode.User_defined_0,d.range,(n.length?n[0]:d).range.toString()),S.nop();case h.INFO:return b(r,d,t),e.info(i.DiagnosticCode.User_defined_0,d.range,(n.length?n[0]:d).range.toString()),S.nop();case h.i8:return b(r,d,t)|A(n,1,d,e)?(e.currentType=a.Type.i8,S.unreachable()):e.compileExpression(n[0],a.Type.i8,2);case h.i16:return b(r,d,t)|A(n,1,d,e)?(e.currentType=a.Type.i16,S.unreachable()):e.compileExpression(n[0],a.Type.i16,2);case h.i32:return b(r,d,t)|A(n,1,d,e)?(e.currentType=a.Type.i32,S.unreachable()):e.compileExpression(n[0],a.Type.i32,2);case h.i64:return b(r,d,t)|A(n,1,d,e)?(e.currentType=a.Type.i64,S.unreachable()):e.compileExpression(n[0],a.Type.i64,2);case h.isize:{let i=e.options.isizeType;return b(r,d,t)|A(n,1,d,e)?(e.currentType=i,S.unreachable()):e.compileExpression(n[0],i,2)}case h.u8:return b(r,d,t)|A(n,1,d,e)?(e.currentType=a.Type.u8,S.unreachable()):e.compileExpression(n[0],a.Type.u8,2);case h.u16:return b(r,d,t)|A(n,1,d,e)?(e.currentType=a.Type.u16,S.unreachable()):e.compileExpression(n[0],a.Type.u16,2);case h.u32:return b(r,d,t)|A(n,1,d,e)?(e.currentType=a.Type.u32,S.unreachable()):e.compileExpression(n[0],a.Type.u32,2);case h.u64:return b(r,d,t)|A(n,1,d,e)?(e.currentType=a.Type.u64,S.unreachable()):e.compileExpression(n[0],a.Type.u64,2);case h.usize:{let i=e.options.usizeType;return b(r,d,t)|A(n,1,d,e)?(e.currentType=i,S.unreachable()):e.compileExpression(n[0],i,2)}case h.bool:return b(r,d,t)|A(n,1,d,e)?(e.currentType=a.Type.bool,S.unreachable()):e.compileExpression(n[0],a.Type.bool,2);case h.f32:return b(r,d,t)|A(n,1,d,e)?(e.currentType=a.Type.f32,S.unreachable()):e.compileExpression(n[0],a.Type.f32,2);case h.f64:return b(r,d,t)|A(n,1,d,e)?(e.currentType=a.Type.f64,S.unreachable()):e.compileExpression(n[0],a.Type.f64,2);case h.v128:case h.i8x16:{if(f(16,d,e)|b(r,d,t)|A(n,16,d,e))return e.currentType=a.Type.v128,S.unreachable();let s=new Uint8Array(16);for(let t=0;t<16;++t){let r=n[t];if(r){let n=e.precomputeExpression(r,a.Type.i8,1);if(o.getExpressionId(n)!=o.ExpressionId.Const)return e.error(i.DiagnosticCode.Expression_must_be_a_compile_time_constant,r.range),e.currentType=a.Type.v128,S.unreachable();assert(o.getExpressionType(n)==o.NativeType.I32),_.writeI8(o.getConstValueI32(n),s,t)}}return e.currentType=a.Type.v128,S.v128(s)}case h.i16x8:{if(f(16,d,e)|b(r,d,t)|A(n,8,d,e))return e.currentType=a.Type.v128,S.unreachable();let s=new Uint8Array(16);for(let t=0;t<8;++t){let r=n[t];if(r){let n=e.precomputeExpression(r,a.Type.i16,1);if(o.getExpressionId(n)!=o.ExpressionId.Const)return e.error(i.DiagnosticCode.Expression_must_be_a_compile_time_constant,r.range),e.currentType=a.Type.v128,S.unreachable();assert(o.getExpressionType(n)==o.NativeType.I32),_.writeI16(o.getConstValueI32(n),s,t<<1)}}return e.currentType=a.Type.v128,S.v128(s)}case h.i32x4:{if(f(16,d,e)|b(r,d,t)|A(n,4,d,e))return e.currentType=a.Type.v128,S.unreachable();let s=new Uint8Array(16);for(let t=0;t<4;++t){let r=n[t];if(r){let n=e.precomputeExpression(r,a.Type.i32,1);if(o.getExpressionId(n)!=o.ExpressionId.Const)return e.error(i.DiagnosticCode.Expression_must_be_a_compile_time_constant,r.range),e.currentType=a.Type.v128,S.unreachable();assert(o.getExpressionType(n)==o.NativeType.I32),_.writeI32(o.getConstValueI32(n),s,t<<2)}}return e.currentType=a.Type.v128,S.v128(s)}case h.i64x2:{if(f(16,d,e)|b(r,d,t)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let s=new Uint8Array(16);for(let t=0;t<2;++t){let r=n[t];if(r){let n=e.precomputeExpression(r,a.Type.i64,1);if(o.getExpressionId(n)!=o.ExpressionId.Const)return e.error(i.DiagnosticCode.Expression_must_be_a_compile_time_constant,r.range),e.currentType=a.Type.v128,S.unreachable();assert(o.getExpressionType(n)==o.NativeType.I64);let l=t<<3;_.writeI32(o.getConstValueI64Low(n),s,l),_.writeI32(o.getConstValueI64High(n),s,l+4)}}return e.currentType=a.Type.v128,S.v128(s)}case h.f32x4:{if(f(16,d,e)|b(r,d,t)|A(n,4,d,e))return e.currentType=a.Type.v128,S.unreachable();let s=new Uint8Array(16);for(let t=0;t<4;++t){let r=n[t];if(r){let n=e.precomputeExpression(r,a.Type.f32,1);if(o.getExpressionId(n)!=o.ExpressionId.Const)return e.error(i.DiagnosticCode.Expression_must_be_a_compile_time_constant,r.range),e.currentType=a.Type.v128,S.unreachable();assert(o.getExpressionType(n)==o.NativeType.F32),_.writeF32(o.getConstValueF32(n),s,t<<2)}}return e.currentType=a.Type.v128,S.v128(s)}case h.f64x2:{if(f(16,d,e)|b(r,d,t)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let s=new Uint8Array(16);for(let t=0;t<2;++t){let r=n[t];if(r){let n=e.precomputeExpression(r,a.Type.f64,1);if(o.getExpressionId(n)!=o.ExpressionId.Const)return e.error(i.DiagnosticCode.Expression_must_be_a_compile_time_constant,r.range),e.currentType=a.Type.v128,S.unreachable();assert(o.getExpressionType(n)==o.NativeType.F64),_.writeF64(o.getConstValueF64(n),s,t<<3)}}return e.currentType=a.Type.v128,S.v128(s)}case h.v128_splat:{if(f(16,d,e)|I(r,d,e)|A(n,1,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],t,1);if(e.currentType=a.Type.v128,!t.is(256))switch(t.kind){case 0:case 5:return S.unary(o.UnaryOp.SplatI8x16,s);case 1:case 6:return S.unary(o.UnaryOp.SplatI16x8,s);case 2:case 7:return S.unary(o.UnaryOp.SplatI32x4,s);case 3:case 8:return S.unary(o.UnaryOp.SplatI64x2,s);case 4:case 9:return S.unary(e.options.isWasm64?o.UnaryOp.SplatI64x2:o.UnaryOp.SplatI32x4,s);case 11:return S.unary(o.UnaryOp.SplatF32x4,s);case 12:return S.unary(o.UnaryOp.SplatF64x2,s)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.splat",t.toString()),S.unreachable()}case h.v128_extract_lane:{if(f(16,d,e)|I(r,d,e,!0)|A(n,2,d,e))return S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.precomputeExpression(n[1],a.Type.u8,1);e.currentType=t;let c=0;if(o.getExpressionId(l)==o.ExpressionId.Const?(assert(o.getExpressionType(l)==o.NativeType.I32),c=o.getConstValueI32(l)):e.error(i.DiagnosticCode.Expression_must_be_a_compile_time_constant,n[1].range),!t.is(256)){let r=16/assert(t.byteSize)-1;switch((c<0||c>r)&&(e.error(i.DiagnosticCode._0_must_be_a_value_between_1_and_2_inclusive,n[1].range,"Lane index","0",r.toString()),c=0),t.kind){case 0:return S.simd_extract(o.SIMDExtractOp.ExtractLaneI8x16,s,c);case 5:return S.simd_extract(o.SIMDExtractOp.ExtractLaneU8x16,s,c);case 1:return S.simd_extract(o.SIMDExtractOp.ExtractLaneI16x8,s,c);case 6:return S.simd_extract(o.SIMDExtractOp.ExtractLaneU16x8,s,c);case 2:case 7:return S.simd_extract(o.SIMDExtractOp.ExtractLaneI32x4,s,c);case 3:case 8:return S.simd_extract(o.SIMDExtractOp.ExtractLaneI64x2,s,c);case 4:case 9:return S.simd_extract(e.options.isWasm64?o.SIMDExtractOp.ExtractLaneI64x2:o.SIMDExtractOp.ExtractLaneI32x4,s,c);case 11:return S.simd_extract(o.SIMDExtractOp.ExtractLaneF32x4,s,c);case 12:return S.simd_extract(o.SIMDExtractOp.ExtractLaneF64x2,s,c)}}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.extract_lane",t.toString()),S.unreachable()}case h.v128_replace_lane:{if(f(16,d,e)|I(r,d,e)|A(n,3,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.precomputeExpression(n[1],a.Type.u8,1),c=e.compileExpression(n[2],t,1);e.currentType=a.Type.v128;let u=0;if(o.getExpressionId(l)==o.ExpressionId.Const?(assert(o.getExpressionType(l)==o.NativeType.I32),u=o.getConstValueI32(l)):e.error(i.DiagnosticCode.Expression_must_be_a_compile_time_constant,n[1].range),!t.is(256)){let r=16/assert(t.byteSize)-1;switch((u<0||u>r)&&(e.error(i.DiagnosticCode._0_must_be_a_value_between_1_and_2_inclusive,n[1].range,"Lane index","0",r.toString()),u=0),t.kind){case 0:case 5:return S.simd_replace(o.SIMDReplaceOp.ReplaceLaneI8x16,s,u,c);case 1:case 6:return S.simd_replace(o.SIMDReplaceOp.ReplaceLaneI16x8,s,u,c);case 2:case 7:return S.simd_replace(o.SIMDReplaceOp.ReplaceLaneI32x4,s,u,c);case 3:case 8:return S.simd_replace(o.SIMDReplaceOp.ReplaceLaneI64x2,s,u,c);case 4:case 9:return S.simd_replace(e.options.isWasm64?o.SIMDReplaceOp.ReplaceLaneI64x2:o.SIMDReplaceOp.ReplaceLaneI32x4,s,u,c);case 11:return S.simd_replace(o.SIMDReplaceOp.ReplaceLaneF32x4,s,u,c);case 12:return S.simd_replace(o.SIMDReplaceOp.ReplaceLaneF64x2,s,u,c)}}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.replace_lane",t.toString()),S.unreachable()}case h.v128_shuffle:{if(f(16,d,e)|I(r,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0];if(!t.is(256)){let r=t.byteSize,s=16/r;if(assert(isInteger(s)&&_.isPowerOf2(s)),A(n,2+s,d,e))return e.currentType=a.Type.v128,S.unreachable();let l=e.compileExpression(n[0],a.Type.v128,1),c=e.compileExpression(n[1],a.Type.v128,1);switch(t.kind){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 11:case 12:{let t=new Uint8Array(16),u=(s<<1)-1;for(let l=0;l<s;++l){let s=n[2+l],c=e.precomputeExpression(s,a.Type.u8,1);if(o.getExpressionId(c)!=o.ExpressionId.Const)return e.error(i.DiagnosticCode.Expression_must_be_a_compile_time_constant,s.range),e.currentType=a.Type.v128,S.unreachable();assert(o.getExpressionType(c)==o.NativeType.I32);let p=o.getConstValueI32(c);if(p<0||p>u)return e.error(i.DiagnosticCode._0_must_be_a_value_between_1_and_2_inclusive,s.range,"Lane index","0",u.toString()),e.currentType=a.Type.v128,S.unreachable();switch(r){case 1:_.writeI8(p,t,l);break;case 2:{let e=l<<1,r=p<<1;_.writeI8(r,t,e),_.writeI8(r+1,t,e+1);break}case 4:{let e=l<<2,r=p<<2;_.writeI8(r,t,e),_.writeI8(r+1,t,e+1),_.writeI8(r+2,t,e+2),_.writeI8(r+3,t,e+3);break}case 8:{let e=l<<3,r=p<<3;_.writeI8(r,t,e),_.writeI8(r+1,t,e+1),_.writeI8(r+2,t,e+2),_.writeI8(r+3,t,e+3),_.writeI8(r+4,t,e+4),_.writeI8(r+5,t,e+5),_.writeI8(r+6,t,e+6),_.writeI8(r+7,t,e+7);break}default:assert(!1)}}return e.currentType=a.Type.v128,S.simd_shuffle(l,c,t)}}}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.shuffle",t.toString()),e.currentType=a.Type.v128,S.unreachable()}case h.v128_swizzle:{if(f(16,d,e)|b(r,d,t)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let i=e.compileExpression(n[0],a.Type.v128,1),s=e.compileExpression(n[1],a.Type.v128,1);return S.binary(o.BinaryOp.SwizzleV8x16,i,s)}case h.v128_load_splat:{if(f(16,d,e)|I(r,d,e,!0)|N(n,1,3,d,e))return S.unreachable();let t,s=r[0],l=e.compileExpression(n[0],e.options.usizeType,1),c=n.length,u=c>=2?E(n[1],e):0;if(u<0)return e.currentType=a.Type.v128,S.unreachable();let p=s.byteSize;if(3==c){if((t=E(n[2],e))<0)return e.currentType=a.Type.v128,S.unreachable()}else t=p;if(e.currentType=a.Type.v128,!s.is(256)){if(t>p)return e.error(i.DiagnosticCode._0_must_be_a_value_between_1_and_2_inclusive,n[2].range,"Alignment","0",p.toString()),S.unreachable();if(!_.isPowerOf2(t))return e.error(i.DiagnosticCode._0_must_be_a_power_of_two,n[2].range,"Alignment"),S.unreachable();switch(s.kind){case 0:case 5:return S.simd_load(o.SIMDLoadOp.LoadSplatV8x16,l,u,t);case 1:case 6:return S.simd_load(o.SIMDLoadOp.LoadSplatV16x8,l,u,t);case 2:case 7:case 11:return S.simd_load(o.SIMDLoadOp.LoadSplatV32x4,l,u,t);case 4:case 9:if(!e.options.isWasm64)return S.simd_load(o.SIMDLoadOp.LoadSplatV32x4,l,u,t);case 3:case 8:case 12:return S.simd_load(o.SIMDLoadOp.LoadSplatV64x2,l,u,t)}}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.load_splat",s.toString()),S.unreachable()}case h.v128_load_ext:{if(f(16,d,e)|I(r,d,e,!0)|N(n,1,3,d,e))return S.unreachable();let t,s=r[0],l=e.compileExpression(n[0],e.options.usizeType,1),c=n.length,u=c>=2?E(n[1],e):0;if(u<0)return e.currentType=a.Type.v128,S.unreachable();let p=s.byteSize;if(3==c){if((t=E(n[2],e))<0)return e.currentType=a.Type.v128,S.unreachable()}else t=p;if(e.currentType=a.Type.v128,!s.is(256)){if(t>p)return e.error(i.DiagnosticCode._0_must_be_a_value_between_1_and_2_inclusive,n[2].range,"Alignment","0",p.toString()),S.unreachable();if(!_.isPowerOf2(t))return e.error(i.DiagnosticCode._0_must_be_a_power_of_two,n[2].range,"Alignment"),S.unreachable();switch(s.kind){case 0:return S.simd_load(o.SIMDLoadOp.LoadI8ToI16x8,l,u,t);case 5:return S.simd_load(o.SIMDLoadOp.LoadU8ToU16x8,l,u,t);case 1:return S.simd_load(o.SIMDLoadOp.LoadI16ToI32x4,l,u,t);case 6:return S.simd_load(o.SIMDLoadOp.LoadU16ToU32x4,l,u,t);case 4:if(e.options.isWasm64)break;case 2:return S.simd_load(o.SIMDLoadOp.LoadI32ToI64x2,l,u,t);case 9:if(e.options.isWasm64)break;case 7:return S.simd_load(o.SIMDLoadOp.LoadU32ToU64x2,l,u,t)}}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.load_ext",s.toString()),S.unreachable()}case h.v128_add:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:case 5:return S.binary(o.BinaryOp.AddI8x16,s,l);case 1:case 6:return S.binary(o.BinaryOp.AddI16x8,s,l);case 2:case 7:return S.binary(o.BinaryOp.AddI32x4,s,l);case 3:case 8:return S.binary(o.BinaryOp.AddI64x2,s,l);case 4:case 9:return S.binary(e.options.isWasm64?o.BinaryOp.AddI64x2:o.BinaryOp.AddI32x4,s,l);case 11:return S.binary(o.BinaryOp.AddF32x4,s,l);case 12:return S.binary(o.BinaryOp.AddF64x2,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.add",t.toString()),S.unreachable()}case h.v128_sub:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:case 5:return S.binary(o.BinaryOp.SubI8x16,s,l);case 1:case 6:return S.binary(o.BinaryOp.SubI16x8,s,l);case 2:case 7:return S.binary(o.BinaryOp.SubI32x4,s,l);case 3:case 8:return S.binary(o.BinaryOp.SubI64x2,s,l);case 4:case 9:return S.binary(e.options.isWasm64?o.BinaryOp.SubI64x2:o.BinaryOp.SubI32x4,s,l);case 11:return S.binary(o.BinaryOp.SubF32x4,s,l);case 12:return S.binary(o.BinaryOp.SubF64x2,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.sub",t.toString()),S.unreachable()}case h.v128_mul:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:case 5:return S.binary(o.BinaryOp.MulI8x16,s,l);case 1:case 6:return S.binary(o.BinaryOp.MulI16x8,s,l);case 2:case 7:return S.binary(o.BinaryOp.MulI32x4,s,l);case 4:case 9:if(!e.options.isWasm64)return S.binary(o.BinaryOp.MulI32x4,s,l);break;case 11:return S.binary(o.BinaryOp.MulF32x4,s,l);case 12:return S.binary(o.BinaryOp.MulF64x2,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.mul",t.toString()),S.unreachable()}case h.v128_div:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 11:return S.binary(o.BinaryOp.DivF32x4,s,l);case 12:return S.binary(o.BinaryOp.DivF64x2,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.div",t.toString()),S.unreachable()}case h.v128_add_saturate:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:return S.binary(o.BinaryOp.AddSatI8x16,s,l);case 5:return S.binary(o.BinaryOp.AddSatU8x16,s,l);case 1:return S.binary(o.BinaryOp.AddSatI16x8,s,l);case 6:return S.binary(o.BinaryOp.AddSatU16x8,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.add_saturate",t.toString()),S.unreachable()}case h.v128_sub_saturate:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:return S.binary(o.BinaryOp.SubSatI8x16,s,l);case 5:return S.binary(o.BinaryOp.SubSatU8x16,s,l);case 1:return S.binary(o.BinaryOp.SubSatI16x8,s,l);case 6:return S.binary(o.BinaryOp.SubSatU16x8,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.sub_saturate",t.toString()),S.unreachable()}case h.v128_min:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:return S.binary(o.BinaryOp.MinI8x16,s,l);case 5:return S.binary(o.BinaryOp.MinU8x16,s,l);case 1:return S.binary(o.BinaryOp.MinI16x8,s,l);case 6:return S.binary(o.BinaryOp.MinU16x8,s,l);case 4:if(e.options.isWasm64)break;case 2:return S.binary(o.BinaryOp.MinI32x4,s,l);case 9:if(e.options.isWasm64)break;case 7:return S.binary(o.BinaryOp.MinU32x4,s,l);case 11:return S.binary(o.BinaryOp.MinF32x4,s,l);case 12:return S.binary(o.BinaryOp.MinF64x2,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.min",t.toString()),S.unreachable()}case h.v128_max:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:return S.binary(o.BinaryOp.MaxI8x16,s,l);case 5:return S.binary(o.BinaryOp.MaxU8x16,s,l);case 1:return S.binary(o.BinaryOp.MaxI16x8,s,l);case 6:return S.binary(o.BinaryOp.MaxU16x8,s,l);case 4:if(e.options.isWasm64)break;case 2:return S.binary(o.BinaryOp.MaxI32x4,s,l);case 9:if(e.options.isWasm64)break;case 7:return S.binary(o.BinaryOp.MaxU32x4,s,l);case 11:return S.binary(o.BinaryOp.MaxF32x4,s,l);case 12:return S.binary(o.BinaryOp.MaxF64x2,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.max",t.toString()),S.unreachable()}case h.v128_dot:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 1:return S.binary(o.BinaryOp.DotI16x8,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.dot",t.toString()),S.unreachable()}case h.v128_eq:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:case 5:return S.binary(o.BinaryOp.EqI8x16,s,l);case 1:case 6:return S.binary(o.BinaryOp.EqI16x8,s,l);case 2:case 7:return S.binary(o.BinaryOp.EqI32x4,s,l);case 4:case 9:if(!e.options.isWasm64)return S.binary(o.BinaryOp.EqI32x4,s,l);break;case 11:return S.binary(o.BinaryOp.EqF32x4,s,l);case 12:return S.binary(o.BinaryOp.EqF64x2,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.eq",t.toString()),S.unreachable()}case h.v128_ne:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:case 5:return S.binary(o.BinaryOp.NeI8x16,s,l);case 1:case 6:return S.binary(o.BinaryOp.NeI16x8,s,l);case 2:case 7:return S.binary(o.BinaryOp.NeI32x4,s,l);case 4:case 9:if(!e.options.isWasm64)return S.binary(o.BinaryOp.NeI32x4,s,l);break;case 11:return S.binary(o.BinaryOp.NeF32x4,s,l);case 12:return S.binary(o.BinaryOp.NeF64x2,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.ne",t.toString()),S.unreachable()}case h.v128_lt:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:return S.binary(o.BinaryOp.LtI8x16,s,l);case 5:return S.binary(o.BinaryOp.LtU8x16,s,l);case 1:return S.binary(o.BinaryOp.LtI16x8,s,l);case 6:return S.binary(o.BinaryOp.LtU16x8,s,l);case 2:return S.binary(o.BinaryOp.LtI32x4,s,l);case 7:return S.binary(o.BinaryOp.LtU32x4,s,l);case 4:if(!e.options.isWasm64)return S.binary(o.BinaryOp.LtI32x4,s,l);break;case 9:if(!e.options.isWasm64)return S.binary(o.BinaryOp.LtU32x4,s,l);break;case 11:return S.binary(o.BinaryOp.LtF32x4,s,l);case 12:return S.binary(o.BinaryOp.LtF64x2,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.lt",t.toString()),S.unreachable()}case h.v128_le:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:return S.binary(o.BinaryOp.LeI8x16,s,l);case 5:return S.binary(o.BinaryOp.LeU8x16,s,l);case 1:return S.binary(o.BinaryOp.LeI16x8,s,l);case 6:return S.binary(o.BinaryOp.LeU16x8,s,l);case 2:return S.binary(o.BinaryOp.LeI32x4,s,l);case 7:return S.binary(o.BinaryOp.LeU32x4,s,l);case 4:if(!e.options.isWasm64)return S.binary(o.BinaryOp.LeI32x4,s,l);break;case 9:if(!e.options.isWasm64)return S.binary(o.BinaryOp.LeU32x4,s,l);break;case 11:return S.binary(o.BinaryOp.LeF32x4,s,l);case 12:return S.binary(o.BinaryOp.LeF64x2,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.le",t.toString()),S.unreachable()}case h.v128_gt:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:return S.binary(o.BinaryOp.GtI8x16,s,l);case 5:return S.binary(o.BinaryOp.GtU8x16,s,l);case 1:return S.binary(o.BinaryOp.GtI16x8,s,l);case 6:return S.binary(o.BinaryOp.GtU16x8,s,l);case 2:return S.binary(o.BinaryOp.GtI32x4,s,l);case 7:return S.binary(o.BinaryOp.GtU32x4,s,l);case 4:if(!e.options.isWasm64)return S.binary(o.BinaryOp.GtI32x4,s,l);break;case 9:if(!e.options.isWasm64)return S.binary(o.BinaryOp.GtU32x4,s,l);break;case 11:return S.binary(o.BinaryOp.GtF32x4,s,l);case 12:return S.binary(o.BinaryOp.GtF64x2,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.gt",t.toString()),S.unreachable()}case h.v128_ge:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:return S.binary(o.BinaryOp.GeI8x16,s,l);case 5:return S.binary(o.BinaryOp.GeU8x16,s,l);case 1:return S.binary(o.BinaryOp.GeI16x8,s,l);case 6:return S.binary(o.BinaryOp.GeU16x8,s,l);case 2:return S.binary(o.BinaryOp.GeI32x4,s,l);case 7:return S.binary(o.BinaryOp.GeU32x4,s,l);case 4:if(!e.options.isWasm64)return S.binary(o.BinaryOp.GeI32x4,s,l);break;case 9:if(!e.options.isWasm64)return S.binary(o.BinaryOp.GeU32x4,s,l);break;case 11:return S.binary(o.BinaryOp.GeF32x4,s,l);case 12:return S.binary(o.BinaryOp.GeF64x2,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.ge",t.toString()),S.unreachable()}case h.v128_narrow:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 1:return S.binary(o.BinaryOp.NarrowI16x8ToI8x16,s,l);case 6:return S.binary(o.BinaryOp.NarrowU16x8ToU8x16,s,l);case 2:return S.binary(o.BinaryOp.NarrowI32x4ToI16x8,s,l);case 7:return S.binary(o.BinaryOp.NarrowU32x4ToU16x8,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.narrow",t.toString()),S.unreachable()}case h.v128_neg:{if(f(16,d,e)|I(r,d,e)|A(n,1,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:case 5:return S.unary(o.UnaryOp.NegI8x16,s);case 1:case 6:return S.unary(o.UnaryOp.NegI16x8,s);case 2:case 7:return S.unary(o.UnaryOp.NegI32x4,s);case 3:case 8:return S.unary(o.UnaryOp.NegI64x2,s);case 4:case 9:return S.unary(e.options.isWasm64?o.UnaryOp.NegI64x2:o.UnaryOp.NegI32x4,s);case 11:return S.unary(o.UnaryOp.NegF32x4,s);case 12:return S.unary(o.UnaryOp.NegF64x2,s)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.neg",t.toString()),S.unreachable()}case h.v128_abs:{if(f(16,d,e)|I(r,d,e)|A(n,1,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 11:return S.unary(o.UnaryOp.AbsF32x4,s);case 12:return S.unary(o.UnaryOp.AbsF64x2,s)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.abs",t.toString()),S.unreachable()}case h.v128_sqrt:{if(f(16,d,e)|I(r,d,e)|A(n,1,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 11:return S.unary(o.UnaryOp.SqrtF32x4,s);case 12:return S.unary(o.UnaryOp.SqrtF64x2,s)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.sqrt",t.toString()),S.unreachable()}case h.v128_convert:{if(f(16,d,e)|I(r,d,e)|A(n,1,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 2:return S.unary(o.UnaryOp.ConvertI32x4ToF32x4,s);case 7:return S.unary(o.UnaryOp.ConvertU32x4ToF32x4,s);case 3:return S.unary(o.UnaryOp.ConvertI64x2ToF64x2,s);case 8:return S.unary(o.UnaryOp.ConvertU64x2ToF64x2,s)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.convert",t.toString()),S.unreachable()}case h.v128_trunc_sat:{if(f(16,d,e)|I(r,d,e)|A(n,1,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 2:return S.unary(o.UnaryOp.TruncSatF32x4ToI32x4,s);case 7:return S.unary(o.UnaryOp.TruncSatF32x4ToU32x4,s);case 3:return S.unary(o.UnaryOp.TruncSatF64x2ToI64x2,s);case 8:return S.unary(o.UnaryOp.TruncSatF64x2ToU64x2,s)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.trunc_sat",t.toString()),S.unreachable()}case h.v128_widen_low:{if(f(16,d,e)|I(r,d,e)|A(n,1,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:return S.unary(o.UnaryOp.WidenLowI8x16ToI16x8,s);case 5:return S.unary(o.UnaryOp.WidenLowU8x16ToU16x8,s);case 1:return S.unary(o.UnaryOp.WidenLowI16x8ToI32x4,s);case 6:return S.unary(o.UnaryOp.WidenLowU16x8ToU32x4,s)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.widen_low",t.toString()),S.unreachable()}case h.v128_widen_high:{if(f(16,d,e)|I(r,d,e)|A(n,1,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 0:return S.unary(o.UnaryOp.WidenHighI8x16ToI16x8,s);case 5:return S.unary(o.UnaryOp.WidenHighU8x16ToU16x8,s);case 1:return S.unary(o.UnaryOp.WidenHighI16x8ToI32x4,s);case 6:return S.unary(o.UnaryOp.WidenHighU16x8ToU32x4,s)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.widen_high",t.toString()),S.unreachable()}case h.v128_shl:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.i32,1);if(e.currentType=a.Type.v128,!t.is(256))switch(t.kind){case 0:case 5:return S.simd_shift(o.SIMDShiftOp.ShlI8x16,s,l);case 1:case 6:return S.simd_shift(o.SIMDShiftOp.ShlI16x8,s,l);case 2:case 7:return S.simd_shift(o.SIMDShiftOp.ShlI32x4,s,l);case 3:case 8:return S.simd_shift(o.SIMDShiftOp.ShlI64x2,s,l);case 4:case 9:return S.simd_shift(e.options.isWasm64?o.SIMDShiftOp.ShlI64x2:o.SIMDShiftOp.ShlI32x4,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.shl",t.toString()),S.unreachable()}case h.v128_shr:{if(f(16,d,e)|I(r,d,e)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.i32,1);if(e.currentType=a.Type.v128,!t.is(256))switch(t.kind){case 0:return S.simd_shift(o.SIMDShiftOp.ShrI8x16,s,l);case 5:return S.simd_shift(o.SIMDShiftOp.ShrU8x16,s,l);case 1:return S.simd_shift(o.SIMDShiftOp.ShrI16x8,s,l);case 6:return S.simd_shift(o.SIMDShiftOp.ShrU16x8,s,l);case 2:return S.simd_shift(o.SIMDShiftOp.ShrI32x4,s,l);case 7:return S.simd_shift(o.SIMDShiftOp.ShrU32x4,s,l);case 3:return S.simd_shift(o.SIMDShiftOp.ShrI64x2,s,l);case 8:return S.simd_shift(o.SIMDShiftOp.ShrU64x2,s,l);case 4:return S.simd_shift(e.options.isWasm64?o.SIMDShiftOp.ShrI64x2:o.SIMDShiftOp.ShrI32x4,s,l);case 9:return S.simd_shift(e.options.isWasm64?o.SIMDShiftOp.ShrU64x2:o.SIMDShiftOp.ShrU32x4,s,l)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.shr",t.toString()),S.unreachable()}case h.v128_and:{if(f(16,d,e)|b(r,d,t)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let i=e.compileExpression(n[0],a.Type.v128,1),s=e.compileExpression(n[1],a.Type.v128,1);return S.binary(o.BinaryOp.AndV128,i,s)}case h.v128_or:{if(f(16,d,e)|b(r,d,t)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let i=e.compileExpression(n[0],a.Type.v128,1),s=e.compileExpression(n[1],a.Type.v128,1);return S.binary(o.BinaryOp.OrV128,i,s)}case h.v128_xor:{if(f(16,d,e)|b(r,d,t)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let i=e.compileExpression(n[0],a.Type.v128,1),s=e.compileExpression(n[1],a.Type.v128,1);return S.binary(o.BinaryOp.XorV128,i,s)}case h.v128_andnot:{if(f(16,d,e)|b(r,d,t)|A(n,2,d,e))return e.currentType=a.Type.v128,S.unreachable();let i=e.compileExpression(n[0],a.Type.v128,1),s=e.compileExpression(n[1],a.Type.v128,1);return S.binary(o.BinaryOp.AndNotV128,i,s)}case h.v128_not:{if(f(16,d,e)|b(r,d,t)|A(n,1,d,e))return e.currentType=a.Type.v128,S.unreachable();let i=e.compileExpression(n[0],a.Type.v128,1);return S.unary(o.UnaryOp.NotV128,i)}case h.v128_bitselect:{if(f(16,d,e)|b(r,d,t)|A(n,3,d,e))return e.currentType=a.Type.v128,S.unreachable();let i=e.compileExpression(n[0],a.Type.v128,1),s=e.compileExpression(n[1],a.Type.v128,1),l=e.compileExpression(n[2],a.Type.v128,1);return S.simd_ternary(o.SIMDTernaryOp.Bitselect,i,s,l)}case h.v128_any_true:{if(f(16,d,e)|I(r,d,e)|A(n,1,d,e))return e.currentType=a.Type.bool,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1);if(e.currentType=a.Type.bool,!t.is(256))switch(t.kind){case 0:case 5:return S.unary(o.UnaryOp.AnyTrueI8x16,s);case 1:case 6:return S.unary(o.UnaryOp.AnyTrueI16x8,s);case 2:case 7:return S.unary(o.UnaryOp.AnyTrueI32x4,s);case 3:case 8:return S.unary(o.UnaryOp.AnyTrueI64x2,s);case 4:case 9:return S.unary(e.options.isWasm64?o.UnaryOp.AnyTrueI64x2:o.UnaryOp.AnyTrueI32x4,s)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.any_true",t.toString()),S.unreachable()}case h.v128_all_true:{if(f(16,d,e)|I(r,d,e)|A(n,1,d,e))return e.currentType=a.Type.bool,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1);if(e.currentType=a.Type.bool,!t.is(256))switch(t.kind){case 0:case 5:return S.unary(o.UnaryOp.AllTrueI8x16,s);case 1:case 6:return S.unary(o.UnaryOp.AllTrueI16x8,s);case 2:case 7:return S.unary(o.UnaryOp.AllTrueI32x4,s);case 3:case 8:return S.unary(o.UnaryOp.AllTrueI64x2,s);case 4:case 9:return S.unary(e.options.isWasm64?o.UnaryOp.AllTrueI64x2:o.UnaryOp.AllTrueI32x4,s)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.all_true",t.toString()),S.unreachable()}case h.v128_qfma:{if(f(16,d,e)|I(r,d,e)|A(n,3,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1),c=e.compileExpression(n[2],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 11:return S.simd_ternary(o.SIMDTernaryOp.QFMAF32x4,s,l,c);case 12:return S.simd_ternary(o.SIMDTernaryOp.QFMAF64x2,s,l,c)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.qfma",t.toString()),S.unreachable()}case h.v128_qfms:{if(f(16,d,e)|I(r,d,e)|A(n,3,d,e))return e.currentType=a.Type.v128,S.unreachable();let t=r[0],s=e.compileExpression(n[0],a.Type.v128,1),l=e.compileExpression(n[1],a.Type.v128,1),c=e.compileExpression(n[2],a.Type.v128,1);if(!t.is(256))switch(t.kind){case 11:return S.simd_ternary(o.SIMDTernaryOp.QFMSF32x4,s,l,c);case 12:return S.simd_ternary(o.SIMDTernaryOp.QFMSF64x2,s,l,c)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"v128.qfms",t.toString()),S.unreachable()}case h.idof:{let t=g(e,r,n,d);if(e.currentType=a.Type.u32,!t)return S.unreachable();if(t.is(256)){let e=t.signatureReference;if(e)return S.i32(e.id);let r=t.classReference;if(null!==r&&!r.hasDecorator(l.DecoratorFlags.UNMANAGED))return S.i32(r.id)}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"idof",t.toString()),S.unreachable()}case h.visit_globals:{if(b(r,d,t)|A(n,1,d,e))return e.currentType=a.Type.void,S.unreachable();let i=e.compileExpression(n[0],a.Type.u32,1);return e.runtimeFeatures|=4,e.currentType=a.Type.void,S.call(h.visit_globals,[i],o.NativeType.None)}case h.visit_members:{if(b(r,d,t)|A(n,2,d,e))return e.currentType=a.Type.void,S.unreachable();let i=e.compileExpression(n[0],e.options.usizeType,1),s=e.compileExpression(n[1],a.Type.u32,1);return e.runtimeFeatures|=8,e.currentType=a.Type.void,S.call(h.visit_members,[i,s],o.NativeType.None)}case h.isNaN:{if(x(r,d,e)|A(n,1,d,e))return e.currentType=a.Type.bool,S.unreachable();let t=r?e.compileExpression(n[0],r[0],1):e.compileExpression(n[0],a.Type.auto),s=e.currentType;if(e.currentType=a.Type.bool,!s.is(256))switch(s.kind){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:return o.hasSideEffects(t)?S.block(null,[S.drop(t),S.i32(0)],o.NativeType.I32):S.i32(0);case 11:{if(o.getExpressionId(t)==o.ExpressionId.LocalGet)return S.binary(o.BinaryOp.NeF32,t,S.local_get(o.getLocalGetIndex(t),o.NativeType.F32));let r=e.currentFlow,n=r.getTempLocal(a.Type.f32),i=S.binary(o.BinaryOp.NeF32,S.local_tee(n.index,t),S.local_get(n.index,o.NativeType.F32));return r.freeTempLocal(n),i}case 12:{if(o.getExpressionId(t)==o.ExpressionId.LocalGet)return S.binary(o.BinaryOp.NeF64,t,S.local_get(o.getLocalGetIndex(t),o.NativeType.F64));let r=e.currentFlow,n=r.getTempLocal(a.Type.f64),i=S.binary(o.BinaryOp.NeF64,S.local_tee(n.index,t),S.local_get(n.index,o.NativeType.F64));return r.freeTempLocal(n),i}}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"isNaN",s.toString()),S.unreachable()}case h.isFinite:{if(x(r,d,e)|A(n,1,d,e))return e.currentType=a.Type.bool,S.unreachable();let t=r?e.compileExpression(n[0],r[0],1):e.compileExpression(n[0],a.Type.auto),s=e.currentType;if(e.currentType=a.Type.bool,!s.is(256))switch(s.kind){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:return o.hasSideEffects(t)?S.block(null,[S.drop(t),S.i32(1)],o.NativeType.I32):S.i32(1);case 11:{if(o.getExpressionId(t)==o.ExpressionId.LocalGet)return S.binary(o.BinaryOp.EqF32,S.binary(o.BinaryOp.SubF32,t,S.local_get(o.getLocalGetIndex(t),o.NativeType.F32)),S.f32(0));let r=e.currentFlow,n=r.getTempLocal(a.Type.f32),i=S.binary(o.BinaryOp.EqF32,S.binary(o.BinaryOp.SubF32,S.local_tee(n.index,t),S.local_get(n.index,o.NativeType.F32)),S.f32(0));return r.freeTempLocal(n),i}case 12:{if(o.getExpressionId(t)==o.ExpressionId.LocalGet)return S.binary(o.BinaryOp.EqF64,S.binary(o.BinaryOp.SubF64,t,S.local_get(o.getLocalGetIndex(t),o.NativeType.F64)),S.f64(0));let r=e.currentFlow,n=r.getTempLocal(a.Type.f64),i=S.binary(o.BinaryOp.EqF64,S.binary(o.BinaryOp.SubF64,S.local_tee(n.index,t),S.local_get(n.index,o.NativeType.F64)),S.f64(0));return r.freeTempLocal(n),i}}return e.error(i.DiagnosticCode.Operation_0_cannot_be_applied_to_type_1,d.typeArgumentsRange,"isFinite",s.toString()),S.unreachable()}}{let s=function(e,t,r,n){switch(t.internalName){case h.i32_clz:return y(h.clz,e,a.Type.i32,r,a.Type.i32,n);case h.i64_clz:return y(h.clz,e,a.Type.i64,r,a.Type.i64,n);case h.i32_ctz:return y(h.ctz,e,a.Type.i32,r,a.Type.i32,n);case h.i64_ctz:return y(h.ctz,e,a.Type.i64,r,a.Type.i64,n);case h.i32_popcnt:return y(h.popcnt,e,a.Type.i32,r,a.Type.i32,n);case h.i64_popcnt:return y(h.popcnt,e,a.Type.i64,r,a.Type.i64,n);case h.i32_rotl:return y(h.rotl,e,a.Type.i32,r,a.Type.i32,n);case h.i64_rotl:return y(h.rotl,e,a.Type.i64,r,a.Type.i64,n);case h.i32_rotr:return y(h.rotr,e,a.Type.i32,r,a.Type.i32,n);case h.i64_rotr:return y(h.rotr,e,a.Type.i64,r,a.Type.i64,n);case h.f32_abs:return y(h.abs,e,a.Type.f32,r,a.Type.f32,n);case h.f64_abs:return y(h.abs,e,a.Type.f64,r,a.Type.f64,n);case h.f32_max:return y(h.max,e,a.Type.f32,r,a.Type.f32,n);case h.f64_max:return y(h.max,e,a.Type.f64,r,a.Type.f64,n);case h.f32_min:return y(h.min,e,a.Type.f32,r,a.Type.f32,n);case h.f64_min:return y(h.min,e,a.Type.f64,r,a.Type.f64,n);case h.f32_ceil:return y(h.ceil,e,a.Type.f32,r,a.Type.f32,n);case h.f64_ceil:return y(h.ceil,e,a.Type.f64,r,a.Type.f64,n);case h.f32_floor:return y(h.floor,e,a.Type.f32,r,a.Type.f32,n);case h.f64_floor:return y(h.floor,e,a.Type.f64,r,a.Type.f64,n);case h.f32_copysign:return y(h.copysign,e,a.Type.f32,r,a.Type.f32,n);case h.f64_copysign:return y(h.copysign,e,a.Type.f64,r,a.Type.f64,n);case h.f32_nearest:return y(h.nearest,e,a.Type.f32,r,a.Type.f32,n);case h.f64_nearest:return y(h.nearest,e,a.Type.f64,r,a.Type.f64,n);case h.i32_reinterpret_f32:return y(h.reinterpret,e,a.Type.i32,r,a.Type.f32,n);case h.i64_reinterpret_f64:return y(h.reinterpret,e,a.Type.i64,r,a.Type.f64,n);case h.f32_reinterpret_i32:return y(h.reinterpret,e,a.Type.f32,r,a.Type.i32,n);case h.f64_reinterpret_i64:return y(h.reinterpret,e,a.Type.f64,r,a.Type.i64,n);case h.f32_sqrt:return y(h.sqrt,e,a.Type.f32,r,a.Type.f32,n);case h.f64_sqrt:return y(h.sqrt,e,a.Type.f64,r,a.Type.f64,n);case h.f32_trunc:return y(h.trunc,e,a.Type.f32,r,a.Type.f32,n);case h.f64_trunc:return y(h.trunc,e,a.Type.f64,r,a.Type.f64,n);case h.i32_load8_s:return y(h.load,e,a.Type.i8,r,a.Type.i32,n);case h.i32_load8_u:return y(h.load,e,a.Type.u8,r,a.Type.i32,n);case h.i32_load16_s:return y(h.load,e,a.Type.i16,r,a.Type.i32,n);case h.i32_load16_u:return y(h.load,e,a.Type.u16,r,a.Type.i32,n);case h.i32_load:return y(h.load,e,a.Type.i32,r,a.Type.i32,n);case h.i64_load8_s:return y(h.load,e,a.Type.i8,r,a.Type.i64,n);case h.i64_load8_u:return y(h.load,e,a.Type.u8,r,a.Type.i64,n);case h.i64_load16_s:return y(h.load,e,a.Type.i16,r,a.Type.i64,n);case h.i64_load16_u:return y(h.load,e,a.Type.u16,r,a.Type.i64,n);case h.i64_load32_s:return y(h.load,e,a.Type.i32,r,a.Type.i64,n);case h.i64_load32_u:return y(h.load,e,a.Type.u32,r,a.Type.i64,n);case h.i64_load:return y(h.load,e,a.Type.i64,r,a.Type.i64,n);case h.f32_load:return y(h.load,e,a.Type.f32,r,a.Type.f32,n);case h.f64_load:return y(h.load,e,a.Type.f64,r,a.Type.f64,n);case h.i32_store8:return y(h.store,e,a.Type.i8,r,a.Type.i32,n);case h.i32_store16:return y(h.store,e,a.Type.i16,r,a.Type.i32,n);case h.i32_store:return y(h.store,e,a.Type.i32,r,a.Type.i32,n);case h.i64_store8:return y(h.store,e,a.Type.i8,r,a.Type.i64,n);case h.i64_store16:return y(h.store,e,a.Type.i16,r,a.Type.i64,n);case h.i64_store32:return y(h.store,e,a.Type.i32,r,a.Type.i64,n);case h.i64_store:return y(h.store,e,a.Type.i64,r,a.Type.i64,n);case h.f32_store:return y(h.store,e,a.Type.f32,r,a.Type.f32,n);case h.f64_store:return y(h.store,e,a.Type.f64,r,a.Type.f64,n);case h.i32_atomic_load8_u:return y(h.atomic_load,e,a.Type.u8,r,a.Type.i32,n);case h.i32_atomic_load16_u:return y(h.atomic_load,e,a.Type.u16,r,a.Type.i32,n);case h.i32_atomic_load:return y(h.atomic_load,e,a.Type.i32,r,a.Type.i32,n);case h.i64_atomic_load8_u:return y(h.atomic_load,e,a.Type.u8,r,a.Type.i64,n);case h.i64_atomic_load16_u:return y(h.atomic_load,e,a.Type.u16,r,a.Type.i64,n);case h.i64_atomic_load32_u:return y(h.atomic_load,e,a.Type.u32,r,a.Type.i64,n);case h.i64_atomic_load:return y(h.atomic_load,e,a.Type.i64,r,a.Type.i64,n);case h.i32_atomic_store8:return y(h.atomic_store,e,a.Type.u8,r,a.Type.i32,n);case h.i32_atomic_store16:return y(h.atomic_store,e,a.Type.u16,r,a.Type.i32,n);case h.i32_atomic_store:return y(h.atomic_store,e,a.Type.i32,r,a.Type.i32,n);case h.i64_atomic_store8:return y(h.atomic_store,e,a.Type.u8,r,a.Type.i64,n);case h.i64_atomic_store16:return y(h.atomic_store,e,a.Type.u16,r,a.Type.i64,n);case h.i64_atomic_store32:return y(h.atomic_store,e,a.Type.u32,r,a.Type.i64,n);case h.i64_atomic_store:return y(h.atomic_store,e,a.Type.i64,r,a.Type.i64,n);case h.i32_atomic_rmw8_add_u:return y(h.atomic_add,e,a.Type.u8,r,a.Type.i32,n);case h.i32_atomic_rmw16_add_u:return y(h.atomic_add,e,a.Type.u16,r,a.Type.i32,n);case h.i32_atomic_rmw_add:return y(h.atomic_add,e,a.Type.i32,r,a.Type.i32,n);case h.i64_atomic_rmw8_add_u:return y(h.atomic_add,e,a.Type.u8,r,a.Type.i64,n);case h.i64_atomic_rmw16_add_u:return y(h.atomic_add,e,a.Type.u16,r,a.Type.i64,n);case h.i64_atomic_rmw32_add_u:return y(h.atomic_add,e,a.Type.u32,r,a.Type.i64,n);case h.i64_atomic_rmw_add:return y(h.atomic_add,e,a.Type.i64,r,a.Type.i64,n);case h.i32_atomic_rmw8_sub_u:return y(h.atomic_sub,e,a.Type.u8,r,a.Type.i32,n);case h.i32_atomic_rmw16_sub_u:return y(h.atomic_sub,e,a.Type.u16,r,a.Type.i32,n);case h.i32_atomic_rmw_sub:return y(h.atomic_sub,e,a.Type.i32,r,a.Type.i32,n);case h.i64_atomic_rmw8_sub_u:return y(h.atomic_sub,e,a.Type.u8,r,a.Type.i64,n);case h.i64_atomic_rmw16_sub_u:return y(h.atomic_sub,e,a.Type.u16,r,a.Type.i64,n);case h.i64_atomic_rmw32_sub_u:return y(h.atomic_sub,e,a.Type.u32,r,a.Type.i64,n);case h.i64_atomic_rmw_sub:return y(h.atomic_sub,e,a.Type.i64,r,a.Type.i64,n);case h.i32_atomic_rmw8_and_u:return y(h.atomic_and,e,a.Type.u8,r,a.Type.i32,n);case h.i32_atomic_rmw16_and_u:return y(h.atomic_and,e,a.Type.u16,r,a.Type.i32,n);case h.i32_atomic_rmw_and:return y(h.atomic_and,e,a.Type.i32,r,a.Type.i32,n);case h.i64_atomic_rmw8_and_u:return y(h.atomic_and,e,a.Type.u8,r,a.Type.i64,n);case h.i64_atomic_rmw16_and_u:return y(h.atomic_and,e,a.Type.u16,r,a.Type.i64,n);case h.i64_atomic_rmw32_and_u:return y(h.atomic_and,e,a.Type.u32,r,a.Type.i64,n);case h.i64_atomic_rmw_and:return y(h.atomic_and,e,a.Type.i64,r,a.Type.i64,n);case h.i32_atomic_rmw8_or_u:return y(h.atomic_or,e,a.Type.u8,r,a.Type.i32,n);case h.i32_atomic_rmw16_or_u:return y(h.atomic_or,e,a.Type.u16,r,a.Type.i32,n);case h.i32_atomic_rmw_or:return y(h.atomic_or,e,a.Type.i32,r,a.Type.i32,n);case h.i64_atomic_rmw8_or_u:return y(h.atomic_or,e,a.Type.u8,r,a.Type.i64,n);case h.i64_atomic_rmw16_or_u:return y(h.atomic_or,e,a.Type.u16,r,a.Type.i64,n);case h.i64_atomic_rmw32_or_u:return y(h.atomic_or,e,a.Type.u32,r,a.Type.i64,n);case h.i64_atomic_rmw_or:return y(h.atomic_or,e,a.Type.i64,r,a.Type.i64,n);case h.i32_atomic_rmw8_xor_u:return y(h.atomic_xor,e,a.Type.u8,r,a.Type.i32,n);case h.i32_atomic_rmw16_xor_u:return y(h.atomic_xor,e,a.Type.u16,r,a.Type.i32,n);case h.i32_atomic_rmw_xor:return y(h.atomic_xor,e,a.Type.i32,r,a.Type.i32,n);case h.i64_atomic_rmw8_xor_u:return y(h.atomic_xor,e,a.Type.u8,r,a.Type.i64,n);case h.i64_atomic_rmw16_xor_u:return y(h.atomic_xor,e,a.Type.u16,r,a.Type.i64,n);case h.i64_atomic_rmw32_xor_u:return y(h.atomic_xor,e,a.Type.u32,r,a.Type.i64,n);case h.i64_atomic_rmw_xor:return y(h.atomic_xor,e,a.Type.i64,r,a.Type.i64,n);case h.i32_atomic_rmw8_xchg_u:return y(h.atomic_xchg,e,a.Type.u8,r,a.Type.i32,n);case h.i32_atomic_rmw16_xchg_u:return y(h.atomic_xchg,e,a.Type.u16,r,a.Type.i32,n);case h.i32_atomic_rmw_xchg:return y(h.atomic_xchg,e,a.Type.i32,r,a.Type.i32,n);case h.i64_atomic_rmw8_xchg_u:return y(h.atomic_xchg,e,a.Type.u8,r,a.Type.i64,n);case h.i64_atomic_rmw16_xchg_u:return y(h.atomic_xchg,e,a.Type.u16,r,a.Type.i64,n);case h.i64_atomic_rmw32_xchg_u:return y(h.atomic_xchg,e,a.Type.u32,r,a.Type.i64,n);case h.i64_atomic_rmw_xchg:return y(h.atomic_xchg,e,a.Type.i64,r,a.Type.i64,n);case h.i32_atomic_rmw8_cmpxchg_u:return y(h.atomic_cmpxchg,e,a.Type.u8,r,a.Type.i32,n);case h.i32_atomic_rmw16_cmpxchg_u:return y(h.atomic_cmpxchg,e,a.Type.u16,r,a.Type.i32,n);case h.i32_atomic_rmw_cmpxchg:return y(h.atomic_cmpxchg,e,a.Type.i32,r,a.Type.i32,n);case h.i64_atomic_rmw8_cmpxchg_u:return y(h.atomic_cmpxchg,e,a.Type.u8,r,a.Type.i64,n);case h.i64_atomic_rmw16_cmpxchg_u:return y(h.atomic_cmpxchg,e,a.Type.u16,r,a.Type.i64,n);case h.i64_atomic_rmw32_cmpxchg_u:return y(h.atomic_cmpxchg,e,a.Type.u32,r,a.Type.i64,n);case h.i64_atomic_rmw_cmpxchg:return y(h.atomic_cmpxchg,e,a.Type.i64,r,a.Type.i64,n);case h.i32_wait:return y(h.atomic_wait,e,a.Type.i32,r,a.Type.i32,n);case h.i64_wait:return y(h.atomic_wait,e,a.Type.i64,r,a.Type.i32,n);case h.v128_load:return y(h.load,e,a.Type.v128,r,a.Type.v128,n);case h.v128_store:return y(h.store,e,a.Type.v128,r,a.Type.v128,n);case h.i8x16_splat:return y(h.v128_splat,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_extract_lane_s:return y(h.v128_extract_lane,e,a.Type.i8,r,a.Type.i8,n);case h.i8x16_extract_lane_u:return y(h.v128_extract_lane,e,a.Type.u8,r,a.Type.u8,n);case h.i8x16_replace_lane:return y(h.v128_replace_lane,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_add:return y(h.v128_add,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_sub:return y(h.v128_sub,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_mul:return y(h.v128_mul,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_min_s:return y(h.v128_min,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_min_u:return y(h.v128_min,e,a.Type.u8,r,a.Type.v128,n);case h.i8x16_max_s:return y(h.v128_max,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_max_u:return y(h.v128_max,e,a.Type.u8,r,a.Type.v128,n);case h.i8x16_neg:return y(h.v128_neg,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_add_saturate_s:return y(h.v128_add_saturate,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_add_saturate_u:return y(h.v128_add_saturate,e,a.Type.u8,r,a.Type.v128,n);case h.i8x16_sub_saturate_s:return y(h.v128_sub_saturate,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_sub_saturate_u:return y(h.v128_sub_saturate,e,a.Type.u8,r,a.Type.v128,n);case h.i8x16_shl:return y(h.v128_shl,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_shr_s:return y(h.v128_shr,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_shr_u:return y(h.v128_shr,e,a.Type.u8,r,a.Type.v128,n);case h.i8x16_any_true:return y(h.v128_any_true,e,a.Type.i8,r,a.Type.i32,n);case h.i8x16_all_true:return y(h.v128_all_true,e,a.Type.i8,r,a.Type.i32,n);case h.i8x16_eq:return y(h.v128_eq,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_ne:return y(h.v128_ne,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_lt_s:return y(h.v128_lt,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_lt_u:return y(h.v128_lt,e,a.Type.u8,r,a.Type.v128,n);case h.i8x16_le_s:return y(h.v128_le,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_le_u:return y(h.v128_le,e,a.Type.u8,r,a.Type.v128,n);case h.i8x16_gt_s:return y(h.v128_gt,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_gt_u:return y(h.v128_gt,e,a.Type.u8,r,a.Type.v128,n);case h.i8x16_ge_s:return y(h.v128_ge,e,a.Type.i8,r,a.Type.v128,n);case h.i8x16_ge_u:return y(h.v128_ge,e,a.Type.u8,r,a.Type.v128,n);case h.i8x16_narrow_i16x8_s:return y(h.v128_narrow,e,a.Type.i16,r,a.Type.v128,n);case h.i8x16_narrow_i16x8_u:return y(h.v128_narrow,e,a.Type.u16,r,a.Type.v128,n);case h.i16x8_splat:return y(h.v128_splat,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_extract_lane_s:return y(h.v128_extract_lane,e,a.Type.i16,r,a.Type.i16,n);case h.i16x8_extract_lane_u:return y(h.v128_extract_lane,e,a.Type.u16,r,a.Type.u16,n);case h.i16x8_replace_lane:return y(h.v128_replace_lane,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_add:return y(h.v128_add,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_sub:return y(h.v128_sub,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_mul:return y(h.v128_mul,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_min_s:return y(h.v128_min,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_min_u:return y(h.v128_min,e,a.Type.u16,r,a.Type.v128,n);case h.i16x8_max_s:return y(h.v128_max,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_max_u:return y(h.v128_max,e,a.Type.u16,r,a.Type.v128,n);case h.i16x8_neg:return y(h.v128_neg,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_add_saturate_s:return y(h.v128_add_saturate,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_add_saturate_u:return y(h.v128_add_saturate,e,a.Type.u16,r,a.Type.v128,n);case h.i16x8_sub_saturate_s:return y(h.v128_sub_saturate,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_sub_saturate_u:return y(h.v128_sub_saturate,e,a.Type.u16,r,a.Type.v128,n);case h.i16x8_shl:return y(h.v128_shl,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_shr_s:return y(h.v128_shr,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_shr_u:return y(h.v128_shr,e,a.Type.u16,r,a.Type.v128,n);case h.i16x8_any_true:return y(h.v128_any_true,e,a.Type.i16,r,a.Type.i32,n);case h.i16x8_all_true:return y(h.v128_all_true,e,a.Type.i16,r,a.Type.i32,n);case h.i16x8_eq:return y(h.v128_eq,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_ne:return y(h.v128_ne,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_lt_s:return y(h.v128_lt,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_lt_u:return y(h.v128_lt,e,a.Type.u16,r,a.Type.v128,n);case h.i16x8_le_s:return y(h.v128_le,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_le_u:return y(h.v128_le,e,a.Type.u16,r,a.Type.v128,n);case h.i16x8_gt_s:return y(h.v128_gt,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_gt_u:return y(h.v128_gt,e,a.Type.u16,r,a.Type.v128,n);case h.i16x8_ge_s:return y(h.v128_ge,e,a.Type.i16,r,a.Type.v128,n);case h.i16x8_ge_u:return y(h.v128_ge,e,a.Type.u16,r,a.Type.v128,n);case h.i16x8_narrow_i32x4_s:return y(h.v128_narrow,e,a.Type.i32,r,a.Type.v128,n);case h.i16x8_narrow_i32x4_u:return y(h.v128_narrow,e,a.Type.u32,r,a.Type.v128,n);case h.i16x8_widen_low_i8x16_s:return y(h.v128_widen_low,e,a.Type.i8,r,a.Type.v128,n);case h.i16x8_widen_low_i8x16_u:return y(h.v128_widen_low,e,a.Type.u8,r,a.Type.v128,n);case h.i16x8_widen_high_i8x16_s:return y(h.v128_widen_high,e,a.Type.i8,r,a.Type.v128,n);case h.i16x8_widen_high_i8x16_u:return y(h.v128_widen_high,e,a.Type.u8,r,a.Type.v128,n);case h.i16x8_load8x8_s:return y(h.v128_load_ext,e,a.Type.i8,r,a.Type.v128,n);case h.i16x8_load8x8_u:return y(h.v128_load_ext,e,a.Type.u8,r,a.Type.v128,n);case h.i32x4_splat:return y(h.v128_splat,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_extract_lane:return y(h.v128_extract_lane,e,a.Type.i32,r,a.Type.i32,n);case h.i32x4_replace_lane:return y(h.v128_replace_lane,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_add:return y(h.v128_add,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_sub:return y(h.v128_sub,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_mul:return y(h.v128_mul,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_min_s:return y(h.v128_min,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_min_u:return y(h.v128_min,e,a.Type.u32,r,a.Type.v128,n);case h.i32x4_max_s:return y(h.v128_max,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_max_u:return y(h.v128_max,e,a.Type.u32,r,a.Type.v128,n);case h.i32x4_dot_i16x8_s:return y(h.v128_dot,e,a.Type.i16,r,a.Type.v128,n);case h.i32x4_neg:return y(h.v128_neg,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_shl:return y(h.v128_shl,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_shr_s:return y(h.v128_shr,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_shr_u:return y(h.v128_shr,e,a.Type.u32,r,a.Type.v128,n);case h.i32x4_any_true:return y(h.v128_any_true,e,a.Type.i32,r,a.Type.i32,n);case h.i32x4_all_true:return y(h.v128_all_true,e,a.Type.i32,r,a.Type.i32,n);case h.i32x4_eq:return y(h.v128_eq,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_ne:return y(h.v128_ne,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_lt_s:return y(h.v128_lt,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_lt_u:return y(h.v128_lt,e,a.Type.u32,r,a.Type.v128,n);case h.i32x4_le_s:return y(h.v128_le,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_le_u:return y(h.v128_le,e,a.Type.u32,r,a.Type.v128,n);case h.i32x4_gt_s:return y(h.v128_gt,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_gt_u:return y(h.v128_gt,e,a.Type.u32,r,a.Type.v128,n);case h.i32x4_ge_s:return y(h.v128_ge,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_ge_u:return y(h.v128_ge,e,a.Type.u32,r,a.Type.v128,n);case h.i32x4_trunc_sat_f32x4_s:return y(h.v128_trunc_sat,e,a.Type.i32,r,a.Type.v128,n);case h.i32x4_trunc_sat_f32x4_u:return y(h.v128_trunc_sat,e,a.Type.u32,r,a.Type.v128,n);case h.i32x4_widen_low_i16x8_s:return y(h.v128_widen_low,e,a.Type.i16,r,a.Type.v128,n);case h.i32x4_widen_low_i16x8_u:return y(h.v128_widen_low,e,a.Type.u16,r,a.Type.v128,n);case h.i32x4_widen_high_i16x8_s:return y(h.v128_widen_high,e,a.Type.i16,r,a.Type.v128,n);case h.i32x4_widen_high_i16x8_u:return y(h.v128_widen_high,e,a.Type.u16,r,a.Type.v128,n);case h.i32x4_load16x4_s:return y(h.v128_load_ext,e,a.Type.i16,r,a.Type.v128,n);case h.i32x4_load16x4_u:return y(h.v128_load_ext,e,a.Type.u16,r,a.Type.v128,n);case h.i64x2_splat:return y(h.v128_splat,e,a.Type.i64,r,a.Type.v128,n);case h.i64x2_extract_lane:return y(h.v128_extract_lane,e,a.Type.i64,r,a.Type.i64,n);case h.i64x2_replace_lane:return y(h.v128_replace_lane,e,a.Type.i64,r,a.Type.v128,n);case h.i64x2_add:return y(h.v128_add,e,a.Type.i64,r,a.Type.v128,n);case h.i64x2_sub:return y(h.v128_sub,e,a.Type.i64,r,a.Type.v128,n);case h.i64x2_neg:return y(h.v128_neg,e,a.Type.i64,r,a.Type.v128,n);case h.i64x2_shl:return y(h.v128_shl,e,a.Type.i64,r,a.Type.v128,n);case h.i64x2_shr_s:return y(h.v128_shr,e,a.Type.i64,r,a.Type.v128,n);case h.i64x2_shr_u:return y(h.v128_shr,e,a.Type.u64,r,a.Type.v128,n);case h.i64x2_any_true:return y(h.v128_any_true,e,a.Type.i64,r,a.Type.i32,n);case h.i64x2_all_true:return y(h.v128_all_true,e,a.Type.i64,r,a.Type.i32,n);case h.i64x2_trunc_sat_f64x2_s:return y(h.v128_trunc_sat,e,a.Type.i64,r,a.Type.v128,n);case h.i64x2_trunc_sat_f64x2_u:return y(h.v128_trunc_sat,e,a.Type.u64,r,a.Type.v128,n);case h.i64x2_load32x2_s:return y(h.v128_load_ext,e,a.Type.i32,r,a.Type.v128,n);case h.i64x2_load32x2_u:return y(h.v128_load_ext,e,a.Type.u32,r,a.Type.v128,n);case h.f32x4_splat:return y(h.v128_splat,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_extract_lane:return y(h.v128_extract_lane,e,a.Type.f32,r,a.Type.f32,n);case h.f32x4_replace_lane:return y(h.v128_replace_lane,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_add:return y(h.v128_add,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_sub:return y(h.v128_sub,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_mul:return y(h.v128_mul,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_div:return y(h.v128_div,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_neg:return y(h.v128_neg,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_min:return y(h.v128_min,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_max:return y(h.v128_max,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_abs:return y(h.v128_abs,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_sqrt:return y(h.v128_sqrt,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_eq:return y(h.v128_eq,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_ne:return y(h.v128_ne,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_lt:return y(h.v128_lt,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_le:return y(h.v128_le,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_gt:return y(h.v128_gt,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_ge:return y(h.v128_ge,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_convert_i32x4_s:return y(h.v128_convert,e,a.Type.i32,r,a.Type.v128,n);case h.f32x4_convert_i32x4_u:return y(h.v128_convert,e,a.Type.u32,r,a.Type.v128,n);case h.f32x4_qfma:return y(h.v128_qfma,e,a.Type.f32,r,a.Type.v128,n);case h.f32x4_qfms:return y(h.v128_qfms,e,a.Type.f32,r,a.Type.v128,n);case h.f64x2_splat:return y(h.v128_splat,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_extract_lane:return y(h.v128_extract_lane,e,a.Type.f64,r,a.Type.f64,n);case h.f64x2_replace_lane:return y(h.v128_replace_lane,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_add:return y(h.v128_add,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_sub:return y(h.v128_sub,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_mul:return y(h.v128_mul,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_div:return y(h.v128_div,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_neg:return y(h.v128_neg,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_min:return y(h.v128_min,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_max:return y(h.v128_max,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_abs:return y(h.v128_abs,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_sqrt:return y(h.v128_sqrt,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_eq:return y(h.v128_eq,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_ne:return y(h.v128_ne,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_lt:return y(h.v128_lt,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_le:return y(h.v128_le,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_gt:return y(h.v128_gt,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_ge:return y(h.v128_ge,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_convert_i64x2_s:return y(h.v128_convert,e,a.Type.i64,r,a.Type.v128,n);case h.f64x2_convert_i64x2_u:return y(h.v128_convert,e,a.Type.u64,r,a.Type.v128,n);case h.f64x2_qfma:return y(h.v128_qfma,e,a.Type.f64,r,a.Type.v128,n);case h.f64x2_qfms:return y(h.v128_qfms,e,a.Type.f64,r,a.Type.v128,n);case h.v8x16_shuffle:return y(h.v128_shuffle,e,a.Type.i8,r,a.Type.v128,n);case h.v8x16_swizzle:return y(h.v128_swizzle,e,null,r,a.Type.v128,n);case h.v8x16_load_splat:return y(h.v128_load_splat,e,a.Type.u8,r,a.Type.v128,n);case h.v16x8_load_splat:return y(h.v128_load_splat,e,a.Type.u16,r,a.Type.v128,n);case h.v32x4_load_splat:return y(h.v128_load_splat,e,a.Type.u32,r,a.Type.v128,n);case h.v64x2_load_splat:return y(h.v128_load_splat,e,a.Type.u64,r,a.Type.v128,n)}return 0}(e,t,n,d);if(s)return r&&e.error(i.DiagnosticCode.Type_0_is_not_generic,d.typeArgumentsRange,t.internalName),s}return e.error(i.DiagnosticCode.Not_implemented,d.expression.range),S.unreachable()}function y(e,t,r,n,i,s){assert(t.program.elementsByName.has(e));var a=t.program.elementsByName.get(e);return assert(a.kind==l.ElementKind.FUNCTION_PROTOTYPE),d(t,a,r?[r]:null,n,i,s,!0)}function T(e,t,r){var n=e.program,i=e.module,s=e.program.stringInstance;if(!s)return i.unreachable();var l,c=n.abortInstance;if(!c||!e.compileFunction(c))return i.unreachable();l=null!==t?e.compileExpression(t,s.type,17):s.type.toNativeZero(i);var u=e.ensureStaticString(r.range.source.normalizedPath);return e.currentType=a.Type.void,i.block(null,[i.call(c.internalName,[l,u,i.i32(r.range.line),i.i32(r.range.column)],o.NativeType.None),i.unreachable()])}function m(e){var t=32*(1<<e.alignLog2);return e.is(1)&&(t|=1024),e.is(8)&&(t|=2048),e.is(512)&&(t|=4096),e.isManaged&&(t|=8192),t/32}function g(e,t,r,n){if(0==r.length)return t&&1==t.length?t[0]:(e.error(i.DiagnosticCode.Expected_0_type_arguments_but_got_1,n.typeArgumentsRange,"1",t?t.length.toString(10):"0"),null);if(1==r.length){if(null!==t&&t.length){if(t.length>1)return e.error(i.DiagnosticCode.Expected_0_type_arguments_but_got_1,n.typeArgumentsRange,"1",t.length.toString(10)),null;e.compileExpression(r[0],t[0],1)}else e.compileExpression(r[0],a.Type.auto);return e.currentType}return t&&t.length>1&&e.error(i.DiagnosticCode.Expected_0_type_arguments_but_got_1,n.typeArgumentsRange,"1",t.length.toString(10)),e.error(i.DiagnosticCode.Expected_0_arguments_but_got_1,n.argumentsRange,"1",r.length.toString(10)),null}function E(e,t){var r,n;return t.options.isWasm64?(r=t.precomputeExpression(e,a.Type.usize64,1),(o.getExpressionId(r)!=o.ExpressionId.Const||o.getExpressionType(r)!=o.NativeType.I64||0!=o.getConstValueI64High(r)||(n=o.getConstValueI64Low(r))<0)&&(t.error(i.DiagnosticCode.Expression_must_be_a_compile_time_constant,e.range),n=-1)):(r=t.precomputeExpression(e,a.Type.usize32,1),(o.getExpressionId(r)!=o.ExpressionId.Const||o.getExpressionType(r)!=o.NativeType.I32||(n=o.getConstValueI32(r))<0)&&(t.error(i.DiagnosticCode.Expression_must_be_a_compile_time_constant,e.range),n=-1)),n}function f(e,t,r){return r.options.hasFeature(e)?0:(r.error(i.DiagnosticCode.Feature_0_is_not_enabled,t.range,p.featureToString(e)),1)}function I(e,t,r,n=!1){if(e){let s=e.length;if(1==s)return 0;assert(s),n&&(r.currentType=e[0]),r.error(i.DiagnosticCode.Expected_0_type_arguments_but_got_1,t.typeArgumentsRange,"1",s.toString())}else r.error(i.DiagnosticCode.Expected_0_type_arguments_but_got_1,t.range,"1","0");return 1}function x(e,t,r,n=!1){if(e){let s=e.length;return 1==s?0:(assert(s),n&&(r.currentType=e[0]),r.error(i.DiagnosticCode.Expected_0_type_arguments_but_got_1,t.typeArgumentsRange,"1",s.toString()),1)}return 0}function b(e,t,r){return e?(r.program.error(i.DiagnosticCode.Type_0_is_not_generic,t.typeArgumentsRange,r.internalName),1):0}function A(e,t,r,n){return e.length!=t?(n.error(i.DiagnosticCode.Expected_0_arguments_but_got_1,r.range,t.toString(),e.length.toString()),1):0}function N(e,t,r,n,s){var a=e.length;return a<t?(s.error(i.DiagnosticCode.Expected_at_least_0_arguments_but_got_1,n.range,t.toString(),a.toString()),1):a>r?(s.error(i.DiagnosticCode.Expected_0_arguments_but_got_1,n.range,r.toString(),a.toString()),1):0}!function(e){e.isInteger="~lib/builtins/isInteger",e.isFloat="~lib/builtins/isFloat",e.isBoolean="~lib/builtins/isBoolean",e.isSigned="~lib/builtins/isSigned",e.isReference="~lib/builtins/isReference",e.isString="~lib/builtins/isString",e.isArray="~lib/builtins/isArray",e.isArrayLike="~lib/builtins/isArrayLike",e.isFunction="~lib/builtins/isFunction",e.isNullable="~lib/builtins/isNullable",e.isDefined="~lib/builtins/isDefined",e.isConstant="~lib/builtins/isConstant",e.isManaged="~lib/builtins/isManaged",e.isVoid="~lib/builtins/isVoid",e.clz="~lib/builtins/clz",e.ctz="~lib/builtins/ctz",e.popcnt="~lib/builtins/popcnt",e.rotl="~lib/builtins/rotl",e.rotr="~lib/builtins/rotr",e.abs="~lib/builtins/abs",e.max="~lib/builtins/max",e.min="~lib/builtins/min",e.ceil="~lib/builtins/ceil",e.floor="~lib/builtins/floor",e.copysign="~lib/builtins/copysign",e.nearest="~lib/builtins/nearest",e.reinterpret="~lib/builtins/reinterpret",e.sqrt="~lib/builtins/sqrt",e.trunc="~lib/builtins/trunc",e.load="~lib/builtins/load",e.store="~lib/builtins/store",e.atomic_load="~lib/builtins/atomic.load",e.atomic_store="~lib/builtins/atomic.store",e.atomic_add="~lib/builtins/atomic.add",e.atomic_sub="~lib/builtins/atomic.sub",e.atomic_and="~lib/builtins/atomic.and",e.atomic_or="~lib/builtins/atomic.or",e.atomic_xor="~lib/builtins/atomic.xor",e.atomic_xchg="~lib/builtins/atomic.xchg",e.atomic_cmpxchg="~lib/builtins/atomic.cmpxchg",e.atomic_wait="~lib/builtins/atomic.wait",e.atomic_notify="~lib/builtins/atomic.notify",e.atomic_fence="~lib/builtins/atomic.fence",e.sizeof="~lib/builtins/sizeof",e.alignof="~lib/builtins/alignof",e.offsetof="~lib/builtins/offsetof",e.nameof="~lib/builtins/nameof",e.lengthof="~lib/builtins/lengthof",e.select="~lib/builtins/select",e.unreachable="~lib/builtins/unreachable",e.changetype="~lib/builtins/changetype",e.assert="~lib/builtins/assert",e.unchecked="~lib/builtins/unchecked",e.call_direct="~lib/builtins/call_direct",e.call_indirect="~lib/builtins/call_indirect",e.instantiate="~lib/builtins/instantiate",e.idof="~lib/builtins/idof",e.i8="~lib/builtins/i8",e.i16="~lib/builtins/i16",e.i32="~lib/builtins/i32",e.i64="~lib/builtins/i64",e.isize="~lib/builtins/isize",e.u8="~lib/builtins/u8",e.u16="~lib/builtins/u16",e.u32="~lib/builtins/u32",e.u64="~lib/builtins/u64",e.usize="~lib/builtins/usize",e.bool="~lib/builtins/bool",e.f32="~lib/builtins/f32",e.f64="~lib/builtins/f64",e.v128="~lib/builtins/v128",e.void_="~lib/builtins/void",e.i32_clz="~lib/builtins/i32.clz",e.i64_clz="~lib/builtins/i64.clz",e.i32_ctz="~lib/builtins/i32.ctz",e.i64_ctz="~lib/builtins/i64.ctz",e.i32_popcnt="~lib/builtins/i32.popcnt",e.i64_popcnt="~lib/builtins/i64.popcnt",e.i32_rotl="~lib/builtins/i32.rotl",e.i64_rotl="~lib/builtins/i64.rotl",e.i32_rotr="~lib/builtins/i32.rotr",e.i64_rotr="~lib/builtins/i64.rotr",e.f32_abs="~lib/builtins/f32.abs",e.f64_abs="~lib/builtins/f64.abs",e.f32_max="~lib/builtins/f32.max",e.f64_max="~lib/builtins/f64.max",e.f32_min="~lib/builtins/f32.min",e.f64_min="~lib/builtins/f64.min",e.f32_ceil="~lib/builtins/f32.ceil",e.f64_ceil="~lib/builtins/f64.ceil",e.f32_floor="~lib/builtins/f32.floor",e.f64_floor="~lib/builtins/f64.floor",e.f32_copysign="~lib/builtins/f32.copysign",e.f64_copysign="~lib/builtins/f64.copysign",e.f32_nearest="~lib/builtins/f32.nearest",e.f64_nearest="~lib/builtins/f64.nearest",e.i32_reinterpret_f32="~lib/builtins/i32.reinterpret_f32",e.i64_reinterpret_f64="~lib/builtins/i64.reinterpret_f64",e.f32_reinterpret_i32="~lib/builtins/f32.reinterpret_i32",e.f64_reinterpret_i64="~lib/builtins/f64.reinterpret_i64",e.f32_sqrt="~lib/builtins/f32.sqrt",e.f64_sqrt="~lib/builtins/f64.sqrt",e.f32_trunc="~lib/builtins/f32.trunc",e.f64_trunc="~lib/builtins/f64.trunc",e.i32_load8_s="~lib/builtins/i32.load8_s",e.i32_load8_u="~lib/builtins/i32.load8_u",e.i32_load16_s="~lib/builtins/i32.load16_s",e.i32_load16_u="~lib/builtins/i32.load16_u",e.i32_load="~lib/builtins/i32.load",e.i64_load8_s="~lib/builtins/i64.load8_s",e.i64_load8_u="~lib/builtins/i64.load8_u",e.i64_load16_s="~lib/builtins/i64.load16_s",e.i64_load16_u="~lib/builtins/i64.load16_u",e.i64_load32_s="~lib/builtins/i64.load32_s",e.i64_load32_u="~lib/builtins/i64.load32_u",e.i64_load="~lib/builtins/i64.load",e.f32_load="~lib/builtins/f32.load",e.f64_load="~lib/builtins/f64.load",e.i32_store8="~lib/builtins/i32.store8",e.i32_store16="~lib/builtins/i32.store16",e.i32_store="~lib/builtins/i32.store",e.i64_store8="~lib/builtins/i64.store8",e.i64_store16="~lib/builtins/i64.store16",e.i64_store32="~lib/builtins/i64.store32",e.i64_store="~lib/builtins/i64.store",e.f32_store="~lib/builtins/f32.store",e.f64_store="~lib/builtins/f64.store",e.i32_atomic_load8_u="~lib/builtins/i32.atomic.load8_u",e.i32_atomic_load16_u="~lib/builtins/i32.atomic.load16_u",e.i32_atomic_load="~lib/builtins/i32.atomic.load",e.i64_atomic_load8_u="~lib/builtins/i64.atomic.load8_u",e.i64_atomic_load16_u="~lib/builtins/i64.atomic.load16_u",e.i64_atomic_load32_u="~lib/builtins/i64.atomic.load32_u",e.i64_atomic_load="~lib/builtins/i64.atomic.load",e.i32_atomic_store8="~lib/builtins/i32.atomic.store8",e.i32_atomic_store16="~lib/builtins/i32.atomic.store16",e.i32_atomic_store="~lib/builtins/i32.atomic.store",e.i64_atomic_store8="~lib/builtins/i64.atomic.store8",e.i64_atomic_store16="~lib/builtins/i64.atomic.store16",e.i64_atomic_store32="~lib/builtins/i64.atomic.store32",e.i64_atomic_store="~lib/builtins/i64.atomic.store",e.i32_atomic_rmw8_add_u="~lib/builtins/i32.atomic.rmw8.add_u",e.i32_atomic_rmw16_add_u="~lib/builtins/i32.atomic.rmw16.add_u",e.i32_atomic_rmw_add="~lib/builtins/i32.atomic.rmw.add",e.i64_atomic_rmw8_add_u="~lib/builtins/i64.atomic.rmw8.add_u",e.i64_atomic_rmw16_add_u="~lib/builtins/i64.atomic.rmw16.add_u",e.i64_atomic_rmw32_add_u="~lib/builtins/i64.atomic.rmw32.add_u",e.i64_atomic_rmw_add="~lib/builtins/i64.atomic.rmw.add",e.i32_atomic_rmw8_sub_u="~lib/builtins/i32.atomic.rmw8.sub_u",e.i32_atomic_rmw16_sub_u="~lib/builtins/i32.atomic.rmw16.sub_u",e.i32_atomic_rmw_sub="~lib/builtins/i32.atomic.rmw.sub",e.i64_atomic_rmw8_sub_u="~lib/builtins/i64.atomic.rmw8.sub_u",e.i64_atomic_rmw16_sub_u="~lib/builtins/i64.atomic.rmw16.sub_u",e.i64_atomic_rmw32_sub_u="~lib/builtins/i64.atomic.rmw32.sub_u",e.i64_atomic_rmw_sub="~lib/builtins/i64.atomic.rmw.sub",e.i32_atomic_rmw8_and_u="~lib/builtins/i32.atomic.rmw8.and_u",e.i32_atomic_rmw16_and_u="~lib/builtins/i32.atomic.rmw16.and_u",e.i32_atomic_rmw_and="~lib/builtins/i32.atomic.rmw.and",e.i64_atomic_rmw8_and_u="~lib/builtins/i64.atomic.rmw8.and_u",e.i64_atomic_rmw16_and_u="~lib/builtins/i64.atomic.rmw16.and_u",e.i64_atomic_rmw32_and_u="~lib/builtins/i64.atomic.rmw32.and_u",e.i64_atomic_rmw_and="~lib/builtins/i64.atomic.rmw.and",e.i32_atomic_rmw8_or_u="~lib/builtins/i32.atomic.rmw8.or_u",e.i32_atomic_rmw16_or_u="~lib/builtins/i32.atomic.rmw16.or_u",e.i32_atomic_rmw_or="~lib/builtins/i32.atomic.rmw.or",e.i64_atomic_rmw8_or_u="~lib/builtins/i64.atomic.rmw8.or_u",e.i64_atomic_rmw16_or_u="~lib/builtins/i64.atomic.rmw16.or_u",e.i64_atomic_rmw32_or_u="~lib/builtins/i64.atomic.rmw32.or_u",e.i64_atomic_rmw_or="~lib/builtins/i64.atomic.rmw.or",e.i32_atomic_rmw8_xor_u="~lib/builtins/i32.atomic.rmw8.xor_u",e.i32_atomic_rmw16_xor_u="~lib/builtins/i32.atomic.rmw16.xor_u",e.i32_atomic_rmw_xor="~lib/builtins/i32.atomic.rmw.xor",e.i64_atomic_rmw8_xor_u="~lib/builtins/i64.atomic.rmw8.xor_u",e.i64_atomic_rmw16_xor_u="~lib/builtins/i64.atomic.rmw16.xor_u",e.i64_atomic_rmw32_xor_u="~lib/builtins/i64.atomic.rmw32.xor_u",e.i64_atomic_rmw_xor="~lib/builtins/i64.atomic.rmw.xor",e.i32_atomic_rmw8_xchg_u="~lib/builtins/i32.atomic.rmw8.xchg_u",e.i32_atomic_rmw16_xchg_u="~lib/builtins/i32.atomic.rmw16.xchg_u",e.i32_atomic_rmw_xchg="~lib/builtins/i32.atomic.rmw.xchg",e.i64_atomic_rmw8_xchg_u="~lib/builtins/i64.atomic.rmw8.xchg_u",e.i64_atomic_rmw16_xchg_u="~lib/builtins/i64.atomic.rmw16.xchg_u",e.i64_atomic_rmw32_xchg_u="~lib/builtins/i64.atomic.rmw32.xchg_u",e.i64_atomic_rmw_xchg="~lib/builtins/i64.atomic.rmw.xchg",e.i32_atomic_rmw8_cmpxchg_u="~lib/builtins/i32.atomic.rmw8.cmpxchg_u",e.i32_atomic_rmw16_cmpxchg_u="~lib/builtins/i32.atomic.rmw16.cmpxchg_u",e.i32_atomic_rmw_cmpxchg="~lib/builtins/i32.atomic.rmw.cmpxchg",e.i64_atomic_rmw8_cmpxchg_u="~lib/builtins/i64.atomic.rmw8.cmpxchg_u",e.i64_atomic_rmw16_cmpxchg_u="~lib/builtins/i64.atomic.rmw16.cmpxchg_u",e.i64_atomic_rmw32_cmpxchg_u="~lib/builtins/i64.atomic.rmw32.cmpxchg_u",e.i64_atomic_rmw_cmpxchg="~lib/builtins/i64.atomic.rmw.cmpxchg",e.i32_wait="~lib/builtins/i32.wait",e.i64_wait="~lib/builtins/i64.wait",e.v128_splat="~lib/builtins/v128.splat",e.v128_extract_lane="~lib/builtins/v128.extract_lane",e.v128_replace_lane="~lib/builtins/v128.replace_lane",e.v128_shuffle="~lib/builtins/v128.shuffle",e.v128_swizzle="~lib/builtins/v128.swizzle",e.v128_load_splat="~lib/builtins/v128.load_splat",e.v128_load_ext="~lib/builtins/v128.load_ext",e.v128_load="~lib/builtins/v128.load",e.v128_store="~lib/builtins/v128.store",e.v128_add="~lib/builtins/v128.add",e.v128_sub="~lib/builtins/v128.sub",e.v128_mul="~lib/builtins/v128.mul",e.v128_div="~lib/builtins/v128.div",e.v128_neg="~lib/builtins/v128.neg",e.v128_add_saturate="~lib/builtins/v128.add_saturate",e.v128_sub_saturate="~lib/builtins/v128.sub_saturate",e.v128_shl="~lib/builtins/v128.shl",e.v128_shr="~lib/builtins/v128.shr",e.v128_and="~lib/builtins/v128.and",e.v128_or="~lib/builtins/v128.or",e.v128_xor="~lib/builtins/v128.xor",e.v128_andnot="~lib/builtins/v128.andnot",e.v128_not="~lib/builtins/v128.not",e.v128_bitselect="~lib/builtins/v128.bitselect",e.v128_any_true="~lib/builtins/v128.any_true",e.v128_all_true="~lib/builtins/v128.all_true",e.v128_min="~lib/builtins/v128.min",e.v128_max="~lib/builtins/v128.max",e.v128_dot="~lib/builtins/v128.dot",e.v128_abs="~lib/builtins/v128.abs",e.v128_sqrt="~lib/builtins/v128.sqrt",e.v128_eq="~lib/builtins/v128.eq",e.v128_ne="~lib/builtins/v128.ne",e.v128_lt="~lib/builtins/v128.lt",e.v128_le="~lib/builtins/v128.le",e.v128_gt="~lib/builtins/v128.gt",e.v128_ge="~lib/builtins/v128.ge",e.v128_convert="~lib/builtins/v128.convert",e.v128_trunc_sat="~lib/builtins/v128.trunc_sat",e.v128_narrow="~lib/builtins/v128.narrow",e.v128_widen_low="~lib/builtins/v128.widen_low",e.v128_widen_high="~lib/builtins/v128.widen_high",e.v128_qfma="~lib/builtins/v128.qfma",e.v128_qfms="~lib/builtins/v128.qfms",e.i8x16="~lib/builtins/i8x16",e.i16x8="~lib/builtins/i16x8",e.i32x4="~lib/builtins/i32x4",e.i64x2="~lib/builtins/i64x2",e.f32x4="~lib/builtins/f32x4",e.f64x2="~lib/builtins/f64x2",e.i8x16_splat="~lib/builtins/i8x16.splat",e.i8x16_extract_lane_s="~lib/builtins/i8x16.extract_lane_s",e.i8x16_extract_lane_u="~lib/builtins/i8x16.extract_lane_u",e.i8x16_replace_lane="~lib/builtins/i8x16.replace_lane",e.i8x16_add="~lib/builtins/i8x16.add",e.i8x16_sub="~lib/builtins/i8x16.sub",e.i8x16_mul="~lib/builtins/i8x16.mul",e.i8x16_min_s="~lib/builtins/i8x16.min_s",e.i8x16_min_u="~lib/builtins/i8x16.min_u",e.i8x16_max_s="~lib/builtins/i8x16.max_s",e.i8x16_max_u="~lib/builtins/i8x16.max_u",e.i8x16_neg="~lib/builtins/i8x16.neg",e.i8x16_add_saturate_s="~lib/builtins/i8x16.add_saturate_s",e.i8x16_add_saturate_u="~lib/builtins/i8x16.add_saturate_u",e.i8x16_sub_saturate_s="~lib/builtins/i8x16.sub_saturate_s",e.i8x16_sub_saturate_u="~lib/builtins/i8x16.sub_saturate_u",e.i8x16_shl="~lib/builtins/i8x16.shl",e.i8x16_shr_s="~lib/builtins/i8x16.shr_s",e.i8x16_shr_u="~lib/builtins/i8x16.shr_u",e.i8x16_any_true="~lib/builtins/i8x16.any_true",e.i8x16_all_true="~lib/builtins/i8x16.all_true",e.i8x16_eq="~lib/builtins/i8x16.eq",e.i8x16_ne="~lib/builtins/i8x16.ne",e.i8x16_lt_s="~lib/builtins/i8x16.lt_s",e.i8x16_lt_u="~lib/builtins/i8x16.lt_u",e.i8x16_le_s="~lib/builtins/i8x16.le_s",e.i8x16_le_u="~lib/builtins/i8x16.le_u",e.i8x16_gt_s="~lib/builtins/i8x16.gt_s",e.i8x16_gt_u="~lib/builtins/i8x16.gt_u",e.i8x16_ge_s="~lib/builtins/i8x16.ge_s",e.i8x16_ge_u="~lib/builtins/i8x16.ge_u",e.i8x16_narrow_i16x8_s="~lib/builtins/i8x16.narrow_i16x8_s",e.i8x16_narrow_i16x8_u="~lib/builtins/i8x16.narrow_i16x8_u",e.i16x8_splat="~lib/builtins/i16x8.splat",e.i16x8_extract_lane_s="~lib/builtins/i16x8.extract_lane_s",e.i16x8_extract_lane_u="~lib/builtins/i16x8.extract_lane_u",e.i16x8_replace_lane="~lib/builtins/i16x8.replace_lane",e.i16x8_add="~lib/builtins/i16x8.add",e.i16x8_sub="~lib/builtins/i16x8.sub",e.i16x8_mul="~lib/builtins/i16x8.mul",e.i16x8_min_s="~lib/builtins/i16x8.min_s",e.i16x8_min_u="~lib/builtins/i16x8.min_u",e.i16x8_max_s="~lib/builtins/i16x8.max_s",e.i16x8_max_u="~lib/builtins/i16x8.max_u",e.i16x8_neg="~lib/builtins/i16x8.neg",e.i16x8_add_saturate_s="~lib/builtins/i16x8.add_saturate_s",e.i16x8_add_saturate_u="~lib/builtins/i16x8.add_saturate_u",e.i16x8_sub_saturate_s="~lib/builtins/i16x8.sub_saturate_s",e.i16x8_sub_saturate_u="~lib/builtins/i16x8.sub_saturate_u",e.i16x8_shl="~lib/builtins/i16x8.shl",e.i16x8_shr_s="~lib/builtins/i16x8.shr_s",e.i16x8_shr_u="~lib/builtins/i16x8.shr_u",e.i16x8_any_true="~lib/builtins/i16x8.any_true",e.i16x8_all_true="~lib/builtins/i16x8.all_true",e.i16x8_eq="~lib/builtins/i16x8.eq",e.i16x8_ne="~lib/builtins/i16x8.ne",e.i16x8_lt_s="~lib/builtins/i16x8.lt_s",e.i16x8_lt_u="~lib/builtins/i16x8.lt_u",e.i16x8_le_s="~lib/builtins/i16x8.le_s",e.i16x8_le_u="~lib/builtins/i16x8.le_u",e.i16x8_gt_s="~lib/builtins/i16x8.gt_s",e.i16x8_gt_u="~lib/builtins/i16x8.gt_u",e.i16x8_ge_s="~lib/builtins/i16x8.ge_s",e.i16x8_ge_u="~lib/builtins/i16x8.ge_u",e.i16x8_narrow_i32x4_s="~lib/builtins/i16x8.narrow_i32x4_s",e.i16x8_narrow_i32x4_u="~lib/builtins/i16x8.narrow_i32x4_u",e.i16x8_widen_low_i8x16_s="~lib/builtins/i16x8.widen_low_i8x16_s",e.i16x8_widen_low_i8x16_u="~lib/builtins/i16x8.widen_low_i8x16_u",e.i16x8_widen_high_i8x16_s="~lib/builtins/i16x8.widen_high_i8x16_s",e.i16x8_widen_high_i8x16_u="~lib/builtins/i16x8.widen_high_i8x16_u",e.i16x8_load8x8_s="~lib/builtins/i16x8.load8x8_s",e.i16x8_load8x8_u="~lib/builtins/i16x8.load8x8_u",e.i32x4_splat="~lib/builtins/i32x4.splat",e.i32x4_extract_lane="~lib/builtins/i32x4.extract_lane",e.i32x4_replace_lane="~lib/builtins/i32x4.replace_lane",e.i32x4_add="~lib/builtins/i32x4.add",e.i32x4_sub="~lib/builtins/i32x4.sub",e.i32x4_mul="~lib/builtins/i32x4.mul",e.i32x4_min_s="~lib/builtins/i32x4.min_s",e.i32x4_min_u="~lib/builtins/i32x4.min_u",e.i32x4_max_s="~lib/builtins/i32x4.max_s",e.i32x4_max_u="~lib/builtins/i32x4.max_u",e.i32x4_dot_i16x8_s="~lib/builtins/i32x4.dot_i16x8_s",e.i32x4_neg="~lib/builtins/i32x4.neg",e.i32x4_shl="~lib/builtins/i32x4.shl",e.i32x4_shr_s="~lib/builtins/i32x4.shr_s",e.i32x4_shr_u="~lib/builtins/i32x4.shr_u",e.i32x4_any_true="~lib/builtins/i32x4.any_true",e.i32x4_all_true="~lib/builtins/i32x4.all_true",e.i32x4_eq="~lib/builtins/i32x4.eq",e.i32x4_ne="~lib/builtins/i32x4.ne",e.i32x4_lt_s="~lib/builtins/i32x4.lt_s",e.i32x4_lt_u="~lib/builtins/i32x4.lt_u",e.i32x4_le_s="~lib/builtins/i32x4.le_s",e.i32x4_le_u="~lib/builtins/i32x4.le_u",e.i32x4_gt_s="~lib/builtins/i32x4.gt_s",e.i32x4_gt_u="~lib/builtins/i32x4.gt_u",e.i32x4_ge_s="~lib/builtins/i32x4.ge_s",e.i32x4_ge_u="~lib/builtins/i32x4.ge_u",e.i32x4_trunc_sat_f32x4_s="~lib/builtins/i32x4.trunc_sat_f32x4_s",e.i32x4_trunc_sat_f32x4_u="~lib/builtins/i32x4.trunc_sat_f32x4_u",e.i32x4_widen_low_i16x8_s="~lib/builtins/i32x4.widen_low_i16x8_s",e.i32x4_widen_low_i16x8_u="~lib/builtins/i32x4.widen_low_i16x8_u",e.i32x4_widen_high_i16x8_s="~lib/builtins/i32x4.widen_high_i16x8_s",e.i32x4_widen_high_i16x8_u="~lib/builtins/i32x4.widen_high_i16x8_u",e.i32x4_load16x4_s="~lib/builtins/i32x4.load16x4_s",e.i32x4_load16x4_u="~lib/builtins/i32x4.load16x4_u",e.i64x2_splat="~lib/builtins/i64x2.splat",e.i64x2_extract_lane="~lib/builtins/i64x2.extract_lane",e.i64x2_replace_lane="~lib/builtins/i64x2.replace_lane",e.i64x2_add="~lib/builtins/i64x2.add",e.i64x2_sub="~lib/builtins/i64x2.sub",e.i64x2_neg="~lib/builtins/i64x2.neg",e.i64x2_shl="~lib/builtins/i64x2.shl",e.i64x2_shr_s="~lib/builtins/i64x2.shr_s",e.i64x2_shr_u="~lib/builtins/i64x2.shr_u",e.i64x2_any_true="~lib/builtins/i64x2.any_true",e.i64x2_all_true="~lib/builtins/i64x2.all_true",e.i64x2_trunc_sat_f64x2_s="~lib/builtins/i64x2.trunc_sat_f64x2_s",e.i64x2_trunc_sat_f64x2_u="~lib/builtins/i64x2.trunc_sat_f64x2_u",e.i64x2_load32x2_s="~lib/builtins/i64x2.load32x2_s",e.i64x2_load32x2_u="~lib/builtins/i64x2.load32x2_u",e.f32x4_splat="~lib/builtins/f32x4.splat",e.f32x4_extract_lane="~lib/builtins/f32x4.extract_lane",e.f32x4_replace_lane="~lib/builtins/f32x4.replace_lane",e.f32x4_add="~lib/builtins/f32x4.add",e.f32x4_sub="~lib/builtins/f32x4.sub",e.f32x4_mul="~lib/builtins/f32x4.mul",e.f32x4_div="~lib/builtins/f32x4.div",e.f32x4_neg="~lib/builtins/f32x4.neg",e.f32x4_min="~lib/builtins/f32x4.min",e.f32x4_max="~lib/builtins/f32x4.max",e.f32x4_abs="~lib/builtins/f32x4.abs",e.f32x4_sqrt="~lib/builtins/f32x4.sqrt",e.f32x4_eq="~lib/builtins/f32x4.eq",e.f32x4_ne="~lib/builtins/f32x4.ne",e.f32x4_lt="~lib/builtins/f32x4.lt",e.f32x4_le="~lib/builtins/f32x4.le",e.f32x4_gt="~lib/builtins/f32x4.gt",e.f32x4_ge="~lib/builtins/f32x4.ge",e.f32x4_convert_i32x4_s="~lib/builtins/f32x4.convert_i32x4_s",e.f32x4_convert_i32x4_u="~lib/builtins/f32x4.convert_i32x4_u",e.f32x4_qfma="~lib/builtins/f32x4.qfma",e.f32x4_qfms="~lib/builtins/f32x4.qfms",e.f64x2_splat="~lib/builtins/f64x2.splat",e.f64x2_extract_lane="~lib/builtins/f64x2.extract_lane",e.f64x2_replace_lane="~lib/builtins/f64x2.replace_lane",e.f64x2_add="~lib/builtins/f64x2.add",e.f64x2_sub="~lib/builtins/f64x2.sub",e.f64x2_mul="~lib/builtins/f64x2.mul",e.f64x2_div="~lib/builtins/f64x2.div",e.f64x2_neg="~lib/builtins/f64x2.neg",e.f64x2_min="~lib/builtins/f64x2.min",e.f64x2_max="~lib/builtins/f64x2.max",e.f64x2_abs="~lib/builtins/f64x2.abs",e.f64x2_sqrt="~lib/builtins/f64x2.sqrt",e.f64x2_eq="~lib/builtins/f64x2.eq",e.f64x2_ne="~lib/builtins/f64x2.ne",e.f64x2_lt="~lib/builtins/f64x2.lt",e.f64x2_le="~lib/builtins/f64x2.le",e.f64x2_gt="~lib/builtins/f64x2.gt",e.f64x2_ge="~lib/builtins/f64x2.ge",e.f64x2_convert_i64x2_s="~lib/builtins/f64x2.convert_i64x2_s",e.f64x2_convert_i64x2_u="~lib/builtins/f64x2.convert_i64x2_u",e.f64x2_qfma="~lib/builtins/f64x2.qfma",e.f64x2_qfms="~lib/builtins/f64x2.qfms",e.v8x16_shuffle="~lib/builtins/v8x16.shuffle",e.v8x16_swizzle="~lib/builtins/v8x16.swizzle",e.v8x16_load_splat="~lib/builtins/v8x16.load_splat",e.v16x8_load_splat="~lib/builtins/v16x8.load_splat",e.v32x4_load_splat="~lib/builtins/v32x4.load_splat",e.v64x2_load_splat="~lib/builtins/v64x2.load_splat",e.heap_base="~lib/heap/__heap_base",e.rtti_base="~lib/rt/__rtti_base",e.visit_globals="~lib/rt/__visit_globals",e.visit_members="~lib/rt/__visit_members",e.isNaN="~lib/number/isNaN",e.isFinite="~lib/number/isFinite",e.ERROR="~lib/diagnostics/ERROR",e.WARNING="~lib/diagnostics/WARNING",e.INFO="~lib/diagnostics/INFO",e.memory_size="~lib/memory/memory.size",e.memory_grow="~lib/memory/memory.grow",e.memory_copy="~lib/memory/memory.copy",e.memory_fill="~lib/memory/memory.fill",e.memory_allocate="~lib/memory/memory.allocate",e.memory_free="~lib/memory/memory.free",e.memory_reset="~lib/memory/memory.reset",e.runtime_instanceof="~lib/runtime/runtime.instanceof",e.runtime_flags="~lib/runtime/runtime.flags",e.runtime_allocate="~lib/util/runtime/allocate",e.runtime_reallocate="~lib/util/runtime/reallocate",e.runtime_register="~lib/util/runtime/register",e.runtime_discard="~lib/util/runtime/discard",e.runtime_makeArray="~lib/util/runtime/makeArray",e.Int8Array="~lib/typedarray/Int8Array",e.Uint8Array="~lib/typedarray/Uint8Array",e.Int16Array="~lib/typedarray/Int16Array",e.Uint16Array="~lib/typedarray/Uint16Array",e.Int32Array="~lib/typedarray/Int32Array",e.Uint32Array="~lib/typedarray/Uint32Array",e.Int64Array="~lib/typedarray/Int64Array",e.Uint64Array="~lib/typedarray/Uint64Array",e.Uint8ClampedArray="~lib/typedarray/Uint8ClampedArray",e.Float32Array="~lib/typedarray/Float32Array",e.Float64Array="~lib/typedarray/Float64Array",e.started="~lib/started",e.argc="~lib/argc",e.setargc="~lib/setargc",e.capabilities="~lib/capabilities"}(h=t.BuiltinSymbols||(t.BuiltinSymbols={})),t.compileCall=d,t.compileAbort=T,t.compileVisitGlobals=function(e){var t=e.module,r=new Array,n=e.ensureFunctionType([a.Type.u32],a.Type.void),i=e.options.nativeSizeType,s=assert(e.program.visitInstance);e.compileFunction(s);for(let n of e.program.elementsByName.values()){if(n.kind!=l.ElementKind.GLOBAL)continue;let a=n,c=a.type,u=c.classReference;if(c.is(256)&&null!==u&&!u.hasDecorator(l.DecoratorFlags.UNMANAGED)&&a.is(p.CommonFlags.COMPILED))if(a.is(p.CommonFlags.INLINED)){let n=a.constantIntegerValue;(i64_low(n)||i64_high(n))&&r.push(t.call(s.internalName,[e.options.isWasm64?t.i64(i64_low(n),i64_high(n)):t.i32(i64_low(n))],o.NativeType.None))}else r.push(t.if(t.local_tee(1,t.global_get(a.internalName,i)),t.call(s.internalName,[t.local_get(1,i),t.local_get(0,o.NativeType.I32)],o.NativeType.None)))}t.addFunction(h.visit_globals,n,[i],r.length?t.block(null,r):t.nop())},t.compileVisitMembers=function(e){var t=e.program,r=e.module,i=t.options.usizeType,s=i.toNativeType(),c=i.byteSize,u=e.ensureFunctionType([i,a.Type.i32],a.Type.void),p=t.managedClasses,_=assert(t.visitInstance),d=new Array,y=o.Relooper.create(r),T=y.addBlockWithSwitch(r.nop(),r.load(c,!1,s==o.NativeType.I64?r.binary(o.BinaryOp.SubI64,r.local_get(0,s),r.i64(8)):r.binary(o.BinaryOp.SubI32,r.local_get(0,s),r.i32(8)),o.NativeType.I32,0)),m=0;for(let[i,u]of p){let p;assert(u.type.isManaged),assert(i==m++);let h=new Array;if(u.isDeclaredInLibrary&&(p=u.lookupInSelf("__visit_impl"))){assert(p.kind==l.ElementKind.FUNCTION_PROTOTYPE);let n=t.resolver.resolveFunction(p,null);if(n&&e.compileFunction(n)){let e=n.signature;assert(1==e.parameterTypes.length&&e.parameterTypes[0]==a.Type.u32&&e.returnType==a.Type.void&&e.thisType==u.type),h.push(r.call(n.internalName,[r.local_get(0,s),r.local_get(1,o.NativeType.I32)],o.NativeType.None))}else h.push(r.unreachable())}else{let e=u.members;if(e)for(let t of e.values())if(t.kind==l.ElementKind.FIELD&&t.parent===u){if(t.type.isManaged){let e=t.memoryOffset;assert(e>=0),h.push(r.if(r.local_tee(2,r.load(c,!1,r.local_get(0,s),s,e)),r.call(_.internalName,[r.local_get(2,s),r.local_get(1,o.NativeType.I32)],o.NativeType.None)))}}}u.base||h.push(r.return());let g=y.addBlock(n.flatten(r,h,o.NativeType.None));y.addBranchForSwitch(T,g,[i]),d.push(g)}for(let[e,t]of p){let r=t.base;r&&y.addBranch(d[e],d[r.id])}d.push(y.addBlock(r.unreachable())),y.addBranchForSwitch(T,d[d.length-1],[]),e.compileFunction(_),r.addFunction(h.visit_members,u,[s],y.renderAndDispose(T,2))},t.compileRTTI=function(e){var t=e.program,r=e.module,n=t.managedClasses,i=n.size,s=4+8*i,a=new Uint8Array(s);_.writeI32(i,a,0);var l=4,c=t.arrayBufferViewInstance,u=c.prototype,p=t.arrayPrototype,d=t.setPrototype,y=t.mapPrototype,T=0;for(let[e,t]of n){assert(e==T++);let r=0;if(t.isAcyclic&&(r|=16),t!==c&&t.extends(u)){let e=t.getArrayValueType();r|=1,t.extends(p)&&(r|=2),r|=32*m(e)}else if(t.extends(d)){let e=assert(t.getTypeArgumentsTo(d));assert(1==e.length),r|=4,r|=32*m(e[0])}else if(t.extends(y)){let e=assert(t.getTypeArgumentsTo(y));assert(2==e.length),r|=8,r|=16384*m(e[0]),r|=32*m(e[1])}_.writeI32(r,a,l),l+=4,t.rttiFlags=r;let n=t.base;_.writeI32(n?n.id:0,a,l),l+=4}assert(l==s);var g=t.options.usizeType,E=e.addMemorySegment(a);if(8==g.size){let e=E.offset;r.addGlobal(h.rtti_base,o.NativeType.I64,!1,r.i64(i64_low(e),i64_high(e)))}else r.addGlobal(h.rtti_base,o.NativeType.I32,!1,r.i32(i64_low(E.offset)))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5);class i{constructor(){this.text=[],this.functionId=0}static decompile(e){var t=new i;return t.decompile(e),t.finish()}decompile(e){throw new Error("not implemented")}decompileFunction(e){var t=n.getFunctionName(e)||"$"+this.functionId.toString(10),r=n.getFunctionBody(e);this.push("function "),this.push(t),this.push("(");for(let t=0,r=n.getFunctionParamCount(e);t<r;++t)t>0&&this.push(", "),this.push("$"),this.push(t.toString(10)),this.push(": "),this.push(s(n.getFunctionParamType(e,t)));this.push("): "),this.push(s(n.getFunctionResultType(e))),this.push(" "),n.getExpressionId(r)!=n.ExpressionId.Block&&this.push("{\n"),this.decompileExpression(r),n.getExpressionId(r)!=n.ExpressionId.Block&&this.push("\n}\n"),++this.functionId}decompileExpression(e){var t,r,i,a,o=n.getExpressionId(e),l=n.getExpressionType(e);switch(o){case n.ExpressionId.Block:for(null!=(r=n.getBlockName(e))&&(this.push(r),this.push(": ")),this.push("{\n"),a=n.getBlockChildCount(e),i=0;i<a;++i)this.decompileExpression(n.getBlockChild(e,i));return void this.push("}\n");case n.ExpressionId.If:return void(l==n.NativeType.None?(this.push("if ("),this.decompileExpression(n.getIfCondition(e)),this.push(") "),this.decompileExpression(n.getIfTrue(e)),(t=n.getIfFalse(e))&&(this.push(" else "),this.decompileExpression(t))):(this.decompileExpression(n.getIfCondition(e)),this.push(" ? "),this.decompileExpression(n.getIfTrue(e)),this.push(" : "),this.decompileExpression(n.getIfFalse(e))));case n.ExpressionId.Loop:null!=(r=n.getLoopName(e))&&(this.push(r),this.push(": ")),this.push("do "),this.decompileExpression(n.getLoopBody(e)),this.push("while (0);\n");case n.ExpressionId.Break:return(t=n.getBreakCondition(e))&&(this.push("if ("),this.decompileExpression(t),this.push(") ")),void(null!=(r=n.getBreakName(e))?(this.push("break "),this.push(r),this.push(";\n")):this.push("break;\n"));case n.ExpressionId.Switch:case n.ExpressionId.Call:case n.ExpressionId.CallIndirect:throw new Error("not implemented");case n.ExpressionId.LocalGet:return this.push("$"),void this.push(n.getLocalGetIndex(e).toString(10));case n.ExpressionId.LocalSet:return this.push("$"),this.push(n.getLocalSetIndex(e).toString(10)),this.push(" = "),void this.decompileExpression(n.getLocalSetValue(e));case n.ExpressionId.GlobalGet:case n.ExpressionId.GlobalSet:throw new Error("not implemented");case n.ExpressionId.Load:return this.push("load<"),this.push(s(l)),this.push(">("),this.push(n.getLoadOffset(e).toString(10)),this.push(" + "),this.decompileExpression(n.getLoadPtr(e)),void this.push(")");case n.ExpressionId.Store:return this.push("store<"),this.push(s(l)),this.push(">("),this.push(n.getStoreOffset(e).toString(10)),this.push(" + "),this.decompileExpression(n.getStorePtr(e)),this.push(", "),this.decompileExpression(n.getStoreValue(e)),void this.push(")");case n.ExpressionId.Const:switch(l){case n.NativeType.I32:return void this.push(n.getConstValueI32(e).toString(10));case n.NativeType.I64:return void this.push(i64_to_string(i64_new(n.getConstValueI64Low(e),n.getConstValueI64High(e))));case n.NativeType.F32:return void this.push(n.getConstValueF32(e).toString(10));case n.NativeType.F64:return void this.push(n.getConstValueF64(e).toString(10))}break;case n.ExpressionId.Unary:switch(n.getUnaryOp(e)){case n.UnaryOp.ClzI32:return this.push("clz<i32>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.CtzI32:return this.push("ctz<i32>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.PopcntI32:return this.push("popcnt<i32>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.NegF32:case n.UnaryOp.NegF64:return this.push("-"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.AbsF32:return this.push("abs<f32>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.CeilF32:return this.push("ceil<f32>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.FloorF32:return this.push("floor<f32>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.TruncF32:return this.push("trunc<f32>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.NearestF32:return this.push("nearest<i32>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.SqrtF32:return this.push("sqrt<f32>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.EqzI32:case n.UnaryOp.EqzI64:return this.push("!"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.ClzI64:return this.push("clz<i64>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.CtzI64:return this.push("ctz<i64>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.PopcntI64:return this.push("popcnt<i64>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.AbsF64:return this.push("abs<f64>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.CeilF64:return this.push("ceil<f64>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.FloorF64:return this.push("floor<f64>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.TruncF64:return this.push("trunc<f64>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.NearestF64:return this.push("nearest<f64>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.SqrtF64:return this.push("sqrt<f64>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.ExtendI32:return this.push("<i64>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.ExtendU32:return this.push("<i64><u64>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.WrapI64:case n.UnaryOp.TruncF32ToI32:return this.push("<i32>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.TruncF32ToI64:return this.push("<i64>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.TruncF32ToU32:return this.push("<i32><u32>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.TruncF32ToU64:return this.push("<i64><u64>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.TruncF64ToI32:return this.push("<i32>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.TruncF64ToI64:return this.push("<i64>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.TruncF64ToU32:return this.push("<i32><u32>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.TruncF64ToU64:return this.push("<i64><u64>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.ReinterpretF32:return this.push("reinterpret<f32,i32>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.ReinterpretF64:return this.push("reinterpret<f64,i64>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.ConvertI32ToF32:return this.push("<f32>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.ConvertI32ToF64:return this.push("<f64>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.ConvertU32ToF32:return this.push("<f32><u32>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.ConvertU32ToF64:return this.push("<f64><u32>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.ConvertI64ToF32:return this.push("<f32>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.ConvertI64ToF64:return this.push("<f64>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.ConvertU64ToF32:return this.push("<f32><u64>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.ConvertU64ToF64:return this.push("<f64><u64>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.PromoteF32:return this.push("<f64>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.DemoteF64:return this.push("<f32>"),void this.decompileExpression(n.getUnaryValue(e));case n.UnaryOp.ReinterpretI32:return this.push("reinterpret<i32,f32>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")");case n.UnaryOp.ReinterpretI64:return this.push("reinterpret<i64,f64>("),this.decompileExpression(n.getUnaryValue(e)),void this.push(")")}break;case n.ExpressionId.Binary:switch(n.getBinaryOp(e)){case n.BinaryOp.AddI32:case n.BinaryOp.AddI64:case n.BinaryOp.AddF32:case n.BinaryOp.AddF64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" + "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.SubI32:case n.BinaryOp.SubI64:case n.BinaryOp.SubF32:case n.BinaryOp.SubF64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" - "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.MulI32:case n.BinaryOp.MulI64:case n.BinaryOp.MulF32:case n.BinaryOp.MulF64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" * "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.DivI32:case n.BinaryOp.DivI64:case n.BinaryOp.DivF32:case n.BinaryOp.DivF64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" / "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.DivU32:return this.push("<i32>(<u32>"),this.decompileExpression(n.getBinaryLeft(e)),this.push(" / <u32>"),this.decompileExpression(n.getBinaryRight(e)),void this.push(")");case n.BinaryOp.RemI32:case n.BinaryOp.RemI64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" % "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.RemU32:return this.push("<i32>(<u32>"),this.decompileExpression(n.getBinaryLeft(e)),this.push(" / <u32>"),this.decompileExpression(n.getBinaryRight(e)),void this.push(")");case n.BinaryOp.AndI32:case n.BinaryOp.AndI64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" & "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.OrI32:case n.BinaryOp.OrI64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" | "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.XorI32:case n.BinaryOp.XorI64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" ^ "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.ShlI32:case n.BinaryOp.ShlI64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" << "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.ShrU32:case n.BinaryOp.ShrU64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" >>> "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.ShrI32:case n.BinaryOp.ShrI64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" >> "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.RotlI32:return this.push("rotl<i32>("),this.decompileExpression(n.getBinaryLeft(e)),this.push(", "),this.decompileExpression(n.getBinaryRight(e)),void this.push(")");case n.BinaryOp.RotrI32:return this.push("rotr<i32>("),this.decompileExpression(n.getBinaryLeft(e)),this.push(", "),this.decompileExpression(n.getBinaryRight(e)),void this.push(")");case n.BinaryOp.EqI32:case n.BinaryOp.EqI64:case n.BinaryOp.EqF32:case n.BinaryOp.EqF64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" == "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.NeI32:case n.BinaryOp.NeI64:case n.BinaryOp.NeF32:case n.BinaryOp.NeF64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" != "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.LtI32:case n.BinaryOp.LtI64:case n.BinaryOp.LtF32:case n.BinaryOp.LtF64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" < "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.LtU32:return this.push("<u32>"),this.decompileExpression(n.getBinaryLeft(e)),this.push(" < <u32>"),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.LeI32:case n.BinaryOp.LeI64:case n.BinaryOp.LeF32:case n.BinaryOp.LeF64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" <= "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.LeU32:return this.push("<u32>"),this.decompileExpression(n.getBinaryLeft(e)),this.push(" <= <u32>"),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.GtI32:case n.BinaryOp.GtI64:case n.BinaryOp.GtF32:case n.BinaryOp.GtF64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" > "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.GtU32:return this.push("<u32>"),this.decompileExpression(n.getBinaryLeft(e)),this.push(" > <u32>"),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.GeI32:case n.BinaryOp.GeI64:case n.BinaryOp.GeF32:case n.BinaryOp.GeF64:return this.decompileExpression(n.getBinaryLeft(e)),this.push(" >= "),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.GeU32:return this.push("<u32>"),this.decompileExpression(n.getBinaryLeft(e)),this.push(" >= <u32>"),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.DivU64:return this.push("<u64>"),this.decompileExpression(n.getBinaryLeft(e)),this.push(" / <u64>"),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.RemU64:return this.push("<u64>"),this.decompileExpression(n.getBinaryLeft(e)),this.push(" % <u64>"),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.RotlI64:return this.push("rotl<i64>("),this.decompileExpression(n.getBinaryLeft(e)),this.push(", "),this.decompileExpression(n.getBinaryRight(e)),void this.push(")");case n.BinaryOp.RotrI64:return this.push("rotr<i64>("),this.decompileExpression(n.getBinaryLeft(e)),this.push(", "),this.decompileExpression(n.getBinaryRight(e)),void this.push(")");case n.BinaryOp.LtU64:return this.push("<u64>"),this.decompileExpression(n.getBinaryLeft(e)),this.push(" < <u64>"),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.LeU64:return this.push("<u64>"),this.decompileExpression(n.getBinaryLeft(e)),this.push(" <= <u64>"),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.GtU64:return this.push("<u64>"),this.decompileExpression(n.getBinaryLeft(e)),this.push(" > <u64>"),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.GeU64:return this.push("<u64>"),this.decompileExpression(n.getBinaryLeft(e)),this.push(" >= <u64>"),void this.decompileExpression(n.getBinaryRight(e));case n.BinaryOp.CopysignF32:return this.push("copysign<f32>("),this.decompileExpression(n.getBinaryLeft(e)),this.push(", "),this.decompileExpression(n.getBinaryRight(e)),void this.push(")");case n.BinaryOp.MinF32:return this.push("min<f32>("),this.decompileExpression(n.getBinaryLeft(e)),this.push(", "),this.decompileExpression(n.getBinaryRight(e)),void this.push(")");case n.BinaryOp.MaxF32:return this.push("max<f32>("),this.decompileExpression(n.getBinaryLeft(e)),this.push(", "),this.decompileExpression(n.getBinaryRight(e)),void this.push(")");case n.BinaryOp.CopysignF64:return this.push("copysign<f64>("),this.decompileExpression(n.getBinaryLeft(e)),this.push(", "),this.decompileExpression(n.getBinaryRight(e)),void this.push(")");case n.BinaryOp.MinF64:return this.push("min<f64>("),this.decompileExpression(n.getBinaryLeft(e)),this.push(", "),this.decompileExpression(n.getBinaryRight(e)),void this.push(")");case n.BinaryOp.MaxF64:return this.push("max<f64>("),this.decompileExpression(n.getBinaryLeft(e)),this.push(", "),this.decompileExpression(n.getBinaryRight(e)),void this.push(")")}return;case n.ExpressionId.Select:return this.push("select<"),this.push(s(l)),this.push(">("),this.decompileExpression(n.getSelectThen(e)),this.push(", "),this.decompileExpression(n.getSelectElse(e)),this.push(", "),this.decompileExpression(n.getSelectCondition(e)),void this.push(")");case n.ExpressionId.Drop:return this.decompileExpression(n.getDropValue(e)),void this.push(";\n");case n.ExpressionId.Return:return void((t=n.getReturnValue(e))?(this.push("return "),this.decompileExpression(t),this.push(";\n")):this.push("return;\n"));case n.ExpressionId.Host:switch(n.getHostOp(e)){case n.HostOp.MemorySize:return void this.push("memory.size()");case n.HostOp.MemoryGrow:return this.push("memory.grow("),this.decompileExpression(n.getHostOperand(e,0)),void this.push(")")}break;case n.ExpressionId.Nop:return void this.push(";\n");case n.ExpressionId.Unreachable:return void this.push("unreachable()");case n.ExpressionId.AtomicCmpxchg:case n.ExpressionId.AtomicRMW:case n.ExpressionId.AtomicWait:case n.ExpressionId.AtomicNotify:}throw new Error("not implemented")}push(e){this.text.push(e)}finish(){var e=this.text.join("");return this.text=[],e}}function s(e){switch(e){case n.NativeType.None:return"void";case n.NativeType.I32:return"i32";case n.NativeType.I64:return"i64";case n.NativeType.F32:return"f32";case n.NativeType.F64:return"f64";case n.NativeType.V128:return"v128";case n.NativeType.Unreachable:throw new Error("unreachable type");case n.NativeType.Auto:throw new Error("auto type");default:throw new Error("unexpected type")}}t.Decompiler=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(4),s=r(3),a=r(1);class o{constructor(e,t=!1){this.seen=new Map,this.program=e,this.includePrivate}walk(){for(let e of this.program.filesByName.values())e.source.sourceKind==s.SourceKind.USER_ENTRY&&this.visitFile(e)}visitFile(e){var t=e.exports;if(t)for(let[e,r]of t)this.visitElement(e,r);var r=e.exportsStar;if(r)for(let e of r)this.visitFile(e)}visitElement(e,t){if(!t.is(n.CommonFlags.PRIVATE)||this.includePrivate){var r=this.seen;if(r.has(t))this.visitAlias(e,t,r.get(t));else switch(r.set(t,e),t.kind){case i.ElementKind.GLOBAL:t.is(n.CommonFlags.COMPILED)&&this.visitGlobal(e,t);break;case i.ElementKind.ENUM:t.is(n.CommonFlags.COMPILED)&&this.visitEnum(e,t);break;case i.ElementKind.FUNCTION_PROTOTYPE:this.visitFunctionInstances(e,t);break;case i.ElementKind.CLASS_PROTOTYPE:this.visitClassInstances(e,t);break;case i.ElementKind.FIELD:t.is(n.CommonFlags.COMPILED)&&this.visitField(e,t);break;case i.ElementKind.PROPERTY_PROTOTYPE:this.visitPropertyInstances(e,t);break;case i.ElementKind.PROPERTY:{let r=t,n=r.getterInstance;n&&this.visitFunction(e,n);let i=r.setterInstance;i&&this.visitFunction(e,i);break}case i.ElementKind.NAMESPACE:(function e(t){var r=t.members;if(r)for(let t of r.values())switch(t.kind){case i.ElementKind.FUNCTION_PROTOTYPE:case i.ElementKind.CLASS_PROTOTYPE:{let e=t.instances;if(e)for(let t of e.values())if(t.is(n.CommonFlags.COMPILED))return!0;break}default:if(t.is(n.CommonFlags.COMPILED)||e(t))return!0}return!1})(t)&&this.visitNamespace(e,t);break;case i.ElementKind.TYPEDEFINITION:break;default:assert(!1)}}}visitFunctionInstances(e,t){var r=t.instances;if(r)for(let t of r.values())t.is(n.CommonFlags.COMPILED)&&this.visitFunction(e,t)}visitClassInstances(e,t){var r=t.instances;if(r)for(let t of r.values())t.is(n.CommonFlags.COMPILED)&&this.visitClass(e,t)}visitPropertyInstances(e,t){assert(!1)}}t.ExportsWalker=o;class l extends o{constructor(e,t=!1){super(e,t),this.sb=[],this.indentLevel=0}static build(e){return new l(e).build()}visitGlobal(e,t){var r=this.sb,i=t.is(n.CommonFlags.INLINED);if(a.indent(r,this.indentLevel),i&&r.push("const "),r.push(this.typeToString(t.type)),r.push(" "),r.push(e),i)switch(t.constantValueKind){case 1:r.push(" = "),r.push(i64_to_string(t.constantIntegerValue));break;case 2:r.push(" = "),r.push(t.constantFloatValue.toString());break;default:assert(!1)}r.push(";\n")}visitEnum(e,t){var r=this.sb;a.indent(r,this.indentLevel++),r.push("interface "),r.push(e),r.push(" {\n");var s=t.members;if(s){for(let[e,t]of s)if(t.kind==i.ElementKind.ENUMVALUE){let i=t.is(n.CommonFlags.INLINED);a.indent(r,this.indentLevel),i?r.push("const "):r.push("readonly "),r.push("unsigned long "),r.push(e),i&&(r.push(" = "),assert(1==t.constantValueKind),r.push(i64_low(t.constantIntegerValue).toString(10))),r.push(";\n")}for(let e of s.values())e.kind!=i.ElementKind.ENUMVALUE&&this.visitElement(e.name,e)}a.indent(r,--this.indentLevel),r.push("}\n")}visitFunction(e,t){var r=this.sb,n=t.signature;a.indent(r,this.indentLevel),r.push(this.typeToString(n.returnType)),r.push(" "),r.push(e),r.push("(");var i=n.parameterTypes,s=i.length;for(let e=0;e<s;++e)e&&r.push(", "),r.push(this.typeToString(i[e])),r.push(" "),r.push(n.getParameterName(e));r.push(");\n");var o=t.members;if(o&&o.size){a.indent(r,this.indentLevel),r.push("interface "),r.push(t.name),r.push(" {\n");for(let e of o.values())this.visitElement(e.name,e);a.indent(r,--this.indentLevel),r.push("}\n")}}visitClass(e,t){var r=this.sb;a.indent(r,this.indentLevel++),r.push("interface "),r.push(e),r.push(" {\n"),a.indent(r,--this.indentLevel),r.push("}\n")}visitInterface(e,t){this.visitClass(e,t)}visitField(e,t){}visitNamespace(e,t){var r=this.sb;a.indent(r,this.indentLevel++),r.push("interface "),r.push(e),r.push(" {\n");var n=t.members;if(n)for(let e of n.values())this.visitElement(e.name,e);a.indent(r,--this.indentLevel),r.push("}\n")}visitAlias(e,t,r){}typeToString(e){switch(e.kind){case 0:return"byte";case 1:return"short";case 2:return"long";case 3:return"long long";case 4:return this.program.options.isWasm64?"long long":"long";case 5:return"octet";case 6:return"unsigned short";case 7:return"unsigned long";case 8:return"unsigned long long";case 9:return this.program.options.isWasm64?"unsigned long long":"unsigned long";case 10:return"boolean";case 11:return"unrestricted float";case 12:return"unrestricted double";case 15:return"void";default:return assert(!1),""}}build(){var e=this.sb;return e.push("interface ASModule {\n"),++this.indentLevel,this.walk(),--this.indentLevel,e.push("}\n"),e.join("")}}t.IDLBuilder=l;class c extends o{constructor(e,t=!1){super(e,t),this.sb=[],this.indentLevel=0,this.unknown=new Set}static build(e){return new c(e).build()}visitGlobal(e,t){var r=this.sb,i=t.is(n.CommonFlags.INLINED);a.indent(r,this.indentLevel),t.is(n.CommonFlags.STATIC)?i?r.push("static readonly "):r.push("static "):i?r.push("export const "):r.push("export var "),r.push(e),r.push(": "),r.push(this.typeToString(t.type)),r.push(";\n"),this.visitNamespace(e,t)}visitEnum(e,t){var r=this.sb;a.indent(r,this.indentLevel++),r.push("export enum "),r.push(e),r.push(" {\n");var s=t.members;if(s){let o=s.size;for(let[e,t]of s)t.kind==i.ElementKind.ENUMVALUE&&(a.indent(r,this.indentLevel),r.push(e),t.is(n.CommonFlags.INLINED)&&(r.push(" = "),assert(1==t.constantValueKind),r.push(i64_low(t.constantIntegerValue).toString(10))),r.push(",\n"),--o);o&&this.visitNamespace(e,t)}a.indent(r,--this.indentLevel),r.push("}\n")}visitFunction(e,t){if(!t.isAny(n.CommonFlags.PRIVATE|n.CommonFlags.SET)){var r=this.sb,i=t.signature;if(a.indent(r,this.indentLevel),t.is(n.CommonFlags.PROTECTED)&&r.push("protected "),t.is(n.CommonFlags.STATIC)&&r.push("static "),t.is(n.CommonFlags.GET))return r.push("get "),r.push(e),r.push("(): "),r.push(this.typeToString(i.returnType)),void r.push(";\n");t.isAny(n.CommonFlags.STATIC|n.CommonFlags.INSTANCE)||r.push("export function "),r.push(e),r.push("(");var s=i.parameterTypes,o=s.length;for(let e=0;e<o;++e)e&&r.push(", "),r.push(i.getParameterName(e)),r.push(": "),r.push(this.typeToString(s[e]));t.isAny(n.CommonFlags.CONSTRUCTOR|n.CommonFlags.SET)?r.push(")"):(r.push("): "),r.push(this.typeToString(i.returnType))),r.push(";\n"),this.visitNamespace(e,t)}}visitClass(e,t){var r=this.sb,s=t.kind==i.ElementKind.INTERFACE;a.indent(r,this.indentLevel++),s?r.push("export interface "):(t.is(n.CommonFlags.ABSTRACT)&&r.push("abstract "),r.push("export class ")),r.push(e),r.push(" {\n");var o=t.prototype.members;if(o)for(let e of o.values())this.visitElement(e.name,e);var l=t.members;if(l)for(let e of l.values())this.visitElement(e.name,e);a.indent(r,--this.indentLevel),r.push("}\n")}visitInterface(e,t){this.visitClass(e,t)}visitField(e,t){if(!t.is(n.CommonFlags.PRIVATE)){var r=this.sb;a.indent(r,this.indentLevel),t.is(n.CommonFlags.PROTECTED)&&r.push("protected "),t.is(n.CommonFlags.STATIC)&&r.push("static "),t.is(n.CommonFlags.READONLY)&&r.push("readonly "),r.push(e),r.push(": "),r.push(this.typeToString(t.type)),r.push(";\n")}}visitNamespace(e,t){var r=t.members;if(r&&r.size){let t=this.sb;a.indent(t,this.indentLevel++),t.push("export namespace "),t.push(e),t.push(" {\n");for(let e of r.values())this.visitElement(e.name,e);a.indent(t,--this.indentLevel),t.push("}\n")}}visitAlias(e,t,r){var n=this.sb;a.indent(n,this.indentLevel),n.push("export const "),n.push(e),n.push(": typeof "),n.push(r),n.push(";\n")}typeToString(e){switch(e.kind){case 0:return"i8";case 1:return"i16";case 2:return"i32";case 3:return"I64";case 4:return this.program.options.isWasm64?"I64":"i32";case 5:return"u8";case 6:return"u16";case 7:return"u32";case 8:return"U64";case 9:return this.program.options.isWasm64?"U64":"u32";case 10:return"bool";case 11:return"f32";case 12:return"f64";case 13:return"v128";case 15:return"void";default:return assert(!1),"any"}}build(){var e=this.sb;return e.push("declare module ASModule {\n"),e.push("  type i8 = number;\n"),e.push("  type i16 = number;\n"),e.push("  type i32 = number;\n"),e.push("  type u8 = number;\n"),e.push("  type u16 = number;\n"),e.push("  type u32 = number;\n"),e.push("  type f32 = number;\n"),e.push("  type f64 = number;\n"),e.push("  type bool = any;\n"),++this.indentLevel,this.walk(),--this.indentLevel,e.push("}\n"),e.push("export default ASModule;\n"),this.sb.join("")}}t.TSDBuilder=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(4),s=r(7),a=r(2),o=r(1),l=r(3);class c extends a.DiagnosticEmitter{constructor(){super(),this.backlog=new Array,this.seenlog=new Set,this.donelog=new Set,this.onComment=null,this.dependees=new Map,this.tryParseSignatureIsSignature=!1,this.parseParametersThis=null,this.program=new i.Program(this.diagnostics)}parseFile(e,t,r){var i=o.normalizePath(t),a=l.mangleInternalPath(i);if(!this.donelog.has(a)){this.donelog.add(a),this.seenlog.add(a);var c=new l.Source(i,e,r?l.SourceKind.USER_ENTRY:t.startsWith(n.LIBRARY_PREFIX)?t.indexOf(n.PATH_DELIMITER,n.LIBRARY_PREFIX.length)<0?l.SourceKind.LIBRARY_ENTRY:l.SourceKind.LIBRARY:l.SourceKind.USER),u=this.program;u.sources.push(c),this.currentSource=c;var p=new s.Tokenizer(c,u.diagnostics);p.onComment=this.onComment,c.tokenizer=p;for(var _=c.statements;!p.skip(s.Token.ENDOFFILE);){let e=this.parseTopLevelStatement(p,null);e&&_.push(e)}p.finish()}}parseTopLevelStatement(e,t=null){for(var r=n.CommonFlags.NONE,i=-1,o=null;e.skip(s.Token.AT);){i<0&&(i=e.tokenPos);let t=this.parseDecorator(e);t?o?o.push(t):o=[t]:this.skipStatement(e)}var c=0,u=0,p=0,_=0;e.skip(s.Token.EXPORT)&&(i<0&&(i=e.tokenPos),r|=n.CommonFlags.EXPORT,c=e.tokenPos,u=e.pos,e.skip(s.Token.DEFAULT)&&(p=e.tokenPos,_=e.pos));var h=0,d=0,y=null!=t&&t.is(n.CommonFlags.AMBIENT);e.skip(s.Token.DECLARE)?y?this.error(a.DiagnosticCode.A_declare_modifier_cannot_be_used_in_an_already_ambient_context,e.range()):(i<0&&(i=e.tokenPos),h=i,d=e.pos,r|=n.CommonFlags.DECLARE|n.CommonFlags.AMBIENT):y&&(r|=n.CommonFlags.AMBIENT);var T=null,m=e.peek();switch(i<0&&(i=e.nextTokenPos),m){case s.Token.CONST:e.next(),r|=n.CommonFlags.CONST,T=e.skip(s.Token.ENUM)?this.parseEnum(e,r,o,i):this.parseVariable(e,r,o,i),o=null;break;case s.Token.LET:r|=n.CommonFlags.LET;case s.Token.VAR:e.next(),T=this.parseVariable(e,r,o,i),o=null;break;case s.Token.ENUM:e.next(),T=this.parseEnum(e,r,o,i),o=null;break;case s.Token.FUNCTION:e.next(),T=this.parseFunction(e,r,o,i),o=null;break;case s.Token.ABSTRACT:{let t=e.mark();if(e.next(),!e.skip(s.Token.CLASS)){e.reset(t),T=this.parseStatement(e,!0);break}e.discard(t),r|=n.CommonFlags.ABSTRACT}case s.Token.CLASS:case s.Token.INTERFACE:e.next(),T=this.parseClassOrInterface(e,r,o,i),o=null;break;case s.Token.NAMESPACE:{let t=e.mark();e.next(),e.peek(!1,s.IdentifierHandling.PREFER)==s.Token.IDENTIFIER?(e.discard(t),T=this.parseNamespace(e,r,o,i),o=null):(e.reset(t),T=this.parseStatement(e,!0));break}case s.Token.IMPORT:e.next(),T=(r|=n.CommonFlags.IMPORT)&n.CommonFlags.EXPORT?this.parseExportImport(e,i):this.parseImport(e);break;case s.Token.TYPE:{let t=e.mark();e.next(),e.peek(!1,s.IdentifierHandling.PREFER)==s.Token.IDENTIFIER?(e.discard(t),T=this.parseTypeDeclaration(e,r,o,i),o=null):(e.reset(t),T=this.parseStatement(e,!0));break}default:r&n.CommonFlags.EXPORT?_&&e.skipIdentifier(s.IdentifierHandling.PREFER)?(d&&this.error(a.DiagnosticCode.An_export_assignment_cannot_have_modifiers,e.range(h,d)),T=this.parseExportDefaultAlias(e,i,p,_),p=_=0):T=this.parseExport(e,i,0!=(r&n.CommonFlags.DECLARE)):(u&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(c,u),"export"),d&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(h,d),"declare"),t||(T=this.parseStatement(e,!0)))}if(o)for(let e=0,t=o.length;e<t;++e)this.error(a.DiagnosticCode.Decorators_are_not_valid_here,o[e].range);if(_&&null!==T)switch(T.kind){case l.NodeKind.ENUMDECLARATION:case l.NodeKind.FUNCTIONDECLARATION:case l.NodeKind.CLASSDECLARATION:case l.NodeKind.INTERFACEDECLARATION:case l.NodeKind.NAMESPACEDECLARATION:return l.Node.createExportDefaultStatement(T,e.range(i,e.pos));default:this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(p,_),"default")}return T}nextFile(){var e=this.backlog;return e.length?e.shift():null}getDependee(e){var t=this.dependees.get(e);return t?t.internalPath:null}finish(){if(this.backlog.length)throw new Error("backlog is not empty");return this.backlog=[],this.seenlog.clear(),this.donelog.clear(),this.dependees.clear(),this.program}parseType(e,t=!0,r=!1){var n,i=e.next(),o=e.tokenPos;if(i==s.Token.OPENPAREN){let i=e.skip(s.Token.OPENPAREN),l=this.tryParseFunctionType(e);if(l){if(i){if(!e.skip(s.Token.CLOSEPAREN))return this.error(a.DiagnosticCode._0_expected,e.range(),")"),null;if(!e.skip(s.Token.BAR))return this.error(a.DiagnosticCode._0_expected,e.range(),"|"),null;e.skip(s.Token.NULL)||this.error(a.DiagnosticCode._0_expected,e.range(),"null"),l.isNullable=!0}return l}if(i||this.tryParseSignatureIsSignature)return this.error(a.DiagnosticCode.Unexpected_token,e.range()),null;if(!t)return this.error(a.DiagnosticCode.Unexpected_token,e.range()),null;{let t=this.parseType(e,!1,r);if(!t)return null;if(!e.skip(s.Token.CLOSEPAREN))return r||this.error(a.DiagnosticCode._0_expected,e.range(e.pos),")"),null;(n=t).range.start=o,n.range.end=e.pos}}else if(i==s.Token.VOID)n=l.Node.createNamedType(l.Node.createSimpleTypeName("void",e.range()),[],!1,e.range(o,e.pos));else if(i==s.Token.THIS)n=l.Node.createNamedType(l.Node.createSimpleTypeName("this",e.range()),[],!1,e.range(o,e.pos));else if(i==s.Token.TRUE||i==s.Token.FALSE)n=l.Node.createNamedType(l.Node.createSimpleTypeName("bool",e.range()),[],!1,e.range(o,e.pos));else if(i==s.Token.STRINGLITERAL)e.readString(),n=l.Node.createNamedType(l.Node.createSimpleTypeName("string",e.range()),[],!1,e.range(o,e.pos));else{if(i!=s.Token.IDENTIFIER)return r||this.error(a.DiagnosticCode.Identifier_expected,e.range()),null;{let t=l.Node.createSimpleTypeName(e.readIdentifier(),e.range()),i=t,c=null,u=!1;for(;e.skip(s.Token.DOT);){if(!e.skip(s.Token.IDENTIFIER))return this.error(a.DiagnosticCode.Identifier_expected,e.range(e.pos)),null;{let t=l.Node.createSimpleTypeName(e.readIdentifier(),e.range());i.next=t,i=t}}if(e.skip(s.Token.LESSTHAN)){do{let t=this.parseType(e,!0,r);if(!t)return null;c?c.push(t):c=[t]}while(e.skip(s.Token.COMMA));if(!e.skip(s.Token.GREATERTHAN))return r||this.error(a.DiagnosticCode._0_expected,e.range(e.pos),">"),null}for(;e.skip(s.Token.BAR);){if(!e.skip(s.Token.NULL))return r||this.error(a.DiagnosticCode._0_expected,e.range(e.pos),"null"),null;u=!0}n=l.Node.createNamedType(t,c||[],u,e.range(o,e.pos))}}for(;e.skip(s.Token.OPENBRACKET);){let t=e.tokenPos;if(!e.skip(s.Token.CLOSEBRACKET))return r||this.error(a.DiagnosticCode._0_expected,e.range(),"]"),null;let i=e.range(t,e.pos),c=!1;if(e.skip(s.Token.BAR)){if(!e.skip(s.Token.NULL))return r||this.error(a.DiagnosticCode._0_expected,e.range(),"null"),null;c=!0}if(n=l.Node.createNamedType(l.Node.createSimpleTypeName("Array",i),[n],c,e.range(o,e.pos)),c)break}return n}tryParseFunctionType(e){var t,r=e.mark(),n=e.tokenPos,i=null,o=null,c=!1,u=null,p=l.ParameterKind.DEFAULT;if(e.skip(s.Token.CLOSEPAREN))c=!0,e.discard(r),i=[];else{c=!1;do{let t=l.ParameterKind.DEFAULT;if(e.skip(s.Token.DOT_DOT_DOT)&&(c=!0,e.discard(r),t=l.ParameterKind.REST),e.skip(s.Token.THIS)){if(!e.skip(s.Token.COLON))return e.reset(r),this.tryParseSignatureIsSignature=!1,null;{c=!0,e.discard(r);let t=this.parseType(e,!1);if(!t)return null;if(t.kind!=l.NodeKind.NAMEDTYPE)return this.error(a.DiagnosticCode.Identifier_expected,t.range),this.tryParseSignatureIsSignature=!0,null;o=t}}else{if(!e.skipIdentifier())return c?this.error(a.DiagnosticCode.Identifier_expected,e.range()):e.reset(r),this.tryParseSignatureIsSignature=c,null;{let n=l.Node.createIdentifierExpression(e.readIdentifier(),e.range(e.tokenPos,e.pos));if(e.skip(s.Token.QUESTION)&&(c=!0,e.discard(r),t==l.ParameterKind.REST?this.error(a.DiagnosticCode.A_rest_parameter_cannot_be_optional,e.range()):t=l.ParameterKind.OPTIONAL),e.skip(s.Token.COLON)){c=!0,e.discard(r);let s=this.parseType(e);if(!s)return this.tryParseSignatureIsSignature=c,null;let a=new l.ParameterNode;a.parameterKind=t,a.name=n,a.type=s,i?i.push(a):i=[a]}else if(c||e.peek()==s.Token.COMMA&&(c=!0,e.discard(r)),c){let r=new l.ParameterNode;r.parameterKind=t,r.name=n,r.type=l.Node.createOmittedType(e.range().atEnd),i?i.push(r):i=[r],this.error(a.DiagnosticCode.Type_expected,r.type.range)}else i||(u=n,p=t)}}}while(e.skip(s.Token.COMMA));if(!e.skip(s.Token.CLOSEPAREN))return c?this.error(a.DiagnosticCode._0_expected,e.range(),")"):e.reset(r),this.tryParseSignatureIsSignature=c,null}if(!e.skip(s.Token.EQUALS_GREATERTHAN))return c?this.error(a.DiagnosticCode._0_expected,e.range(),"=>"):e.reset(r),this.tryParseSignatureIsSignature=c,null;if(!c&&(c=!0,e.discard(r),u)){let e=new l.ParameterNode;e.parameterKind=p,e.name=u,e.type=l.Node.createOmittedType(u.range.atEnd),i?i.push(e):i=[e],this.error(a.DiagnosticCode.Type_expected,e.type.range)}return(t=this.parseType(e))?(this.tryParseSignatureIsSignature=!0,l.Node.createFunctionType(i||[],t,o,!1,e.range(n,e.pos))):(this.tryParseSignatureIsSignature=c,null)}parseDecorator(e){var t=e.tokenPos;if(e.skipIdentifier()){let r,n=e.readIdentifier(),i=l.Node.createIdentifierExpression(n,e.range(t,e.pos));for(;e.skip(s.Token.DOT);){if(!e.skipIdentifier())return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null;n=e.readIdentifier(),i=l.Node.createPropertyAccessExpression(i,l.Node.createIdentifierExpression(n,e.range()),e.range(t,e.pos))}if(!e.skip(s.Token.OPENPAREN))return l.Node.createDecorator(i,null,e.range(t,e.pos));if(r=this.parseArguments(e))return l.Node.createDecorator(i,r,e.range(t,e.pos))}else this.error(a.DiagnosticCode.Identifier_expected,e.range());return null}parseVariable(e,t,r,n){var i=new Array;do{let n=this.parseVariableDeclaration(e,t,r);if(!n)return null;i.push(n)}while(e.skip(s.Token.COMMA));var a=l.Node.createVariableStatement(i,r,e.range(n,e.pos));return e.skip(s.Token.SEMICOLON),a}parseVariableDeclaration(e,t,r){if(!e.skipIdentifier())return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null;var i=l.Node.createIdentifierExpression(e.readIdentifier(),e.range());s.isIllegalVariableIdentifier(i.text)&&this.error(a.DiagnosticCode.Identifier_expected,i.range);var o=t;e.skip(s.Token.EXCLAMATION)&&(o|=n.CommonFlags.DEFINITE_ASSIGNMENT);var c=null;e.skip(s.Token.COLON)&&(c=this.parseType(e));var u=null;if(e.skip(s.Token.EQUALS)){if(o&n.CommonFlags.AMBIENT&&this.error(a.DiagnosticCode.Initializers_are_not_allowed_in_ambient_contexts,e.range()),!(u=this.parseExpression(e,2)))return null}else o&n.CommonFlags.CONST?o&n.CommonFlags.AMBIENT||this.error(a.DiagnosticCode._const_declarations_must_be_initialized,i.range):c||this.error(a.DiagnosticCode.Type_expected,e.range(e.pos));var p=s.Range.join(i.range,e.range());return o&n.CommonFlags.DEFINITE_ASSIGNMENT&&u&&this.error(a.DiagnosticCode.A_definite_assignment_assertion_is_not_permitted_in_this_context,p),l.Node.createVariableDeclaration(i,c,u,r,o,p)}parseEnum(e,t,r,i){if(e.next()!=s.Token.IDENTIFIER)return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null;var o=l.Node.createIdentifierExpression(e.readIdentifier(),e.range());if(e.next()!=s.Token.OPENBRACE)return this.error(a.DiagnosticCode._0_expected,e.range(),"{"),null;for(var c=new Array;!e.skip(s.Token.CLOSEBRACE);){let t=this.parseEnumValue(e,n.CommonFlags.NONE);if(!t)return null;if(c.push(t),!e.skip(s.Token.COMMA)){if(e.skip(s.Token.CLOSEBRACE))break;return this.error(a.DiagnosticCode._0_expected,e.range(),"}"),null}}var u=l.Node.createEnumDeclaration(o,c,r,t,e.range(i,e.pos));return e.skip(s.Token.SEMICOLON),u}parseEnumValue(e,t){if(!e.skipIdentifier())return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null;var r=l.Node.createIdentifierExpression(e.readIdentifier(),e.range()),n=null;return e.skip(s.Token.EQUALS)&&!(n=this.parseExpression(e,2))?null:l.Node.createEnumValueDeclaration(r,n,t,s.Range.join(r.range,e.range()))}parseReturn(e){var t=e.tokenPos,r=null;if(e.peek(!0)!=s.Token.SEMICOLON&&e.nextToken!=s.Token.CLOSEBRACE&&!e.nextTokenOnNewLine&&!(r=this.parseExpression(e)))return null;var n=l.Node.createReturnStatement(r,e.range(t,e.pos));return e.skip(s.Token.SEMICOLON),n}parseTypeParameters(e){for(var t=null,r=!1;!e.skip(s.Token.GREATERTHAN);){let n=this.parseTypeParameter(e);if(!n)return null;if(null!==n.defaultType?r=!0:r&&(this.error(a.DiagnosticCode.Required_type_parameters_may_not_follow_optional_type_parameters,n.range),n.defaultType=null),t?t.push(n):t=[n],!e.skip(s.Token.COMMA)){if(e.skip(s.Token.GREATERTHAN))break;return this.error(a.DiagnosticCode._0_expected,e.range(),">"),null}}return t&&t.length||this.error(a.DiagnosticCode.Type_parameter_list_cannot_be_empty,e.range()),t}parseTypeParameter(e){if(e.next()==s.Token.IDENTIFIER){let t=l.Node.createIdentifierExpression(e.readIdentifier(),e.range()),r=null;if(e.skip(s.Token.EXTENDS)){let t=this.parseType(e);if(!t)return null;if(t.kind!=l.NodeKind.NAMEDTYPE)return this.error(a.DiagnosticCode.Identifier_expected,t.range),null;r=t}let n=null;if(e.skip(s.Token.EQUALS)){let t=this.parseType(e);if(!t)return null;if(t.kind!=l.NodeKind.NAMEDTYPE)return this.error(a.DiagnosticCode.Identifier_expected,t.range),null;n=t}return l.Node.createTypeParameter(t,r,n,s.Range.join(t.range,e.range()))}return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null}parseParameters(e,t=!1){var r=new Array,n=null,i=!1,o=!1,c=null;if(this.parseParametersThis=null,e.skip(s.Token.THIS)){if(!e.skip(s.Token.COLON))return this.error(a.DiagnosticCode._0_expected,e.range(),":"),null;if(!(c=this.parseType(e)))return null;if(c.kind==l.NodeKind.NAMEDTYPE?this.parseParametersThis=c:this.error(a.DiagnosticCode.Identifier_expected,c.range),!e.skip(s.Token.COMMA))return e.skip(s.Token.CLOSEPAREN)?r:(this.error(a.DiagnosticCode._0_expected,e.range(),")"),null)}for(;!e.skip(s.Token.CLOSEPAREN);){let c=this.parseParameter(e,t);if(!c)return null;switch(n&&!o&&(this.error(a.DiagnosticCode.A_rest_parameter_must_be_last_in_a_parameter_list,n.name.range),o=!0),c.parameterKind){default:i&&this.error(a.DiagnosticCode.A_required_parameter_cannot_follow_an_optional_parameter,c.name.range);break;case l.ParameterKind.OPTIONAL:i=!0;break;case l.ParameterKind.REST:n=c}if(r.push(c),!e.skip(s.Token.COMMA)){if(e.skip(s.Token.CLOSEPAREN))break;return this.error(a.DiagnosticCode._0_expected,e.range(),")"),null}}return r}parseParameter(e,t=!1){var r=!1,i=!1,o=null,c=n.CommonFlags.NONE;if(t&&(e.skip(s.Token.PUBLIC)?(o=e.range(),c|=n.CommonFlags.PUBLIC):e.skip(s.Token.PROTECTED)?(o=e.range(),c|=n.CommonFlags.PROTECTED):e.skip(s.Token.PRIVATE)&&(o=e.range(),c|=n.CommonFlags.PRIVATE),e.peek()==s.Token.READONLY)){let t=e.mark();e.next(),e.peek()!=s.Token.COLON?(e.discard(t),o||(o=e.range()),c|=n.CommonFlags.READONLY):e.reset(t)}if(e.skip(s.Token.DOT_DOT_DOT)&&(c?this.error(a.DiagnosticCode.A_parameter_property_cannot_be_declared_using_a_rest_parameter,e.range()):o=e.range(),r=!0),e.skipIdentifier()){r||(o=e.range());let t=l.Node.createIdentifierExpression(e.readIdentifier(),e.range()),n=null;if((i=e.skip(s.Token.QUESTION))&&r&&this.error(a.DiagnosticCode.A_rest_parameter_cannot_be_optional,t.range),e.skip(s.Token.COLON)){if(!(n=this.parseType(e)))return null}else n=l.Node.createOmittedType(e.range(e.pos));let u=null;if(e.skip(s.Token.EQUALS)&&(r&&this.error(a.DiagnosticCode.A_rest_parameter_cannot_have_an_initializer,t.range),i?this.error(a.DiagnosticCode.Parameter_cannot_have_question_mark_and_initializer,t.range):i=!0,!(u=this.parseExpression(e,2))))return null;let p=l.Node.createParameter(t,n,u,r?l.ParameterKind.REST:i?l.ParameterKind.OPTIONAL:l.ParameterKind.DEFAULT,s.Range.join(o,e.range()));return p.flags|=c,p}return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null}parseFunction(e,t,r,i){if(!e.skipIdentifier())return this.error(a.DiagnosticCode.Identifier_expected,e.range(e.pos)),null;var o=l.Node.createIdentifierExpression(e.readIdentifier(),e.range()),c=-1,u=null;if(e.skip(s.Token.LESSTHAN)){if(c=e.tokenPos,!(u=this.parseTypeParameters(e)))return null;t|=n.CommonFlags.GENERIC}if(!e.skip(s.Token.OPENPAREN))return this.error(a.DiagnosticCode._0_expected,e.range(e.pos),"("),null;c<0&&(c=e.tokenPos);var p=this.parseParameters(e);if(!p)return null;var _=this.parseParametersThis,h=0!=(t&n.CommonFlags.SET);h&&(1!=p.length&&this.error(a.DiagnosticCode.A_set_accessor_must_have_exactly_one_parameter,o.range),p.length&&p[0].initializer&&this.error(a.DiagnosticCode.A_set_accessor_parameter_cannot_have_an_initializer,o.range)),t&n.CommonFlags.GET&&p.length&&this.error(a.DiagnosticCode.A_get_accessor_cannot_have_parameters,o.range);var d=null;if(e.skip(s.Token.COLON)&&!(d=this.parseType(e,!0,h)))return null;d||(d=l.Node.createOmittedType(e.range(e.pos)),h||this.error(a.DiagnosticCode.Type_expected,d.range));var y=l.Node.createFunctionType(p,d,_,!1,e.range(c,e.pos)),T=null;if(e.skip(s.Token.OPENBRACE)){if(t&n.CommonFlags.AMBIENT&&this.error(a.DiagnosticCode.An_implementation_cannot_be_declared_in_ambient_contexts,e.range()),!(T=this.parseBlockStatement(e,!1)))return null}else t&n.CommonFlags.AMBIENT||this.error(a.DiagnosticCode.Function_implementation_is_missing_or_not_immediately_following_the_declaration,e.range(e.pos));var m=l.Node.createFunctionDeclaration(o,u,y,T,r,t,0,e.range(i,e.pos));return e.skip(s.Token.SEMICOLON),m}parseFunctionExpression(e){var t,r=e.tokenPos,n=0;if(e.token==s.Token.FUNCTION){if(t=e.skipIdentifier()?l.Node.createIdentifierExpression(e.readIdentifier(),e.range()):l.Node.createEmptyIdentifierExpression(e.range(e.pos)),!e.skip(s.Token.OPENPAREN))return this.error(a.DiagnosticCode._0_expected,e.range(e.pos),"("),null}else n=1,assert(e.token==s.Token.OPENPAREN),t=l.Node.createEmptyIdentifierExpression(e.range(e.tokenPos));var i=e.pos,o=this.parseParameters(e);return o?this.parseFunctionExpressionCommon(e,t,o,n,r,i):null}parseFunctionExpressionCommon(e,t,r,i,o=-1,c=-1){o<0&&(o=t.range.start),c<0&&(c=o);var u=null;if(2!=i&&e.skip(s.Token.COLON)){if(!(u=this.parseType(e)))return null}else u=l.Node.createOmittedType(e.range(e.pos));if(i&&!e.skip(s.Token.EQUALS_GREATERTHAN))return this.error(a.DiagnosticCode._0_expected,e.range(e.pos),"=>"),null;var p=l.Node.createFunctionType(r,u,null,!1,e.range(c,e.pos)),_=null;if(i)if(e.skip(s.Token.OPENBRACE))_=this.parseBlockStatement(e,!1);else{let t=this.parseExpression(e,2);t&&(_=l.Node.createExpressionStatement(t))}else{if(!e.skip(s.Token.OPENBRACE))return this.error(a.DiagnosticCode._0_expected,e.range(e.pos),"{"),null;_=this.parseBlockStatement(e,!1)}if(!_)return null;var h=l.Node.createFunctionDeclaration(t,null,p,_,null,n.CommonFlags.NONE,i,e.range(o,e.pos));return l.Node.createFunctionExpression(h)}parseClassOrInterface(e,t,r,i){var o=e.token==s.Token.INTERFACE;if(!e.skipIdentifier())return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null;var c=l.Node.createIdentifierExpression(e.readIdentifier(),e.range()),u=null;if(e.skip(s.Token.LESSTHAN)){if(!(u=this.parseTypeParameters(e)))return null;t|=n.CommonFlags.GENERIC}var p=null;if(e.skip(s.Token.EXTENDS)){let t=this.parseType(e);if(!t)return null;if(t.kind!=l.NodeKind.NAMEDTYPE)return this.error(a.DiagnosticCode.Identifier_expected,t.range),null;p=t}var _=null;if(e.skip(s.Token.IMPLEMENTS)){o&&this.error(a.DiagnosticCode.Interface_declaration_cannot_have_implements_clause,e.range());do{let t=this.parseType(e);if(!t)return null;o||(_?_.push(t):_=[t])}while(e.skip(s.Token.COMMA))}if(!e.skip(s.Token.OPENBRACE))return this.error(a.DiagnosticCode._0_expected,e.range(),"{"),null;var h,d=new Array;if(o?(assert(!_),h=l.Node.createInterfaceDeclaration(c,u,p,d,r,t,e.range(i,e.pos))):h=l.Node.createClassDeclaration(c,u,p,_,d,r,t,e.range(i,e.pos)),!e.skip(s.Token.CLOSEBRACE))do{let t=this.parseClassMember(e,h);if(t)d.push(t);else if(this.skipStatement(e),e.skip(s.Token.ENDOFFILE))return this.error(a.DiagnosticCode._0_expected,e.range(),"}"),null}while(!e.skip(s.Token.CLOSEBRACE));return h.range.end=e.pos,h}parseClassExpression(e){var t,r=e.tokenPos;if(t=e.skipIdentifier()?l.Node.createIdentifierExpression(e.readIdentifier(),e.range()):l.Node.createEmptyIdentifierExpression(e.range(e.pos)),!e.skip(s.Token.OPENBRACE))return this.error(a.DiagnosticCode._0_expected,e.range(e.pos),"{"),null;var i=new Array,o=l.Node.createClassDeclaration(t,[],null,null,i,null,n.CommonFlags.NONE,e.range(r,e.pos));if(!e.skip(s.Token.CLOSEBRACE))do{let t=this.parseClassMember(e,o);if(t)i.push(t);else if(this.skipStatement(e),e.skip(s.Token.ENDOFFILE))return this.error(a.DiagnosticCode._0_expected,e.range(),"}"),null}while(!e.skip(s.Token.CLOSEBRACE));return o.range.end=e.pos,l.Node.createClassExpression(o)}parseClassMember(e,t){var r=e.pos,i=t.kind==l.NodeKind.INTERFACEDECLARATION,o=null;if(e.skip(s.Token.AT)){do{let t=this.parseDecorator(e);if(!t)break;o?o.push(t):o=[t]}while(e.skip(s.Token.AT));o&&i&&this.error(a.DiagnosticCode.Decorators_are_not_valid_here,s.Range.join(o[0].range,o[o.length-1].range))}var c=t.flags&n.CommonFlags.AMBIENT;i&&(c|=n.CommonFlags.VIRTUAL);var u=0,p=0;e.skip(s.Token.PUBLIC)?(i&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(),"public"),c|=n.CommonFlags.PUBLIC,u=e.tokenPos,p=e.pos):e.skip(s.Token.PRIVATE)?(i&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(),"private"),c|=n.CommonFlags.PRIVATE,u=e.tokenPos,p=e.pos):e.skip(s.Token.PROTECTED)&&(i&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(),"protected"),c|=n.CommonFlags.PROTECTED,u=e.tokenPos,p=e.pos);var _=0,h=0,d=0,y=0;e.skip(s.Token.STATIC)?(i&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(),"static"),c|=n.CommonFlags.STATIC,_=e.tokenPos,h=e.pos):(c|=n.CommonFlags.INSTANCE,e.skip(s.Token.ABSTRACT)&&(i&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(),"abstract"),c|=n.CommonFlags.ABSTRACT,d=e.tokenPos,y=e.pos),t.flags&n.CommonFlags.GENERIC&&(c|=n.CommonFlags.GENERIC_CONTEXT));var T=0,m=0;if(e.peek()==s.Token.READONLY){let t=e.mark();e.next(),e.peek()!=s.Token.COLON?(e.discard(t),c|=n.CommonFlags.READONLY,T=e.tokenPos,m=e.pos):e.reset(t)}var g,E=e.mark(),f=!1,I=!1,x=!1,b=0,A=0;if(i||(e.skip(s.Token.GET)?e.peek(!0,s.IdentifierHandling.PREFER)!=s.Token.IDENTIFIER||e.nextTokenOnNewLine?e.reset(E):(c|=n.CommonFlags.GET,I=!0,b=e.tokenPos,A=e.pos,c&n.CommonFlags.READONLY&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(T,m),"readonly")):e.skip(s.Token.SET)?e.peek(!0,s.IdentifierHandling.PREFER)!=s.Token.IDENTIFIER||e.nextTokenOnNewLine?e.reset(E):(c|=n.CommonFlags.SET,x=!0,b=e.tokenPos,A=e.pos,c&n.CommonFlags.READONLY&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(T,m),"readonly")):e.skip(s.Token.CONSTRUCTOR)&&(f=!0,(c|=n.CommonFlags.CONSTRUCTOR)&n.CommonFlags.STATIC&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(_,h),"static"),c&n.CommonFlags.ABSTRACT&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(d,y),"abstract"),c&n.CommonFlags.READONLY&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(T,m),"readonly"))),f)g=l.Node.createConstructorExpression(e.range());else{if(!I&&!x&&e.skip(s.Token.OPENBRACKET)){c&n.CommonFlags.PUBLIC?this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(u,p),"public"):c&n.CommonFlags.PROTECTED?this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(u,p),"protected"):c&n.CommonFlags.PRIVATE&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(u,p),"protected"),c&n.CommonFlags.STATIC&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(_,h),"static"),c&n.CommonFlags.ABSTRACT&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(d,y),"abstract"),c&n.CommonFlags.READONLY&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(T,m),"readonly");let t=this.parseIndexSignatureDeclaration(e,o);return t?(e.skip(s.Token.SEMICOLON),t):null}if(!e.skipIdentifier())return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null;g=l.Node.createIdentifierExpression(e.readIdentifier(),e.range())}var N=null;if(e.skip(s.Token.LESSTHAN)){let t=e.tokenPos;if(!(N=this.parseTypeParameters(e)))return null;f?this.error(a.DiagnosticCode.Type_parameters_cannot_appear_on_a_constructor_declaration,e.range(t,e.pos)):I||x?this.error(a.DiagnosticCode.An_accessor_cannot_have_type_parameters,e.range(t,e.pos)):c|=n.CommonFlags.GENERIC}if(e.skip(s.Token.OPENPAREN)){let u=e.tokenPos,p=this.parseParameters(e,f);if(!p)return null;let _=this.parseParametersThis;if(f)for(let e=0,r=p.length;e<r;++e){let r=p[e];if(r.isAny(n.CommonFlags.PUBLIC|n.CommonFlags.PROTECTED|n.CommonFlags.PRIVATE|n.CommonFlags.READONLY)){let i=l.Node.createFieldDeclaration(r.name,r.type,null,null,r.flags|n.CommonFlags.INSTANCE,r.range);i.parameterIndex=e,r.implicitFieldDeclaration=i,t.members.push(i)}}else I?p.length&&this.error(a.DiagnosticCode.A_get_accessor_cannot_have_parameters,g.range):x&&(1!=p.length&&this.error(a.DiagnosticCode.A_set_accessor_must_have_exactly_one_parameter,g.range),p.length&&p[0].initializer&&this.error(a.DiagnosticCode.A_set_accessor_parameter_cannot_have_an_initializer,g.range));let h=null;if(e.skip(s.Token.COLON)){if(g.kind==l.NodeKind.CONSTRUCTOR?this.error(a.DiagnosticCode.Type_annotation_cannot_appear_on_a_constructor_declaration,e.range()):x&&this.error(a.DiagnosticCode.A_set_accessor_cannot_have_a_return_type_annotation,e.range()),!(h=this.parseType(e,g.kind==l.NodeKind.CONSTRUCTOR||x)))return null}else h=l.Node.createOmittedType(e.range(e.pos)),x||g.kind==l.NodeKind.CONSTRUCTOR||this.error(a.DiagnosticCode.Type_expected,h.range);let d=l.Node.createFunctionType(p,h,_,!1,e.range(u,e.pos)),y=null;if(e.skip(s.Token.OPENBRACE)){if(c&n.CommonFlags.AMBIENT?this.error(a.DiagnosticCode.An_implementation_cannot_be_declared_in_ambient_contexts,e.range()):c&n.CommonFlags.ABSTRACT&&this.error(a.DiagnosticCode.Method_0_cannot_have_an_implementation_because_it_is_marked_abstract,e.range(),g.text),!(y=this.parseBlockStatement(e,!1)))return null}else c&n.CommonFlags.AMBIENT||i||this.error(a.DiagnosticCode.Function_implementation_is_missing_or_not_immediately_following_the_declaration,e.range());let T=l.Node.createMethodDeclaration(g,N,d,y,o,c,e.range(r,e.pos));return e.skip(s.Token.SEMICOLON),T}if(f)this.error(a.DiagnosticCode.Constructor_implementation_is_missing,g.range);else{if(!I&&!x){c&n.CommonFlags.ABSTRACT&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(d,y),"abstract"),c&n.CommonFlags.GET&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(0,0),"get"),c&n.CommonFlags.SET&&this.error(a.DiagnosticCode._0_modifier_cannot_be_used_here,e.range(b,A),"set");let t=null;if(e.skip(s.Token.QUESTION)&&this.error(a.DiagnosticCode.Optional_properties_are_not_supported,e.range(r,e.pos)),e.skip(s.Token.EXCLAMATION)&&(c|=n.CommonFlags.DEFINITE_ASSIGNMENT),e.skip(s.Token.COLON)){if(!(t=this.parseType(e)))return null}else this.error(a.DiagnosticCode.Type_expected,e.range());let u=null;if(e.skip(s.Token.EQUALS)&&!(u=this.parseExpression(e)))return null;let p=e.range(r,e.pos);c&n.CommonFlags.DEFINITE_ASSIGNMENT&&(c&n.CommonFlags.STATIC||i||u)&&this.error(a.DiagnosticCode.A_definite_assignment_assertion_is_not_permitted_in_this_context,p);let _=l.Node.createFieldDeclaration(g,t,u,o,c,p);return e.skip(s.Token.SEMICOLON),_}this.error(a.DiagnosticCode.Function_implementation_is_missing_or_not_immediately_following_the_declaration,g.range)}return null}parseIndexSignatureDeclaration(e,t){t&&t.length&&this.error(a.DiagnosticCode.Decorators_are_not_valid_here,s.Range.join(t[0].range,t[t.length-1].range));var r=e.tokenPos;if(e.skipIdentifier()){if("key"==e.readIdentifier())if(e.skip(s.Token.COLON)){let t=this.parseType(e);if(!t)return null;if(t.kind!=l.NodeKind.NAMEDTYPE)return this.error(a.DiagnosticCode.Type_expected,e.range()),null;if(e.skip(s.Token.CLOSEBRACKET)){if(e.skip(s.Token.COLON)){let n=this.parseType(e);return n?l.Node.createIndexSignatureDeclaration(t,n,e.range(r,e.pos)):null}this.error(a.DiagnosticCode._0_expected,e.range(),":")}else this.error(a.DiagnosticCode._0_expected,e.range(),"]")}else this.error(a.DiagnosticCode._0_expected,e.range(),":");else this.error(a.DiagnosticCode._0_expected,e.range(),"key")}else this.error(a.DiagnosticCode.Identifier_expected,e.range());return null}parseNamespace(e,t,r,n){if(e.skipIdentifier()){let i=l.Node.createIdentifierExpression(e.readIdentifier(),e.range());if(e.skip(s.Token.OPENBRACE)){let o=new Array,c=l.Node.createNamespaceDeclaration(i,o,r,t,e.range(n,e.pos));for(;!e.skip(s.Token.CLOSEBRACE);){let t=this.parseTopLevelStatement(e,c);if(t)o.push(t);else if(this.skipStatement(e),e.skip(s.Token.ENDOFFILE))return this.error(a.DiagnosticCode._0_expected,e.range(),"}"),null}return c.range.end=e.pos,e.skip(s.Token.SEMICOLON),c}this.error(a.DiagnosticCode._0_expected,e.range(),"{")}else this.error(a.DiagnosticCode.Identifier_expected,e.range());return null}parseExport(e,t,r){var n=null;if(e.skip(s.Token.OPENBRACE)){let i=new Array;for(;!e.skip(s.Token.CLOSEBRACE);){let t=this.parseExportMember(e);if(!t)return null;if(i.push(t),!e.skip(s.Token.COMMA)){if(e.skip(s.Token.CLOSEBRACE))break;return this.error(a.DiagnosticCode._0_expected,e.range(),"}"),null}}if(e.skip(s.Token.FROM)){if(!e.skip(s.Token.STRINGLITERAL))return this.error(a.DiagnosticCode.String_literal_expected,e.range()),null;n=l.Node.createStringLiteralExpression(e.readString(),e.range())}let o=l.Node.createExportStatement(i,n,r,e.range(t,e.pos)),c=o.internalPath;return null===c||this.seenlog.has(c)||(this.dependees.set(c,this.currentSource),this.backlog.push(c),this.seenlog.add(c)),e.skip(s.Token.SEMICOLON),o}if(e.skip(s.Token.ASTERISK))if(e.skip(s.Token.FROM)){if(e.skip(s.Token.STRINGLITERAL)){n=l.Node.createStringLiteralExpression(e.readString(),e.range());let i=l.Node.createExportStatement(null,n,r,e.range(t,e.pos)),a=assert(i.internalPath),o=e.source;return o.exportPaths||(o.exportPaths=new Set),o.exportPaths.add(a),this.seenlog.has(a)||(this.dependees.set(a,this.currentSource),this.backlog.push(a)),e.skip(s.Token.SEMICOLON),i}this.error(a.DiagnosticCode.String_literal_expected,e.range())}else this.error(a.DiagnosticCode._0_expected,e.range(),"from");else this.error(a.DiagnosticCode._0_expected,e.range(),"{");return null}parseExportMember(e){if(e.skipIdentifier()){let t=l.Node.createIdentifierExpression(e.readIdentifier(),e.range()),r=null;if(e.skip(s.Token.AS)){if(!e.skipIdentifier(s.IdentifierHandling.ALWAYS))return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null;r=l.Node.createIdentifierExpression(e.readIdentifier(),e.range())}return l.Node.createExportMember(t,r,r?s.Range.join(t.range,r.range):t.range)}return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null}parseExportDefaultAlias(e,t,r,n){var i=e.readIdentifier(),a=e.range(),o=l.Node.createExportStatement([l.Node.createExportMember(l.Node.createIdentifierExpression(i,a),l.Node.createIdentifierExpression("default",e.range(r,n)),a)],null,!1,e.range(t,e.pos));return e.skip(s.Token.SEMICOLON),o}parseImport(e){var t=e.tokenPos,r=null,n=null,i=!1;if(e.skip(s.Token.OPENBRACE))for(r=new Array;!e.skip(s.Token.CLOSEBRACE);){let t=this.parseImportDeclaration(e);if(!t)return null;if(r.push(t),!e.skip(s.Token.COMMA)){if(e.skip(s.Token.CLOSEBRACE))break;return this.error(a.DiagnosticCode._0_expected,e.range(),"}"),null}}else if(e.skip(s.Token.ASTERISK)){if(!e.skip(s.Token.AS))return this.error(a.DiagnosticCode._0_expected,e.range(),"as"),null;if(!e.skipIdentifier())return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null;n=l.Node.createIdentifierExpression(e.readIdentifier(),e.range())}else if(e.skip(s.Token.IDENTIFIER,s.IdentifierHandling.PREFER)){let t=e.readIdentifier(),n=e.range();if(r=[l.Node.createImportDeclaration(l.Node.createIdentifierExpression("default",n),l.Node.createIdentifierExpression(t,n),n)],e.skip(s.Token.COMMA))return this.error(a.DiagnosticCode.Not_implemented,e.range()),null}else i=!0;if(i||e.skip(s.Token.FROM)){if(e.skip(s.Token.STRINGLITERAL)){let i,a=l.Node.createStringLiteralExpression(e.readString(),e.range());n?(assert(!r),i=l.Node.createImportStatementWithWildcard(n,a,e.range(t,e.pos))):i=l.Node.createImportStatement(r,a,e.range(t,e.pos));let o=i.internalPath;return this.seenlog.has(o)||(this.dependees.set(o,this.currentSource),this.backlog.push(o)),e.skip(s.Token.SEMICOLON),i}this.error(a.DiagnosticCode.String_literal_expected,e.range())}else this.error(a.DiagnosticCode._0_expected,e.range(),"from");return null}parseImportDeclaration(e){if(e.skipIdentifier(s.IdentifierHandling.ALWAYS)){let t=l.Node.createIdentifierExpression(e.readIdentifier(),e.range()),r=null;if(e.skip(s.Token.AS)){if(!e.skipIdentifier())return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null;r=l.Node.createIdentifierExpression(e.readIdentifier(),e.range())}return l.Node.createImportDeclaration(t,r,r?s.Range.join(t.range,r.range):t.range)}return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null}parseExportImport(e,t){if(e.skipIdentifier()){let r=l.Node.createIdentifierExpression(e.readIdentifier(),e.range());if(e.skip(s.Token.EQUALS)){if(e.skipIdentifier()){let n=l.Node.createIdentifierExpression(e.readIdentifier(),e.range()),i=l.Node.createExportImportStatement(n,r,e.range(t,e.pos));return e.skip(s.Token.SEMICOLON),i}this.error(a.DiagnosticCode.Identifier_expected,e.range())}else this.error(a.DiagnosticCode._0_expected,e.range(),"=")}else this.error(a.DiagnosticCode.Identifier_expected,e.range());return null}parseStatement(e,t=!1){var r=e.mark(),i=null;switch(e.next()){case s.Token.BREAK:i=this.parseBreak(e);break;case s.Token.CONST:i=this.parseVariable(e,n.CommonFlags.CONST,null,e.tokenPos);break;case s.Token.CONTINUE:i=this.parseContinue(e);break;case s.Token.DO:i=this.parseDoStatement(e);break;case s.Token.FOR:i=this.parseForStatement(e);break;case s.Token.IF:i=this.parseIfStatement(e);break;case s.Token.LET:i=this.parseVariable(e,n.CommonFlags.LET,null,e.tokenPos);break;case s.Token.VAR:i=this.parseVariable(e,n.CommonFlags.NONE,null,e.tokenPos);break;case s.Token.OPENBRACE:i=this.parseBlockStatement(e,t);break;case s.Token.RETURN:t&&this.error(a.DiagnosticCode.A_return_statement_can_only_be_used_within_a_function_body,e.range()),i=this.parseReturn(e);break;case s.Token.SEMICOLON:return l.Node.createEmptyStatement(e.range(e.tokenPos));case s.Token.SWITCH:i=this.parseSwitchStatement(e);break;case s.Token.THROW:i=this.parseThrowStatement(e);break;case s.Token.TRY:i=this.parseTryStatement(e);break;case s.Token.VOID:i=this.parseVoidStatement(e);break;case s.Token.WHILE:i=this.parseWhileStatement(e);break;case s.Token.TYPE:if(e.peek(!1,s.IdentifierHandling.PREFER)==s.Token.IDENTIFIER){i=this.parseTypeDeclaration(e,n.CommonFlags.NONE,null,e.tokenPos);break}default:e.reset(r),i=this.parseExpressionStatement(e)}return i?e.discard(r):(e.reset(r),this.skipStatement(e)),i}parseBlockStatement(e,t){for(var r=e.tokenPos,n=new Array;!e.skip(s.Token.CLOSEBRACE);){let r=e.mark(),i=this.parseStatement(e,t);if(i)e.discard(r),n.push(i);else{if(e.token==s.Token.ENDOFFILE)return null;e.reset(r),this.skipStatement(e)}}var i=l.Node.createBlockStatement(n,e.range(r,e.pos));return e.skip(s.Token.SEMICOLON),i}parseBreak(e){var t=null;e.peek(!0)!=s.Token.IDENTIFIER||e.nextTokenOnNewLine||(e.next(s.IdentifierHandling.PREFER),t=l.Node.createIdentifierExpression(e.readIdentifier(),e.range()));var r=l.Node.createBreakStatement(t,e.range());return e.skip(s.Token.SEMICOLON),r}parseContinue(e){var t=null;e.peek(!0)!=s.Token.IDENTIFIER||e.nextTokenOnNewLine||(e.next(s.IdentifierHandling.PREFER),t=l.Node.createIdentifierExpression(e.readIdentifier(),e.range()));var r=l.Node.createContinueStatement(t,e.range());return e.skip(s.Token.SEMICOLON),r}parseDoStatement(e){var t=e.tokenPos,r=this.parseStatement(e);if(!r)return null;if(e.skip(s.Token.WHILE))if(e.skip(s.Token.OPENPAREN)){let n=this.parseExpression(e);if(!n)return null;if(e.skip(s.Token.CLOSEPAREN)){let i=l.Node.createDoStatement(r,n,e.range(t,e.pos));return e.skip(s.Token.SEMICOLON),i}this.error(a.DiagnosticCode._0_expected,e.range(),")")}else this.error(a.DiagnosticCode._0_expected,e.range(),"(");else this.error(a.DiagnosticCode._0_expected,e.range(),"while");return null}parseExpressionStatement(e){var t=this.parseExpression(e);if(!t)return null;var r=l.Node.createExpressionStatement(t);return e.skip(s.Token.SEMICOLON),r}parseForStatement(e){var t=e.tokenPos;if(e.skip(s.Token.OPENPAREN)){let r=null;if(e.skip(s.Token.CONST))r=this.parseVariable(e,n.CommonFlags.CONST,null,e.tokenPos);else if(e.skip(s.Token.LET))r=this.parseVariable(e,n.CommonFlags.LET,null,e.tokenPos);else if(e.skip(s.Token.VAR))r=this.parseVariable(e,n.CommonFlags.NONE,null,e.tokenPos);else if(!e.skip(s.Token.SEMICOLON)&&!(r=this.parseExpressionStatement(e)))return null;if(e.token==s.Token.SEMICOLON){let n=null;if(!e.skip(s.Token.SEMICOLON)&&!(n=this.parseExpressionStatement(e)))return null;if(e.token==s.Token.SEMICOLON){let i=null;if(!e.skip(s.Token.CLOSEPAREN)){if(!(i=this.parseExpression(e)))return null;if(!e.skip(s.Token.CLOSEPAREN))return this.error(a.DiagnosticCode._0_expected,e.range(),")"),null}let o=this.parseStatement(e);return o?l.Node.createForStatement(r,n?n.expression:null,i,o,e.range(t,e.pos)):null}this.error(a.DiagnosticCode._0_expected,e.range(),";")}else this.error(a.DiagnosticCode._0_expected,e.range(),";")}else this.error(a.DiagnosticCode._0_expected,e.range(),"(");return null}parseIfStatement(e){var t=e.tokenPos;if(e.skip(s.Token.OPENPAREN)){let r=this.parseExpression(e);if(!r)return null;if(e.skip(s.Token.CLOSEPAREN)){let n=this.parseStatement(e);if(!n)return null;let i=null;return e.skip(s.Token.ELSE)&&!(i=this.parseStatement(e))?null:l.Node.createIfStatement(r,n,i,e.range(t,e.pos))}this.error(a.DiagnosticCode._0_expected,e.range(),")")}else this.error(a.DiagnosticCode._0_expected,e.range(),"(");return null}parseSwitchStatement(e){var t=e.tokenPos;if(e.skip(s.Token.OPENPAREN)){let r=this.parseExpression(e);if(!r)return null;if(e.skip(s.Token.CLOSEPAREN)){if(e.skip(s.Token.OPENBRACE)){let n=new Array;for(;!e.skip(s.Token.CLOSEBRACE);){let t=this.parseSwitchCase(e);if(!t)return null;n.push(t)}let i=l.Node.createSwitchStatement(r,n,e.range(t,e.pos));return e.skip(s.Token.SEMICOLON),i}this.error(a.DiagnosticCode._0_expected,e.range(),"{")}else this.error(a.DiagnosticCode._0_expected,e.range(),")")}else this.error(a.DiagnosticCode._0_expected,e.range(),"(");return null}parseSwitchCase(e){var t,r,n=e.tokenPos;if(e.skip(s.Token.CASE)){let i=this.parseExpression(e);if(!i)return null;if(e.skip(s.Token.COLON)){for(t=new Array;e.peek()!=s.Token.CASE&&e.nextToken!=s.Token.DEFAULT&&e.nextToken!=s.Token.CLOSEBRACE;){if(!(r=this.parseStatement(e)))return null;t.push(r)}return l.Node.createSwitchCase(i,t,e.range(n,e.pos))}this.error(a.DiagnosticCode._0_expected,e.range(),":")}else if(e.skip(s.Token.DEFAULT)){if(e.skip(s.Token.COLON)){for(t=new Array;e.peek()!=s.Token.CASE&&e.nextToken!=s.Token.DEFAULT&&e.nextToken!=s.Token.CLOSEBRACE;){if(!(r=this.parseStatement(e)))return null;t.push(r)}return l.Node.createSwitchCase(null,t,e.range(n,e.pos))}this.error(a.DiagnosticCode._0_expected,e.range(),":")}else this.error(a.DiagnosticCode._case_or_default_expected,e.range());return null}parseThrowStatement(e){var t=e.tokenPos,r=this.parseExpression(e);if(!r)return null;var n=l.Node.createThrowStatement(r,e.range(t,e.pos));return e.skip(s.Token.SEMICOLON),n}parseTryStatement(e){var t,r=e.tokenPos;if(e.skip(s.Token.OPENBRACE)){let n=new Array;for(;!e.skip(s.Token.CLOSEBRACE);){if(!(t=this.parseStatement(e)))return null;n.push(t)}let i=null,o=null,c=null;if(e.skip(s.Token.CATCH)){if(!e.skip(s.Token.OPENPAREN))return this.error(a.DiagnosticCode._0_expected,e.range(),"("),null;if(!e.skipIdentifier())return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null;if(i=l.Node.createIdentifierExpression(e.readIdentifier(),e.range()),!e.skip(s.Token.CLOSEPAREN))return this.error(a.DiagnosticCode._0_expected,e.range(),")"),null;if(!e.skip(s.Token.OPENBRACE))return this.error(a.DiagnosticCode._0_expected,e.range(),"{"),null;for(o=[];!e.skip(s.Token.CLOSEBRACE);){if(!(t=this.parseStatement(e)))return null;o.push(t)}}if(e.skip(s.Token.FINALLY)){if(!e.skip(s.Token.OPENBRACE))return this.error(a.DiagnosticCode._0_expected,e.range(),"{"),null;for(c=[];!e.skip(s.Token.CLOSEBRACE);){if(!(t=this.parseStatement(e)))return null;c.push(t)}}if(!o&&!c)return this.error(a.DiagnosticCode._0_expected,e.range(),"catch"),null;let u=l.Node.createTryStatement(n,i,o,c,e.range(r,e.pos));return e.skip(s.Token.SEMICOLON),u}return this.error(a.DiagnosticCode._0_expected,e.range(),"{"),null}parseTypeDeclaration(e,t,r,i){if(e.skipIdentifier()){let o=l.Node.createIdentifierExpression(e.readIdentifier(),e.range()),c=null;if(e.skip(s.Token.LESSTHAN)){if(!(c=this.parseTypeParameters(e)))return null;t|=n.CommonFlags.GENERIC}if(e.skip(s.Token.EQUALS)){let n=this.parseType(e);if(!n)return null;let a=l.Node.createTypeDeclaration(o,c,n,r,t,e.range(i,e.pos));return e.skip(s.Token.SEMICOLON),a}this.error(a.DiagnosticCode._0_expected,e.range(),"=")}else this.error(a.DiagnosticCode.Identifier_expected,e.range());return null}parseVoidStatement(e){var t=e.tokenPos,r=this.parseExpression(e,21);if(!r)return null;var n=l.Node.createVoidStatement(r,e.range(t,e.pos));return e.skip(s.Token.SEMICOLON),n}parseWhileStatement(e){var t=e.tokenPos;if(e.skip(s.Token.OPENPAREN)){let r=this.parseExpression(e);if(!r)return null;if(e.skip(s.Token.CLOSEPAREN)){let n=this.parseStatement(e);if(!n)return null;let i=l.Node.createWhileStatement(r,n,e.range(t,e.pos));return e.skip(s.Token.SEMICOLON),i}this.error(a.DiagnosticCode._0_expected,e.range(),")")}else this.error(a.DiagnosticCode._0_expected,e.range(),"(");return null}parseExpressionStart(e){var t=e.next(s.IdentifierHandling.PREFER),r=e.tokenPos,n=function(e){switch(e){case s.Token.DOT_DOT_DOT:return 2;case s.Token.YIELD:return 3;case s.Token.EXCLAMATION:case s.Token.TILDE:case s.Token.PLUS:case s.Token.MINUS:case s.Token.PLUS_PLUS:case s.Token.MINUS_MINUS:case s.Token.TYPEOF:case s.Token.VOID:case s.Token.DELETE:return 17;case s.Token.NEW:return 20}return 0}(t);if(0!=n){let i;return t==s.Token.NEW?(i=this.parseExpression(e,19))?i.kind==l.NodeKind.CALL?l.Node.createNewExpression(i.expression,i.typeArguments,i.arguments,e.range(r,e.pos)):(this.error(a.DiagnosticCode.This_expression_is_not_constructable,i.range),null):null:(i=this.parseExpression(e,n))?(t!=s.Token.PLUS_PLUS&&t!=s.Token.MINUS_MINUS||i.kind!=l.NodeKind.IDENTIFIER&&i.kind!=l.NodeKind.ELEMENTACCESS&&i.kind!=l.NodeKind.PROPERTYACCESS&&this.error(a.DiagnosticCode.The_operand_of_an_increment_or_decrement_operator_must_be_a_variable_or_a_property_access,i.range),l.Node.createUnaryPrefixExpression(t,i,e.range(r,e.pos))):null}var i=null;switch(t){case s.Token.NULL:return l.Node.createNullExpression(e.range());case s.Token.TRUE:return l.Node.createTrueExpression(e.range());case s.Token.FALSE:return l.Node.createFalseExpression(e.range());case s.Token.OPENPAREN:{if(e.skip(s.Token.CLOSEPAREN))return this.parseFunctionExpressionCommon(e,l.Node.createEmptyIdentifierExpression(e.range(r)),[],1);let t=e.mark(),n=!0;do{switch(e.next(s.IdentifierHandling.PREFER)){case s.Token.DOT_DOT_DOT:return e.reset(t),this.parseFunctionExpression(e);case s.Token.IDENTIFIER:switch(e.readIdentifier(),e.next()){case s.Token.CLOSEPAREN:if(!e.skip(s.Token.COLON)&&!e.skip(s.Token.EQUALS_GREATERTHAN)){n=!1;break}case s.Token.COLON:return e.reset(t),this.parseFunctionExpression(e);case s.Token.QUESTION:if(e.skip(s.Token.COLON)||e.skip(s.Token.COMMA)||e.skip(s.Token.CLOSEPAREN))return e.reset(t),this.parseFunctionExpression(e);n=!1;break;case s.Token.COMMA:break;default:n=!1}break;default:n=!1}}while(n);return e.reset(t),(i=this.parseExpression(e))?e.skip(s.Token.CLOSEPAREN)?l.Node.createParenthesizedExpression(i,e.range(r,e.pos)):(this.error(a.DiagnosticCode._0_expected,e.range(),")"),null):null}case s.Token.OPENBRACKET:{let t=new Array;for(;!e.skip(s.Token.CLOSEBRACKET);){if(e.peek()==s.Token.COMMA)i=null;else if(!(i=this.parseExpression(e,2)))return null;if(t.push(i),!e.skip(s.Token.COMMA)){if(e.skip(s.Token.CLOSEBRACKET))break;return this.error(a.DiagnosticCode._0_expected,e.range(),"]"),null}}return l.Node.createArrayLiteralExpression(t,e.range(r,e.pos))}case s.Token.OPENBRACE:{let t,r=e.tokenPos,n=new Array,i=new Array;for(;!e.skip(s.Token.CLOSEBRACE);){if(e.skipIdentifier())t=l.Node.createIdentifierExpression(e.readIdentifier(),e.range());else{if(!e.skip(s.Token.STRINGLITERAL))return this.error(a.DiagnosticCode.Identifier_expected,e.range()),null;(t=l.Node.createIdentifierExpression(e.readString(),e.range())).isQuoted=!0}if(n.push(t),e.skip(s.Token.COLON)){let t=this.parseExpression(e,2);if(!t)return null;i.push(t)}else{if(t.isQuoted)return this.error(a.DiagnosticCode._0_expected,e.range(),":"),null;i.push(t)}if(!e.skip(s.Token.COMMA)){if(e.skip(s.Token.CLOSEBRACE))break;return this.error(a.DiagnosticCode._0_expected,e.range(),"}"),null}}return l.Node.createObjectLiteralExpression(n,i,e.range(r,e.pos))}case s.Token.LESSTHAN:{let t=this.parseType(e);return t?e.skip(s.Token.GREATERTHAN)?(i=this.parseExpression(e,19))?l.Node.createAssertionExpression(l.AssertionKind.PREFIX,i,t,e.range(r,e.pos)):null:(this.error(a.DiagnosticCode._0_expected,e.range(),">"),null):null}case s.Token.IDENTIFIER:{let t=e.readIdentifier();if("null"==t)return l.Node.createNullExpression(e.range());let n=l.Node.createIdentifierExpression(t,e.range(r,e.pos));return e.peek(!0)!=s.Token.EQUALS_GREATERTHAN||e.nextTokenOnNewLine?n:this.parseFunctionExpressionCommon(e,l.Node.createEmptyIdentifierExpression(e.range(r)),[l.Node.createParameter(n,l.Node.createOmittedType(n.range.atEnd),null,l.ParameterKind.DEFAULT,n.range)],2,r)}case s.Token.THIS:return l.Node.createThisExpression(e.range(r,e.pos));case s.Token.CONSTRUCTOR:return l.Node.createConstructorExpression(e.range(r,e.pos));case s.Token.SUPER:return e.peek()!=s.Token.DOT&&e.nextToken!=s.Token.OPENPAREN&&this.error(a.DiagnosticCode._super_must_be_followed_by_an_argument_list_or_member_access,e.range()),l.Node.createSuperExpression(e.range(r,e.pos));case s.Token.STRINGLITERAL:return l.Node.createStringLiteralExpression(e.readString(),e.range(r,e.pos));case s.Token.INTEGERLITERAL:return l.Node.createIntegerLiteralExpression(e.readInteger(),e.range(r,e.pos));case s.Token.FLOATLITERAL:return l.Node.createFloatLiteralExpression(e.readFloat(),e.range(r,e.pos));case s.Token.SLASH:{let t=e.readRegexpPattern();return e.skip(s.Token.SLASH)?l.Node.createRegexpLiteralExpression(t,e.readRegexpFlags(),e.range(r,e.pos)):(this.error(a.DiagnosticCode._0_expected,e.range(),"/"),null)}case s.Token.FUNCTION:return this.parseFunctionExpression(e);case s.Token.CLASS:return this.parseClassExpression(e);default:return t==s.Token.ENDOFFILE?this.error(a.DiagnosticCode.Unexpected_end_of_text,e.range(r)):this.error(a.DiagnosticCode.Expression_expected,e.range()),null}}tryParseTypeArgumentsBeforeArguments(e){var t=e.mark();if(!e.skip(s.Token.LESSTHAN))return null;var r=null;do{if(e.peek()===s.Token.GREATERTHAN)break;let n=this.parseType(e,!0,!0);if(!n)return e.reset(t),null;r?r.push(n):r=[n]}while(e.skip(s.Token.COMMA));return e.skip(s.Token.GREATERTHAN)&&e.skip(s.Token.OPENPAREN)?r:(e.reset(t),null)}parseArguments(e){for(var t=new Array;!e.skip(s.Token.CLOSEPAREN);){let r=this.parseExpression(e,2);if(!r)return null;if(t.push(r),!e.skip(s.Token.COMMA)){if(e.skip(s.Token.CLOSEPAREN))break;return this.error(a.DiagnosticCode._0_expected,e.range(),")"),null}}return t}parseExpression(e,t=1){assert(0!=t);var r=this.parseExpressionStart(e);if(!r)return null;for(var n,i,o=(r=this.maybeParseCallExpression(e,r)).range.start,c=null;(i=u(n=e.peek()))>=t;){switch(e.next(),n){case s.Token.AS:{let t=this.parseType(e);if(!t)return null;r=l.Node.createAssertionExpression(l.AssertionKind.AS,r,t,e.range(o,e.pos));break}case s.Token.EXCLAMATION:r=l.Node.createAssertionExpression(l.AssertionKind.NONNULL,r,null,e.range(o,e.pos));break;case s.Token.INSTANCEOF:{let t=this.parseType(e);if(!t)return null;r=l.Node.createInstanceOfExpression(r,t,e.range(o,e.pos));break}case s.Token.OPENBRACKET:if(!(c=this.parseExpression(e)))return null;if(!e.skip(s.Token.CLOSEBRACKET))return this.error(a.DiagnosticCode._0_expected,e.range(),"]"),null;r=l.Node.createElementAccessExpression(r,c,e.range(o,e.pos));break;case s.Token.PLUS_PLUS:case s.Token.MINUS_MINUS:r.kind!=l.NodeKind.IDENTIFIER&&r.kind!=l.NodeKind.ELEMENTACCESS&&r.kind!=l.NodeKind.PROPERTYACCESS&&this.error(a.DiagnosticCode.The_operand_of_an_increment_or_decrement_operator_must_be_a_variable_or_a_property_access,r.range),r=l.Node.createUnaryPostfixExpression(n,r,e.range(o,e.pos));break;case s.Token.QUESTION:{let n=this.parseExpression(e);if(!n)return null;if(!e.skip(s.Token.COLON))return this.error(a.DiagnosticCode._0_expected,e.range(),":"),null;let i=this.parseExpression(e,t>1?2:1);if(!i)return null;r=l.Node.createTernaryExpression(r,n,i,e.range(o,e.pos));break}case s.Token.COMMA:{let t=[r];do{if(!(r=this.parseExpression(e,2)))return null;t.push(r)}while(e.skip(s.Token.COMMA));r=l.Node.createCommaExpression(t,e.range(o,e.pos));break}default:if(n==s.Token.DOT){if(e.skipIdentifier())c=l.Node.createIdentifierExpression(e.readIdentifier(),e.range());else if(!(c=this.parseExpression(e,p(n)?i:i+1)))return null;if(c.kind==l.NodeKind.IDENTIFIER)r=l.Node.createPropertyAccessExpression(r,c,e.range(o,e.pos));else{if(c.kind!=l.NodeKind.CALL)return this.error(a.DiagnosticCode.Identifier_expected,c.range),null;if(!(r=this.joinPropertyCall(e,o,r,c)))return null}}else{if(!(c=this.parseExpression(e,p(n)?i:i+1)))return null;r=l.Node.createBinaryExpression(n,r,c,e.range(o,e.pos))}}r=this.maybeParseCallExpression(e,r)}return r}joinPropertyCall(e,t,r,n){var i=n.expression;switch(i.kind){case l.NodeKind.IDENTIFIER:n.expression=l.Node.createPropertyAccessExpression(r,i,e.range(t,e.pos));break;case l.NodeKind.CALL:{let s=this.joinPropertyCall(e,t,r,i);if(!s)return null;n.expression=s,n.range=e.range(t,e.pos);break}default:return this.error(a.DiagnosticCode.Identifier_expected,n.range),null}return n}maybeParseCallExpression(e,t){if(l.nodeIsCallable(t.kind)){let r=null;for(;e.skip(s.Token.OPENPAREN)||l.nodeIsGenericCallable(t.kind)&&null!==(r=this.tryParseTypeArgumentsBeforeArguments(e));){let n=this.parseArguments(e);if(!n)break;t=l.Node.createCallExpression(t,r,n,e.range(t.range.start,e.pos))}}return t}skipStatement(e){for(e.peek(!0),e.nextTokenOnNewLine&&e.next();;){let t=e.peek(!0);if(t==s.Token.ENDOFFILE||t==s.Token.SEMICOLON){e.next();break}if(e.nextTokenOnNewLine)break;switch(e.next()){case s.Token.IDENTIFIER:e.readIdentifier();break;case s.Token.STRINGLITERAL:e.readString();break;case s.Token.INTEGERLITERAL:e.readInteger();break;case s.Token.FLOATLITERAL:e.readFloat();break;case s.Token.OPENBRACE:this.skipBlock(e)}}}skipBlock(e){var t=1,r=!0;do{switch(e.next()){case s.Token.ENDOFFILE:this.error(a.DiagnosticCode._0_expected,e.range(),"}"),r=!1;break;case s.Token.OPENBRACE:++t;break;case s.Token.CLOSEBRACE:--t||(r=!1);break;case s.Token.IDENTIFIER:e.readIdentifier();break;case s.Token.STRINGLITERAL:e.readString();break;case s.Token.INTEGERLITERAL:e.readInteger();break;case s.Token.FLOATLITERAL:e.readFloat()}}while(r)}}function u(e){switch(e){case s.Token.COMMA:return 1;case s.Token.EQUALS:case s.Token.PLUS_EQUALS:case s.Token.MINUS_EQUALS:case s.Token.ASTERISK_ASTERISK_EQUALS:case s.Token.ASTERISK_EQUALS:case s.Token.SLASH_EQUALS:case s.Token.PERCENT_EQUALS:case s.Token.LESSTHAN_LESSTHAN_EQUALS:case s.Token.GREATERTHAN_GREATERTHAN_EQUALS:case s.Token.GREATERTHAN_GREATERTHAN_GREATERTHAN_EQUALS:case s.Token.AMPERSAND_EQUALS:case s.Token.CARET_EQUALS:case s.Token.BAR_EQUALS:return 4;case s.Token.QUESTION:return 5;case s.Token.BAR_BAR:return 6;case s.Token.AMPERSAND_AMPERSAND:return 7;case s.Token.BAR:return 8;case s.Token.CARET:return 9;case s.Token.AMPERSAND:return 10;case s.Token.EQUALS_EQUALS:case s.Token.EXCLAMATION_EQUALS:case s.Token.EQUALS_EQUALS_EQUALS:case s.Token.EXCLAMATION_EQUALS_EQUALS:return 11;case s.Token.AS:case s.Token.IN:case s.Token.INSTANCEOF:case s.Token.LESSTHAN:case s.Token.GREATERTHAN:case s.Token.LESSTHAN_EQUALS:case s.Token.GREATERTHAN_EQUALS:return 12;case s.Token.LESSTHAN_LESSTHAN:case s.Token.GREATERTHAN_GREATERTHAN:case s.Token.GREATERTHAN_GREATERTHAN_GREATERTHAN:return 13;case s.Token.PLUS:case s.Token.MINUS:return 14;case s.Token.ASTERISK:case s.Token.SLASH:case s.Token.PERCENT:return 15;case s.Token.ASTERISK_ASTERISK:return 16;case s.Token.PLUS_PLUS:case s.Token.MINUS_MINUS:return 18;case s.Token.DOT:case s.Token.NEW:case s.Token.OPENBRACKET:case s.Token.EXCLAMATION:return 20}return 0}function p(e){switch(e){case s.Token.EQUALS:case s.Token.PLUS_EQUALS:case s.Token.MINUS_EQUALS:case s.Token.ASTERISK_ASTERISK_EQUALS:case s.Token.ASTERISK_EQUALS:case s.Token.SLASH_EQUALS:case s.Token.PERCENT_EQUALS:case s.Token.LESSTHAN_LESSTHAN_EQUALS:case s.Token.GREATERTHAN_GREATERTHAN_EQUALS:case s.Token.GREATERTHAN_GREATERTHAN_GREATERTHAN_EQUALS:case s.Token.AMPERSAND_EQUALS:case s.Token.CARET_EQUALS:case s.Token.BAR_EQUALS:case s.Token.QUESTION:case s.Token.ASTERISK_ASTERISK:return!0;default:return!1}}t.Parser=c,function(e){e[e.NONE=0]="NONE",e[e.COMMA=1]="COMMA",e[e.SPREAD=2]="SPREAD",e[e.YIELD=3]="YIELD",e[e.ASSIGNMENT=4]="ASSIGNMENT",e[e.CONDITIONAL=5]="CONDITIONAL",e[e.LOGICAL_OR=6]="LOGICAL_OR",e[e.LOGICAL_AND=7]="LOGICAL_AND",e[e.BITWISE_OR=8]="BITWISE_OR",e[e.BITWISE_XOR=9]="BITWISE_XOR",e[e.BITWISE_AND=10]="BITWISE_AND",e[e.EQUALITY=11]="EQUALITY",e[e.RELATIONAL=12]="RELATIONAL",e[e.SHIFT=13]="SHIFT",e[e.ADDITIVE=14]="ADDITIVE",e[e.MULTIPLICATIVE=15]="MULTIPLICATIVE",e[e.EXPONENTIATED=16]="EXPONENTIATED",e[e.UNARY_PREFIX=17]="UNARY_PREFIX",e[e.UNARY_POSTFIX=18]="UNARY_POSTFIX",e[e.CALL=19]="CALL",e[e.MEMBERACCESS=20]="MEMBERACCESS",e[e.GROUPING=21]="GROUPING"}(t.Precedence||(t.Precedence={}))},function(e,t,r){r(18),e.exports=r(28)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(19),r(21),r(22),r(23);const n=r(5);n.Module.prototype.toText=function(){return binaryen.wrapModule(this.ref).emitStackIR(!0)},n.Module.prototype.toAsmjs=function(){return binaryen.wrapModule(this.ref).emitAsmjs()}},function(e,t,r){(function(e){const t=e.Binaryen||r(20);for(var n in e.binaryen=t,t)(n.startsWith("_Binaryen")||n.startsWith("_Relooper"))&&(e[n]=t[n]);e.__memory_allocate=t._malloc,e.__memory_free=t._free,e.__memory_copy=t._memmove,e.__store=function(e,r){t.HEAPU8[e]=r},e.__load=function(e){return t.HEAPU8[e]}}).call(this,r(8))},function(t,r){t.exports=e},function(e,t,r){(function(e){var t="undefined"!=typeof window&&window||void 0!==e&&e||self;t.ASC_TARGET=2,t.ASC_NO_ASSERT=!1,t.ASC_MEMORY_BASE=0,t.ASC_OPTIMIZE_LEVEL=3,t.ASC_SHRINK_LEVEL=0,t.ASC_FEATURE_MUTABLE_GLOBAL=!1,t.ASC_FEATURE_SIGN_EXTENSION=!1,t.ASC_FEATURE_BULK_MEMORY=!1,t.ASC_FEATURE_SIMD=!1,t.ASC_FEATURE_THREADS=!1;var r=new Float64Array(1),n=new Uint32Array(r.buffer);function i(){Error.captureStackTrace?Error.captureStackTrace(this,i):this.stack=this.name+": "+this.message+"\n"+(new Error).stack}function s(e){this.message=e||"assertion failed",Error.captureStackTrace?Error.captureStackTrace(this,s):this.stack=this.name+": "+this.message+"\n"+(new Error).stack}function a(e,t){if(e===t){if(0!==e)return 0;e=1/e,t=1/t}else{var r=e!=e,n=t!=t;if(r|n)return r-n;null==e&&(e=String(e)),null==t&&(t=String(t))}return e>t?1:-1}Object.defineProperties(t.i8=function(e){return e<<24>>24},{MIN_VALUE:{value:-128,writable:!1},MAX_VALUE:{value:127,writable:!1}}),Object.defineProperties(t.i16=function(e){return e<<16>>16},{MIN_VALUE:{value:-32768,writable:!1},MAX_VALUE:{value:32767,writable:!1}}),Object.defineProperties(t.i32=t.isize=function(e){return 0|e},{MIN_VALUE:{value:-2147483648,writable:!1},MAX_VALUE:{value:2147483647,writable:!1}}),Object.defineProperties(t.u8=function(e){return 255&e},{MIN_VALUE:{value:0,writable:!1},MAX_VALUE:{value:255,writable:!1}}),Object.defineProperties(t.u16=function(e){return 65535&e},{MIN_VALUE:{value:0,writable:!1},MAX_VALUE:{value:65535,writable:!1}}),Object.defineProperties(t.u32=t.usize=function(e){return e>>>0},{MIN_VALUE:{value:0,writable:!1},MAX_VALUE:{value:4294967295,writable:!1}}),Object.defineProperties(t.bool=function(e){return!!e},{MIN_VALUE:{value:!1,writable:!1},MAX_VALUE:{value:!0,writable:!1}}),Object.defineProperties(t.f32=function(e){return Math.fround(e)},{EPSILON:{value:Math.fround(1.1920929e-7),writable:!1},MIN_VALUE:{value:Math.fround(14012985e-52),writable:!1},MAX_VALUE:{value:Math.fround(34028235e31),writable:!1},MIN_NORMAL_VALUE:{value:Math.fround(117549435e-46),writable:!1},MIN_SAFE_INTEGER:{value:-16777215,writable:!1},MAX_SAFE_INTEGER:{value:16777215,writable:!1}}),Object.defineProperties(t.f64=function(e){return+e},{EPSILON:{value:2220446049250313e-31,writable:!1},MIN_VALUE:{value:5e-324,writable:!1},MAX_VALUE:{value:17976931348623157e292,writable:!1},MIN_NORMAL_VALUE:{value:22250738585072014e-324,writable:!1},MIN_SAFE_INTEGER:{value:-9007199254740991,writable:!1},MAX_SAFE_INTEGER:{value:9007199254740991,writable:!1}}),t.clz=Math.clz32,t.ctz=function(e){var t=Math.clz32(e&-e);return e?31-t:t},t.popcnt=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},t.rotl=function(e,t){return e<<(t&=31)|e>>>32-t},t.rotr=function(e,t){return e>>>(t&=31)|e<<32-t},t.abs=Math.abs,t.max=Math.max,t.min=Math.min,t.ceil=Math.ceil,t.floor=Math.floor,t.nearest=function(e){return.5===Math.abs(e-Math.trunc(e))?2*Math.round(.5*e):Math.round(e)},t.select=function(e,t,r){return r?e:t},t.sqrt=Math.sqrt,t.trunc=Math.trunc,t.copysign=function(e,t){return Math.abs(e)*Math.sign(t)},t.bswap=function(e){var t=e>>8&16711935,r=(16711935&e)<<8;return(t=(e=t|r)>>16&65535)|(r=(65535&e)<<16)},t.bswap16=function(e){return e<<8&65280|e>>8&255|4294901760&e},i.prototype=Object.create(Error.prototype),i.prototype.name="UnreachableError",i.prototype.message="unreachable",t.unreachable=function(){throw new i},s.prototype=Object.create(Error.prototype),s.prototype.name="AssertionError",t.assert=function(e,t){if(e)return e;throw new s(t)},t.changetype=function(e){return e},String.fromCharCodes=function(e){return String.fromCharCode.apply(String,e)},String.fromCodePoints=function(e){return String.fromCodePoint.apply(String,e)},String.prototype.replaceAll||Object.defineProperty(String.prototype,"replaceAll",{value:function(e,t){var r=this.split(e).join(t);return e.length||(r=t+r+t),r}});const o=Array.prototype.sort;Array.prototype.sort=function(e){return o.call(this,e||a)},t.isInteger=Number.isInteger,t.isFloat=function(e){return"number"==typeof e},t.isNullable=function(e){return!0},t.isReference=function(e){return"object"==typeof e||"string"==typeof e},t.isFunction=function(e){return"function"==typeof e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isArray=Array.isArray,t.isArrayLike=function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&Math.trunc(e.length)===e.length},t.isDefined=function(e){return void 0!==e},t.isConstant=function(e){return!1},t.unchecked=function(e){return e},t.fmod=function(e,t){return e%t},t.fmodf=function(e,t){return Math.fround(e%t)},t.JSMath=Math,Object.defineProperties(t.JSMath,{sincos_sin:{value:0,writable:!0},sincos_cos:{value:0,writable:!0},signbit:{value:function(e){return r[0]=e,Boolean(n[1]>>>31&e==e)}},sincos:{value:function(e){this.sincos_sin=Math.sin(e),this.sincos_cos=Math.cos(e)}}}),t.memory=(()=>{var e=new Uint8Array(0),r=0;return{allocate:t.__memory_allocate||function(t){if(!(t>>>=0))return 0;if(r+t>e.length){var n=e;(e=new Uint8Array(Math.max(65536,e.length+t,2*e.length))).set(n)}var i=r;return 7&(r+=t)&&(r=1+(7|r)),i},fill:t.__memory_fill||function(t,r,n){e.fill(r,t,t+n)},free:t.__memory_free||function(e){},copy:t.__memory_copy||function(t,r,n){e.copyWithin(t,r,r+n)},reset:t.__memory_reset||function(){e=new Uint8Array(0),r=0}}})(),t.store=t.__store||function(e,t,r){HEAP[(0|e)+(0|r)]=t},t.load=t.__load||function(e,t){return HEAP[(0|e)+(0|t)]},t.unmanaged=function(){}}).call(this,r(8))},function(e,t,r){(function(e){const t=new Float64Array(1),r=new Float32Array(t.buffer),n=new Int32Array(t.buffer);e.f32_as_i32=function(e){return r[0]=e,n[0]},e.i32_as_f32=function(e){return n[0]=e,r[0]},e.f64_as_i64=function(e){return t[0]=e,i64_new(n[0],n[1])},e.i64_as_f64=function(e){return n[0]=i64_low(e),n[1]=i64_high(e),t[0]}}).call(this,r(8))},function(e,t,r){(function(e){const t=e.Long||r(24);e.i64_zero=t.ZERO,e.i64_one=t.ONE,e.i64_new=function(e,r){return t.fromBits(e,r)},e.i64_low=function(e){return e.low},e.i64_high=function(e){return e.high},e.i64_add=function(e,t){return e.add(t)},e.i64_sub=function(e,t){return e.sub(t)},e.i64_mul=function(e,t){return e.mul(t)},e.i64_div=function(e,t){return e.div(t)},e.i64_div_u=function(e,t){return e.toUnsigned().div(t.toUnsigned()).toSigned()},e.i64_rem=function(e,t){return e.mod(t)},e.i64_rem_u=function(e,t){return e.toUnsigned().mod(t.toUnsigned()).toSigned()},e.i64_and=function(e,t){return e.and(t)},e.i64_or=function(e,t){return e.or(t)},e.i64_xor=function(e,t){return e.xor(t)},e.i64_shl=function(e,t){return e.shl(t)},e.i64_shr=function(e,t){return e.shr(t)},e.i64_shr_u=function(e,t){return e.shru(t)},e.i64_not=function(e){return e.not()},e.i64_eq=function(e,t){return e.eq(t)},e.i64_ne=function(e,t){return e.ne(t)},e.i64_align=function(e,r){assert(r&&0==(r&r-1));var n=t.fromInt(r-1);return e.add(n).and(n.not())},e.i64_is_i8=function(e){return 0===e.high&&e.low>=0&&e.low<=i8.MAX_VALUE||-1===e.high&&e.low>=i8.MIN_VALUE&&e.low<0},e.i64_is_i16=function(e){return 0===e.high&&e.low>=0&&e.low<=i16.MAX_VALUE||-1===e.high&&e.low>=i16.MIN_VALUE&&e.low<0},e.i64_is_i32=function(e){return 0===e.high&&e.low>=0||-1===e.high&&e.low<0},e.i64_is_u8=function(e){return 0===e.high&&e.low>=0&&e.low<=u8.MAX_VALUE},e.i64_is_u16=function(e){return 0===e.high&&e.low>=0&&e.low<=u16.MAX_VALUE},e.i64_is_u32=function(e){return 0===e.high},e.i64_is_bool=function(e){return 0===e.high&&(0===e.low||1===e.low)};const n=t.fromNumber(f32.MIN_SAFE_INTEGER),i=t.fromNumber(f32.MAX_SAFE_INTEGER);e.i64_is_f32=function(e){return e.gte(n)&&e.lte(i)};const s=t.fromNumber(f64.MIN_SAFE_INTEGER),a=t.fromNumber(f64.MAX_SAFE_INTEGER);e.i64_is_f64=function(e){return e.gte(s)&&e.lte(a)},e.i64_to_f32=function(t){return e.Math.fround(t.toNumber())},e.i64_to_f64=function(e){return e.toNumber()},e.i64_to_string=function(e,t){return(t?e.toUnsigned():e).toString(10)}}).call(this,r(8))},function(e,t){e.exports=n;var r=null;try{r=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function i(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=i;var s={},a={};function o(e,t){var r,n,i;return t?(i=0<=(e>>>=0)&&e<256)&&(n=a[e])?n:(r=c(e,(0|e)<0?-1:0,!0),i&&(a[e]=r),r):(i=-128<=(e|=0)&&e<128)&&(n=s[e])?n:(r=c(e,e<0?-1:0,!1),i&&(s[e]=r),r)}function l(e,t){if(isNaN(e))return t?g:m;if(t){if(e<0)return g;if(e>=d)return b}else{if(e<=-y)return A;if(e+1>=y)return x}return e<0?l(-e,t).neg():c(e%h|0,e/h|0,t)}function c(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=l,n.fromBits=c;var u=Math.pow;function p(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"==typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return p(e.substring(1),t,r).neg();for(var i=l(u(r,8)),s=m,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),c=parseInt(e.substring(a,a+o),r);if(o<8){var _=l(u(r,o));s=s.mul(_).add(l(c))}else s=(s=s.mul(i)).add(l(c))}return s.unsigned=t,s}function _(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?p(e,t):c(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=p,n.fromValue=_;var h=4294967296,d=h*h,y=d/2,T=o(1<<24),m=o(0);n.ZERO=m;var g=o(0,!0);n.UZERO=g;var E=o(1);n.ONE=E;var f=o(1,!0);n.UONE=f;var I=o(-1);n.NEG_ONE=I;var x=c(-1,2147483647,!1);n.MAX_VALUE=x;var b=c(-1,-1,!0);n.MAX_UNSIGNED_VALUE=b;var A=c(0,-2147483648,!1);n.MIN_VALUE=A;var N=n.prototype;N.toInt=function(){return this.unsigned?this.low>>>0:this.low},N.toNumber=function(){return this.unsigned?(this.high>>>0)*h+(this.low>>>0):this.high*h+(this.low>>>0)},N.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(A)){var t=l(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=l(u(e,6),this.unsigned),s=this,a="";;){var o=s.div(i),c=(s.sub(o.mul(i)).toInt()>>>0).toString(e);if((s=o).isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}},N.getHighBits=function(){return this.high},N.getHighBitsUnsigned=function(){return this.high>>>0},N.getLowBits=function(){return this.low},N.getLowBitsUnsigned=function(){return this.low>>>0},N.getNumBitsAbs=function(){if(this.isNegative())return this.eq(A)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},N.isZero=function(){return 0===this.high&&0===this.low},N.eqz=N.isZero,N.isNegative=function(){return!this.unsigned&&this.high<0},N.isPositive=function(){return this.unsigned||this.high>=0},N.isOdd=function(){return 1==(1&this.low)},N.isEven=function(){return 0==(1&this.low)},N.equals=function(e){return i(e)||(e=_(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},N.eq=N.equals,N.notEquals=function(e){return!this.eq(e)},N.neq=N.notEquals,N.ne=N.notEquals,N.lessThan=function(e){return this.comp(e)<0},N.lt=N.lessThan,N.lessThanOrEqual=function(e){return this.comp(e)<=0},N.lte=N.lessThanOrEqual,N.le=N.lessThanOrEqual,N.greaterThan=function(e){return this.comp(e)>0},N.gt=N.greaterThan,N.greaterThanOrEqual=function(e){return this.comp(e)>=0},N.gte=N.greaterThanOrEqual,N.ge=N.greaterThanOrEqual,N.compare=function(e){if(i(e)||(e=_(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},N.comp=N.compare,N.negate=function(){return!this.unsigned&&this.eq(A)?A:this.not().add(E)},N.neg=N.negate,N.add=function(e){i(e)||(e=_(e));var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,s=65535&this.low,a=e.high>>>16,o=65535&e.high,l=e.low>>>16,u=0,p=0,h=0,d=0;return h+=(d+=s+(65535&e.low))>>>16,p+=(h+=n+l)>>>16,u+=(p+=r+o)>>>16,u+=t+a,c((h&=65535)<<16|(d&=65535),(u&=65535)<<16|(p&=65535),this.unsigned)},N.subtract=function(e){return i(e)||(e=_(e)),this.add(e.neg())},N.sub=N.subtract,N.multiply=function(e){if(this.isZero())return m;if(i(e)||(e=_(e)),r)return c(r.mul(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned);if(e.isZero())return m;if(this.eq(A))return e.isOdd()?A:m;if(e.eq(A))return this.isOdd()?A:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(T)&&e.lt(T))return l(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,s=this.low>>>16,a=65535&this.low,o=e.high>>>16,u=65535&e.high,p=e.low>>>16,h=65535&e.low,d=0,y=0,g=0,E=0;return g+=(E+=a*h)>>>16,y+=(g+=s*h)>>>16,g&=65535,y+=(g+=a*p)>>>16,d+=(y+=n*h)>>>16,y&=65535,d+=(y+=s*p)>>>16,y&=65535,d+=(y+=a*u)>>>16,d+=t*h+n*p+s*u+a*o,c((g&=65535)<<16|(E&=65535),(d&=65535)<<16|(y&=65535),this.unsigned)},N.mul=N.multiply,N.divide=function(e){if(i(e)||(e=_(e)),e.isZero())throw Error("division by zero");var t,n,s;if(r)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?r.div_u:r.div_s)(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:m;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return f;s=g}else{if(this.eq(A))return e.eq(E)||e.eq(I)?A:e.eq(A)?E:(t=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?E:I:(n=this.sub(e.mul(t)),s=t.add(n.div(e)));if(e.eq(A))return this.unsigned?g:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=m}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(t)/Math.LN2),o=a<=48?1:u(2,a-48),p=l(t),h=p.mul(e);h.isNegative()||h.gt(n);)h=(p=l(t-=o,this.unsigned)).mul(e);p.isZero()&&(p=E),s=s.add(p),n=n.sub(h)}return s},N.div=N.divide,N.modulo=function(e){return i(e)||(e=_(e)),r?c((this.unsigned?r.rem_u:r.rem_s)(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},N.mod=N.modulo,N.rem=N.modulo,N.not=function(){return c(~this.low,~this.high,this.unsigned)},N.and=function(e){return i(e)||(e=_(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},N.or=function(e){return i(e)||(e=_(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},N.xor=function(e){return i(e)||(e=_(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},N.shiftLeft=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},N.shl=N.shiftLeft,N.shiftRight=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},N.shr=N.shiftRight,N.shiftRightUnsigned=function(e){if(i(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?c(this.low>>>e|t<<32-e,t>>>e,this.unsigned):c(32===e?t:t>>>e-32,0,this.unsigned)},N.shru=N.shiftRightUnsigned,N.shr_u=N.shiftRightUnsigned,N.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},N.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},N.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},N.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},N.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.SIGN_EXTENSION=1]="SIGN_EXTENSION",e[e.MUTABLE_GLOBALS=2]="MUTABLE_GLOBALS",e[e.NONTRAPPING_F2I=4]="NONTRAPPING_F2I",e[e.BULK_MEMORY=8]="BULK_MEMORY",e[e.SIMD=16]="SIMD",e[e.THREADS=32]="THREADS",e[e.EXCEPTION_HANDLING=64]="EXCEPTION_HANDLING",e[e.TAIL_CALLS=128]="TAIL_CALLS",e[e.REFERENCE_TYPES=256]="REFERENCE_TYPES"}(t.Feature||(t.Feature={})),t.featureToString=function(e){switch(e){case 1:return"sign-extension";case 2:return"mutable-globals";case 4:return"nontrapping-f2i";case 8:return"bulk-memory";case 16:return"simd";case 32:return"threads";case 64:return"exception-handling";case 128:return"tail-calls";case 256:return"reference-types"}return assert(!1),""}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.WASM32=0]="WASM32",e[e.WASM64=1]="WASM64",e[e.JS=2]="JS"}(t.Target||(t.Target={}))},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});let i=class{};i=n([unmanaged],i),t.Typeinfo=i,function(e){e[e.NONE=0]="NONE",e[e.ARRAYBUFFERVIEW=1]="ARRAYBUFFERVIEW",e[e.ARRAY=2]="ARRAY",e[e.SET=4]="SET",e[e.MAP=8]="MAP",e[e.ACYCLIC=16]="ACYCLIC",e[e.VALUE_ALIGN_0=32]="VALUE_ALIGN_0",e[e.VALUE_ALIGN_1=64]="VALUE_ALIGN_1",e[e.VALUE_ALIGN_2=128]="VALUE_ALIGN_2",e[e.VALUE_ALIGN_3=256]="VALUE_ALIGN_3",e[e.VALUE_ALIGN_4=512]="VALUE_ALIGN_4",e[e.VALUE_SIGNED=1024]="VALUE_SIGNED",e[e.VALUE_FLOAT=2048]="VALUE_FLOAT",e[e.VALUE_NULLABLE=4096]="VALUE_NULLABLE",e[e.VALUE_MANAGED=8192]="VALUE_MANAGED",e[e.KEY_ALIGN_0=16384]="KEY_ALIGN_0",e[e.KEY_ALIGN_1=32768]="KEY_ALIGN_1",e[e.KEY_ALIGN_2=65536]="KEY_ALIGN_2",e[e.KEY_ALIGN_3=131072]="KEY_ALIGN_3",e[e.KEY_ALIGN_4=262144]="KEY_ALIGN_4",e[e.KEY_SIGNED=524288]="KEY_SIGNED",e[e.KEY_FLOAT=1048576]="KEY_FLOAT",e[e.KEY_NULLABLE=2097152]="KEY_NULLABLE",e[e.KEY_MANAGED=4194304]="KEY_MANAGED"}(t.TypeinfoFlags||(t.TypeinfoFlags={}))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0});const i=r(11),s=r(14),a=r(15),o=r(2);t.formatDiagnostic=o.formatDiagnosticMessage;const l=r(16);t.parseFile=function(e,t,r=!1,n=null){return n||(n=new l.Parser),n.parseFile(e,t,r),n},t.nextFile=function(e){return e.nextFile()},t.getDependee=function(e,t){return e.getDependee(t)},t.nextDiagnostic=function(e){var t=e.program;return t.diagnosticsOffset<t.diagnostics.length?t.diagnostics[t.diagnosticsOffset++]:null},t.isInfo=function(e){return e.category==o.DiagnosticCategory.INFO},t.isWarning=function(e){return e.category==o.DiagnosticCategory.WARNING},t.isError=function(e){return e.category==o.DiagnosticCategory.ERROR},t.createOptions=function(){return new i.Options},t.setTarget=function(e,t){e.target=t},t.setNoAssert=function(e,t){e.noAssert=t},t.setImportMemory=function(e,t){e.importMemory=t},t.setSharedMemory=function(e,t){e.sharedMemory=t},t.setImportTable=function(e,t){e.importTable=t},t.setSourceMap=function(e,t){e.sourceMap=t},t.setMemoryBase=function(e,t){e.memoryBase=t},t.setGlobalAlias=function(e,t,r){var n=e.globalAliases;n||(e.globalAliases=n=new Map),n.set(t,r)},t.setExplicitStart=function(e,t){e.explicitStart=t},t.setNoUnsafe=function(e,t){e.noUnsafe=t},t.FEATURE_SIGN_EXTENSION=1,t.FEATURE_MUTABLE_GLOBALS=2,t.FEATURE_NONTRAPPING_F2I=4,t.FEATURE_BULK_MEMORY=8,t.FEATURE_SIMD=16,t.FEATURE_THREADS=32,t.FEATURE_EXCEPTION_HANDLING=64,t.FEATURE_TAIL_CALLS=128,t.FEATURE_REFERENCE_TYPES=256,t.enableFeature=function(e,t){e.features|=t},t.disableFeature=function(e,t){e.features&=~t},t.setOptimizeLevelHints=function(e,t,r){e.optimizeLevelHint=t,e.shrinkLevelHint=r},t.finishParsing=function(e){return e.finish()},t.getSource=function(e,t){return e.getSource(t)},t.compileProgram=function(e,t=null){return new i.Compiler(e,t).compile()},t.decompileModule=function(e){var t=new s.Decompiler;return t.decompile(e),t.finish()},t.buildIDL=function(e){return a.IDLBuilder.build(e)},t.buildTSD=function(e){return a.TSDBuilder.build(e)},t.buildRTTI=function(e){var t=new Array;t.push('{\n  "names": [\n');for(let r of e.managedClasses.values())t.push('    "'),t.push(r.internalName),t.push('",\n');t.push('  ],\n  "base": [\n');for(let r of e.managedClasses.values()){let e=r.base;t.push("    "),t.push(e?e.id.toString():"0"),t.push(",\n")}t.push('  ],\n  "flags": [\n');for(let r of e.managedClasses.values())t.push("    "),t.push(r.rttiFlags.toString()),t.push(",\n");return t.push("  ]\n}\n"),t.join("")};var c=r(0);t.LIBRARY_PREFIX=c.LIBRARY_PREFIX,n(r(3)),n(r(0)),n(r(11)),n(r(14)),n(r(15)),n(r(12)),n(r(2)),n(r(10)),n(r(5)),n(r(16)),n(r(4)),n(r(9)),n(r(7)),n(r(6)),n(r(1))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bitsetIs=function(e,t){return assert(t>=0&&t<64),i64_ne(i64_and(e,i64_shl(i64_one,i64_new(t))),i64_zero)},t.bitsetSet=function(e,t,r){return assert(t>=0&&t<64),r?i64_or(e,i64_shl(i64_one,i64_new(t))):i64_and(e,i64_not(i64_shl(i64_one,i64_new(t))))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NULL=0]="NULL",e[e.LINEFEED=10]="LINEFEED",e[e.CARRIAGERETURN=13]="CARRIAGERETURN",e[e.LINESEPARATOR=8232]="LINESEPARATOR",e[e.PARAGRAPHSEPARATOR=8233]="PARAGRAPHSEPARATOR",e[e.NEXTLINE=133]="NEXTLINE",e[e.SPACE=32]="SPACE",e[e.NONBREAKINGSPACE=160]="NONBREAKINGSPACE",e[e.ENQUAD=8192]="ENQUAD",e[e.EMQUAD=8193]="EMQUAD",e[e.ENSPACE=8194]="ENSPACE",e[e.EMSPACE=8195]="EMSPACE",e[e.THREEPEREMSPACE=8196]="THREEPEREMSPACE",e[e.FOURPEREMSPACE=8197]="FOURPEREMSPACE",e[e.SIXPEREMSPACE=8198]="SIXPEREMSPACE",e[e.FIGURESPACE=8199]="FIGURESPACE",e[e.PUNCTUATIONSPACE=8200]="PUNCTUATIONSPACE",e[e.THINSPACE=8201]="THINSPACE",e[e.HAIRSPACE=8202]="HAIRSPACE",e[e.ZEROWIDTHSPACE=8203]="ZEROWIDTHSPACE",e[e.NARROWNOBREAKSPACE=8239]="NARROWNOBREAKSPACE",e[e.IDEOGRAPHICSPACE=12288]="IDEOGRAPHICSPACE",e[e.MATHEMATICALSPACE=8287]="MATHEMATICALSPACE",e[e.OGHAM=5760]="OGHAM",e[e._=95]="_",e[e._0=48]="_0",e[e._1=49]="_1",e[e._2=50]="_2",e[e._3=51]="_3",e[e._4=52]="_4",e[e._5=53]="_5",e[e._6=54]="_6",e[e._7=55]="_7",e[e._8=56]="_8",e[e._9=57]="_9",e[e.a=97]="a",e[e.b=98]="b",e[e.c=99]="c",e[e.d=100]="d",e[e.e=101]="e",e[e.f=102]="f",e[e.g=103]="g",e[e.h=104]="h",e[e.i=105]="i",e[e.j=106]="j",e[e.k=107]="k",e[e.l=108]="l",e[e.m=109]="m",e[e.n=110]="n",e[e.o=111]="o",e[e.p=112]="p",e[e.q=113]="q",e[e.r=114]="r",e[e.s=115]="s",e[e.t=116]="t",e[e.u=117]="u",e[e.v=118]="v",e[e.w=119]="w",e[e.x=120]="x",e[e.y=121]="y",e[e.z=122]="z",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.AMPERSAND=38]="AMPERSAND",e[e.ASTERISK=42]="ASTERISK",e[e.AT=64]="AT",e[e.BACKSLASH=92]="BACKSLASH",e[e.BACKTICK=96]="BACKTICK",e[e.BAR=124]="BAR",e[e.CARET=94]="CARET",e[e.CLOSEBRACE=125]="CLOSEBRACE",e[e.CLOSEBRACKET=93]="CLOSEBRACKET",e[e.CLOSEPAREN=41]="CLOSEPAREN",e[e.COLON=58]="COLON",e[e.COMMA=44]="COMMA",e[e.DOLLAR=36]="DOLLAR",e[e.DOT=46]="DOT",e[e.DOUBLEQUOTE=34]="DOUBLEQUOTE",e[e.EQUALS=61]="EQUALS",e[e.EXCLAMATION=33]="EXCLAMATION",e[e.GREATERTHAN=62]="GREATERTHAN",e[e.HASH=35]="HASH",e[e.LESSTHAN=60]="LESSTHAN",e[e.MINUS=45]="MINUS",e[e.OPENBRACE=123]="OPENBRACE",e[e.OPENBRACKET=91]="OPENBRACKET",e[e.OPENPAREN=40]="OPENPAREN",e[e.PERCENT=37]="PERCENT",e[e.PLUS=43]="PLUS",e[e.QUESTION=63]="QUESTION",e[e.SEMICOLON=59]="SEMICOLON",e[e.SINGLEQUOTE=39]="SINGLEQUOTE",e[e.SLASH=47]="SLASH",e[e.TILDE=126]="TILDE",e[e.BACKSPACE=8]="BACKSPACE",e[e.FORMFEED=12]="FORMFEED",e[e.BYTEORDERMARK=65279]="BYTEORDERMARK",e[e.TAB=9]="TAB",e[e.VERTICALTAB=11]="VERTICALTAB"}(t.CharCode||(t.CharCode={})),t.isLineBreak=function(e){switch(e){case 10:case 13:case 8232:case 8233:return!0;default:return!1}},t.isWhiteSpace=function(e){switch(e){case 32:case 9:case 11:case 12:case 160:case 133:case 5760:case 8239:case 8287:case 12288:case 65279:return!0;default:return e>=8192&&e<=8203}},t.isDecimalDigit=function(e){return e>=48&&e<=57},t.isOctalDigit=function(e){return e>=48&&e<=55},t.isIdentifierStart=function(e){return e>=97&&e<=122||e>=65&&e<=90||95==e||36==e||e>127&&(!((t=e)<0||t>65535)&&s(t,n));var t},t.isKeywordCharacter=function(e){return e>=97&&e<=122},t.isIdentifierPart=function(e){return e>=97&&e<=122||e>=65&&e<=90||e>=48&&e<=57||95==e||36==e||e>127&&(!((t=e)<0||t>65535)&&s(t,i));var t};const n=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,880,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1162,1319,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1568,1610,1646,1647,1649,1747,1749,1749,1765,1766,1774,1775,1786,1788,1791,1791,1808,1808,1810,1839,1869,1957,1969,1969,1994,2026,2036,2037,2042,2042,2048,2069,2074,2074,2084,2084,2088,2088,2112,2136,2208,2208,2210,2220,2308,2361,2365,2365,2384,2384,2392,2401,2417,2423,2425,2431,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2493,2493,2510,2510,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2785,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2877,2877,2908,2909,2911,2913,2929,2929,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3024,3024,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3133,3160,3161,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3261,3261,3294,3294,3296,3297,3313,3314,3333,3340,3342,3344,3346,3386,3389,3389,3406,3406,3424,3425,3450,3455,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3807,3840,3840,3904,3911,3913,3948,3976,3980,4096,4138,4159,4159,4176,4181,4186,4189,4193,4193,4197,4198,4206,4208,4213,4225,4238,4238,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5905,5920,5937,5952,5969,5984,5996,5998,6e3,6016,6067,6103,6103,6108,6108,6176,6263,6272,6312,6314,6314,6320,6389,6400,6428,6480,6509,6512,6516,6528,6571,6593,6599,6656,6678,6688,6740,6823,6823,6917,6963,6981,6987,7043,7072,7086,7087,7098,7141,7168,7203,7245,7247,7258,7293,7401,7404,7406,7409,7413,7414,7424,7615,7680,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8305,8305,8319,8319,8336,8348,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11502,11506,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11648,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11823,11823,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42527,42538,42539,42560,42606,42623,42647,42656,42735,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43009,43011,43013,43015,43018,43020,43042,43072,43123,43138,43187,43250,43255,43259,43259,43274,43301,43312,43334,43360,43388,43396,43442,43471,43471,43520,43560,43584,43586,43588,43595,43616,43638,43642,43642,43648,43695,43697,43697,43701,43702,43705,43709,43712,43712,43714,43714,43739,43741,43744,43754,43762,43764,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44002,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],i=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,768,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1155,1159,1162,1319,1329,1366,1369,1369,1377,1415,1425,1469,1471,1471,1473,1474,1476,1477,1479,1479,1488,1514,1520,1522,1552,1562,1568,1641,1646,1747,1749,1756,1759,1768,1770,1788,1791,1791,1808,1866,1869,1969,1984,2037,2042,2042,2048,2093,2112,2139,2208,2208,2210,2220,2276,2302,2304,2403,2406,2415,2417,2423,2425,2431,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2500,2503,2504,2507,2510,2519,2519,2524,2525,2527,2531,2534,2545,2561,2563,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2641,2641,2649,2652,2654,2654,2662,2677,2689,2691,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2787,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2876,2884,2887,2888,2891,2893,2902,2903,2908,2909,2911,2915,2918,2927,2929,2929,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3006,3010,3014,3016,3018,3021,3024,3024,3031,3031,3046,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3140,3142,3144,3146,3149,3157,3158,3160,3161,3168,3171,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3260,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3299,3302,3311,3313,3314,3330,3331,3333,3340,3342,3344,3346,3386,3389,3396,3398,3400,3402,3406,3415,3415,3424,3427,3430,3439,3450,3455,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3807,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3948,3953,3972,3974,3991,3993,4028,4038,4038,4096,4169,4176,4253,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4957,4959,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5908,5920,5940,5952,5971,5984,5996,5998,6e3,6002,6003,6016,6099,6103,6103,6108,6109,6112,6121,6155,6157,6160,6169,6176,6263,6272,6314,6320,6389,6400,6428,6432,6443,6448,6459,6470,6509,6512,6516,6528,6571,6576,6601,6608,6617,6656,6683,6688,6750,6752,6780,6783,6793,6800,6809,6823,6823,6912,6987,6992,7001,7019,7027,7040,7155,7168,7223,7232,7241,7245,7293,7376,7378,7380,7414,7424,7654,7676,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8204,8205,8255,8256,8276,8276,8305,8305,8319,8319,8336,8348,8400,8412,8417,8417,8421,8432,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11647,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11744,11775,11823,11823,12293,12295,12321,12335,12337,12341,12344,12348,12353,12438,12441,12442,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42539,42560,42607,42612,42621,42623,42647,42655,42737,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43047,43072,43123,43136,43204,43216,43225,43232,43255,43259,43259,43264,43309,43312,43347,43360,43388,43392,43456,43471,43481,43520,43574,43584,43597,43600,43609,43616,43638,43642,43643,43648,43714,43739,43741,43744,43759,43762,43766,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44010,44012,44013,44016,44025,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65024,65039,65056,65062,65075,65076,65101,65103,65136,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500];function s(e,t){if(e<t[0])return!1;for(var r,n,i=0,s=t.length;i+1<s;){if(r=i+(s-i>>1),(n=t[r-=1&r])<=e&&e<=t[r+1])return!0;e<n?s=r:i=r+2}return!1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeArray=function(e=null){if(e){let t=new Array(e.length);for(let r=0,n=e.length;r<n;++r)unchecked(t[r]=e[r]);return t}return new Array},t.makeSet=function(e=null){if(e){let t=new Set;for(let r of e)t.add(r);return t}return new Set},t.makeMap=function(e=null,t=null){var r=new Map;if(e){for(let[t,n]of e)r.set(t,n);if(t)for(let[e,n]of t)r.set(e,n)}else if(t)for(let[e,n]of t)r.set(e,n);return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=47;function s(e){for(var t,r=0,n=e.length;r+1<n&&46==e.charCodeAt(r)&&e.charCodeAt(r+1)==i;)r+=2;for((r>0||n<e.length)&&(e=e.substring(r,n),n-=r,r=0);r+1<n;){if(t=!1,e.charCodeAt(r)==i&&46==e.charCodeAt(r+1)){if((t=r+2==n)||r+2<n&&e.charCodeAt(r+2)==i){e=t?e.substring(0,r):e.substring(0,r)+e.substring(r+2),n-=2;continue}if((t=r+3==n)&&46==e.charCodeAt(r+2)||r+3<n&&46==e.charCodeAt(r+2)&&e.charCodeAt(r+3)==i){let s=r;for(;--s>=0;)if(e.charCodeAt(s)==i){r-s==3&&46==e.charCodeAt(s+1)&&46==e.charCodeAt(s+2)||(e=t?e.substring(0,s):e.substring(0,s)+e.substring(r+3),n-=r+3-s,r=s-1);break}if(s<0&&r>0&&(2!=r||46!=e.charCodeAt(0)||46!=e.charCodeAt(1))){n=(e=e.substring(r+4)).length;continue}}}r++}return n>0?e:"."}function a(e){var t=e.length;if(t<=1){if(0==t)return".";if(e.charCodeAt(0)==i)return e}for(;--t>0;)if(e.charCodeAt(t)==i)return e.substring(0,t);return"."}t.normalizePath=s,t.resolvePath=function(e,t){return e.startsWith("std/")?e:s(a(t)+n.PATH_DELIMITER+e)},t.dirname=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n="  ",i="    ",s="        ";t.indent=function(e,t){for(;t>=4;)e.push(s),t-=4;t>=2&&(e.push(i),t-=2),t&&e.push(n)}},function(e,t,r){"use strict";function n(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}function i(e,t,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function s(e,t){var r=n(e,t),i=n(e,t+4);return i64_new(r,i)}Object.defineProperty(t,"__esModule",{value:!0}),t.readI8=function(e,t){return e[t]},t.writeI8=function(e,t,r){t[r]=e},t.readI16=function(e,t){return e[t]|e[t+1]<<8},t.writeI16=function(e,t,r){t[r]=e,t[r+1]=e>>>8},t.readI32=n,t.writeI32=i,t.readI64=s,t.writeI64=function(e,t,r){i(i64_low(e),t,r),i(i64_high(e),t,r+4)},t.readF32=function(e,t){return i32_as_f32(n(e,t))},t.writeF32=function(e,t,r){i(f32_as_i32(e),t,r)},t.readF64=function(e,t){return i64_as_f64(s(e,t))},t.writeF64=function(e,t,r){var n=f64_as_i64(e);i(i64_low(n),t,r),i(i64_high(n),t,r+4)}}])}));
//# sourceMappingURL=assemblyscript.js.map